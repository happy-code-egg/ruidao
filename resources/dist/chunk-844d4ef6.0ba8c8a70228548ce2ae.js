(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-844d4ef6"],{2260:function(t,e,a){"use strict";a.r(e);var l=function(){var t=this,e=t._self._c;return e("div",{staticClass:"invoice-pending-container"},[e("div",{staticClass:"body-part-search"},[e("el-form",{attrs:{model:t.searchForm,"label-width":"100px"}},[e("el-row",[e("el-col",{attrs:{span:6}},[e("el-form-item",{attrs:{label:"申请单号"}},[e("el-input",{attrs:{size:"small",placeholder:"请输入申请单号"},model:{value:t.searchForm.applicationNo,callback:function(e){t.$set(t.searchForm,"applicationNo",e)},expression:"searchForm.applicationNo"}})],1)],1),e("el-col",{attrs:{span:6}},[e("el-form-item",{attrs:{label:"申请人"}},[e("el-input",{attrs:{size:"small",placeholder:"请输入申请人"},model:{value:t.searchForm.applicant,callback:function(e){t.$set(t.searchForm,"applicant",e)},expression:"searchForm.applicant"}})],1)],1),e("el-col",{attrs:{span:6}},[e("el-form-item",{attrs:{label:"客户名称"}},[e("el-input",{attrs:{size:"small",placeholder:"请输入客户名称"},model:{value:t.searchForm.clientName,callback:function(e){t.$set(t.searchForm,"clientName",e)},expression:"searchForm.clientName"}})],1)],1),e("el-col",{attrs:{span:6}},[e("el-form-item",{attrs:{label:"所属部门"}},[e("el-select",{attrs:{size:"small",placeholder:"请选择"},model:{value:t.searchForm.department,callback:function(e){t.$set(t.searchForm,"department",e)},expression:"searchForm.department"}},[e("el-option",{attrs:{label:"信息与商务管理学院",value:"info_management"}}),e("el-option",{attrs:{label:"财务部",value:"finance"}}),e("el-option",{attrs:{label:"商务部",value:"business"}}),e("el-option",{attrs:{label:"技术部",value:"technology"}})],1)],1)],1)],1),e("el-row",[e("el-col",{attrs:{span:6}},[e("el-form-item",{attrs:{label:"发票类型"}},[e("el-select",{attrs:{size:"small",placeholder:"请选择"},model:{value:t.searchForm.invoiceType,callback:function(e){t.$set(t.searchForm,"invoiceType",e)},expression:"searchForm.invoiceType"}},[e("el-option",{attrs:{label:"增值税专用发票",value:"special"}}),e("el-option",{attrs:{label:"增值税普通发票",value:"general"}}),e("el-option",{attrs:{label:"电子发票",value:"electronic"}})],1)],1)],1),e("el-col",{attrs:{span:6}},[e("el-form-item",{attrs:{label:"流程状态"}},[e("el-select",{attrs:{size:"small",placeholder:"请选择"},model:{value:t.searchForm.flowStatus,callback:function(e){t.$set(t.searchForm,"flowStatus",e)},expression:"searchForm.flowStatus"}},[e("el-option",{attrs:{label:"审核中",value:"reviewing"}}),e("el-option",{attrs:{label:"财务审核",value:"finance_review"}}),e("el-option",{attrs:{label:"领导审批",value:"leader_approve"}}),e("el-option",{attrs:{label:"已退回",value:"returned"}})],1)],1)],1),e("el-col",{attrs:{span:6}},[e("el-form-item",{attrs:{label:"优先级"}},[e("el-select",{attrs:{size:"small",placeholder:"请选择"},model:{value:t.searchForm.priority,callback:function(e){t.$set(t.searchForm,"priority",e)},expression:"searchForm.priority"}},[e("el-option",{attrs:{label:"紧急",value:"urgent"}}),e("el-option",{attrs:{label:"普通",value:"normal"}}),e("el-option",{attrs:{label:"低",value:"low"}})],1)],1)],1),e("el-col",{attrs:{span:6}},[e("el-form-item",{attrs:{label:"申请时间"}},[e("el-date-picker",{attrs:{size:"small",type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期"},model:{value:t.searchForm.applicationDate,callback:function(e){t.$set(t.searchForm,"applicationDate",e)},expression:"searchForm.applicationDate"}})],1)],1)],1)],1),e("div",{staticClass:"part-search-buttons"},[e("el-button",{attrs:{size:"small",type:"primary"},on:{click:t.handleSearch}},[t._v("查询")]),e("el-button",{attrs:{size:"small"},on:{click:t.handleReset}},[t._v("重置")]),e("el-button",{attrs:{size:"small",type:"success",disabled:0===t.multipleSelection.length},on:{click:t.handleBatchApprove}},[t._v("批量通过")]),e("el-button",{attrs:{size:"small",type:"warning",disabled:0===t.multipleSelection.length},on:{click:t.handleBatchReject}},[t._v("批量退回")])],1)],1),e("div",{staticClass:"body-part-content"},[e("div",{staticClass:"part-table-header"},[e("div",{staticClass:"part-table-title"},[t._v(" 待处理发票申请 "),e("el-badge",{staticClass:"badge-margin",attrs:{value:t.pendingCount,type:"warning"}})],1),e("div",{staticClass:"part-table-buttons"},[e("el-button",{attrs:{size:"small",type:"info"},on:{click:t.handleRefresh}},[e("i",{staticClass:"el-icon-refresh"}),t._v(" 刷新 ")])],1)]),e("div",{staticClass:"workbench-stats"},[e("el-row",{attrs:{gutter:20}},[e("el-col",{attrs:{span:6}},[e("div",{staticClass:"stat-card reviewing"},[e("div",{staticClass:"stat-icon"},[e("i",{staticClass:"el-icon-document-checked"})]),e("div",{staticClass:"stat-content"},[e("div",{staticClass:"stat-value"},[t._v(t._s(t.stats.reviewing))]),e("div",{staticClass:"stat-label"},[t._v("待我审核")])])])]),e("el-col",{attrs:{span:6}},[e("div",{staticClass:"stat-card urgent"},[e("div",{staticClass:"stat-icon"},[e("i",{staticClass:"el-icon-warning"})]),e("div",{staticClass:"stat-content"},[e("div",{staticClass:"stat-value"},[t._v(t._s(t.stats.urgent))]),e("div",{staticClass:"stat-label"},[t._v("紧急处理")])])])]),e("el-col",{attrs:{span:6}},[e("div",{staticClass:"stat-card overdue"},[e("div",{staticClass:"stat-icon"},[e("i",{staticClass:"el-icon-time"})]),e("div",{staticClass:"stat-content"},[e("div",{staticClass:"stat-value"},[t._v(t._s(t.stats.overdue))]),e("div",{staticClass:"stat-label"},[t._v("超时处理")])])])]),e("el-col",{attrs:{span:6}},[e("div",{staticClass:"stat-card today"},[e("div",{staticClass:"stat-icon"},[e("i",{staticClass:"el-icon-calendar"})]),e("div",{staticClass:"stat-content"},[e("div",{staticClass:"stat-value"},[t._v(t._s(t.stats.today))]),e("div",{staticClass:"stat-label"},[t._v("今日处理")])])])])],1)],1),e("el-table",{staticStyle:{width:"100%"},attrs:{size:"small",data:t.tableData,border:"","row-class-name":t.tableRowClassName},on:{"selection-change":t.handleSelectionChange}},[e("el-table-column",{attrs:{type:"selection",width:"80"}}),e("el-table-column",{attrs:{type:"index",label:"序号",width:"60"}}),e("el-table-column",{attrs:{prop:"applicationNo",label:"申请单号","show-overflow-tooltip":""}}),e("el-table-column",{attrs:{prop:"applicant",label:"申请人","show-overflow-tooltip":""}}),e("el-table-column",{attrs:{prop:"department",label:"所属部门","show-overflow-tooltip":""}}),e("el-table-column",{attrs:{prop:"contractName",label:"合同名称","show-overflow-tooltip":""}}),e("el-table-column",{attrs:{prop:"clientName",label:"客户名称","show-overflow-tooltip":""}}),e("el-table-column",{attrs:{prop:"invoiceAmount",label:"开票金额","show-overflow-tooltip":""},scopedSlots:t._u([{key:"default",fn:function(a){return[e("span",[t._v(t._s(t._f("currency")(a.row.invoiceAmount)))])]}}])}),e("el-table-column",{attrs:{prop:"invoiceType",label:"发票类型","show-overflow-tooltip":""}}),e("el-table-column",{attrs:{prop:"priority",label:"优先级","show-overflow-tooltip":""},scopedSlots:t._u([{key:"default",fn:function(a){return[e("el-tag",{attrs:{type:t.getPriorityType(a.row.priority),size:"small"}},[t._v(" "+t._s(t.getPriorityText(a.row.priority))+" ")])]}}])}),e("el-table-column",{attrs:{prop:"flowStatus",label:"流程状态","show-overflow-tooltip":""},scopedSlots:t._u([{key:"default",fn:function(a){return[e("el-tag",{attrs:{type:t.getStatusType(a.row.flowStatus),size:"small"}},[t._v(t._s(t.getStatusText(a.row.flowStatus)))])]}}])}),e("el-table-column",{attrs:{prop:"currentHandler",label:"当前处理人","show-overflow-tooltip":""}}),e("el-table-column",{attrs:{prop:"applicationDate",label:"申请时间","show-overflow-tooltip":""}}),e("el-table-column",{attrs:{prop:"deadline",label:"处理期限","show-overflow-tooltip":""},scopedSlots:t._u([{key:"default",fn:function(a){return[e("span",{class:{"text-danger":t.isOverdue(a.row.deadline)}},[t._v(t._s(a.row.deadline))])]}}])}),e("el-table-column",{attrs:{fixed:"right",label:"操作"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("el-button",{attrs:{size:"small",type:"text"},on:{click:function(e){return t.handleView(a.row)}}},[t._v("查看")]),t.canApprove(a.row)?e("el-button",{attrs:{size:"small",type:"text"},on:{click:function(e){return t.handleApprove(a.row)}}},[t._v("审批")]):t._e(),t.canTransfer(a.row)?e("el-button",{attrs:{size:"small",type:"text"},on:{click:function(e){return t.handleTransfer(a.row)}}},[t._v("转办")]):t._e()]}}])})],1),e("el-pagination",{attrs:{"current-page":t.currentPage,"page-sizes":[10,20,30,50],"page-size":t.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:t.total},on:{"size-change":t.handleSizeChange,"current-change":t.handleCurrentChange}})],1),e("el-dialog",{attrs:{title:t.approvalDialogTitle,visible:t.approvalDialogVisible,width:"60%"},on:{"update:visible":function(e){t.approvalDialogVisible=e}}},[e("div",{staticClass:"approval-content"},[e("div",{staticClass:"approval-section"},[e("h3",[t._v("申请信息")]),e("el-descriptions",{attrs:{column:3,border:""}},[e("el-descriptions-item",{attrs:{label:"申请单号"}},[t._v(t._s(t.currentRow.applicationNo))]),e("el-descriptions-item",{attrs:{label:"申请人"}},[t._v(t._s(t.currentRow.applicant))]),e("el-descriptions-item",{attrs:{label:"所属部门"}},[t._v(t._s(t.currentRow.department))]),e("el-descriptions-item",{attrs:{label:"合同名称"}},[t._v(t._s(t.currentRow.contractName))]),e("el-descriptions-item",{attrs:{label:"客户名称"}},[t._v(t._s(t.currentRow.clientName))]),e("el-descriptions-item",{attrs:{label:"开票金额"}},[t._v(t._s(t._f("currency")(t.currentRow.invoiceAmount)))]),e("el-descriptions-item",{attrs:{label:"发票类型"}},[t._v(t._s(t.currentRow.invoiceType))]),e("el-descriptions-item",{attrs:{label:"申请时间"}},[t._v(t._s(t.currentRow.applicationDate))]),e("el-descriptions-item",{attrs:{label:"当前状态"}},[e("el-tag",{attrs:{type:t.getStatusType(t.currentRow.flowStatus),size:"small"}},[t._v(t._s(t.getStatusText(t.currentRow.flowStatus)))])],1)],1)],1),e("div",{staticClass:"approval-section"},[e("h3",[t._v("审批操作")]),e("el-form",{ref:"approvalForm",attrs:{model:t.approvalForm,rules:t.approvalRules,"label-width":"100px"}},[e("el-form-item",{attrs:{label:"审批结果",prop:"result"}},[e("el-radio-group",{model:{value:t.approvalForm.result,callback:function(e){t.$set(t.approvalForm,"result",e)},expression:"approvalForm.result"}},[e("el-radio",{attrs:{label:"approve"}},[t._v("通过")]),e("el-radio",{attrs:{label:"reject"}},[t._v("退回")]),e("el-radio",{attrs:{label:"transfer"}},[t._v("转办")])],1)],1),e("el-form-item",{attrs:{label:"处理意见",prop:"comment"}},[e("el-input",{attrs:{type:"textarea",rows:"4",placeholder:"请输入处理意见"},model:{value:t.approvalForm.comment,callback:function(e){t.$set(t.approvalForm,"comment",e)},expression:"approvalForm.comment"}})],1),"transfer"===t.approvalForm.result?e("el-form-item",{attrs:{label:"转办人员",prop:"transferTo"}},[e("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择转办人员"},model:{value:t.approvalForm.transferTo,callback:function(e){t.$set(t.approvalForm,"transferTo",e)},expression:"approvalForm.transferTo"}},t._l(t.handlerOptions,(function(t){return e("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1)],1):t._e()],1)],1),e("div",{staticClass:"approval-section"},[e("h3",[t._v("流程历史")]),e("el-timeline",t._l(t.processHistory,(function(a,l){return e("el-timeline-item",{key:l,attrs:{timestamp:a.timestamp,type:a.type}},[e("div",{staticClass:"timeline-content"},[e("div",{staticClass:"timeline-title"},[t._v(t._s(a.title))]),e("div",{staticClass:"timeline-handler"},[t._v("处理人："+t._s(a.handler))]),a.comment?e("div",{staticClass:"timeline-comment"},[t._v("意见："+t._s(a.comment))]):t._e()])])})),1)],1)]),e("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{on:{click:function(e){t.approvalDialogVisible=!1}}},[t._v("取消")]),e("el-button",{attrs:{type:"primary",loading:t.approvalLoading},on:{click:t.submitApproval}},[t._v("确定")])],1)]),e("el-dialog",{attrs:{title:t.batchDialogTitle,visible:t.batchDialogVisible,width:"50%"},on:{"update:visible":function(e){t.batchDialogVisible=e}}},[e("div",{staticClass:"batch-content"},[e("p",[t._v("您选择了 "),e("strong",[t._v(t._s(t.multipleSelection.length))]),t._v(" 个申请单，确认要执行"+t._s(t.batchOperation)+"操作吗？")]),e("ul",{staticClass:"batch-list"},t._l(t.multipleSelection,(function(a){return e("li",{key:a.id},[t._v(" "+t._s(a.applicationNo)+" - "+t._s(a.applicant)+" - "+t._s(t._f("currency")(a.invoiceAmount))+" ")])})),0),"退回"===t.batchOperation?e("el-form",{attrs:{model:t.batchForm,"label-width":"100px"}},[e("el-form-item",{attrs:{label:"退回原因"}},[e("el-input",{attrs:{type:"textarea",rows:"3",placeholder:"请输入退回原因"},model:{value:t.batchForm.comment,callback:function(e){t.$set(t.batchForm,"comment",e)},expression:"batchForm.comment"}})],1)],1):t._e()],1),e("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{on:{click:function(e){t.batchDialogVisible=!1}}},[t._v("取消")]),e("el-button",{attrs:{type:"primary",loading:t.batchLoading},on:{click:t.confirmBatchOperation}},[t._v("确定")])],1)])],1)},s=[],r=(a("14d9"),a("e9f5"),a("ab43"),{name:"InvoicePending",data(){return{searchForm:{applicationNo:"",applicant:"",clientName:"",department:"",invoiceType:"",flowStatus:"",priority:"",applicationDate:""},tableData:[],currentPage:1,pageSize:10,total:0,multipleSelection:[],stats:{reviewing:0,urgent:0,overdue:0,today:0},pendingCount:0,approvalDialogVisible:!1,approvalDialogTitle:"审批处理",currentRow:{},approvalForm:{result:"approve",comment:"",transferTo:""},approvalRules:{result:[{required:!0,message:"请选择审批结果",trigger:"change"}],comment:[{required:!0,message:"请输入处理意见",trigger:"blur"}],transferTo:[{required:!0,message:"请选择转办人员",trigger:"change"}]},approvalLoading:!1,processHistory:[],handlerOptions:[{value:"user1",label:"张三（财务部）"},{value:"user2",label:"李四（财务部）"},{value:"user3",label:"王五（审计部）"},{value:"user4",label:"赵六（领导）"}],batchDialogVisible:!1,batchDialogTitle:"批量操作确认",batchOperation:"",batchForm:{comment:""},batchLoading:!1}},filters:{currency(t){return t?"¥"+parseFloat(t).toLocaleString("zh-CN",{minimumFractionDigits:2,maximumFractionDigits:2}):"¥0.00"}},created(){this.getList(),this.getStats()},methods:{getList(){this.tableData=Array.from({length:15}).map((t,e)=>({id:e+1,applicationNo:"FPSP"+(2025e3+e),applicant:"申请人"+(e+1),department:["信息与商务管理学院","财务部","商务部","技术部"][e%4],contractName:`${["技术服务","软件开发","系统维护","设备采购"][e%4]}合同${String(e+1).padStart(3,"0")}`,clientName:"客户"+(e+1),invoiceAmount:1e4+5e3*e,invoiceType:["增值税专用发票","增值税普通发票","电子发票"][e%3],priority:["urgent","normal","low"][e%3],flowStatus:["reviewing","finance_review","leader_approve","returned"][e%4],currentHandler:"处理人"+(e%4+1),applicationDate:"2025-07-"+String(e%30+1).padStart(2,"0"),deadline:"2025-07-"+String(e%30+3).padStart(2,"0")})),this.total=50,this.pendingCount=this.tableData.length},getStats(){this.stats={reviewing:8,urgent:3,overdue:2,today:5}},handleSearch(){console.log("搜索条件:",this.searchForm),this.currentPage=1,this.getList()},handleReset(){this.searchForm={applicationNo:"",applicant:"",clientName:"",department:"",invoiceType:"",flowStatus:"",priority:"",applicationDate:""},this.getList()},handleRefresh(){this.getList(),this.getStats(),this.$message.success("数据已刷新")},handleSelectionChange(t){this.multipleSelection=t},handleView(t){this.$router.push({path:"/finance/invoice/detail",query:{id:t.id,mode:"view"}})},handleApprove(t){this.currentRow=t,this.approvalDialogTitle="审批处理",this.approvalForm={result:"approve",comment:"",transferTo:""},this.getProcessHistory(t.id),this.approvalDialogVisible=!0},handleTransfer(t){this.currentRow=t,this.approvalDialogTitle="转办处理",this.approvalForm={result:"transfer",comment:"",transferTo:""},this.getProcessHistory(t.id),this.approvalDialogVisible=!0},handleCommand(t,e){switch(t){case"history":this.showProcessHistory(e);break;case"urge":this.urgeProcess(e);break;case"recall":this.recallProcess(e);break}},handleBatchApprove(){this.batchOperation="批量通过",this.batchDialogTitle="批量通过确认",this.batchDialogVisible=!0},handleBatchReject(){this.batchOperation="退回",this.batchDialogTitle="批量退回确认",this.batchForm.comment="",this.batchDialogVisible=!0},submitApproval(){this.$refs.approvalForm.validate(t=>{t&&(this.approvalLoading=!0,setTimeout(()=>{this.approvalLoading=!1,this.approvalDialogVisible=!1;const t={approve:"通过",reject:"退回",transfer:"转办"}[this.approvalForm.result];this.$message.success(t+"成功"),this.getList()},1e3))})},confirmBatchOperation(){"退回"!==this.batchOperation||this.batchForm.comment?(this.batchLoading=!0,setTimeout(()=>{this.batchLoading=!1,this.batchDialogVisible=!1,this.approvalDialogVisible=!1,this.$message.success(this.batchOperation+"操作完成"),this.multipleSelection=[],this.getList()},1e3)):this.$message.warning("请输入退回原因")},getProcessHistory(t){this.processHistory=[{title:"申请提交",handler:"申请人1",timestamp:"2025-07-20 09:00",type:"primary",comment:"提交开票申请"},{title:"部门审核",handler:"部门主管",timestamp:"2025-07-20 14:30",type:"success",comment:"部门审核通过"},{title:"财务审核",handler:"财务人员",timestamp:"2025-07-21 10:15",type:"warning",comment:"等待财务审核"}]},showProcessHistory(t){this.currentRow=t,this.getProcessHistory(t.id),this.approvalDialogTitle="流程历史",this.approvalDialogVisible=!0},urgeProcess(t){this.$confirm("确认催办该申请单？","催办确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{this.$message.success("催办成功")})},recallProcess(t){this.$confirm("确认撤回该申请单？","撤回确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{this.$message.success("撤回成功"),this.getList()})},canApprove(t){return["reviewing","finance_review","leader_approve"].includes(t.flowStatus)},canTransfer(t){return["reviewing","finance_review"].includes(t.flowStatus)},canUrge(t){return"returned"!==t.flowStatus},canRecall(t){return"申请人1"===t.applicant&&["reviewing","finance_review"].includes(t.flowStatus)},getPriorityType(t){const e={urgent:"danger",normal:"",low:"info"};return e[t]||""},getPriorityText(t){const e={urgent:"紧急",normal:"普通",low:"低"};return e[t]||t},getStatusType(t){const e={reviewing:"warning",finance_review:"primary",leader_approve:"success",returned:"danger"};return e[t]||"info"},getStatusText(t){const e={reviewing:"审核中",finance_review:"财务审核",leader_approve:"领导审批",returned:"已退回"};return e[t]||t},isOverdue(t){const e=new Date,a=new Date(t);return a<e},tableRowClassName({row:t,rowIndex:e}){return"urgent"===t.priority?"urgent-row":this.isOverdue(t.deadline)?"overdue-row":""},handleSizeChange(t){this.pageSize=t,this.getList()},handleCurrentChange(t){this.currentPage=t,this.getList()}}}),i=r,o=(a("86c3"),a("2877")),n=Object(o["a"])(i,l,s,!1,null,"784cb64d",null);e["default"]=n.exports},2457:function(t,e,a){},"86c3":function(t,e,a){"use strict";a("2457")}}]);