(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-9e8df2c8"],{"0655":function(e,t,a){},"2f9c":function(e,t,a){"use strict";a("0655")},"47e7":function(e,t,a){"use strict";a.r(t);var l=function(){var e=this,t=e._self._c;return t("div",{staticClass:"pending-case-page"},[t("div",{staticClass:"body-part-search"},[t("el-form",{ref:"searchForm",attrs:{model:e.searchForm,"label-width":"100px"}},[t("el-row",[t("el-col",{attrs:{span:6}},[t("el-form-item",{attrs:{label:"项目编号"}},[t("el-input",{attrs:{size:"small",placeholder:"请输入"},model:{value:e.searchForm.ourRefNumber,callback:function(t){e.$set(e.searchForm,"ourRefNumber",t)},expression:"searchForm.ourRefNumber"}})],1)],1),t("el-col",{attrs:{span:6}},[t("el-form-item",{attrs:{label:"客户名称"}},[t("el-input",{attrs:{size:"small",placeholder:"请输入"},model:{value:e.searchForm.customerName,callback:function(t){e.$set(e.searchForm,"customerName",t)},expression:"searchForm.customerName"}})],1)],1),t("el-col",{attrs:{span:6}},[t("el-form-item",{attrs:{label:"申报批次"}},[t("el-input",{attrs:{size:"small",placeholder:"请输入"},model:{value:e.searchForm.applicationBatch,callback:function(t){e.$set(e.searchForm,"applicationBatch",t)},expression:"searchForm.applicationBatch"}})],1)],1),t("el-col",{attrs:{span:6}},[t("el-form-item",{attrs:{label:"申请类型"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{size:"small",placeholder:"请选择"},model:{value:e.searchForm.applicationType,callback:function(t){e.$set(e.searchForm,"applicationType",t)},expression:"searchForm.applicationType"}},[t("el-option",{attrs:{label:"全部",value:""}}),t("el-option",{attrs:{label:"项目申报",value:"项目申报"}}),t("el-option",{attrs:{label:"科技服务",value:"科技服务"}}),t("el-option",{attrs:{label:"技术咨询",value:"技术咨询"}})],1)],1)],1)],1),t("el-row",[t("el-col",{attrs:{span:6}},[t("el-form-item",{attrs:{label:"科技服务名称"}},[t("el-input",{attrs:{size:"small",placeholder:"请输入文字摸糊糊"},model:{value:e.searchForm.businessType,callback:function(t){e.$set(e.searchForm,"businessType",t)},expression:"searchForm.businessType"}})],1)],1),t("el-col",{attrs:{span:6}},[t("el-form-item",{attrs:{label:"项目年份"}},[t("el-date-picker",{attrs:{type:"daterange","value-format":"yyyy","range-separator":"至","start-placeholder":"开始年份","end-placeholder":"结束年份",size:"small"},model:{value:e.searchForm.projectYear,callback:function(t){e.$set(e.searchForm,"projectYear",t)},expression:"searchForm.projectYear"}})],1)],1),t("el-col",{attrs:{span:6}},[t("el-form-item",{attrs:{label:"主管地"}},[t("el-input",{attrs:{size:"small",placeholder:"输入文字摸糊糊"},model:{value:e.searchForm.managementArea,callback:function(t){e.$set(e.searchForm,"managementArea",t)},expression:"searchForm.managementArea"}})],1)],1),t("el-col",{attrs:{span:6}},[t("el-form-item",{attrs:{label:"项目状态"}},[t("el-input",{attrs:{size:"small",placeholder:"请输入"},model:{value:e.searchForm.caseStatus,callback:function(t){e.$set(e.searchForm,"caseStatus",t)},expression:"searchForm.caseStatus"}})],1)],1)],1),t("el-row",[t("el-col",{attrs:{span:6}},[t("el-form-item",{attrs:{label:"事项完成日期"}},[t("el-date-picker",{attrs:{type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"yyyy-MM-dd",size:"small"},model:{value:e.searchForm.completedDateRange,callback:function(t){e.$set(e.searchForm,"completedDateRange",t)},expression:"searchForm.completedDateRange"}})],1)],1),t("el-col",{attrs:{span:6}},[t("el-form-item",{attrs:{label:"结案时间"}},[t("el-date-picker",{attrs:{type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"yyyy-MM-dd",size:"small"},model:{value:e.searchForm.closedDateRange,callback:function(t){e.$set(e.searchForm,"closedDateRange",t)},expression:"searchForm.closedDateRange"}})],1)],1)],1),t("div",{staticClass:"part-search-buttons"},[t("el-button",{attrs:{size:"small",type:"primary"},on:{click:e.handleSearch}},[e._v("查询")]),t("el-button",{attrs:{size:"small"},on:{click:e.resetForm}},[e._v("重置")]),t("el-button",{attrs:{size:"small",type:"success"},on:{click:e.handleExport}},[e._v("导出")]),t("div",{staticStyle:{"margin-left":"10px",display:"inline-block"}})],1)],1)],1),t("div",{staticClass:"body-part-content"},[e._m(0),t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"table",staticStyle:{width:"100%"},attrs:{data:e.tableData,border:""},on:{"selection-change":e.handleSelectionChange}},[t("el-table-column",{attrs:{type:"expand"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("div",{staticStyle:{padding:"10px 20px"}},[t("h4",[e._v("事项列表")]),t("el-table",{staticClass:"nested-table",staticStyle:{width:"100%"},attrs:{data:a.row.items,border:""}},[t("el-table-column",{attrs:{prop:"taskType",label:"任务类型",width:"120"}}),t("el-table-column",{attrs:{prop:"projectTask",label:"项目任务"}}),t("el-table-column",{attrs:{prop:"status",label:"处理状态",width:"100"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-tag",{attrs:{type:e.getStatusType(a.row.status)}},[e._v(e._s(a.row.status))])]}}],null,!0)}),t("el-table-column",{attrs:{prop:"plannedPoints",label:"处理事项计划点数",width:"140"}}),t("el-table-column",{attrs:{prop:"processHandler",label:"处理事项处理人",width:"120"}}),t("el-table-column",{attrs:{prop:"expectedFinishDate",label:"预计完成日",width:"120"}}),t("el-table-column",{attrs:{prop:"assignDate",label:"配案日",width:"100"}}),t("el-table-column",{attrs:{prop:"officialDeadline",label:"官方期限",width:"120"}}),t("el-table-column",{attrs:{prop:"processRemark",label:"处理事项备注"}}),t("el-table-column",{attrs:{prop:"completedPoints",label:"处理事项完成点数",width:"140"}}),t("el-table-column",{attrs:{prop:"completionRate",label:"处理事项完成程度",width:"140"},scopedSlots:e._u([{key:"default",fn:function(e){return[t("el-progress",{attrs:{percentage:e.row.completionRate,status:100===e.row.completionRate?"success":null}})]}}],null,!0)}),t("el-table-column",{attrs:{prop:"totalCompletedPoints",label:"处理事项完成总点数",width:"150"}}),t("el-table-column",{attrs:{prop:"totalCompletionRate",label:"处理事项完成总程度",width:"150"},scopedSlots:e._u([{key:"default",fn:function(e){return[t("el-progress",{attrs:{percentage:e.row.totalCompletionRate,status:100===e.row.totalCompletionRate?"success":null}})]}}],null,!0)}),t("el-table-column",{attrs:{prop:"expectedStartDate",label:"预计启动日",width:"120"}}),t("el-table-column",{attrs:{prop:"internalDeadline",label:"内部期限",width:"120"}}),t("el-table-column",{attrs:{prop:"partialCompleteDate",label:"部分完成日",width:"120"}}),t("el-table-column",{attrs:{label:"操作",width:"80",fixed:"right"},scopedSlots:e._u([{key:"default",fn:function(l){return[t("el-button",{attrs:{type:"text",size:"small"},on:{click:function(t){return e.handleModify(l.row,a.row)}}},[e._v("修改")])]}}],null,!0)})],1)],1)]}}])}),t("el-table-column",{attrs:{type:"selection",width:"80"}}),e.visibleColumns.ourRefNumber?t("el-table-column",{attrs:{prop:"ourRefNumber",label:"项目编号",width:"120"}}):e._e(),e.visibleColumns.partyBCompany?t("el-table-column",{attrs:{prop:"partyBCompany",label:"乙方签约公司",width:"160"}}):e._e(),e.visibleColumns.presalesSupport?t("el-table-column",{attrs:{prop:"presalesSupport",label:"售前支持",width:"120"}}):e._e(),e.visibleColumns.businessType?t("el-table-column",{attrs:{prop:"businessType",label:"科技服务名称",width:"150"}}):e._e(),e.visibleColumns.caseStatus?t("el-table-column",{attrs:{prop:"caseStatus",label:"项目状态",width:"120"}}):e._e(),e.visibleColumns.applicationType?t("el-table-column",{attrs:{prop:"applicationType",label:"申请类型",width:"120"}}):e._e(),e.visibleColumns.projectYear?t("el-table-column",{attrs:{prop:"projectYear",label:"项目年份",width:"100"}}):e._e(),e.visibleColumns.applicationBatch?t("el-table-column",{attrs:{prop:"applicationBatch",label:"申报批次",width:"120"}}):e._e(),e.visibleColumns.serviceLevel?t("el-table-column",{attrs:{prop:"serviceLevel",label:"科技服务级别",width:"120"}}):e._e(),e.visibleColumns.managementArea?t("el-table-column",{attrs:{prop:"managementArea",label:"主管地",width:"120"}}):e._e(),e.visibleColumns.isUrgent?t("el-table-column",{attrs:{prop:"isUrgent",label:"是否加急",width:"100"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-tag",{attrs:{type:a.row.isUrgent?"danger":"info"}},[e._v(e._s(a.row.isUrgent?"加急":"正常"))])]}}],null,!1,1835392259)}):e._e(),e.visibleColumns.customerName?t("el-table-column",{attrs:{prop:"customerName",label:"客户名称"}}):e._e(),e.visibleColumns.technicalLead?t("el-table-column",{attrs:{prop:"technicalLead",label:"技术主导",width:"120"}}):e._e(),e.visibleColumns.businessPerson?t("el-table-column",{attrs:{prop:"businessPerson",label:"业务人员",width:"120"}}):e._e(),e.visibleColumns.caseHandler?t("el-table-column",{attrs:{prop:"caseHandler",label:"案件处理人",width:"120"}}):e._e(),e.visibleColumns.coHandler1?t("el-table-column",{attrs:{prop:"coHandler1",label:"协处理人1",width:"120"}}):e._e(),e.visibleColumns.coHandler2?t("el-table-column",{attrs:{prop:"coHandler2",label:"协处理人2",width:"120"}}):e._e(),e.visibleColumns.contractCode?t("el-table-column",{attrs:{prop:"contractCode",label:"合同代码",width:"140"}}):e._e(),e.visibleColumns.contractDate?t("el-table-column",{attrs:{prop:"contractDate",label:"合同日期",width:"120"}}):e._e(),e.visibleColumns.receiveDate?t("el-table-column",{attrs:{prop:"receiveDate",label:"收单日期",width:"120"}}):e._e(),e.visibleColumns.applicationDeadline?t("el-table-column",{attrs:{prop:"applicationDeadline",label:"申报截止日",width:"140"}}):e._e(),t("el-table-column",{attrs:{fixed:"right",label:"操作",width:"120"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-button",{attrs:{type:"text",size:"small"},on:{click:function(t){return e.handleDetail(a.row)}}},[e._v("查看")]),t("el-button",{attrs:{type:"text",size:"small"},on:{click:function(t){return e.handleArchive(a.row)}}},[e._v("归档")])]}}])})],1),t("el-pagination",{attrs:{"current-page":e.currentPage,"page-sizes":[10,20,30,50],"page-size":e.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1),t("el-dialog",{attrs:{title:"修改处理事项",visible:e.modifyDialogVisible,width:"60%","before-close":e.handleCloseModifyDialog},on:{"update:visible":function(t){e.modifyDialogVisible=t}}},[t("el-form",{ref:"modifyForm",attrs:{model:e.modifyForm,"label-width":"140px"}},[t("el-row",[t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"项目号"}},[t("el-input",{staticStyle:{"background-color":"#f5f7fa"},attrs:{placeholder:"带出来的",readonly:"",disabled:""},model:{value:e.modifyForm.projectNumber,callback:function(t){e.$set(e.modifyForm,"projectNumber",t)},expression:"modifyForm.projectNumber"}})],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"客户名称"}},[t("el-input",{staticStyle:{"background-color":"#f5f7fa"},attrs:{placeholder:"带出来的",readonly:"",disabled:""},model:{value:e.modifyForm.customerName,callback:function(t){e.$set(e.modifyForm,"customerName",t)},expression:"modifyForm.customerName"}})],1)],1)],1),t("el-row",[t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"科服名称"}},[t("el-input",{staticStyle:{"background-color":"#f5f7fa"},attrs:{placeholder:"带出来的",readonly:"",disabled:""},model:{value:e.modifyForm.serviceName,callback:function(t){e.$set(e.modifyForm,"serviceName",t)},expression:"modifyForm.serviceName"}})],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"主管地"}},[t("el-input",{staticStyle:{"background-color":"#f5f7fa"},attrs:{placeholder:"带出来的",readonly:"",disabled:""},model:{value:e.modifyForm.managementArea,callback:function(t){e.$set(e.modifyForm,"managementArea",t)},expression:"modifyForm.managementArea"}})],1)],1)],1),t("el-row",[t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"项目年份"}},[t("el-input",{staticStyle:{"background-color":"#f5f7fa"},attrs:{placeholder:"带出来的",readonly:"",disabled:""},model:{value:e.modifyForm.projectYear,callback:function(t){e.$set(e.modifyForm,"projectYear",t)},expression:"modifyForm.projectYear"}})],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"预计启动日"}},[t("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"date",placeholder:"年/月/日","value-format":"yyyy-MM-dd"},model:{value:e.modifyForm.expectedStartDate,callback:function(t){e.$set(e.modifyForm,"expectedStartDate",t)},expression:"modifyForm.expectedStartDate"}})],1)],1)],1),t("el-row",[t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"处理事项完成点数"}},[t("el-input",{attrs:{placeholder:"输入数字",type:"number"},model:{value:e.modifyForm.completedPoints,callback:function(t){e.$set(e.modifyForm,"completedPoints",e._n(t))},expression:"modifyForm.completedPoints"}})],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"处理事项完成总点数"}},[t("el-input",{attrs:{placeholder:"输入数字",type:"number"},model:{value:e.modifyForm.totalCompletedPoints,callback:function(t){e.$set(e.modifyForm,"totalCompletedPoints",e._n(t))},expression:"modifyForm.totalCompletedPoints"}})],1)],1)],1),t("el-row",[t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"预计完成日"}},[t("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"date",placeholder:"年/月/日","value-format":"yyyy-MM-dd"},model:{value:e.modifyForm.expectedFinishDate,callback:function(t){e.$set(e.modifyForm,"expectedFinishDate",t)},expression:"modifyForm.expectedFinishDate"}})],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"处理事项完成程度"}},[t("el-input",{attrs:{placeholder:"输入数字",type:"number",min:"0",max:"100"},model:{value:e.modifyForm.completionRate,callback:function(t){e.$set(e.modifyForm,"completionRate",e._n(t))},expression:"modifyForm.completionRate"}},[t("template",{slot:"append"},[e._v("%")])],2)],1)],1)],1),t("el-row",[t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"处理事项完成总程度"}},[t("el-input",{attrs:{placeholder:"输入数字",type:"number",min:"0",max:"100"},model:{value:e.modifyForm.totalCompletionRate,callback:function(t){e.$set(e.modifyForm,"totalCompletionRate",e._n(t))},expression:"modifyForm.totalCompletionRate"}},[t("template",{slot:"append"},[e._v("%")])],2)],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"部分完成日"}},[t("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"date",placeholder:"年/月/日","value-format":"yyyy-MM-dd"},model:{value:e.modifyForm.partialCompleteDate,callback:function(t){e.$set(e.modifyForm,"partialCompleteDate",t)},expression:"modifyForm.partialCompleteDate"}})],1)],1)],1),t("el-row",[t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"完成日"}},[t("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"date",placeholder:"年/月/日","value-format":"yyyy-MM-dd"},model:{value:e.modifyForm.completeDate,callback:function(t){e.$set(e.modifyForm,"completeDate",t)},expression:"modifyForm.completeDate"}})],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"处理事项状态"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"字典17里的 下拉选"},model:{value:e.modifyForm.processStatus,callback:function(t){e.$set(e.modifyForm,"processStatus",t)},expression:"modifyForm.processStatus"}},[t("el-option",{attrs:{label:"待处理",value:"待处理"}}),t("el-option",{attrs:{label:"处理中",value:"处理中"}}),t("el-option",{attrs:{label:"已完成",value:"已完成"}}),t("el-option",{attrs:{label:"已驳回",value:"已驳回"}}),t("el-option",{attrs:{label:"暂停",value:"暂停"}}),t("el-option",{attrs:{label:"部分完成",value:"部分完成"}})],1)],1)],1)],1)],1),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:e.handleCloseModifyDialog}},[e._v("取消")]),t("el-button",{attrs:{size:"small",type:"primary"},on:{click:e.handleConfirmModify}},[e._v("确认")])],1)],1)],1)},o=[function(){var e=this,t=e._self._c;return t("div",{staticClass:"part-table-header"},[t("div",{staticClass:"part-table-title"},[t("span",[e._v("已完成（科技服务）")])]),t("div",{staticClass:"part-table-operations"})])}],s=(a("14d9"),a("e9f5"),a("7d54"),a("ab43"),a("88a7"),a("271a"),a("5494"),{name:"PendingCase",components:{},data(){return{loading:!1,searchForm:{ourRefNumber:"",customerName:"",businessType:"",applicationType:"",applicationBatch:"",projectYear:null,managementArea:"",caseStatus:"",completedDateRange:null,closedDateRange:null},tableData:[],currentPage:1,pageSize:10,total:0,selectedItem:null,projectColumns:[{prop:"ourRefNumber",label:"项目编号"},{prop:"partyBCompany",label:"乙方签约公司"},{prop:"presalesSupport",label:"售前支持"},{prop:"businessType",label:"科技服务名称"},{prop:"caseStatus",label:"项目状态"},{prop:"applicationType",label:"申请类型"},{prop:"projectYear",label:"项目年份"},{prop:"applicationBatch",label:"申报批次"},{prop:"serviceLevel",label:"科技服务级别"},{prop:"managementArea",label:"主管地"},{prop:"isUrgent",label:"是否加急"},{prop:"customerName",label:"客户名称"},{prop:"technicalLead",label:"技术主导"},{prop:"businessPerson",label:"业务人员"},{prop:"caseHandler",label:"案件处理人"},{prop:"coHandler1",label:"协处理人1"},{prop:"coHandler2",label:"协处理人2"},{prop:"contractCode",label:"合同代码"},{prop:"contractDate",label:"合同日期"},{prop:"receiveDate",label:"收单日期"},{prop:"applicationDeadline",label:"申报截止日"}],projectDefaultSelected:["ourRefNumber","partyBCompany","presalesSupport","businessType","caseStatus","applicationType","projectYear","applicationBatch","serviceLevel","managementArea","isUrgent","customerName","technicalLead","businessPerson","caseHandler","contractCode","contractDate","receiveDate","applicationDeadline"],visibleColumns:{},modifyDialogVisible:!1,selectedRows:[],modifyForm:{projectNumber:"",customerName:"",serviceName:"",managementArea:"",projectYear:"",expectedStartDate:"",completedPoints:null,totalCompletedPoints:null,expectedFinishDate:"",completionRate:null,totalCompletionRate:null,partialCompleteDate:"",completeDate:"",processStatus:""}}},computed:{},created(){this.initializeVisibleColumns(),this.fetchData()},methods:{initializeVisibleColumns(){const e=this.projectDefaultSelected;this.visibleColumns={},this.projectColumns.forEach(t=>{this.$set(this.visibleColumns,t.prop,e.includes(t.prop))})},getStatusType(e){const t={"待处理":"warning","处理中":"primary","已完成":"success","已驳回":"danger","暂停":"info"};return t[e]||"info"},async fetchData(){this.loading=!0;try{const e=await this.$api.personalCase.getCompletedProject({page:this.currentPage,limit:this.pageSize,our_ref_number:this.searchForm.ourRefNumber,customer_name:this.searchForm.customerName,application_batch:this.searchForm.applicationBatch,application_type:this.searchForm.applicationType,business_type:this.searchForm.businessType,project_year:this.searchForm.projectYear?this.searchForm.projectYear.join(","):null,management_area:this.searchForm.managementArea,case_status:this.searchForm.caseStatus,start_date:this.searchForm.completedDateRange?this.searchForm.completedDateRange[0]:null,end_date:this.searchForm.completedDateRange?this.searchForm.completedDateRange[1]:null});e.data.success?(this.tableData=e.data.data.list||[],this.total=e.data.data.total||0):this.$message.error(e.data.message||"获取数据失败")}catch(e){console.error("获取科技服务已完成项目失败:",e),this.$message.error("获取数据失败，请稍后重试"),this.tableData=[],this.total=0}finally{this.loading=!1}},updateVisibleColumns(e){this.visibleColumns=e},handleSearch(){this.currentPage=1,this.fetchData()},resetForm(){this.$refs.searchForm.resetFields()},async handleExport(){const e=this.$refs.table?this.$refs.table.selection:[];if(0!==e.length)try{await this.$confirm("确定要导出选中的记录吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),this.loading=!0;const t={type:"completed_project",search_params:{our_ref_number:this.searchForm.ourRefNumber,customer_name:this.searchForm.customerName,application_batch:this.searchForm.applicationBatch,application_type:this.searchForm.applicationType,business_type:this.searchForm.businessType,project_year:this.searchForm.projectYear?this.searchForm.projectYear.join(","):null,management_area:this.searchForm.managementArea,case_status:this.searchForm.caseStatus,completed_start_date:this.searchForm.completedDateRange?this.searchForm.completedDateRange[0]:null,completed_end_date:this.searchForm.completedDateRange?this.searchForm.completedDateRange[1]:null,closed_start_date:this.searchForm.closedDateRange?this.searchForm.closedDateRange[0]:null,closed_end_date:this.searchForm.closedDateRange?this.searchForm.closedDateRange[1]:null},selected_ids:e.map(e=>e.id)},a=await this.$api.personalCase.exportData(t);if(a.headers["content-type"]&&a.headers["content-type"].includes("application/json")){const e=new FileReader;return e.onload=()=>{const t=JSON.parse(e.result);this.$message.error(t.message||"导出失败")},void e.readAsText(a.data)}const l=window.URL.createObjectURL(a.data),o=document.createElement("a");o.href=l,o.download=`已完成科技服务项目_${(new Date).toISOString().slice(0,10)}.csv`,document.body.appendChild(o),o.click(),document.body.removeChild(o),window.URL.revokeObjectURL(l),this.$message.success("导出成功")}catch(t){"cancel"!==t?(console.error("导出失败:",t),this.$message.error("导出失败，请稍后重试")):this.$message.info("已取消导出")}finally{this.loading=!1}else this.$message.warning("请先选择要导出的记录")},handleSizeChange(e){this.pageSize=e,this.fetchData()},handleCurrentChange(e){this.currentPage=e,this.fetchData()},handleSelectionChange(e){this.selectedRows=e},handleModify(e,t){this.selectedItem=e,this.fillModifyForm(e,t),this.modifyDialogVisible=!0},fillModifyForm(e,t){this.modifyForm={projectNumber:t.ourRefNumber||"",customerName:t.customerName||"",serviceName:t.businessType||"",managementArea:t.managementArea||"",projectYear:t.projectYear||"",expectedStartDate:e.expectedStartDate||"",completedPoints:e.completedPoints||null,totalCompletedPoints:e.totalCompletedPoints||null,expectedFinishDate:e.expectedFinishDate||"",completionRate:e.completionRate||null,totalCompletionRate:e.totalCompletionRate||null,partialCompleteDate:e.partialCompleteDate||"",completeDate:e.completeDate||"",processStatus:e.status||""}},handleCloseModifyDialog(){this.modifyDialogVisible=!1,this.resetModifyForm()},resetModifyForm(){this.modifyForm={projectNumber:"",customerName:"",serviceName:"",managementArea:"",projectYear:"",expectedStartDate:"",completedPoints:null,totalCompletedPoints:null,expectedFinishDate:"",completionRate:null,totalCompletionRate:null,partialCompleteDate:"",completeDate:"",processStatus:""}},handleConfirmModify(){this.validateModifyForm()&&this.$confirm("确定要保存修改吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{this.submitModifyForm()}).catch(()=>{this.$message.info("已取消修改")})},validateModifyForm(){return null!==this.modifyForm.completionRate&&(this.modifyForm.completionRate<0||this.modifyForm.completionRate>100)?(this.$message.error("处理事项完成程度必须在0-100之间"),!1):null===this.modifyForm.totalCompletionRate||!(this.modifyForm.totalCompletionRate<0||this.modifyForm.totalCompletionRate>100)||(this.$message.error("处理事项完成总程度必须在0-100之间"),!1)},async submitModifyForm(){this.loading=!0;try{const e=await this.$api.personalCase.modifyProcessItem({item_id:this.selectedItem.id,expected_start_date:this.modifyForm.expectedStartDate,completed_points:this.modifyForm.completedPoints,total_completed_points:this.modifyForm.totalCompletedPoints,expected_finish_date:this.modifyForm.expectedFinishDate,completion_rate:this.modifyForm.completionRate,total_completion_rate:this.modifyForm.totalCompletionRate,partial_complete_date:this.modifyForm.partialCompleteDate,complete_date:this.modifyForm.completeDate,process_status:this.modifyForm.processStatus});e.data.success?(this.$message.success("修改成功"),this.modifyDialogVisible=!1,this.resetModifyForm(),this.fetchData()):this.$message.error(e.data.message||"修改失败")}catch(e){console.error("修改处理事项失败:",e),this.$message.error("修改失败，请稍后重试")}finally{this.loading=!1}},handleDetail(e){this.$router.push({path:"/case/project/detail/"+e.id,query:{refNumber:e.ourRefNumber,mode:"view"}})},handleArchive(e){this.$confirm(`确定要归档项目 "${e.ourRefNumber}" 吗？归档后项目将不再显示在当前列表中。`,"归档确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{this.$message.success("项目归档成功"),this.fetchData()}catch(e){console.error("归档失败:",e),this.$message.error("归档失败，请稍后重试")}}).catch(()=>{this.$message.info("已取消归档")})}}}),r=s,i=(a("2f9c"),a("2877")),n=Object(i["a"])(r,l,o,!1,null,"282ff556",null);t["default"]=n.exports}}]);