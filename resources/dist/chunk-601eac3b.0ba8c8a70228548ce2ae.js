(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-601eac3b"],{"48d0":function(s,e,t){"use strict";var o=function(){var s,e,t=this,o=t._self._c;return o("div",{staticClass:"workflow-progress"},[o("div",{staticClass:"workflow-header"},[o("div",{staticClass:"workflow-title"},[o("i",{staticClass:"el-icon-s-operation"}),o("span",[t._v("审批流程")]),t.workflowInstance?o("el-tag",{attrs:{type:t.getStatusType(t.workflowInstance.status),size:"small"}},[t._v(" "+t._s(t.getStatusText(t.workflowInstance.status))+" ")]):t._e()],1),t.workflowInstance?o("div",{staticClass:"workflow-info"},[o("span",[t._v("流程："+t._s((null===(s=t.workflowInstance.workflow)||void 0===s?void 0:s.name)||"合同审批流程"))]),o("span",[t._v("创建时间："+t._s(t.formatDate(t.workflowInstance.created_at)))])]):t._e()]),t.workflowInstance?o("div",{staticClass:"workflow-steps"},[o("div",{staticClass:"progress-bar"},[o("div",{staticClass:"progress-fill",style:{width:t.progressPercentage+"%"}})]),o("div",{staticClass:"steps-horizontal"},t._l(t.displayProcesses,(function(s,e){return o("div",{key:e,staticClass:"step-horizontal",class:t.getStepClass(s,e)},[o("div",{staticClass:"step-circle"},[o("i",{class:t.getStepIcon(s)})]),e<t.displayProcesses.length-1?o("div",{staticClass:"step-line",class:{completed:t.isStepCompleted(s)}}):t._e(),o("div",{staticClass:"step-info"},[o("div",{staticClass:"step-name"},[t._v(t._s(s.node_name))]),t.shouldShowDetails(s)?o("div",{staticClass:"step-details"},[s.assignee?o("div",{staticClass:"step-assignee"},[t._v(" "+t._s(s.assignee.real_name||s.assignee.username)+" ")]):t._e(),s.processed_at?o("div",{staticClass:"step-time"},[t._v(" "+t._s(t.formatDate(s.processed_at))+" ")]):t._e(),t.shouldShowComment(s)&&s.comment?o("div",{staticClass:"step-comment"},[t._v(" "+t._s(s.comment)+" ")]):t._e()]):t._e(),o("div",{staticClass:"step-status-tag"},[o("el-tag",{attrs:{type:t.getProcessStatusType(s.action),size:"mini"}},[t._v(" "+t._s(t.getProcessStatusText(s.action))+" ")])],1)])])})),0)]):o("div",{staticClass:"no-workflow"},[o("div",{staticClass:"no-workflow-content"},[o("i",{staticClass:"el-icon-document"}),o("p",[t._v("暂未发起审批流程")]),t.canStartWorkflow?o("el-button",{attrs:{type:"primary",size:"small",loading:t.starting},on:{click:t.showStartWorkflowDialog}},[t._v(" 发起审批 ")]):t._e()],1)]),!t.workflowInstance||"pending"!==t.workflowInstance.status&&"rejected"!==t.workflowInstance.status?t._e():o("div",{staticClass:"workflow-actions"},[t.currentUserTask?o("div",{staticClass:"task-actions"},[o("el-button",{attrs:{type:"success",size:"small",loading:t.processing},on:{click:t.handleApprove}},[t._v(" 通过 ")]),o("el-button",{attrs:{type:"warning",size:"small",loading:t.processing},on:{click:t.handleReject}},[t._v(" 驳回 ")])],1):t._e(),t.canRestartWorkflow?o("div",{staticClass:"restart-actions"},[o("el-button",{attrs:{type:"primary",size:"small",loading:t.restarting},on:{click:t.restartWorkflow}},[t._v(" 重新发起审批 ")])],1):t._e(),o("div",{staticClass:"other-actions"},[o("el-button",{attrs:{size:"small"},on:{click:function(s){t.showHistory=!t.showHistory}}},[t._v(" "+t._s(t.showHistory?"隐藏":"查看")+"处理历史 ")]),!t.canCancel||t.currentUserTask||t.canRestartWorkflow?t._e():o("el-button",{attrs:{type:"danger",size:"small",loading:t.cancelling},on:{click:t.cancelWorkflow}},[t._v(" 取消流程 ")])],1)]),t.showHistory&&t.workflowInstance?o("div",{staticClass:"workflow-history"},[o("div",{staticClass:"history-title"},[t._v("处理历史")]),o("div",{staticClass:"history-timeline"},t._l(t.processedHistory,(function(s,e){return o("div",{key:e,staticClass:"history-item"},[o("div",{staticClass:"history-time"},[t._v(t._s(t.formatDateTime(s.processed_at)))]),o("div",{staticClass:"history-content"},[o("div",{staticClass:"history-action"},[o("span",{staticClass:"history-node"},[t._v(t._s(s.node_name))]),o("el-tag",{attrs:{type:t.getProcessStatusType(s.action),size:"mini"}},[t._v(" "+t._s(t.getProcessStatusText(s.action))+" ")])],1),s.processor?o("div",{staticClass:"history-processor"},[t._v(" 处理人："+t._s(s.processor.real_name||s.processor.username)+" ")]):t._e(),s.comment?o("div",{staticClass:"history-comment"},[t._v(" 处理意见："+t._s(s.comment)+" ")]):t._e()])])})),0)]):t._e(),o("el-dialog",{attrs:{title:t.taskDialogTitle,visible:t.taskDialogVisible,width:"500px"},on:{"update:visible":function(s){t.taskDialogVisible=s},close:t.resetTaskDialog}},[o("el-form",{ref:"taskForm",attrs:{model:t.taskForm,rules:t.taskRules,"label-width":"80px"}},[o("el-form-item",{attrs:{label:"处理意见",prop:"comment"}},[o("el-input",{attrs:{type:"textarea",rows:4,placeholder:"请输入处理意见"},model:{value:t.taskForm.comment,callback:function(s){t.$set(t.taskForm,"comment",s)},expression:"taskForm.comment"}})],1),"back"===t.taskForm.action&&t.backableNodes.length>1?o("el-form-item",{attrs:{label:"退回到",prop:"backToNodeIndex"}},[o("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择要退回的节点"},model:{value:t.taskForm.backToNodeIndex,callback:function(s){t.$set(t.taskForm,"backToNodeIndex",s)},expression:"taskForm.backToNodeIndex"}},t._l(t.backableNodes,(function(s,e){return o("el-option",{key:e,attrs:{label:s.name,value:e}})})),1)],1):t._e(),"back"===t.taskForm.action&&1===t.backableNodes.length?o("el-form-item",{attrs:{label:"退回到"}},[o("el-tag",{attrs:{type:"info"}},[t._v(t._s(null===(e=t.backableNodes[0])||void 0===e?void 0:e.name))])],1):t._e()],1),o("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{on:{click:function(s){t.taskDialogVisible=!1}}},[t._v("取消")]),o("el-button",{attrs:{type:"primary",loading:t.processing},on:{click:t.submitTask}},[t._v("确定")])],1)],1),o("el-dialog",{attrs:{title:"发起审批流程",visible:t.startWorkflowDialogVisible,width:"600px"},on:{"update:visible":function(s){t.startWorkflowDialogVisible=s},close:t.handleStartDialogClose}},[t.workflowConfig?o("div",[o("h4",[t._v("工作流程："+t._s(t.workflowConfig.name))]),o("p",[t._v(t._s(t.workflowConfig.description))]),t.nodesNeedingAssignees.length>0?o("div",[o("h4",[t._v("请为以下节点选择审批人：")]),t.hasPreviousSelections?o("div",{staticClass:"previous-selection-hint"},[o("i",{staticClass:"el-icon-info"}),o("span",[t._v("已根据之前的选择预填审批人，您可以修改后重新发起")])]):t._e(),t._l(t.nodesNeedingAssignees,(function(s,e){return o("div",{key:e,staticClass:"node-assignee-selection"},[o("div",{staticClass:"node-info"},[o("strong",[t._v(t._s(s.name))]),o("span",{staticClass:"node-desc"},[t._v(t._s(s.description))])]),o("el-select",{staticStyle:{width:"100%","margin-top":"8px"},attrs:{placeholder:"请选择审批人"},model:{value:t.selectedAssignees[e],callback:function(s){t.$set(t.selectedAssignees,e,s)},expression:"selectedAssignees[index]"}},t._l(s.assignee,(function(s){return o("el-option",{key:s,attrs:{label:t.getUserName(s),value:s}})})),1)],1)}))],2):o("div",[o("p",[t._v("该工作流程将自动分配审批人，无需手动选择。")])])]):t._e(),o("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{on:{click:function(s){t.startWorkflowDialogVisible=!1}}},[t._v("取消")]),o("el-button",{attrs:{type:"primary",loading:t.starting,disabled:!t.canConfirmStart},on:{click:t.confirmStartWorkflow}},[t._v(" 确定发起 ")])],1)])],1)},a=[],i=(t("14d9"),t("e9f5"),t("d866"),t("910d"),t("f665"),t("7d54"),t("ab43"),t("f36f")),r=t("d4f4"),n=t("5f87"),l={name:"WorkflowProgress",props:{businessType:{type:String,required:!0},businessId:{type:[String,Number],required:!0},canStart:{type:Boolean,default:!0},createdBy:{type:[Number,String],default:null},canCancel:{type:Boolean,default:!0},workflowCode:{type:String,default:null}},data(){return{workflowInstance:null,processes:[],loading:!1,starting:!1,cancelling:!1,restarting:!1,showHistory:!1,processing:!1,taskDialogVisible:!1,taskDialogTitle:"",taskForm:{action:"",comment:"",backToNodeIndex:null},taskRules:{comment:[{required:!1,message:"请输入处理意见",trigger:"blur"}]},backableNodes:[],startWorkflowDialogVisible:!1,workflowConfig:null,selectedAssignees:[],userList:[]}},computed:{displayProcesses(){return this.processes&&this.processes.length?this.processes.filter((s,e)=>{if(0===e||e===this.processes.length-1)return!0;if(this.workflowInstance&&this.workflowInstance.workflow&&this.workflowInstance.workflow.nodes){const e=this.workflowInstance.workflow.nodes[s.node_index];if(e)return!1!==e.required}return"auto"!==s.action}):[]},progressPercentage(){if(!this.workflowInstance||!this.displayProcesses.length)return 0;if("completed"===this.workflowInstance.status)return 100;if("rejected"===this.workflowInstance.status)return 0;const s=this.displayProcesses.filter(s=>"approve"===s.action||"auto"===s.action).length;return Math.round(s/this.displayProcesses.length*100)},processedHistory(){return this.processes.filter(s=>"pending"!==s.action&&s.processed_at).sort((s,e)=>new Date(e.processed_at)-new Date(s.processed_at))},currentUserTask(){if(!this.workflowInstance||!this.processes.length)return null;let s=null;const e=Object(n["j"])();if(e&&e.id?s=e.id:this.$store&&this.$store.state&&this.$store.state.user?s=this.$store.state.user.id:localStorage.getItem("userId")&&(s=localStorage.getItem("userId")),!s)return null;const t=this.workflowInstance.current_node_index,o=this.processes.find(e=>e.node_index===t&&"pending"===e.action&&e.assignee_id===s);return o},isCreator(){const s=Object(n["j"])();return!!s&&(!this.createdBy||s.id===this.createdBy)},canStartWorkflow(){return this.canStart&&this.isCreator},canRestartWorkflow(){if(!this.workflowInstance||!this.isCreator)return!1;const s=0===this.workflowInstance.current_node_index,e="pending"===this.workflowInstance.status,t=!this.currentUserTask,o="rejected"===this.workflowInstance.status;return e&&s&&t||o},nodesNeedingAssignees(){return this.workflowConfig&&this.workflowConfig.nodes?this.workflowConfig.nodes.filter(s=>s.assignee&&Array.isArray(s.assignee)&&s.assignee.length>0):[]},canConfirmStart(){return 0===this.nodesNeedingAssignees.length||this.nodesNeedingAssignees.every((s,e)=>void 0!==this.selectedAssignees[e]&&null!==this.selectedAssignees[e])},hasPreviousSelections(){const s=this.getPreviousAssigneeSelections();return s&&Object.keys(s).length>0}},created(){this.loadWorkflowStatus()},watch:{businessId(s,e){s!==e&&this.loadWorkflowStatus()}},methods:{async showStartWorkflowDialog(){try{var s,e;await this.loadWorkflowConfig(),console.log("WorkflowProgress: 工作流配置加载完成",{workflowConfig:this.workflowConfig,nodes:null===(s=this.workflowConfig)||void 0===s?void 0:s.nodes,nodesNeedingAssignees:this.nodesNeedingAssignees,needsAssigneeSelection:this.nodesNeedingAssignees.length>0}),null!==(e=this.workflowConfig)&&void 0!==e&&e.nodes&&this.workflowConfig.nodes.forEach((s,e)=>{var t;console.log(`WorkflowProgress: 节点${e+1}:`,{name:s.name,assignee:s.assignee,assigneeLength:null===(t=s.assignee)||void 0===t?void 0:t.length,isArray:Array.isArray(s.assignee)})}),this.initSelectedAssignees(),0===this.nodesNeedingAssignees.length?(console.log("WorkflowProgress: 无需选择审批人，直接启动工作流"),await this.startWorkflow()):(console.log("WorkflowProgress: 需要选择审批人，显示对话框"),await this.loadUserList(),this.startWorkflowDialogVisible=!0)}catch(t){console.error("加载工作流配置失败:",t),this.$message.error("加载工作流配置失败")}},async loadWorkflowConfig(){try{console.log("WorkflowProgress: 开始加载工作流配置",{businessType:this.businessType,businessId:this.businessId,workflowCode:this.workflowCode});let e=this.workflowCode;if(!e){if("case"!==this.businessType)return void console.warn("WorkflowProgress: 未指定workflowCode，且不支持的businessType:",this.businessType);{const s=await r["a"].getCase(this.businessId);if(console.log("WorkflowProgress: 案例响应",s.data),!s.data||!s.data.success)return void console.error("WorkflowProgress: 案例响应失败",s.data);{const t=s.data.data,o=t.case_type;e="CASE_BUSINESS_FLOW",4===o&&(e="CASE_TECH_SERVICE_FLOW")}}}console.log("WorkflowProgress: 工作流查询参数",{finalWorkflowCode:e});const t=await this.$api.workflow.getList({code:e});if(console.log("WorkflowProgress: 工作流响应",t.data),t.data&&t.data.success){if(this.workflowConfig=t.data.data[0]||t.data.data,console.log("WorkflowProgress: 工作流配置已设置",this.workflowConfig),this.workflowConfig&&this.workflowConfig.nodes&&(console.log("WorkflowProgress: nodes类型",typeof this.workflowConfig.nodes),console.log("WorkflowProgress: nodes数据",this.workflowConfig.nodes),"string"===typeof this.workflowConfig.nodes))try{this.workflowConfig.nodes=JSON.parse(this.workflowConfig.nodes),console.log("WorkflowProgress: 解析后的nodes",this.workflowConfig.nodes)}catch(s){console.error("WorkflowProgress: nodes JSON解析失败",s)}}else console.error("WorkflowProgress: 工作流响应失败",t.data)}catch(e){console.error("WorkflowProgress: 加载工作流配置异常:",e)}},initSelectedAssignees(){const s=this.getPreviousAssigneeSelections();s&&Object.keys(s).length>0?(console.log("WorkflowProgress: 发现之前的审批人选择",s),this.selectedAssignees=this.nodesNeedingAssignees.map((e,t)=>{const o=this.workflowConfig.nodes.findIndex(s=>s.name===e.name);return s[o]||null})):this.selectedAssignees=new Array(this.nodesNeedingAssignees.length).fill(null),console.log("WorkflowProgress: 初始化审批人选择",this.selectedAssignees)},getPreviousAssigneeSelections(){if(!this.workflowInstance||!this.workflowInstance.processes)return null;const s={};return this.workflowInstance.processes.forEach(e=>{e.assignee_id&&e.node_index>0&&(s[e.node_index]=e.assignee_id)}),Object.keys(s).length>0?s:null},getUserName(s){const e=this.userList.find(e=>e.id===s);return e?e.real_name||e.username:"用户"+s},async loadUserList(){console.log("WorkflowProgress: 开始加载用户列表...");try{console.log("WorkflowProgress: 尝试调用 workflow.getAssignableUsers()");const s=await i["a"].getAssignableUsers();if(console.log("WorkflowProgress: API响应",s.data),s.data&&(s.data.success||0===s.data.code))return this.userList=s.data.data||[],console.log("WorkflowProgress: 通过工作流API加载用户列表成功",this.userList.length,"个用户"),console.log("WorkflowProgress: 用户数据示例",this.userList.slice(0,3)),void console.log("WorkflowProgress: 第一个用户的详细信息",this.userList[0]);console.error("WorkflowProgress: 工作流API响应格式不正确",s.data)}catch(e){var s;console.error("WorkflowProgress: 工作流用户API失败",e),console.error("WorkflowProgress: 错误详情",null===(s=e.response)||void 0===s?void 0:s.data)}try{const s=await Promise.resolve().then(t.bind(null,"c24f")),e=await s.default.getList();e.data&&e.data.success&&(this.userList=e.data.data.list||e.data.data||[],console.log("WorkflowProgress: 通过用户API加载用户列表成功",this.userList.length,"个用户"),console.log("WorkflowProgress: 用户数据示例",this.userList.slice(0,3)))}catch(e){console.error("WorkflowProgress: 用户API也失败",e),this.userList=[{id:1,real_name:"管理员",username:"admin"},{id:2,real_name:"张三",username:"zhangsan"},{id:3,real_name:"李四",username:"lisi"},{id:4,real_name:"王五",username:"wangwu"},{id:5,real_name:"赵六",username:"zhaoliu"},{id:6,real_name:"孙七",username:"sunqi"}],console.log("WorkflowProgress: 使用默认用户数据")}},handleStartDialogClose(){this.selectedAssignees=[],this.workflowConfig=null},async confirmStartWorkflow(){await this.startWorkflow(),this.startWorkflowDialogVisible=!1},async loadWorkflowStatus(){this.loading=!0;try{let s;"contract"===this.businessType?(s=await i["a"].getContractWorkflowStatus(this.businessId),s.data.success&&s.data.data?s.data.data.workflow_instance?(this.workflowInstance=s.data.data.workflow_instance,this.processes=s.data.data.workflow_instance.processes||[]):(this.workflowInstance=s.data.data,this.processes=s.data.data.processes||[]):(this.workflowInstance=null,this.processes=[])):"case"===this.businessType?(s=await i["a"].getBusinessStatus({business_type:"case",business_id:this.businessId}),0===s.data.code&&s.data.data?(this.workflowInstance=s.data.data,this.processes=s.data.data.processes||[]):(this.workflowInstance=null,this.processes=[])):(s=await i["a"].getBusinessStatus({business_type:this.businessType,business_id:this.businessId}),0===s.data.code&&s.data.data?(this.workflowInstance=s.data.data,this.processes=s.data.data.processes||[]):(this.workflowInstance=null,this.processes=[]))}catch(s){console.error("加载工作流状态失败:",s),s.response&&404===s.response.status&&(this.workflowInstance=null,this.processes=[])}finally{this.loading=!1}},async startWorkflow(){this.starting=!0;try{var s,e;let o;if("contract"===this.businessType)o=await i["a"].startContractWorkflow(this.businessId);else if("case"===this.businessType){const s={};this.nodesNeedingAssignees.forEach((e,t)=>{if(this.selectedAssignees[t]){const o=this.workflowConfig.nodes.findIndex(s=>s.name===e.name);-1!==o&&(s[o]=this.selectedAssignees[t])}}),console.log("WorkflowProgress: 发送给后端的assignees数据",s),o=await r["a"].startCaseWorkflow(this.businessId,{assignees:s})}else o=await i["a"].startInstance({business_type:this.businessType,business_id:this.businessId,business_title:"业务流程",workflow_id:1});var t;if(console.log("WorkflowProgress: 工作流启动响应",{response:o.data,success:null===(s=o.data)||void 0===s?void 0:s.success,code:null===(e=o.data)||void 0===e?void 0:e.code}),o.data&&(o.data.success||0===o.data.code))this.$message.success("审批流程已发起"),this.startWorkflowDialogVisible=!1,setTimeout(()=>{this.loadWorkflowStatus(),this.$emit("workflow-started")},1500);else this.$message.error((null===(t=o.data)||void 0===t?void 0:t.message)||"发起失败")}catch(a){var o;console.error("发起工作流失败:",a),this.$message.error("发起失败："+((null===(o=a.response)||void 0===o||null===(o=o.data)||void 0===o?void 0:o.message)||a.message))}finally{this.starting=!1}},async cancelWorkflow(){try{await this.$confirm("确定要取消当前审批流程吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),this.cancelling=!0;const s=await i["a"].cancelInstance(this.workflowInstance.id);0===s.data.code?(this.$message.success("审批流程已取消"),this.loadWorkflowStatus(),this.$emit("workflow-cancelled")):this.$message.error(s.data.msg||"取消失败")}catch(s){"cancel"!==s&&(console.error("取消工作流失败:",s),this.$message.error("取消失败"))}finally{this.cancelling=!1}},getStatusType(s){const e={pending:"warning",completed:"success",rejected:"danger",cancelled:"info"};return e[s]||"info"},getStatusText(s){const e={pending:"进行中",completed:"已完成",rejected:"已驳回",cancelled:"已取消"};return e[s]||"未知状态"},getStepClass(s,e){const t=["step"];if("approve"===s.action||"auto"===s.action)t.push("completed");else if("reject"===s.action)t.push("rejected");else if("pending"===s.action){const e=this.processes.findIndex(e=>e.id===s.id);this.workflowInstance&&e===this.workflowInstance.current_node_index?t.push("current"):t.push("waiting")}return t},getStepIcon(s){return"approve"===s.action||"auto"===s.action?"el-icon-check":"reject"===s.action?"el-icon-close":"pending"===s.action?"el-icon-time":"el-icon-minus"},getProcessStatusType(s){const e={pending:"warning",approve:"success",reject:"danger",auto:"info"};return e[s]||"info"},getProcessStatusText(s){const e={pending:"待处理",approve:"通过",reject:"驳回",auto:"自动通过"};return e[s]||"未知"},formatDate(s){return s?new Date(s).toLocaleDateString():""},formatDateTime(s){return s?new Date(s).toLocaleString():""},shouldShowDetails(s){const e=this.processes.findIndex(e=>e.id===s.id);return!(0===e||e===this.processes.length-1)},shouldShowComment(s){const e=this.processes.findIndex(e=>e.id===s.id);return!(0===e||e===this.processes.length-1)},isStepCompleted(s){return"approve"===s.action||"auto"===s.action},handleApprove(){this.taskForm.action="approve",this.taskDialogTitle="审批通过",this.taskForm.comment="通过",this.taskDialogVisible=!0},async handleReject(){this.taskForm.action="back",this.taskDialogTitle="审批驳回";try{const s=await i["a"].getBackableNodes(this.workflowInstance.id);if(s.data.success||0===s.data.code){const e=s.data.data||[];if(this.backableNodes=e,0===this.backableNodes.length)return void this.$message.error("没有可退回的节点");1===this.backableNodes.length&&(this.taskForm.backToNodeIndex=0,this.$message.info("将退回到："+this.backableNodes[0].name)),this.taskDialogVisible=!0}else this.$message.error(s.data.message||s.data.msg||"获取可退回节点失败")}catch(s){console.error("获取可退回节点失败:",s),this.$message.error("获取可退回节点失败")}},async submitTask(){if(this.currentUserTask)if("back"!==this.taskForm.action||this.taskForm.comment.trim()){if("back"===this.taskForm.action){if(this.backableNodes.length>1&&null===this.taskForm.backToNodeIndex)return void this.$message.error("请选择要退回的节点");1===this.backableNodes.length&&null===this.taskForm.backToNodeIndex&&(this.taskForm.backToNodeIndex=0)}this.processing=!0;try{const s={action:this.taskForm.action,comment:this.taskForm.comment};if("back"===this.taskForm.action){const e=this.backableNodes[this.taskForm.backToNodeIndex];s.back_to_node_index=e?e.index:0}const e=await i["a"].processTask(this.currentUserTask.id,s);e.data.success||0===e.data.code?(this.$message.success("处理成功"),this.taskDialogVisible=!1,setTimeout(()=>{this.loadWorkflowStatus(),this.$emit("task-processed")},1e3)):this.$message.error(e.data.message||e.data.msg||"处理失败")}catch(s){console.error("处理任务失败:",s),s.response&&s.response.data?this.$message.error(s.response.data.msg||s.response.data.message||"处理失败"):this.$message.error("处理失败")}finally{this.processing=!1}}else this.$message.error("驳回操作必须输入处理意见");else this.$message.error("没有找到待处理任务")},resetTaskDialog(){this.taskForm={action:"",comment:"",backToNodeIndex:null},this.backableNodes=[],this.$refs.taskForm&&this.$refs.taskForm.resetFields()},async restartWorkflow(){try{await this.$confirm("确定要重新发起审批流程吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),console.log("WorkflowProgress: 重新发起工作流，检查是否需要选人"),await this.showStartWorkflowDialog()}catch(s){"cancel"!==s&&(console.error("重新发起工作流失败:",s),this.$message.error("重新发起失败"))}},refresh(){this.workflowInstance=null,this.processes=[],this.loadWorkflowStatus()}}},c=l,d=(t("5c25"),t("2877")),g=Object(d["a"])(c,o,a,!1,null,"419e7429",null);e["a"]=g.exports},"4e1d":function(s,e,t){},"5c25":function(s,e,t){"use strict";t("4e1d")},d4f4:function(s,e,t){"use strict";var o=t("c1fb"),a=t("a417");e["a"]={getCaseList(s){return o["a"].get(a["a"].host+"/api/contract-cases",{params:s})},getCase(s){return o["a"].get(a["a"].host+"/api/contract-cases/"+s)},createCase(s){return o["a"].post(a["a"].host+"/api/contract-cases",s)},updateCase(s,e){return o["a"].put(a["a"].host+"/api/contract-cases/"+s,e)},updatePatentCase(s,e){return o["a"].put(a["a"].host+"/api/contract-cases/"+s,e)},deleteCase(s){return o["a"].delete(a["a"].host+"/api/contract-cases/"+s)},startCaseWorkflow(s,e){return o["a"].post(a["a"].host+"/api/contract-cases/"+s+"/start-workflow",e)},getCaseStatusOptions(){return o["a"].get(a["a"].host+"/api/contract-cases/options/case-statuses")},getCaseTypeOptions(){return[{label:"全部",value:"all"},{label:"专利",value:"patent"},{label:"商标",value:"trademark"},{label:"版权",value:"copyright"},{label:"科服",value:"project"}]},getBusinessTypeOptions(){return[{label:"发明专利",value:"发明专利"},{label:"实用新型",value:"实用新型"},{label:"外观设计",value:"外观设计"},{label:"商标注册",value:"商标注册"},{label:"商标续展",value:"商标续展"},{label:"商标变更",value:"商标变更"},{label:"软件著作权",value:"软件著作权"},{label:"作品著作权",value:"作品著作权"},{label:"高新认定",value:"高新认定"},{label:"科技项目",value:"科技项目"},{label:"其他",value:"其他"}]},getApplyTypeOptions(){return[{label:"国内申请",value:"国内申请"},{label:"国际申请",value:"国际申请"},{label:"PCT申请",value:"PCT申请"},{label:"科技项目",value:"科技项目"},{label:"其他",value:"其他"}]},getStatusOptions(){return[{label:"草稿",value:"draft"},{label:"审核中",value:"pending"},{label:"已提交",value:"to-be-filed"}]}}}}]);