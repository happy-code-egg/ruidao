(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2ba8ca98"],{"3c72":function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t._self._c;return e("div",{staticClass:"invoice-history-container"},[e("div",{staticClass:"body-part-search"},[e("el-form",{attrs:{model:t.searchForm,"label-width":"100px"}},[e("el-row",[e("el-col",{attrs:{span:6}},[e("el-form-item",{attrs:{label:"申请单号"}},[e("el-input",{attrs:{size:"small",placeholder:"请输入申请单号"},model:{value:t.searchForm.applicationNo,callback:function(e){t.$set(t.searchForm,"applicationNo",e)},expression:"searchForm.applicationNo"}})],1)],1),e("el-col",{attrs:{span:6}},[e("el-form-item",{attrs:{label:"申请人"}},[e("el-input",{attrs:{size:"small",placeholder:"请输入申请人"},model:{value:t.searchForm.applicant,callback:function(e){t.$set(t.searchForm,"applicant",e)},expression:"searchForm.applicant"}})],1)],1),e("el-col",{attrs:{span:6}},[e("el-form-item",{attrs:{label:"客户名称"}},[e("el-input",{attrs:{size:"small",placeholder:"请输入客户名称"},model:{value:t.searchForm.clientName,callback:function(e){t.$set(t.searchForm,"clientName",e)},expression:"searchForm.clientName"}})],1)],1),e("el-col",{attrs:{span:6}},[e("el-form-item",{attrs:{label:"所属部门"}},[e("el-select",{attrs:{size:"small",placeholder:"请选择"},model:{value:t.searchForm.department,callback:function(e){t.$set(t.searchForm,"department",e)},expression:"searchForm.department"}},[e("el-option",{attrs:{label:"全部",value:""}}),e("el-option",{attrs:{label:"信息与商务管理学院",value:"info_management"}}),e("el-option",{attrs:{label:"财务部",value:"finance"}}),e("el-option",{attrs:{label:"商务部",value:"business"}}),e("el-option",{attrs:{label:"技术部",value:"technology"}})],1)],1)],1)],1),e("el-row",[e("el-col",{attrs:{span:6}},[e("el-form-item",{attrs:{label:"发票类型"}},[e("el-select",{attrs:{size:"small",placeholder:"请选择"},model:{value:t.searchForm.invoiceType,callback:function(e){t.$set(t.searchForm,"invoiceType",e)},expression:"searchForm.invoiceType"}},[e("el-option",{attrs:{label:"全部",value:""}}),e("el-option",{attrs:{label:"增值税专用发票",value:"special"}}),e("el-option",{attrs:{label:"增值税普通发票",value:"general"}}),e("el-option",{attrs:{label:"电子发票",value:"electronic"}})],1)],1)],1),e("el-col",{attrs:{span:6}},[e("el-form-item",{attrs:{label:"最终状态"}},[e("el-select",{attrs:{size:"small",placeholder:"请选择"},model:{value:t.searchForm.finalStatus,callback:function(e){t.$set(t.searchForm,"finalStatus",e)},expression:"searchForm.finalStatus"}},[e("el-option",{attrs:{label:"全部",value:""}}),e("el-option",{attrs:{label:"已完成",value:"completed"}}),e("el-option",{attrs:{label:"已取消",value:"cancelled"}}),e("el-option",{attrs:{label:"已退回",value:"returned"}})],1)],1)],1),e("el-col",{attrs:{span:6}},[e("el-form-item",{attrs:{label:"时间范围"}},[e("el-select",{attrs:{size:"small",placeholder:"请选择"},on:{change:t.onTimeRangeChange},model:{value:t.searchForm.timeRange,callback:function(e){t.$set(t.searchForm,"timeRange",e)},expression:"searchForm.timeRange"}},[e("el-option",{attrs:{label:"最近一周",value:"week"}}),e("el-option",{attrs:{label:"最近一月",value:"month"}}),e("el-option",{attrs:{label:"最近三月",value:"quarter"}}),e("el-option",{attrs:{label:"最近一年",value:"year"}}),e("el-option",{attrs:{label:"自定义",value:"custom"}})],1)],1)],1),e("el-col",{attrs:{span:6}},["custom"===t.searchForm.timeRange?e("el-form-item",{attrs:{label:"完成时间"}},[e("el-date-picker",{attrs:{size:"small",type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期"},model:{value:t.searchForm.completedDate,callback:function(e){t.$set(t.searchForm,"completedDate",e)},expression:"searchForm.completedDate"}})],1):t._e()],1)],1)],1),e("div",{staticClass:"part-search-buttons"},[e("el-button",{attrs:{size:"small",type:"primary"},on:{click:t.handleSearch}},[t._v("查询")]),e("el-button",{attrs:{size:"small"},on:{click:t.handleReset}},[t._v("重置")]),e("el-button",{attrs:{size:"small",type:"success"},on:{click:t.handleExport}},[t._v("导出报表")]),e("el-button",{attrs:{size:"small",type:"info"},on:{click:t.showStatistics}},[t._v("统计分析")])],1)],1),e("div",{staticClass:"body-part-content"},[t._m(0),"list"===t.viewMode?e("div",{staticClass:"list-view"},[e("el-table",{staticStyle:{width:"100%"},attrs:{size:"small",data:t.tableData,border:""}},[e("el-table-column",{attrs:{type:"index",label:"序号",width:"60"}}),e("el-table-column",{attrs:{prop:"applicationNo",label:"申请单号","show-overflow-tooltip":""}}),e("el-table-column",{attrs:{prop:"applicant",label:"申请人","show-overflow-tooltip":""}}),e("el-table-column",{attrs:{prop:"department",label:"所属部门","show-overflow-tooltip":""}}),e("el-table-column",{attrs:{prop:"contractName",label:"合同名称",width:"160","show-overflow-tooltip":""}}),e("el-table-column",{attrs:{prop:"clientName",label:"客户名称","show-overflow-tooltip":""}}),e("el-table-column",{attrs:{prop:"invoiceAmount",label:"开票金额","show-overflow-tooltip":""},scopedSlots:t._u([{key:"default",fn:function(a){return[e("span",[t._v(t._s(t._f("currency")(a.row.invoiceAmount)))])]}}],null,!1,650965605)}),e("el-table-column",{attrs:{prop:"invoiceType",label:"发票类型","show-overflow-tooltip":""}}),e("el-table-column",{attrs:{prop:"finalStatus",label:"最终状态",width:"100","show-overflow-tooltip":""},scopedSlots:t._u([{key:"default",fn:function(a){return[e("el-tag",{attrs:{type:t.getStatusType(a.row.finalStatus),size:"small"}},[t._v(t._s(t.getStatusText(a.row.finalStatus)))])]}}],null,!1,1656469313)}),e("el-table-column",{attrs:{prop:"applicationDate",label:"申请时间","show-overflow-tooltip":""}}),e("el-table-column",{attrs:{prop:"completedDate",label:"完成时间","show-overflow-tooltip":""}}),e("el-table-column",{attrs:{prop:"duration",label:"处理耗时",width:"100","show-overflow-tooltip":""},scopedSlots:t._u([{key:"default",fn:function(a){return[e("span",{class:t.getDurationClass(a.row.duration)},[t._v(t._s(a.row.duration)+"天")])]}}],null,!1,3101438141)}),e("el-table-column",{attrs:{fixed:"right",label:"操作",width:"150"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("el-button",{attrs:{size:"small",type:"text"},on:{click:function(e){return t.handleViewDetail(a.row)}}},[t._v("查看详情")]),e("el-button",{attrs:{size:"small",type:"text"},on:{click:function(e){return t.handleViewHistory(a.row)}}},[t._v("流程历史")])]}}],null,!1,1861718004)})],1),e("el-pagination",{attrs:{"current-page":t.currentPage,"page-sizes":[10,20,30,50],"page-size":t.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:t.total},on:{"size-change":t.handleSizeChange,"current-change":t.handleCurrentChange}})],1):t._e(),"timeline"===t.viewMode?e("div",{staticClass:"timeline-view"},[e("div",{staticClass:"timeline-filters"},[e("el-date-picker",{attrs:{type:"date",placeholder:"选择查看日期"},on:{change:t.loadTimelineData},model:{value:t.timelineDate,callback:function(e){t.timelineDate=e},expression:"timelineDate"}})],1),e("el-timeline",t._l(t.timelineData,(function(a,s){return e("el-timeline-item",{key:s,attrs:{timestamp:a.timestamp,type:a.type,icon:a.icon}},[e("el-card",{staticClass:"timeline-card"},[e("div",{staticClass:"timeline-header"},[e("span",{staticClass:"timeline-title"},[t._v(t._s(a.title))]),e("el-tag",{attrs:{type:a.statusType,size:"small"}},[t._v(t._s(a.status))])],1),e("div",{staticClass:"timeline-content"},[e("p",[e("strong",[t._v("申请单号：")]),t._v(t._s(a.applicationNo))]),e("p",[e("strong",[t._v("申请人：")]),t._v(t._s(a.applicant))]),e("p",[e("strong",[t._v("金额：")]),t._v(t._s(t._f("currency")(a.amount)))]),a.comment?e("p",[e("strong",[t._v("备注：")]),t._v(t._s(a.comment))]):t._e()]),e("div",{staticClass:"timeline-actions"},[e("el-button",{attrs:{size:"small",type:"text"},on:{click:function(e){return t.handleViewDetail(a)}}},[t._v("查看详情")])],1)])],1)})),1)],1):t._e(),"chart"===t.viewMode?e("div",{staticClass:"chart-view"},[e("el-row",{attrs:{gutter:20}},[e("el-col",{attrs:{span:12}},[e("el-card",{attrs:{title:"月度开票统计"}},[e("div",{ref:"monthlyChart",staticClass:"chart-container"})])],1),e("el-col",{attrs:{span:12}},[e("el-card",{attrs:{title:"发票类型分布"}},[e("div",{ref:"typeChart",staticClass:"chart-container"})])],1)],1),e("el-row",{staticStyle:{"margin-top":"20px"},attrs:{gutter:20}},[e("el-col",{attrs:{span:12}},[e("el-card",{attrs:{title:"部门开票排行"}},[e("div",{ref:"departmentChart",staticClass:"chart-container"})])],1),e("el-col",{attrs:{span:12}},[e("el-card",{attrs:{title:"处理效率分析"}},[e("div",{ref:"efficiencyChart",staticClass:"chart-container"})])],1)],1)],1):t._e()]),e("el-dialog",{attrs:{title:t.detailDialogTitle,visible:t.detailDialogVisible,width:"80%",top:"5vh"},on:{"update:visible":function(e){t.detailDialogVisible=e}}},[e("div",{staticClass:"detail-content"},[e("el-descriptions",{attrs:{column:3,border:""}},[e("el-descriptions-item",{attrs:{label:"申请单号"}},[t._v(t._s(t.currentDetail.applicationNo))]),e("el-descriptions-item",{attrs:{label:"申请人"}},[t._v(t._s(t.currentDetail.applicant))]),e("el-descriptions-item",{attrs:{label:"所属部门"}},[t._v(t._s(t.currentDetail.department))]),e("el-descriptions-item",{attrs:{label:"合同名称"}},[t._v(t._s(t.currentDetail.contractName))]),e("el-descriptions-item",{attrs:{label:"客户名称"}},[t._v(t._s(t.currentDetail.clientName))]),e("el-descriptions-item",{attrs:{label:"开票金额"}},[t._v(t._s(t._f("currency")(t.currentDetail.invoiceAmount)))]),e("el-descriptions-item",{attrs:{label:"发票类型"}},[t._v(t._s(t.currentDetail.invoiceType))]),e("el-descriptions-item",{attrs:{label:"申请时间"}},[t._v(t._s(t.currentDetail.applicationDate))]),e("el-descriptions-item",{attrs:{label:"完成时间"}},[t._v(t._s(t.currentDetail.completedDate))]),e("el-descriptions-item",{attrs:{label:"最终状态"}},[e("el-tag",{attrs:{type:t.getStatusType(t.currentDetail.finalStatus),size:"small"}},[t._v(t._s(t.getStatusText(t.currentDetail.finalStatus)))])],1),e("el-descriptions-item",{attrs:{label:"处理耗时"}},[e("span",{class:t.getDurationClass(t.currentDetail.duration)},[t._v(t._s(t.currentDetail.duration)+"天")])])],1)],1),e("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{on:{click:function(e){t.detailDialogVisible=!1}}},[t._v("关闭")])],1)]),e("el-dialog",{attrs:{title:"流程历史",visible:t.historyDialogVisible,width:"70%",top:"5vh"},on:{"update:visible":function(e){t.historyDialogVisible=e}}},[e("div",{staticClass:"history-content"},[e("el-timeline",t._l(t.processHistory,(function(a,s){return e("el-timeline-item",{key:s,attrs:{timestamp:a.timestamp,type:a.type}},[e("div",{staticClass:"history-item"},[e("div",{staticClass:"history-header"},[e("span",{staticClass:"history-step"},[t._v(t._s(a.step))]),e("span",{staticClass:"history-handler"},[t._v(t._s(a.handler))]),a.duration?e("span",{staticClass:"history-duration"},[t._v("耗时："+t._s(a.duration))]):t._e()]),e("div",{staticClass:"history-status"},[e("el-tag",{attrs:{type:a.statusType,size:"small"}},[t._v(t._s(a.status))])],1),a.comment?e("div",{staticClass:"history-comment"},[t._v(" "+t._s(a.comment)+" ")]):t._e()])])})),1)],1),e("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{on:{click:function(e){t.historyDialogVisible=!1}}},[t._v("关闭")])],1)]),e("el-dialog",{attrs:{title:"统计分析",visible:t.statisticsDialogVisible,width:"90%",top:"3vh"},on:{"update:visible":function(e){t.statisticsDialogVisible=e}}},[e("div",{staticClass:"statistics-content"},[e("el-row",{attrs:{gutter:20}},[e("el-col",{attrs:{span:6}},[e("div",{staticClass:"stat-card"},[e("div",{staticClass:"stat-number"},[t._v(t._s(t.statistics.totalCount))]),e("div",{staticClass:"stat-label"},[t._v("总申请数")])])]),e("el-col",{attrs:{span:6}},[e("div",{staticClass:"stat-card"},[e("div",{staticClass:"stat-number"},[t._v(t._s(t.statistics.completedCount))]),e("div",{staticClass:"stat-label"},[t._v("已完成数")])])]),e("el-col",{attrs:{span:6}},[e("div",{staticClass:"stat-card"},[e("div",{staticClass:"stat-number"},[t._v(t._s(t._f("currency")(t.statistics.totalAmount)))]),e("div",{staticClass:"stat-label"},[t._v("总开票金额")])])]),e("el-col",{attrs:{span:6}},[e("div",{staticClass:"stat-card"},[e("div",{staticClass:"stat-number"},[t._v(t._s(t.statistics.avgDuration)+"天")]),e("div",{staticClass:"stat-label"},[t._v("平均处理时长")])])])],1),e("el-row",{staticStyle:{"margin-top":"20px"},attrs:{gutter:20}},[e("el-col",{attrs:{span:12}},[e("h4",[t._v("各部门处理效率")]),e("el-table",{attrs:{data:t.statistics.departmentStats,size:"small"}},[e("el-table-column",{attrs:{prop:"department",label:"部门"}}),e("el-table-column",{attrs:{prop:"count",label:"申请数量"}}),e("el-table-column",{attrs:{prop:"avgDuration",label:"平均耗时(天)"}}),e("el-table-column",{attrs:{prop:"completionRate",label:"完成率"},scopedSlots:t._u([{key:"default",fn:function(t){return[e("el-progress",{attrs:{percentage:t.row.completionRate,"stroke-width":8}})]}}])})],1)],1),e("el-col",{attrs:{span:12}},[e("h4",[t._v("月度趋势分析")]),e("el-table",{attrs:{data:t.statistics.monthlyStats,size:"small"}},[e("el-table-column",{attrs:{prop:"month",label:"月份"}}),e("el-table-column",{attrs:{prop:"count",label:"申请数量"}}),e("el-table-column",{attrs:{prop:"amount",label:"金额"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(t._f("currency")(e.row.amount))+" ")]}}])}),e("el-table-column",{attrs:{prop:"avgDuration",label:"平均耗时(天)"}})],1)],1)],1)],1),e("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{on:{click:function(e){t.statisticsDialogVisible=!1}}},[t._v("关闭")])],1)])],1)},l=[function(){var t=this,e=t._self._c;return e("div",{staticClass:"part-table-header"},[e("div",{staticClass:"part-table-title"},[t._v(" 发票历史记录 ")])])}],i=(a("e9f5"),a("ab43"),{name:"InvoiceHistory",data(){return{searchForm:{applicationNo:"",applicant:"",clientName:"",department:"",invoiceType:"",finalStatus:"",timeRange:"month",completedDate:""},tableData:[],currentPage:1,pageSize:20,total:0,viewMode:"list",timelineDate:new Date,timelineData:[],detailDialogVisible:!1,detailDialogTitle:"申请详情",currentDetail:{},historyDialogVisible:!1,processHistory:[],statisticsDialogVisible:!1,statistics:{totalCount:0,completedCount:0,totalAmount:0,avgDuration:0,departmentStats:[],monthlyStats:[]}}},filters:{currency(t){return t?"¥"+parseFloat(t).toLocaleString("zh-CN",{minimumFractionDigits:2,maximumFractionDigits:2}):"¥0.00"}},created(){this.getList(),this.loadTimelineData()},mounted(){"chart"===this.viewMode&&this.initCharts()},methods:{getList(){this.tableData=Array.from({length:30}).map((t,e)=>{const a=new Date;a.setDate(a.getDate()-90*Math.random());const s=Math.floor(15*Math.random())+1,l=new Date(a);return l.setDate(l.getDate()+s),{id:e+1,applicationNo:"FPSP"+(2025e3+e),applicant:"申请人"+(e+1),department:["信息与商务管理学院","财务部","商务部","技术部"][e%4],contractName:`${["技术服务","软件开发","系统维护","设备采购"][e%4]}合同${String(e+1).padStart(3,"0")}`,clientName:"客户"+(e+1),invoiceAmount:1e4+5e3*e,invoiceType:["增值税专用发票","增值税普通发票","电子发票"][e%3],finalStatus:["completed","cancelled","returned"][e%10<8?0:e%10<9?1:2],applicationDate:a.toISOString().split("T")[0],completedDate:l.toISOString().split("T")[0],duration:s}}).sort((t,e)=>new Date(e.completedDate)-new Date(t.completedDate)),this.total=100},loadTimelineData(){this.timelineData=[{timestamp:"14:30",type:"success",icon:"el-icon-check",title:"发票申请完成",status:"已完成",statusType:"success",applicationNo:"FPSP2025001",applicant:"张三",amount:5e4,comment:"审批流程顺利完成"},{timestamp:"11:20",type:"primary",icon:"el-icon-edit",title:"发票申请提交",status:"审核中",statusType:"warning",applicationNo:"FPSP2025002",applicant:"李四",amount:3e4,comment:"已提交部门审核"},{timestamp:"09:15",type:"warning",icon:"el-icon-warning",title:"发票申请退回",status:"已退回",statusType:"danger",applicationNo:"FPSP2025003",applicant:"王五",amount:25e3,comment:"信息不完整，需要补充材料"}]},initCharts(){console.log("初始化图表")},handleSearch(){console.log("搜索条件:",this.searchForm),this.currentPage=1,this.getList()},handleReset(){this.searchForm={applicationNo:"",applicant:"",clientName:"",department:"",invoiceType:"",finalStatus:"",timeRange:"month",completedDate:""},this.getList()},handleExport(){this.$message.info("导出功能开发中...")},showStatistics(){this.loadStatistics(),this.statisticsDialogVisible=!0},onTimeRangeChange(t){"custom"!==t&&(this.searchForm.completedDate="")},onViewModeChange(t){"chart"===t&&this.$nextTick(()=>{this.initCharts()})},handleViewDetail(t){this.currentDetail=t,this.detailDialogTitle="申请详情",this.detailDialogVisible=!0},handleViewHistory(t){this.loadProcessHistory(t.id),this.historyDialogVisible=!0},loadProcessHistory(t){this.processHistory=[{step:"申请提交",handler:"申请人",timestamp:"2025-07-20 09:00",type:"primary",status:"已提交",statusType:"success",comment:"提交开票申请",duration:""},{step:"部门审核",handler:"部门主管",timestamp:"2025-07-20 14:30",type:"success",status:"审核通过",statusType:"success",comment:"部门审核通过",duration:"5.5小时"},{step:"财务审核",handler:"财务人员",timestamp:"2025-07-21 10:15",type:"success",status:"审核通过",statusType:"success",comment:"财务审核通过",duration:"19.75小时"},{step:"领导审批",handler:"部门领导",timestamp:"2025-07-21 16:20",type:"success",status:"审批通过",statusType:"success",comment:"领导审批通过",duration:"6小时"},{step:"开票完成",handler:"财务人员",timestamp:"2025-07-22 11:00",type:"success",status:"已完成",statusType:"success",comment:"发票开具完成",duration:"18.67小时"}]},loadStatistics(){this.statistics={totalCount:120,completedCount:96,totalAmount:56e5,avgDuration:3.2,departmentStats:[{department:"信息与商务管理学院",count:45,avgDuration:2.8,completionRate:92},{department:"财务部",count:28,avgDuration:3.1,completionRate:89},{department:"商务部",count:32,avgDuration:3.5,completionRate:85},{department:"技术部",count:15,avgDuration:4.2,completionRate:80}],monthlyStats:[{month:"2025-04",count:28,amount:12e5,avgDuration:3.1},{month:"2025-05",count:35,amount:158e4,avgDuration:2.9},{month:"2025-06",count:42,amount:189e4,avgDuration:3.3},{month:"2025-07",count:15,amount:93e4,avgDuration:3}]}},getStatusType(t){const e={completed:"success",cancelled:"info",returned:"danger"};return e[t]||"info"},getStatusText(t){const e={completed:"已完成",cancelled:"已取消",returned:"已退回"};return e[t]||t},getDurationClass(t){return t<=3?"duration-fast":t<=7?"duration-normal":"duration-slow"},handleSizeChange(t){this.pageSize=t,this.getList()},handleCurrentChange(t){this.currentPage=t,this.getList()}}}),o=i,n=(a("9aed"),a("2877")),r=Object(n["a"])(o,s,l,!1,null,"4a187531",null);e["default"]=r.exports},"907a":function(t,e,a){},"9aed":function(t,e,a){"use strict";a("907a")}}]);