(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-6431052b"],{"13d5":function(e,t,a){"use strict";var r=a("23e7"),s=a("d58f").left,l=a("a640"),o=a("1212"),i=a("9adc"),n=!i&&o>79&&o<83,c=n||!l("reduce");r({target:"Array",proto:!0,forced:c},{reduce:function(e){var t=arguments.length;return s(this,e,t,t>1?arguments[1]:void 0)}})},"50f7":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("div",{staticClass:"app-container"},[t("div",{staticClass:"body-part-header"},[t("div",{staticClass:"page-header"},[t("el-button",{attrs:{size:"small",type:"primary"},on:{click:e.handleAdd}},[e._v("流转")]),t("el-button",{attrs:{size:"small",type:"warning"},on:{click:e.handleReturn}},[e._v("退回")]),t("el-button",{attrs:{size:"small",type:"danger"},on:{click:e.handleDelete}},[e._v("删除")])],1),t("el-form",{ref:"detailForm",attrs:{model:e.detailForm,"label-width":"120px"}},[t("el-row",[t("el-col",{attrs:{span:6}},[t("el-form-item",{attrs:{label:"项目号"}},[t("el-input",{attrs:{size:"small",placeholder:"单行输入",disabled:""},model:{value:e.detailForm.caseNumber,callback:function(t){e.$set(e.detailForm,"caseNumber",t)},expression:"detailForm.caseNumber"}})],1)],1),t("el-col",{attrs:{span:6}},[t("el-form-item",{attrs:{label:"提案名称"}},[t("el-input",{attrs:{size:"small",placeholder:"单行输入",disabled:""},model:{value:e.detailForm.proposalName,callback:function(t){e.$set(e.detailForm,"proposalName",t)},expression:"detailForm.proposalName"}})],1)],1),t("el-col",{attrs:{span:6}},[t("el-form-item",{attrs:{label:"客户名称"}},[t("el-input",{attrs:{size:"small",placeholder:"单行输入",disabled:""},model:{value:e.detailForm.clientName,callback:function(t){e.$set(e.detailForm,"clientName",t)},expression:"detailForm.clientName"}})],1)],1),t("el-col",{attrs:{span:6}},[t("el-form-item",{attrs:{label:"项目名称"}},[t("el-input",{attrs:{size:"small",placeholder:"单行输入",disabled:""},model:{value:e.detailForm.caseName,callback:function(t){e.$set(e.detailForm,"caseName",t)},expression:"detailForm.caseName"}})],1)],1)],1),t("el-row",[t("el-col",{attrs:{span:6}},[t("el-form-item",{attrs:{label:"申请类型"}},[t("el-select",{attrs:{size:"small",placeholder:"请选择",disabled:""},model:{value:e.detailForm.applicationType,callback:function(t){e.$set(e.detailForm,"applicationType",t)},expression:"detailForm.applicationType"}},[t("el-option",{attrs:{label:"发明专利",value:"invention"}}),t("el-option",{attrs:{label:"实用新型",value:"utility"}}),t("el-option",{attrs:{label:"外观设计",value:"design"}})],1)],1)],1),t("el-col",{attrs:{span:6}},[t("el-form-item",{attrs:{label:"业务人员"}},[t("el-select",{attrs:{size:"small",placeholder:"后台配置选人",disabled:""},model:{value:e.detailForm.businessStaff,callback:function(t){e.$set(e.detailForm,"businessStaff",t)},expression:"detailForm.businessStaff"}},[t("el-option",{attrs:{label:"王业务",value:"wangyewu"}}),t("el-option",{attrs:{label:"刘业务",value:"liuyewu"}}),t("el-option",{attrs:{label:"孙业务",value:"sunyewu"}})],1)],1)],1),t("el-col",{attrs:{span:6}},[t("el-form-item",{attrs:{label:"核稿人"}},[t("el-input",{attrs:{size:"small",placeholder:"带出来的",disabled:""},model:{value:e.detailForm.reviewer,callback:function(t){e.$set(e.detailForm,"reviewer",t)},expression:"detailForm.reviewer"}})],1)],1),t("el-col",{attrs:{span:6}},[t("el-form-item",{attrs:{label:"双报项目"}},[t("el-input",{staticStyle:{width:"50%"},attrs:{size:"small",placeholder:"双报项目 双报项目 或类型 三选一",disabled:""},model:{value:e.detailForm.dualReportCase,callback:function(t){e.$set(e.detailForm,"dualReportCase",t)},expression:"detailForm.dualReportCase"}})],1)],1)],1),t("el-row",[t("el-col",{attrs:{span:2}},[t("el-form-item",[t("el-checkbox",{model:{value:e.detailForm.preReviewCase,callback:function(t){e.$set(e.detailForm,"preReviewCase",t)},expression:"detailForm.preReviewCase"}},[e._v("预审项目")])],1)],1),t("el-col",{attrs:{span:2}},[t("el-form-item",[t("el-checkbox",{model:{value:e.detailForm.priorityReview,callback:function(t){e.$set(e.detailForm,"priorityReview",t)},expression:"detailForm.priorityReview"}},[e._v("优先审查")])],1)],1),t("el-col",{attrs:{span:2}},[t("el-form-item",[t("el-checkbox",{model:{value:e.detailForm.earlyPublication,callback:function(t){e.$set(e.detailForm,"earlyPublication",t)},expression:"detailForm.earlyPublication"}},[e._v("提前公开")])],1)],1),t("el-col",{attrs:{span:2}},[t("el-form-item",[t("el-checkbox",{model:{value:e.detailForm.simultaneousSubmission,callback:function(t){e.$set(e.detailForm,"simultaneousSubmission",t)},expression:"detailForm.simultaneousSubmission"}},[e._v("同时提交申请")])],1)],1)],1),t("el-row"),t("el-row",[t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:"项目备注"}},[t("el-input",{attrs:{type:"textarea",rows:3,placeholder:"单行输入",disabled:""},model:{value:e.detailForm.caseRemarks,callback:function(t){e.$set(e.detailForm,"caseRemarks",t)},expression:"detailForm.caseRemarks"}})],1)],1)],1),t("el-row",[t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:"专利撰写文件"}},[t("el-button",{attrs:{size:"small",type:"primary"}},[e._v("上传")])],1)],1)],1)],1)],1),t("div",{staticClass:"body-part-table"},[t("el-table",{staticStyle:{width:"100%"},attrs:{data:e.fileTableData,border:""}},[t("el-table-column",{attrs:{type:"index",label:"序号",width:"60",align:"center"}}),t("el-table-column",{attrs:{prop:"fileName",label:"文件",width:"200"}}),t("el-table-column",{attrs:{prop:"fileCategory",label:"文件大类",width:"120"}}),t("el-table-column",{attrs:{prop:"fileSubCategory",label:"文件小类",width:"120"}}),t("el-table-column",{attrs:{prop:"fileDisplayName",label:"文件名称","show-overflow-tooltip":""}}),t("el-table-column",{attrs:{prop:"uploader",label:"上传人员",width:"120"}}),t("el-table-column",{attrs:{prop:"uploadTime",label:"上传时间",width:"150"}}),t("el-table-column",{attrs:{label:"操作",width:"120"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-button",{attrs:{size:"mini",type:"text"},on:{click:function(t){return e.downloadFile(a.row)}}},[e._v("下载")]),t("el-button",{attrs:{size:"mini",type:"text"},on:{click:function(t){return e.deleteFile(a.row)}}},[e._v("删除")])]}}])})],1)],1),t("div",{staticClass:"scoring-section"},[t("el-button",{attrs:{size:"small"},on:{click:e.handleSave}},[e._v("暂存")]),t("el-button",{attrs:{size:"small",type:"primary"},on:{click:e.handleComplete}},[e._v("完成")]),t("span",{staticStyle:{"margin-right":"10px","margin-left":"10px"}},[e._v("总分")]),t("el-input",{staticStyle:{width:"200px"},attrs:{size:"small",placeholder:"单行输入"},model:{value:e.scoreForm.totalScore,callback:function(t){e.$set(e.scoreForm,"totalScore",t)},expression:"scoreForm.totalScore"}}),t("span",{staticStyle:{"margin-right":"10px","margin-left":"10px"}},[e._v("得分")]),t("el-input",{staticStyle:{width:"200px"},attrs:{size:"small",placeholder:"单行输入"},model:{value:e.scoreForm.actualScore,callback:function(t){e.$set(e.scoreForm,"actualScore",t)},expression:"scoreForm.actualScore"}})],1),t("div",{staticClass:"body-part-table"},[t("el-table",{staticStyle:{width:"100%","margin-top":"20px"},attrs:{data:e.scoringTableData,border:"",size:"small"}},[t("el-table-column",{attrs:{type:"index",label:"序号",width:"60",align:"center"}}),t("el-table-column",{attrs:{prop:"scoringCategory",label:"打分大类"}}),t("el-table-column",{attrs:{prop:"scoringSubCategory",label:"打分小类"}}),t("el-table-column",{attrs:{prop:"description",label:"说明",width:"300","show-overflow-tooltip":""}}),t("el-table-column",{attrs:{prop:"maxScore",label:"满分值",width:"100",align:"center"}}),t("el-table-column",{attrs:{prop:"actualScore",label:"打分值",width:"100",align:"center"}}),t("el-table-column",{attrs:{prop:"remarks",label:"备注",width:"200","show-overflow-tooltip":""}})],1)],1),e.shouldShowWorkflowSection?t("div",{staticClass:"workflow-section"},[t("div",{staticClass:"section-title"},[t("h3",[e._v("核稿流程")]),t("el-divider")],1),t("div",{staticClass:"workflow-container"},[t("WorkflowProgress",{ref:"workflowProgress",attrs:{"business-type":"review","business-id":e.businessId,"can-start":e.canStartWorkflow,"can-cancel":e.canCancelWorkflow,"created-by":e.detailForm.createdBy,"workflow-code":"PROOF_FLOW"},on:{"workflow-started":e.handleWorkflowStarted,"workflow-cancelled":e.handleWorkflowCancelled,"workflow-restarted":e.handleWorkflowRestarted,"task-processed":e.handleTaskProcessed}})],1)]):e._e()])},s=[],l=(a("13d5"),a("e9f5"),a("9485"),a("96b6")),o=a("48d0"),i=a("5f87"),n={name:"ReviewDetail",components:{WorkflowProgress:o["a"]},data(){return{loading:!1,detailForm:{caseNumber:"EM-2023-001",proposalName:"智能设备专利方案",clientName:"北京科技有限公司",caseName:"可穿戴设备专利申请",applicationType:"invention",businessStaff:"wangyewu",reviewer:"李主管",preReviewCase:!1,priorityReview:!0,earlyPublication:!1,simultaneousSubmission:!1,dualReportCase:"双报项目 双报项目 或类型 三选一",caseRemarks:"",createdBy:null,reviewStatus:null},businessId:"",scoreForm:{totalScore:"",actualScore:""},fileList:[],fileTableData:[{id:1,fileName:"一种制备方法.docx",fileCategory:"项目非官文",fileSubCategory:"专利撰写文件",fileDisplayName:"五书草稿",uploader:"张三",uploadTime:"2023-11-10 17:56"}],scoringTableData:[{id:1,scoringCategory:"技术理解",scoringSubCategory:"技术方案理解",description:"对技术方案的理解准确性",maxScore:20,actualScore:18,remarks:"理解较好"},{id:2,scoringCategory:"撰写质量",scoringSubCategory:"权利要求书",description:"权利要求书的撰写质量",maxScore:25,actualScore:22,remarks:"层次清晰"},{id:3,scoringCategory:"撰写质量",scoringSubCategory:"说明书",description:"说明书的撰写质量",maxScore:25,actualScore:23,remarks:"描述详细"},{id:4,scoringCategory:"撰写质量",scoringSubCategory:"说明书摘要",description:"说明书摘要的撰写质量",maxScore:10,actualScore:9,remarks:"简洁明了"},{id:5,scoringCategory:"形式要求",scoringSubCategory:"格式规范",description:"文档格式是否符合规范",maxScore:10,actualScore:10,remarks:"格式标准"},{id:6,scoringCategory:"时间管理",scoringSubCategory:"完成时间",description:"是否按时完成",maxScore:10,actualScore:8,remarks:"略有延期"}]}},computed:{canStartWorkflow(){const e="待核稿"===this.detailForm.reviewStatus||"草稿"===this.detailForm.reviewStatus,t=Object(i["j"])(),a=t?t.id:null,r=this.detailForm.createdBy===a||"草稿"===this.detailForm.reviewStatus&&!this.detailForm.createdBy;return e&&r},canCancelWorkflow(){var e;return("核稿中"===this.detailForm.reviewStatus||"待处理"===this.detailForm.reviewStatus)&&this.detailForm.createdBy===(null===(e=this.$store.state.user)||void 0===e?void 0:e.id)},shouldShowWorkflowSection(){return this.businessId&&"new"!==this.businessId}},created(){this.businessId=this.$route.params.id,this.fetchDetailData(),this.calculateTotalScore()},methods:{async fetchDetailData(){const e=this.$route.params.id;if(e){this.loading=!0;try{const t=await l["a"].getReviewDetail(e);if(t.data.success){const e=t.data.data;this.detailForm={...this.detailForm,caseNumber:e.caseNumber||this.detailForm.caseNumber,proposalName:e.proposalName||this.detailForm.proposalName,clientName:e.clientName||this.detailForm.clientName,caseName:e.caseName||this.detailForm.caseName,applicationType:e.applicationType||this.detailForm.applicationType,businessStaff:e.businessStaff||this.detailForm.businessStaff,applicationNo:e.applicationNo||this.detailForm.applicationNo,registrationNo:e.registrationNo||this.detailForm.registrationNo,customerDocNo:e.customerDocNo||this.detailForm.customerDocNo,trademarkCategory:e.trademarkCategory||this.detailForm.trademarkCategory,processItem:e.processItem||this.detailForm.processItem,processor:e.processor||this.detailForm.processor,reviewer:e.reviewer||this.detailForm.reviewer,internalDeadline:e.internalDeadline||this.detailForm.internalDeadline,officialDeadline:e.officialDeadline||this.detailForm.officialDeadline,customerDeadline:e.customerDeadline||this.detailForm.customerDeadline,caseNotes:e.caseNotes||this.detailForm.caseNotes}}else this.$message.error(t.data.message||"查询详情失败")}catch(t){console.error("查询详情失败:",t),this.$message.error("查询失败，请稍后重试")}finally{this.loading=!1}}},async handleAdd(){try{await this.$confirm("确定要流转此处理事项吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const e=await l["a"].transferProcess({process_id:this.$route.params.id,next_status:2,notes:"流转处理"});e.data.success?(this.$message.success("流转成功"),this.fetchDetailData()):this.$message.error(e.data.message||"流转失败")}catch(e){"cancel"!==e&&(console.error("流转失败:",e),this.$message.error("流转失败，请稍后重试"))}},async handleReturn(){try{const{value:e}=await this.$prompt("请输入退回原因","退回处理事项",{confirmButtonText:"确定",cancelButtonText:"取消",inputPlaceholder:"请输入退回原因",inputValidator:e=>!(!e||!e.trim())||"退回原因不能为空"}),t=await l["a"].returnProcess({process_id:this.$route.params.id,reason:e});t.data.success?(this.$message.success("退回成功"),this.fetchDetailData()):this.$message.error(t.data.message||"退回失败")}catch(e){"cancel"!==e&&(console.error("退回失败:",e),this.$message.error("退回失败，请稍后重试"))}},handleDelete(){this.$confirm("确认要删除吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{this.$message.success("删除成功")}).catch(()=>{this.$message.info("已取消删除")})},beforeUpload(e){const t=e.size/1024/1024<10;return t||this.$message.error("上传文件大小不能超过 10MB!"),t},downloadFile(e){this.$message.success("下载文件: "+e.fileDisplayName)},deleteFile(e){this.$confirm("确认要删除该文件吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{const t=this.fileTableData.findIndex(t=>t.id===e.id);t>-1&&(this.fileTableData.splice(t,1),this.$message.success("删除成功"))}).catch(()=>{this.$message.info("已取消删除")})},calculateTotalScore(){const e=this.scoringTableData.reduce((e,t)=>e+t.maxScore,0),t=this.scoringTableData.reduce((e,t)=>e+t.actualScore,0);this.scoreForm.totalScore=e.toString(),this.scoreForm.actualScore=t.toString()},handleSave(){this.$message.success("保存成功")},handleComplete(){this.$confirm("确认要完成核稿吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"info"}).then(()=>{this.$message.success("核稿完成")}).catch(()=>{this.$message.info("已取消")})},handleWorkflowStarted(){this.$message.success("核稿流程已发起"),setTimeout(()=>{this.$refs.workflowProgress&&this.$refs.workflowProgress.refresh(),this.loadReviewData()},2e3)},handleWorkflowCancelled(){this.$message.success("核稿流程已取消"),this.$refs.workflowProgress&&this.$refs.workflowProgress.refresh(),this.loadReviewData()},handleWorkflowRestarted(){this.$message.success("核稿流程已重新发起"),this.$refs.workflowProgress&&this.$refs.workflowProgress.refresh(),this.loadReviewData()},handleTaskProcessed(){this.loadReviewData(),this.$refs.workflowProgress&&this.$refs.workflowProgress.refresh()},async loadReviewData(){await this.fetchDetailData()}}},c=n,d=(a("c157"),a("2877")),u=Object(d["a"])(c,r,s,!1,null,"6ea815d2",null);t["default"]=u.exports},8558:function(e,t,a){"use strict";var r=a("cfe9"),s=a("b5db"),l=a("c6b6"),o=function(e){return s.slice(0,e.length)===e};e.exports=function(){return o("Bun/")?"BUN":o("Cloudflare-Workers")?"CLOUDFLARE":o("Deno/")?"DENO":o("Node.js/")?"NODE":r.Bun&&"string"==typeof Bun.version?"BUN":r.Deno&&"object"==typeof Deno.version?"DENO":"process"===l(r.process)?"NODE":r.window&&r.document?"BROWSER":"REST"}()},9485:function(e,t,a){"use strict";var r=a("23e7"),s=a("2266"),l=a("59ed"),o=a("825a"),i=a("46c4"),n=TypeError;r({target:"Iterator",proto:!0,real:!0},{reduce:function(e){o(this),l(e);var t=i(this),a=arguments.length<2,r=a?void 0:arguments[1],c=0;if(s(t,(function(t){a?(a=!1,r=t):r=e(r,t,c),c++}),{IS_RECORD:!0}),a)throw new n("Reduce of empty iterator with no initial value");return r}})},"96b6":function(e,t,a){"use strict";var r=a("a417"),s=a("c1fb");const l={getDraftList(e){return s["a"].get(r["a"].host+"/api/review/draft-list",{params:e})},getPendingList(e){return this.getToBeStartList(e)},getToBeStartList(e){return s["a"].get(r["a"].host+"/api/review/to-be-start-list",{params:e})},getInReviewList(e){return s["a"].get(r["a"].host+"/api/review/in-review-list",{params:e})},getCompletedList(e){return s["a"].get(r["a"].host+"/api/review/completed-list",{params:e})},getReviewDetail(e){return s["a"].get(r["a"].host+"/api/review/detail/"+e)},transferProcess(e){return s["a"].post(r["a"].host+"/api/review/transfer",e)},returnProcess(e){return s["a"].post(r["a"].host+"/api/review/return",e)},getApplicationTypes(){return[{label:"发明专利",value:"invention"},{label:"实用新型",value:"utility"},{label:"外观设计",value:"design"},{label:"商标注册",value:"trademark_registration"},{label:"软件著作权",value:"software_copyright"}]},getProcessItems(){return[{label:"撰写",value:"drafting"},{label:"审查意见答复",value:"response"},{label:"补正",value:"amendment"},{label:"缴费",value:"payment"},{label:"登记",value:"registration"}]},getStatusOptions(){return[{label:"草稿",value:0},{label:"待处理",value:1},{label:"进行中",value:2},{label:"已完成",value:3},{label:"已分配",value:4}]}};t["a"]=l},"9adc":function(e,t,a){"use strict";var r=a("8558");e.exports="NODE"===r},a640:function(e,t,a){"use strict";var r=a("d039");e.exports=function(e,t){var a=[][e];return!!a&&r((function(){a.call(null,t||function(){return 1},1)}))}},c157:function(e,t,a){"use strict";a("d235")},d235:function(e,t,a){},d58f:function(e,t,a){"use strict";var r=a("59ed"),s=a("7b0b"),l=a("44ad"),o=a("07fa"),i=TypeError,n="Reduce of empty array with no initial value",c=function(e){return function(t,a,c,d){var u=s(t),m=l(u),p=o(u);if(r(a),0===p&&c<2)throw new i(n);var h=e?p-1:0,f=e?-1:1;if(c<2)while(1){if(h in m){d=m[h],h+=f;break}if(h+=f,e?h<0:p<=h)throw new i(n)}for(;e?h>=0:p>h;h+=f)h in m&&(d=a(d,m[h],h,u));return d}};e.exports={left:c(!1),right:c(!0)}}}]);