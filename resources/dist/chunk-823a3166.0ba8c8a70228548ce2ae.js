(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-823a3166"],{"1fb9":function(t,e,s){},5817:function(t,e,s){"use strict";s("1fb9")},8359:function(t,e,s){"use strict";s.r(e);var a=function(){var t=this,e=t._self._c;return e("div",{staticClass:"app-container"},[e("div",{staticClass:"commission-status-tabs"},[e("el-tabs",{attrs:{type:"card"},on:{"tab-click":t.handleStatusTabClick},model:{value:t.activeStatus,callback:function(e){t.activeStatus=e},expression:"activeStatus"}},[e("el-tab-pane",{attrs:{label:"待计算",name:"pending"}},[e("span",{attrs:{slot:"label"},slot:"label"},[e("i",{staticClass:"el-icon-time"}),t._v(" 待计算 ")])]),e("el-tab-pane",{attrs:{label:"已计算",name:"calculated"}},[e("span",{attrs:{slot:"label"},slot:"label"},[e("i",{staticClass:"el-icon-success"}),t._v(" 已计算 ")])]),e("el-tab-pane",{attrs:{label:"已确认",name:"confirmed"}},[e("span",{attrs:{slot:"label"},slot:"label"},[e("i",{staticClass:"el-icon-check"}),t._v(" 已确认 ")])]),e("el-tab-pane",{attrs:{label:"已发放",name:"paid"}},[e("span",{attrs:{slot:"label"},slot:"label"},[e("i",{staticClass:"el-icon-money"}),t._v(" 已发放 ")])]),e("el-tab-pane",{attrs:{label:"全部",name:"all"}})],1)],1),e("div",{staticClass:"body-part-search"},[e("el-form",{attrs:{model:t.listQuery,"label-width":"100px"}},[e("div",{staticClass:"default-filters"},[e("el-row",[e("el-col",{attrs:{span:6}},[e("el-form-item",{attrs:{label:"商务人员",prop:"businessPerson"}},[e("el-input",{staticClass:"filter-item",attrs:{placeholder:"商务人员",clearable:"",size:"small"},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.handleSearch.apply(null,arguments)}},model:{value:t.listQuery.businessPerson,callback:function(e){t.$set(t.listQuery,"businessPerson",e)},expression:"listQuery.businessPerson"}})],1)],1),e("el-col",{attrs:{span:6}},[e("el-form-item",{attrs:{label:"提成月度",prop:"commissionMonth"}},[e("el-date-picker",{staticClass:"filter-item",attrs:{type:"month",placeholder:"选择月份",format:"yyyy-MM","value-format":"yyyy-MM",size:"small"},model:{value:t.listQuery.commissionMonth,callback:function(e){t.$set(t.listQuery,"commissionMonth",e)},expression:"listQuery.commissionMonth"}})],1)],1),e("el-col",{attrs:{span:6}},[e("el-form-item",{attrs:{label:"客户名称",prop:"customerName"}},[e("el-input",{staticClass:"filter-item",attrs:{placeholder:"客户名称",clearable:"",size:"small"},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.handleSearch.apply(null,arguments)}},model:{value:t.listQuery.customerName,callback:function(e){t.$set(t.listQuery,"customerName",e)},expression:"listQuery.customerName"}})],1)],1),e("el-col",{attrs:{span:6}},[e("el-form-item",{attrs:{label:"人员等级",prop:"staffLevel"}},[e("el-select",{staticClass:"filter-item",attrs:{placeholder:"人员等级",clearable:"",size:"small"},model:{value:t.listQuery.staffLevel,callback:function(e){t.$set(t.listQuery,"staffLevel",e)},expression:"listQuery.staffLevel"}},[e("el-option",{attrs:{label:"初级",value:"junior"}}),e("el-option",{attrs:{label:"中级",value:"middle"}}),e("el-option",{attrs:{label:"高级",value:"senior"}}),e("el-option",{attrs:{label:"专家",value:"expert"}})],1)],1)],1)],1)],1),t.expandVisible?e("div",[e("el-row",[e("el-col",{attrs:{span:6}},[e("el-form-item",{attrs:{label:"合同编号",prop:"contractNo"}},[e("el-input",{staticClass:"filter-item",attrs:{placeholder:"合同编号",clearable:"",size:"small"},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.handleSearch.apply(null,arguments)}},model:{value:t.listQuery.contractNo,callback:function(e){t.$set(t.listQuery,"contractNo",e)},expression:"listQuery.contractNo"}})],1)],1),e("el-col",{attrs:{span:6}},[e("el-form-item",{attrs:{label:"业绩单号",prop:"performanceNo"}},[e("el-input",{staticClass:"filter-item",attrs:{placeholder:"业绩单号",clearable:"",size:"small"},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.handleSearch.apply(null,arguments)}},model:{value:t.listQuery.performanceNo,callback:function(e){t.$set(t.listQuery,"performanceNo",e)},expression:"listQuery.performanceNo"}})],1)],1),e("el-col",{attrs:{span:6}},[e("el-form-item",{attrs:{label:"状态",prop:"status"}},[e("el-select",{staticClass:"filter-item",attrs:{placeholder:"状态",clearable:"",size:"small"},model:{value:t.listQuery.status,callback:function(e){t.$set(t.listQuery,"status",e)},expression:"listQuery.status"}},[e("el-option",{attrs:{label:"待计算",value:"pending"}}),e("el-option",{attrs:{label:"已计算",value:"calculated"}}),e("el-option",{attrs:{label:"已确认",value:"confirmed"}}),e("el-option",{attrs:{label:"已发放",value:"paid"}})],1)],1)],1),e("el-col",{attrs:{span:6}},[e("el-form-item",{attrs:{label:"金额范围",prop:"amountRange"}},[e("div",{staticClass:"custom-range-input"},[e("el-input",{staticClass:"custom-range-item",attrs:{placeholder:"最小金额",size:"small"},model:{value:t.listQuery.minAmount,callback:function(e){t.$set(t.listQuery,"minAmount",e)},expression:"listQuery.minAmount"}}),e("span",{staticClass:"custom-range-separator"},[t._v("-")]),e("el-input",{staticClass:"custom-range-item",attrs:{placeholder:"最大金额",size:"small"},model:{value:t.listQuery.maxAmount,callback:function(e){t.$set(t.listQuery,"maxAmount",e)},expression:"listQuery.maxAmount"}})],1)])],1)],1)],1):t._e()]),e("div",{staticClass:"part-search-buttons"},[e("el-button",{attrs:{size:"small",type:"primary",icon:"el-icon-search"},on:{click:t.handleSearch}},[t._v("搜索")]),e("el-button",{attrs:{size:"small",icon:"el-icon-refresh"},on:{click:t.resetSearch}},[t._v("重置")]),e("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(e){t.expandVisible=!t.expandVisible}}},[t._v(" "+t._s(t.expandVisible?"收起":"展开")+" "),e("i",{class:t.expandVisible?"el-icon-arrow-up":"el-icon-arrow-down"})])],1)],1),e("div",{staticClass:"stats-container"},[e("el-row",{attrs:{gutter:20}},[e("el-col",{attrs:{span:6}},[e("div",{staticClass:"stat-card"},[e("div",{staticClass:"stat-icon pending"},[e("i",{staticClass:"el-icon-time"})]),e("div",{staticClass:"stat-info"},[e("div",{staticClass:"stat-value"},[t._v(t._s(t.stats.pendingCount))]),e("div",{staticClass:"stat-label"},[t._v("待计算提成")])])])]),e("el-col",{attrs:{span:6}},[e("div",{staticClass:"stat-card"},[e("div",{staticClass:"stat-icon calculated"},[e("i",{staticClass:"el-icon-success"})]),e("div",{staticClass:"stat-info"},[e("div",{staticClass:"stat-value"},[t._v(t._s(t.stats.calculatedCount))]),e("div",{staticClass:"stat-label"},[t._v("已计算提成")])])])]),e("el-col",{attrs:{span:6}},[e("div",{staticClass:"stat-card"},[e("div",{staticClass:"stat-icon amount"},[e("i",{staticClass:"el-icon-money"})]),e("div",{staticClass:"stat-info"},[e("div",{staticClass:"stat-value"},[t._v(t._s(t._f("currency")(t.stats.totalAmount)))]),e("div",{staticClass:"stat-label"},[t._v("本月提成总额")])])])]),e("el-col",{attrs:{span:6}},[e("div",{staticClass:"stat-card"},[e("div",{staticClass:"stat-icon people"},[e("i",{staticClass:"el-icon-user"})]),e("div",{staticClass:"stat-info"},[e("div",{staticClass:"stat-value"},[t._v(t._s(t.stats.peopleCount))]),e("div",{staticClass:"stat-label"},[t._v("涉及人员")])])])])],1)],1),e("div",{staticClass:"body-part-content"},[e("div",{staticClass:"part-table-header"},[e("div",{staticClass:"part-table-title"},[t._v(" 商务提成管理 ")]),e("div",{staticClass:"part-table-operations"},[e("el-button",{attrs:{size:"small",type:"success",disabled:0===t.selectedRows.length},on:{click:t.handleBatchCalculate}},[t._v("批量计算")]),e("el-button",{attrs:{size:"small",type:"warning",disabled:0===t.selectedRows.length},on:{click:t.handleBatchConfirm}},[t._v("批量确认")]),e("el-button",{attrs:{size:"small",type:"primary"},on:{click:t.handleMonthlyCalculate}},[t._v("月度计算")]),e("el-button",{attrs:{size:"small",type:"primary"},on:{click:t.handleAdd}},[t._v("新增提成")]),e("el-button",{attrs:{size:"small"},on:{click:t.handleExport}},[t._v("导出")])],1)]),e("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.listLoading,expression:"listLoading"}],staticStyle:{width:"100%"},attrs:{data:t.list,border:"",size:"small"},on:{"selection-change":t.handleSelectionChange}},[e("el-table-column",{attrs:{type:"selection",width:"80",align:"center"}}),e("el-table-column",{attrs:{type:"index",label:"序号",width:"60",align:"center"}}),e("el-table-column",{attrs:{prop:"businessPerson",label:"商务人员",minWidth:"120",align:"center"}}),e("el-table-column",{attrs:{prop:"staffLevel",label:"人员等级",minWidth:"100",align:"center"},scopedSlots:t._u([{key:"default",fn:function(s){return[e("el-tag",{attrs:{type:t.getStaffLevelType(s.row.staffLevel),size:"small"}},[t._v(" "+t._s(t.getStaffLevelText(s.row.staffLevel))+" ")])]}}])}),e("el-table-column",{attrs:{prop:"commissionMonth",label:"提成月度",minWidth:"100",align:"center"}}),e("el-table-column",{attrs:{prop:"customerName",label:"客户名称",minWidth:"150",align:"center","show-overflow-tooltip":""}}),e("el-table-column",{attrs:{prop:"contractNo",label:"合同编号",minWidth:"140",align:"center"}}),e("el-table-column",{attrs:{prop:"performanceNo",label:"业绩单号",minWidth:"140",align:"center"}}),e("el-table-column",{attrs:{prop:"performanceAmount",label:"业绩金额",minWidth:"120",align:"center"},scopedSlots:t._u([{key:"default",fn:function(s){return[e("span",{staticClass:"amount-text"},[t._v(t._s(t._f("currency")(s.row.performanceAmount)))])]}}])}),e("el-table-column",{attrs:{prop:"receivedAmount",label:"到款金额",minWidth:"120",align:"center"},scopedSlots:t._u([{key:"default",fn:function(s){return[e("span",{staticClass:"received-amount"},[t._v(t._s(t._f("currency")(s.row.receivedAmount)))])]}}])}),e("el-table-column",{attrs:{prop:"commissionRate",label:"提成系数",width:"100",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(e.row.commissionRate)+"% ")]}}])}),e("el-table-column",{attrs:{prop:"commissionAmount",label:"提成金额",minWidth:"120",align:"center"},scopedSlots:t._u([{key:"default",fn:function(s){return[e("span",{staticClass:"commission-amount"},[t._v(t._s(t._f("currency")(s.row.commissionAmount)))])]}}])}),e("el-table-column",{attrs:{prop:"status",label:"状态",width:"100",align:"center"},scopedSlots:t._u([{key:"default",fn:function(s){return[e("el-tag",{attrs:{type:t.getStatusType(s.row.status),size:"small"}},[t._v(" "+t._s(t.getStatusText(s.row.status))+" ")])]}}])}),e("el-table-column",{attrs:{prop:"createTime",label:"创建时间",minWidth:"160",align:"center"}}),e("el-table-column",{attrs:{fixed:"right",label:"操作",align:"center",width:"200","class-name":"small-padding fixed-width"},scopedSlots:t._u([{key:"default",fn:function(s){return[e("el-button",{attrs:{size:"mini",type:"text",icon:"el-icon-view"},on:{click:function(e){return t.handleView(s.row)}}},[t._v("查看")]),"pending"===s.row.status?e("el-button",{attrs:{size:"mini",type:"text",icon:"el-icon-money"},on:{click:function(e){return t.handleCalculate(s.row)}}},[t._v("计算")]):t._e(),"calculated"===s.row.status?e("el-button",{attrs:{size:"mini",type:"text",icon:"el-icon-check"},on:{click:function(e){return t.handleConfirm(s.row)}}},[t._v("确认")]):t._e(),e("el-button",{attrs:{size:"mini",type:"text",icon:"el-icon-edit"},on:{click:function(e){return t.handleEdit(s.row)}}},[t._v("编辑")])]}}])})],1),e("el-pagination",{directives:[{name:"show",rawName:"v-show",value:t.total>0,expression:"total > 0"}],attrs:{"current-page":t.listQuery.page,"page-sizes":[10,20,30,50],"page-size":t.listQuery.limit,total:t.total,background:"",layout:"total, sizes, prev, pager, next, jumper"},on:{"size-change":t.handleSizeChange,"current-change":t.handleCurrentChange}})],1),e("el-dialog",{attrs:{title:"商务提成详情",visible:t.viewDialogVisible,width:"70%","before-close":t.handleViewDialogClose},on:{"update:visible":function(e){t.viewDialogVisible=e}}},[t.currentRow?e("div",[e("el-card",{staticClass:"detail-card",attrs:{header:"基本信息"}},[e("el-descriptions",{attrs:{column:2,border:""}},[e("el-descriptions-item",{attrs:{label:"商务人员"}},[t._v(t._s(t.currentRow.businessPerson))]),e("el-descriptions-item",{attrs:{label:"人员等级"}},[e("el-tag",{attrs:{type:t.getStaffLevelType(t.currentRow.staffLevel),size:"small"}},[t._v(" "+t._s(t.getStaffLevelText(t.currentRow.staffLevel))+" ")])],1),e("el-descriptions-item",{attrs:{label:"提成月度"}},[t._v(t._s(t.currentRow.commissionMonth))]),e("el-descriptions-item",{attrs:{label:"计算状态"}},[e("el-tag",{attrs:{type:t.getStatusType(t.currentRow.status),size:"small"}},[t._v(" "+t._s(t.getStatusText(t.currentRow.status))+" ")])],1),e("el-descriptions-item",{attrs:{label:"业绩单号"}},[t._v(t._s(t.currentRow.performanceNo))]),e("el-descriptions-item",{attrs:{label:"合同编号"}},[t._v(t._s(t.currentRow.contractNo))]),e("el-descriptions-item",{attrs:{label:"客户名称"}},[t._v(t._s(t.currentRow.customerName))]),e("el-descriptions-item",{attrs:{label:"创建时间"}},[t._v(t._s(t.currentRow.createTime))])],1)],1),e("el-card",{staticClass:"detail-card",attrs:{header:"提成计算"}},[e("el-descriptions",{attrs:{column:2,border:""}},[e("el-descriptions-item",{attrs:{label:"业绩金额"}},[e("span",{staticClass:"amount-text"},[t._v(t._s(t._f("currency")(t.currentRow.performanceAmount)))])]),e("el-descriptions-item",{attrs:{label:"到款金额"}},[e("span",{staticClass:"received-amount"},[t._v(t._s(t._f("currency")(t.currentRow.receivedAmount)))])]),e("el-descriptions-item",{attrs:{label:"提成系数"}},[t._v(t._s(t.currentRow.commissionRate)+"%")]),e("el-descriptions-item",{attrs:{label:"计算基数"}},[e("span",{staticClass:"amount-text"},[t._v(t._s(t._f("currency")(t.currentRow.calculationBase)))])]),e("el-descriptions-item",{attrs:{label:"提成金额",span:2}},[e("span",{staticClass:"commission-amount-large"},[t._v(t._s(t._f("currency")(t.currentRow.commissionAmount)))])])],1)],1),e("el-card",{staticClass:"detail-card",attrs:{header:"计算明细"}},[e("div",{staticClass:"calculation-detail"},[e("p",[e("strong",[t._v("计算公式：")]),t._v("提成金额 = MIN(业绩金额, 到款金额) × 提成系数")]),e("p",[e("strong",[t._v("计算过程：")])]),e("ul",[e("li",[t._v("业绩金额："+t._s(t._f("currency")(t.currentRow.performanceAmount)))]),e("li",[t._v("到款金额："+t._s(t._f("currency")(t.currentRow.receivedAmount)))]),e("li",[t._v("计算基数："+t._s(t._f("currency")(t.currentRow.calculationBase))+" (取较小值)")]),e("li",[t._v("提成系数："+t._s(t.currentRow.commissionRate)+"% (根据人员等级确定)")]),e("li",[t._v("提成金额："+t._s(t._f("currency")(t.currentRow.calculationBase))+" × "+t._s(t.currentRow.commissionRate)+"% = "+t._s(t._f("currency")(t.currentRow.commissionAmount)))])])])]),e("el-card",{staticClass:"detail-card",attrs:{header:"操作记录"}},[e("el-timeline",t._l(t.currentRow.operationLogs||[],(function(s,a){return e("el-timeline-item",{key:a,attrs:{timestamp:s.timestamp,type:t.getTimelineType(s.type)}},[e("strong",[t._v(t._s(s.action))]),e("p",[t._v("操作人："+t._s(s.operator))]),s.remark?e("p",[t._v("备注："+t._s(s.remark))]):t._e()])})),1)],1)],1):t._e()]),e("el-dialog",{attrs:{title:"月度提成计算",visible:t.monthlyDialogVisible,width:"50%"},on:{"update:visible":function(e){t.monthlyDialogVisible=e}}},[e("el-form",{attrs:{model:t.monthlyForm,"label-width":"120px"}},[e("el-form-item",{attrs:{label:"计算月度",required:""}},[e("el-date-picker",{staticStyle:{width:"200px"},attrs:{type:"month",placeholder:"选择月份",format:"yyyy-MM","value-format":"yyyy-MM"},model:{value:t.monthlyForm.month,callback:function(e){t.$set(t.monthlyForm,"month",e)},expression:"monthlyForm.month"}})],1),e("el-form-item",{attrs:{label:"计算范围"}},[e("el-radio-group",{model:{value:t.monthlyForm.scope,callback:function(e){t.$set(t.monthlyForm,"scope",e)},expression:"monthlyForm.scope"}},[e("el-radio",{attrs:{label:"all"}},[t._v("全部人员")]),e("el-radio",{attrs:{label:"department"}},[t._v("按部门")]),e("el-radio",{attrs:{label:"person"}},[t._v("指定人员")])],1)],1),"person"===t.monthlyForm.scope?e("el-form-item",{attrs:{label:"选择人员"}},[e("el-select",{attrs:{multiple:"",placeholder:"请选择人员"},model:{value:t.monthlyForm.selectedPersons,callback:function(e){t.$set(t.monthlyForm,"selectedPersons",e)},expression:"monthlyForm.selectedPersons"}},t._l(t.businessPersonList,(function(t){return e("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})})),1)],1):t._e(),e("el-form-item",{attrs:{label:"计算说明"}},[e("el-input",{attrs:{type:"textarea",rows:"3",placeholder:"请输入计算说明"},model:{value:t.monthlyForm.remark,callback:function(e){t.$set(t.monthlyForm,"remark",e)},expression:"monthlyForm.remark"}})],1)],1),e("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{on:{click:function(e){t.monthlyDialogVisible=!1}}},[t._v("取消")]),e("el-button",{attrs:{type:"primary"},on:{click:t.handleConfirmMonthlyCalculate}},[t._v("确认计算")])],1)],1),e("el-dialog",{attrs:{title:t.addForm.id?"编辑提成记录":"新增提成记录",visible:t.addDialogVisible,width:"60%","before-close":t.handleAddDialogClose},on:{"update:visible":function(e){t.addDialogVisible=e}}},[e("el-form",{ref:"addForm",attrs:{model:t.addForm,rules:t.addRules,"label-width":"120px"}},[e("el-row",{attrs:{gutter:20}},[e("el-col",{attrs:{span:12}},[e("el-form-item",{attrs:{label:"商务人员",prop:"businessPerson"}},[e("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择商务人员",filterable:""},model:{value:t.addForm.businessPerson,callback:function(e){t.$set(t.addForm,"businessPerson",e)},expression:"addForm.businessPerson"}},t._l(t.businessPersonList,(function(t){return e("el-option",{key:t.id,attrs:{label:t.name,value:t.name}})})),1)],1)],1),e("el-col",{attrs:{span:12}},[e("el-form-item",{attrs:{label:"人员等级",prop:"staffLevel"}},[e("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择人员等级"},model:{value:t.addForm.staffLevel,callback:function(e){t.$set(t.addForm,"staffLevel",e)},expression:"addForm.staffLevel"}},[e("el-option",{attrs:{label:"初级",value:"junior"}}),e("el-option",{attrs:{label:"中级",value:"middle"}}),e("el-option",{attrs:{label:"高级",value:"senior"}}),e("el-option",{attrs:{label:"专家",value:"expert"}})],1)],1)],1)],1),e("el-row",{attrs:{gutter:20}},[e("el-col",{attrs:{span:12}},[e("el-form-item",{attrs:{label:"提成月度",prop:"commissionMonth"}},[e("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"month",placeholder:"选择月份",format:"yyyy-MM","value-format":"yyyy-MM"},model:{value:t.addForm.commissionMonth,callback:function(e){t.$set(t.addForm,"commissionMonth",e)},expression:"addForm.commissionMonth"}})],1)],1),e("el-col",{attrs:{span:12}},[e("el-form-item",{attrs:{label:"客户名称",prop:"customerName"}},[e("el-input",{attrs:{placeholder:"请输入客户名称"},model:{value:t.addForm.customerName,callback:function(e){t.$set(t.addForm,"customerName",e)},expression:"addForm.customerName"}})],1)],1)],1),e("el-row",{attrs:{gutter:20}},[e("el-col",{attrs:{span:12}},[e("el-form-item",{attrs:{label:"合同编号",prop:"contractNo"}},[e("el-input",{attrs:{placeholder:"请输入合同编号"},model:{value:t.addForm.contractNo,callback:function(e){t.$set(t.addForm,"contractNo",e)},expression:"addForm.contractNo"}})],1)],1),e("el-col",{attrs:{span:12}},[e("el-form-item",{attrs:{label:"业绩单号",prop:"performanceNo"}},[e("el-input",{attrs:{placeholder:"请输入业绩单号"},model:{value:t.addForm.performanceNo,callback:function(e){t.$set(t.addForm,"performanceNo",e)},expression:"addForm.performanceNo"}})],1)],1)],1),e("el-row",{attrs:{gutter:20}},[e("el-col",{attrs:{span:12}},[e("el-form-item",{attrs:{label:"业绩金额",prop:"performanceAmount"}},[e("el-input-number",{staticStyle:{width:"100%"},attrs:{min:0,precision:2},on:{change:t.calculateCommission},model:{value:t.addForm.performanceAmount,callback:function(e){t.$set(t.addForm,"performanceAmount",e)},expression:"addForm.performanceAmount"}},[e("template",{slot:"prepend"},[t._v("¥")])],2)],1)],1),e("el-col",{attrs:{span:12}},[e("el-form-item",{attrs:{label:"到款金额",prop:"receivedAmount"}},[e("el-input-number",{staticStyle:{width:"100%"},attrs:{min:0,precision:2},on:{change:t.calculateCommission},model:{value:t.addForm.receivedAmount,callback:function(e){t.$set(t.addForm,"receivedAmount",e)},expression:"addForm.receivedAmount"}},[e("template",{slot:"prepend"},[t._v("¥")])],2)],1)],1)],1),e("el-row",{attrs:{gutter:20}},[e("el-col",{attrs:{span:12}},[e("el-form-item",{attrs:{label:"提成系数",prop:"commissionRate"}},[e("el-input-number",{staticStyle:{width:"100%"},attrs:{min:0,max:100,precision:1},on:{change:t.calculateCommission},model:{value:t.addForm.commissionRate,callback:function(e){t.$set(t.addForm,"commissionRate",e)},expression:"addForm.commissionRate"}},[e("template",{slot:"append"},[t._v("%")])],2)],1)],1),e("el-col",{attrs:{span:12}},[e("el-form-item",{attrs:{label:"提成金额"}},[e("el-input",{attrs:{value:t._f("currency")(t.addForm.commissionAmount),disabled:""}})],1)],1)],1),e("el-form-item",{attrs:{label:"备注"}},[e("el-input",{attrs:{type:"textarea",rows:"3",placeholder:"请输入备注"},model:{value:t.addForm.remark,callback:function(e){t.$set(t.addForm,"remark",e)},expression:"addForm.remark"}})],1)],1),e("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{on:{click:t.handleAddDialogClose}},[t._v("取消")]),e("el-button",{attrs:{type:"primary"},on:{click:t.handleSubmitAdd}},[t._v(t._s(t.addForm.id?"保存修改":"确认新增"))])],1)],1)],1)},l=[],i=(s("14d9"),s("e9f5"),s("910d"),s("7d54"),s("ab43"),{name:"BusinessCommission",filters:{currency(t){return t?"¥"+Number(t).toLocaleString("zh-CN",{minimumFractionDigits:2}):"¥0.00"}},data(){return{listLoading:!1,expandVisible:!1,viewDialogVisible:!1,monthlyDialogVisible:!1,addDialogVisible:!1,currentRow:null,selectedRows:[],activeStatus:"pending",listQuery:{page:1,limit:20,businessPerson:"",commissionMonth:"2024-01",customerName:"",staffLevel:"",contractNo:"",performanceNo:"",status:"pending",minAmount:"",maxAmount:""},list:[],total:0,stats:{pendingCount:0,calculatedCount:0,totalAmount:0,peopleCount:0},monthlyForm:{month:"2024-01",scope:"all",selectedPersons:[],remark:""},addForm:{id:null,businessPerson:"",staffLevel:"",commissionMonth:"",customerName:"",contractNo:"",performanceNo:"",performanceAmount:0,receivedAmount:0,commissionRate:0,commissionAmount:0,remark:""},addRules:{businessPerson:[{required:!0,message:"请选择商务人员",trigger:"change"}],staffLevel:[{required:!0,message:"请选择人员等级",trigger:"change"}],commissionMonth:[{required:!0,message:"请选择提成月度",trigger:"change"}],performanceAmount:[{required:!0,message:"请输入业绩金额",trigger:"blur"}],receivedAmount:[{required:!0,message:"请输入到款金额",trigger:"blur"}],commissionRate:[{required:!0,message:"请输入提成系数",trigger:"blur"}]},businessPersonList:[]}},created(){this.getList(),this.getStats(),this.getBusinessPersonList()},methods:{getList(){this.listLoading=!0,setTimeout(()=>{this.list=this.getMockData(),this.total=45,this.listLoading=!1},500)},getMockData(){const t=[],e=["张商务","李营销","王拓展","赵业务","钱开发","孙销售","周推广","陈经理"],s=["阿里巴巴","腾讯科技","百度公司","京东集团","字节跳动","美团科技","滴滴出行","小米科技"],a=["junior","middle","senior","expert"],l=["pending","calculated","confirmed","paid"];for(let i=1;i<=20;i++){const o=a[Math.floor(Math.random()*a.length)],n=l[Math.floor(Math.random()*l.length)],r=Math.floor(1e5*Math.random())+2e4,c=Math.floor(8e4*Math.random())+15e3,m=Math.min(r,c),u={junior:3,middle:5,senior:8,expert:12},d=u[o],p=Math.floor(m*d/100);t.push({id:i,businessPerson:e[Math.floor(Math.random()*e.length)],staffLevel:o,performanceNo:"YJ"+String(2e4+i).padStart(5,"0"),contractNo:"HT"+String(1e4+i).padStart(5,"0"),customerName:s[Math.floor(Math.random()*s.length)],performanceAmount:r,receivedAmount:c,calculationBase:m,commissionRate:d,commissionAmount:p,commissionMonth:"2024-01",status:n,createTime:"2024-01-15 10:30:00",operationLogs:[{action:"创建提成记录",operator:"系统",timestamp:"2024-01-15 10:30:00",type:"create",remark:"基于业绩单自动创建"},{action:"计算提成金额",operator:"财务人员",timestamp:"2024-01-16 14:20:00",type:"calculate",remark:`计算基数：${m}，提成系数：${d}%`}]})}return t},getStats(){this.stats={pendingCount:15,calculatedCount:23,totalAmount:156e3,peopleCount:12}},getBusinessPersonList(){this.businessPersonList=[{id:1,name:"张商务"},{id:2,name:"李营销"},{id:3,name:"王拓展"},{id:4,name:"赵业务"},{id:5,name:"钱开发"}]},resetSearch(){this.listQuery={page:1,limit:20,businessPerson:"",commissionMonth:"2024-01",customerName:"",staffLevel:"",contractNo:"",performanceNo:"",status:"all"===this.activeStatus?"":this.activeStatus,minAmount:"",maxAmount:""},this.getList()},handleSearch(){this.listQuery.page=1,this.getList()},handleView(t){this.currentRow={...t},this.viewDialogVisible=!0},handleCalculate(t){this.$confirm("确定要计算该商务人员的提成吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{this.listLoading=!0,setTimeout(()=>{t.status="calculated",this.$message.success("提成计算完成"),this.listLoading=!1,this.getList()},1e3)})},handleConfirm(t){this.$confirm("确定要确认该提成计算结果吗？确认后将无法修改。","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{this.listLoading=!0,setTimeout(()=>{t.status="confirmed",this.$message.success("提成确认成功"),this.listLoading=!1,this.getList()},1e3)})},handleBatchCalculate(){const t=this.selectedRows.filter(t=>"pending"===t.status);0!==t.length?this.$confirm(`确定要批量计算选中的 ${t.length} 条记录吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{this.listLoading=!0,setTimeout(()=>{t.forEach(t=>{t.status="calculated"}),this.$message.success(`批量计算完成，共处理 ${t.length} 条记录`),this.listLoading=!1,this.getList()},1500)}):this.$message.warning("请选择待计算的记录")},handleBatchConfirm(){const t=this.selectedRows.filter(t=>"calculated"===t.status);0!==t.length?this.$confirm(`确定要批量确认选中的 ${t.length} 条记录吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{this.listLoading=!0,setTimeout(()=>{t.forEach(t=>{t.status="confirmed"}),this.$message.success(`批量确认完成，共处理 ${t.length} 条记录`),this.listLoading=!1,this.getList()},1500)}):this.$message.warning("请选择已计算的记录")},handleMonthlyCalculate(){this.monthlyDialogVisible=!0},handleConfirmMonthlyCalculate(){this.$confirm("确定要执行月度提成计算吗？这将基于当前月度的业绩和到款数据重新计算提成。","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{this.listLoading=!0,this.monthlyDialogVisible=!1,setTimeout(()=>{this.$message.success("月度提成计算完成"),this.listLoading=!1,this.getList(),this.getStats()},2e3)})},handleExport(){this.$message.info("导出商务提成数据...")},handleAdd(){this.addForm={id:null,businessPerson:"",staffLevel:"",commissionMonth:"",customerName:"",contractNo:"",performanceNo:"",performanceAmount:0,receivedAmount:0,commissionRate:0,commissionAmount:0,remark:""},this.addDialogVisible=!0},handleEdit(t){this.addForm={...t},this.addDialogVisible=!0},handleAddDialogClose(){this.addDialogVisible=!1,this.$refs.addForm.resetFields()},handleSubmitAdd(){this.$refs.addForm.validate(t=>{t&&(this.listLoading=!0,setTimeout(()=>{if(this.addForm.id){const t=this.list.findIndex(t=>t.id===this.addForm.id);-1!==t&&(this.list[t]=this.addForm),this.$message.success("提成记录编辑成功")}else{const t=Math.max(...this.list.map(t=>t.id))+1;this.list.push({...this.addForm,id:t}),this.$message.success("提成记录新增成功")}this.listLoading=!1,this.addDialogVisible=!1,this.getList(),this.getStats()},1e3))})},calculateCommission(){const t=this.addForm.performanceAmount||0,e=this.addForm.receivedAmount||0,s=this.addForm.commissionRate||0;this.addForm.commissionAmount=Math.min(t,e)*s/100},handleViewPerformance(t){this.$message.info("查看业绩单："+t.performanceNo)},handleViewPayment(t){this.$message.info("查看到款记录")},handlePrint(t){this.$message.info("打印提成单")},handleRecalculate(t){this.$confirm("确定要重新计算该提成吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{this.listLoading=!0,setTimeout(()=>{this.$message.success("重新计算完成"),this.listLoading=!1,this.getList()},1e3)})},handleViewDialogClose(){this.viewDialogVisible=!1,this.currentRow=null},handleSelectionChange(t){this.selectedRows=t},handleSizeChange(t){this.listQuery.limit=t,this.getList()},handleCurrentChange(t){this.listQuery.page=t,this.getList()},handleStatusTabClick(t){"all"===this.activeStatus?this.listQuery.status="":this.listQuery.status=this.activeStatus,this.handleSearch()},getStaffLevelType(t){const e={junior:"info",middle:"warning",senior:"success",expert:"primary"};return e[t]||"info"},getStaffLevelText(t){const e={junior:"初级",middle:"中级",senior:"高级",expert:"专家"};return e[t]||t},getStatusType(t){const e={pending:"info",calculated:"warning",confirmed:"success",paid:"primary"};return e[t]||"info"},getStatusText(t){const e={pending:"待计算",calculated:"已计算",confirmed:"已确认",paid:"已发放"};return e[t]||t},getTimelineType(t){const e={create:"primary",calculate:"success",confirm:"warning",pay:"info"};return e[t]||"primary"}}}),o=i,n=(s("5817"),s("2877")),r=Object(n["a"])(o,a,l,!1,null,"9e33e70c",null);e["default"]=r.exports}}]);