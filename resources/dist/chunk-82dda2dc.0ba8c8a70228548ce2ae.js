(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-82dda2dc"],{"0bd2":function(e,t,s){"use strict";s("0e55")},"0e55":function(e,t,s){},"512b":function(e,t,s){"use strict";var i=function(){var e=this,t=e._self._c;return t("div",{staticClass:"select-person-wrapper"},[t("div",{staticClass:"select-person-input",class:{"is-focus":e.dialogVisible,"is-disabled":e.disabled,["el-input--"+e.size]:e.size},on:{click:e.handleClick}},[t("div",{staticClass:"select-person-inner"},[e.displayText?t("span",{staticClass:"selected-text"},[e._v(e._s(e.displayText))]):t("span",{staticClass:"placeholder-text"},[e._v(e._s(e.placeholder))]),t("i",{staticClass:"el-icon-arrow-down select-arrow",class:{"is-reverse":e.dialogVisible}}),e.clearable&&e.selectedPersons.length>0&&!e.disabled?t("i",{staticClass:"el-icon-circle-close clear-icon",on:{click:function(t){return t.stopPropagation(),e.handleClear.apply(null,arguments)}}}):e._e()])]),t("el-dialog",{attrs:{title:"选择人员",visible:e.dialogVisible,width:"500px",modal:!1,"close-on-click-modal":!1,"close-on-press-escape":!0},on:{"update:visible":function(t){e.dialogVisible=t},close:e.handleCancel}},[t("div",{staticClass:"status-filter"},[t("el-radio-group",{model:{value:e.statusFilter,callback:function(t){e.statusFilter=t},expression:"statusFilter"}},[t("el-radio",{attrs:{label:"active"}},[e._v("在职")]),t("el-radio",{attrs:{label:"inactive"}},[e._v("离职")])],1)],1),t("div",{staticClass:"search-section"},[t("el-input",{attrs:{placeholder:"请输入姓名或部门","prefix-icon":"el-icon-search",clearable:""},on:{clear:e.handleSearch,input:e.handleSearch},model:{value:e.searchKeyword,callback:function(t){e.searchKeyword=t},expression:"searchKeyword"}})],1),t("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"tree-container",attrs:{"element-loading-text":"加载人员数据中..."}},[t("el-tree",{ref:"tree",attrs:{data:e.filteredTreeData,props:e.treeProps,"show-checkbox":e.multiple,"check-strictly":!1,"default-expand-all":!1,"expand-on-click-node":!1,"check-on-click-node":e.multiple,"highlight-current":!e.multiple,"node-key":"id","default-checked-keys":e.multiple?e.selectedIds:[],"current-node-key":!e.multiple&&e.selectedIds.length>0?e.selectedIds[0]:null},on:{check:e.handleCheck,"node-click":e.handleNodeClick},scopedSlots:e._u([{key:"default",fn:function({data:s}){return[t("div",{staticClass:"tree-node-content"},[t("i",{staticClass:"node-icon",class:e.getNodeIcon(s)}),t("span",{staticClass:"node-label"},[e._v(e._s(s.name))]),"person"===s.type&&s.position?t("span",{staticClass:"position-tag"},[e._v(" "+e._s(s.position)+" ")]):e._e(),"person"===s.type&&"inactive"===s.status?t("span",{staticClass:"status-tag"},[e._v(" 离职 ")]):e._e()])]}}])})],1),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:e.handleReset}},[e._v("重置")]),t("el-button",{on:{click:e.handleCancel}},[e._v("取消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.handleConfirm}},[e._v("确定")])],1)])],1)},a=[],n=(s("14d9"),s("e9f5"),s("910d"),s("f665"),s("7d54"),s("ab43"),s("f6b0")),r={name:"SelectPerson",model:{prop:"value",event:"input"},props:{value:{type:[Array,String,Number],default:()=>[]},multiple:{type:Boolean,default:!1},placeholder:{type:String,default:"请选择人员"},disabled:{type:Boolean,default:!1},clearable:{type:Boolean,default:!1},size:{type:String,default:"",validator:e=>["","large","small","mini"].includes(e)}},data(){return{dialogVisible:!1,statusFilter:"active",searchKeyword:"",selectedIds:[],selectedPersons:[],loading:!1,treeProps:{children:"children",label:"name"},originalTreeData:[],fallbackTreeData:[{id:"ruitung-group",name:"睿通集团",type:"department",children:[{id:"company-1",name:"一公司",type:"department",children:[{id:"company-1-group-a",name:"一公司A组",type:"department",children:[{id:"chenhao",name:"陈昊",type:"person",status:"active",department:"一公司A组",position:"高级工程师"},{id:"huke",name:"胡可",type:"person",status:"active",department:"一公司A组",position:"项目经理"},{id:"weichaoqun",name:"魏超群",type:"person",status:"inactive",department:"一公司A组",position:"技术主管"},{id:"liwei",name:"李伟",type:"person",status:"active",department:"一公司A组",position:"软件工程师"},{id:"zhangsan",name:"张三",type:"person",status:"active",department:"一公司A组",position:"测试工程师"}]},{id:"company-1-group-b",name:"一公司B组",type:"department",children:[{id:"shichunhua",name:"史春华",type:"person",status:"active",department:"一公司B组",position:"业务经理"},{id:"zhanghongjuan",name:"章红娟",type:"person",status:"active",department:"一公司B组",position:"客户代表"},{id:"heyuzhu",name:"何雨住",type:"person",status:"inactive",department:"一公司B组",position:"销售代表"},{id:"wangwu",name:"王五",type:"person",status:"active",department:"一公司B组",position:"市场专员"},{id:"zhaoliu",name:"赵六",type:"person",status:"active",department:"一公司B组",position:"业务助理"}]}]},{id:"company-2",name:"二公司",type:"department",children:[{id:"company-2-group-a",name:"二公司A组",type:"department",children:[{id:"sunqi",name:"孙七",type:"person",status:"active",department:"二公司A组",position:"部门经理"},{id:"zhouba",name:"周八",type:"person",status:"active",department:"二公司A组",position:"资深顾问"},{id:"wujiu",name:"吴九",type:"person",status:"inactive",department:"二公司A组",position:"项目助理"}]},{id:"company-2-group-b",name:"二公司B组",type:"department",children:[{id:"zhengshi",name:"郑十",type:"person",status:"active",department:"二公司B组",position:"技术专家"},{id:"liuyiyi",name:"刘一一",type:"person",status:"active",department:"二公司B组",position:"产品经理"}]}]},{id:"patent-dept",name:"专利部",type:"department",children:[{id:"chenerer",name:"陈二二",type:"person",status:"active",department:"专利部",position:"专利工程师"},{id:"wangsansan",name:"王三三",type:"person",status:"active",department:"专利部",position:"知识产权专员"},{id:"lisisi",name:"李四四",type:"person",status:"inactive",department:"专利部",position:"专利代理人"}]},{id:"mechanical-dept-1",name:"机械一部",type:"department",children:[{id:"jialixing",name:"贾理兴",type:"person",status:"active",department:"机械一部",position:"机械工程师"},{id:"tianjushan",name:"田菊山",type:"person",status:"active",department:"机械一部",position:"设计师"},{id:"zhangwuwu",name:"张五五",type:"person",status:"active",department:"机械一部",position:"制图员"},{id:"liuliuliu",name:"刘六六",type:"person",status:"inactive",department:"机械一部",position:"技术员"}]},{id:"chemical-dept-1",name:"化学一部",type:"department",children:[{id:"huangqiqi",name:"黄七七",type:"person",status:"active",department:"化学一部",position:"化学工程师"},{id:"zhoubaba",name:"周八八",type:"person",status:"active",department:"化学一部",position:"实验员"},{id:"wujiujiu",name:"吴九九",type:"person",status:"active",department:"化学一部",position:"分析师"}]},{id:"electronic-dept-1",name:"电学一部",type:"department",children:[{id:"zhengshishi",name:"郑十十",type:"person",status:"active",department:"电学一部",position:"电子工程师"},{id:"sunshiyi",name:"孙十一",type:"person",status:"active",department:"电学一部",position:"硬件工程师"},{id:"lishier",name:"李十二",type:"person",status:"inactive",department:"电学一部",position:"测试工程师"}]},{id:"project-dept",name:"项目部",type:"department",children:[{id:"wangshisan",name:"王十三",type:"person",status:"active",department:"项目部",position:"项目总监"},{id:"zhaoshisi",name:"赵十四",type:"person",status:"active",department:"项目部",position:"项目经理"},{id:"chengsihwu",name:"陈十五",type:"person",status:"active",department:"项目部",position:"项目专员"},{id:"liushiliu",name:"刘十六",type:"person",status:"inactive",department:"项目部",position:"项目助理"}]}]}]}},computed:{filteredTreeData(){let e=this.filterTreeByStatus(this.originalTreeData);return this.searchKeyword.trim()&&(e=this.filterTreeByKeyword(e,this.searchKeyword.trim())),e},displayText(){return 0===this.selectedPersons.length?"":this.multiple?1===this.selectedPersons.length?this.selectedPersons[0].name:`已选择 ${this.selectedPersons.length} 人`:(null===(e=this.selectedPersons[0])||void 0===e?void 0:e.name)||"";var e}},created(){this.loadOrganizationData()},watch:{value:{immediate:!0,handler(e){this.initSelectedPersons(e)}},dialogVisible:{handler(e){e&&this.$nextTick(()=>{this.syncTreeSelection()})}},filteredTreeData:{handler(){this.dialogVisible&&this.$nextTick(()=>{this.syncTreeSelection()})}}},methods:{async loadOrganizationData(){this.loading=!0;try{const e=await n["a"].getOrganizationTree();e.data&&e.data.success&&e.data.data?this.originalTreeData=this.transformApiDataToTreeData(e.data.data):(this.originalTreeData=this.fallbackTreeData,console.warn("获取组织架构数据失败，使用备用数据"))}catch(e){console.error("获取组织架构数据失败:",e),this.originalTreeData=this.fallbackTreeData}finally{this.loading=!1}},transformApiDataToTreeData(e){if(!Array.isArray(e))return this.fallbackTreeData;const t=[];return e.forEach(e=>{if("dept"===e.type){const s={id:e.id,name:e.label,type:"department",children:[]};Array.isArray(e.children)&&e.children.forEach(t=>{if("user"===t.type){const i={id:t.id,name:t.label,type:"person",status:"active",department:t.department_name||e.label,position:"员工"};s.children.push(i)}}),(s.children.length>0||0===e.parent_id)&&t.push(s)}}),t.length>0?t:this.fallbackTreeData},initSelectedPersons(e){this.multiple?this.selectedIds=Array.isArray(e)?e.map(e=>String(e)):[]:this.selectedIds=e?[String(e)]:[],console.log("SelectPerson: 初始化选中人员",{originalVal:e,selectedIds:this.selectedIds}),this.updateSelectedPersons()},updateSelectedPersons(){this.selectedPersons=this.getSelectedPersons()},handleClick(){this.disabled||(this.dialogVisible=!0,this.$nextTick(()=>{if(this.$refs.tree&&this.$refs.tree.setExpandedKeys){const e=this.getAllDepartmentIds(this.originalTreeData);this.$refs.tree.setExpandedKeys(e.slice(0,3))}}))},handleClear(){this.selectedIds=[],this.selectedPersons=[],this.emitChange()},getNodeIcon(e){return"department"===e.type?"el-icon-office-building":"el-icon-user"},filterTreeByStatus(e){return e.map(e=>{const t={...e};return e.children&&(t.children=this.filterTreeByStatus(e.children)),"person"===e.type?e.status===this.statusFilter?t:null:t}).filter(Boolean)},filterTreeByKeyword(e,t){const s=[];for(const i of e){const e={...i};let a=!1;if("person"===i.type)(i.name.includes(t)||i.department.includes(t)||i.position&&i.position.includes(t))&&(a=!0);else if("department"===i.type)if(i.name.includes(t))a=!0;else if(i.children){const s=this.filterTreeByKeyword(i.children,t);s.length>0&&(e.children=s,a=!0)}a&&s.push(e)}return s},handleCheck(e,{checkedKeys:t,checkedNodes:s}){if(!this.multiple)return;const i=t.filter(e=>{const t=s.find(t=>t.id===e);return t&&"person"===t.type});this.selectedIds=i,this.updateSelectedPersons()},handleNodeClick(e){"person"===e.type&&(this.multiple||(this.selectedIds=[e.id],this.updateSelectedPersons(),this.handleConfirm()))},handleSearch(){this.searchKeyword.trim()&&this.$nextTick(()=>{this.$refs.tree&&this.$refs.tree.setExpandedKeys&&this.$refs.tree.setExpandedKeys(this.getAllDepartmentIds(this.filteredTreeData))})},getAllDepartmentIds(e){const t=[];return e.forEach(e=>{"department"===e.type&&(t.push(e.id),e.children&&t.push(...this.getAllDepartmentIds(e.children)))}),t},handleConfirm(){this.emitChange(),this.dialogVisible=!1},handleCancel(){this.initSelectedPersons(this.value),this.dialogVisible=!1,this.searchKeyword=""},handleReset(){this.selectedIds=[],this.updateSelectedPersons(),this.searchKeyword="",this.statusFilter="active",this.$refs.tree&&(this.$refs.tree.setCheckedKeys&&this.$refs.tree.setCheckedKeys([]),this.$refs.tree.setCurrentKey&&this.$refs.tree.setCurrentKey(null))},emitChange(){let e;e=this.multiple?this.selectedIds:this.selectedIds.length>0?this.selectedIds[0]:"",this.$emit("input",e),this.$emit("change",e,this.selectedPersons)},getSelectedPersons(){const e=[],t=s=>{s.forEach(s=>{"person"===s.type&&this.selectedIds.includes(String(s.id))&&e.push(s),s.children&&t(s.children)})};return t(this.originalTreeData),e},syncTreeSelection(){this.$refs.tree&&(this.multiple&&this.selectedIds.length>0&&this.$refs.tree.setCheckedKeys&&this.$refs.tree.setCheckedKeys(this.selectedIds),!this.multiple&&this.selectedIds.length>0&&this.$refs.tree.setCurrentKey&&this.$refs.tree.setCurrentKey(this.selectedIds[0]))}}},l=r,d=(s("0bd2"),s("2877")),o=Object(d["a"])(l,i,a,!1,null,"06c944c0",null);t["a"]=o.exports}}]);