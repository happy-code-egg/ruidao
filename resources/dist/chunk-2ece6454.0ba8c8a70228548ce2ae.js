(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2ece6454"],{"027b":function(e,t,a){"use strict";a("3eb8")},"0d26":function(e,t,a){"use strict";var s=a("e330"),o=Error,r=s("".replace),l=function(e){return String(new o(e).stack)}("zxcasd"),n=/\n\s*at [^:]*:[^\n]*/,i=n.test(l);e.exports=function(e,t){if(i&&"string"==typeof e&&!o.prepareStackTrace)while(t--)e=r(e,n,"");return e}},"13d5":function(e,t,a){"use strict";var s=a("23e7"),o=a("d58f").left,r=a("a640"),l=a("1212"),n=a("9adc"),i=!n&&l>79&&l<83,c=i||!r("reduce");s({target:"Array",proto:!0,forced:c},{reduce:function(e){var t=arguments.length;return o(this,e,t,t>1?arguments[1]:void 0)}})},1787:function(e,t,a){"use strict";var s=a("861d");e.exports=function(e){return s(e)||null===e}},2007:function(e,t,a){"use strict";a("81d5")},"2ba4":function(e,t,a){"use strict";var s=a("40d5"),o=Function.prototype,r=o.apply,l=o.call;e.exports="object"==typeof Reflect&&Reflect.apply||(s?l.bind(r):function(){return l.apply(r,arguments)})},3741:function(e,t,a){},"3bbe":function(e,t,a){"use strict";var s=a("1787"),o=String,r=TypeError;e.exports=function(e){if(s(e))return e;throw new r("Can't set "+o(e)+" as a prototype")}},"3eb8":function(e,t,a){},"6f19":function(e,t,a){"use strict";var s=a("9112"),o=a("0d26"),r=a("b980"),l=Error.captureStackTrace;e.exports=function(e,t,a,n){r&&(l?l(e,t):s(e,"stack",o(a,n)))}},7156:function(e,t,a){"use strict";var s=a("1626"),o=a("861d"),r=a("d2bb");e.exports=function(e,t,a){var l,n;return r&&s(l=t.constructor)&&l!==a&&o(n=l.prototype)&&n!==a.prototype&&r(e,n),e}},7282:function(e,t,a){"use strict";var s=a("e330"),o=a("59ed");e.exports=function(e,t,a){try{return s(o(Object.getOwnPropertyDescriptor(e,t)[a]))}catch(r){}}},"81d5":function(e,t,a){},8558:function(e,t,a){"use strict";var s=a("cfe9"),o=a("b5db"),r=a("c6b6"),l=function(e){return o.slice(0,e.length)===e};e.exports=function(){return l("Bun/")?"BUN":l("Cloudflare-Workers")?"CLOUDFLARE":l("Deno/")?"DENO":l("Node.js/")?"NODE":s.Bun&&"string"==typeof Bun.version?"BUN":s.Deno&&"object"==typeof Deno.version?"DENO":"process"===r(s.process)?"NODE":s.window&&s.document?"BROWSER":"REST"}()},9485:function(e,t,a){"use strict";var s=a("23e7"),o=a("2266"),r=a("59ed"),l=a("825a"),n=a("46c4"),i=TypeError;s({target:"Iterator",proto:!0,real:!0},{reduce:function(e){l(this),r(e);var t=n(this),a=arguments.length<2,s=a?void 0:arguments[1],c=0;if(o(t,(function(t){a?(a=!1,s=t):s=e(s,t,c),c++}),{IS_RECORD:!0}),a)throw new i("Reduce of empty iterator with no initial value");return s}})},"9adc":function(e,t,a){"use strict";var s=a("8558");e.exports="NODE"===s},a31f:function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e._self._c;return t("div",{key:e.componentKey,staticClass:"performance-container"},[t("div",{staticClass:"performance-status-tabs"},[t("el-tabs",{attrs:{type:"card"},on:{"tab-click":e.handleStatusTabClick},model:{value:e.activeStatus,callback:function(t){e.activeStatus=t},expression:"activeStatus"}},[t("el-tab-pane",{attrs:{label:"草稿",name:"draft"}},[t("span",{attrs:{slot:"label"},slot:"label"},[t("i",{staticClass:"el-icon-edit-outline"}),e._v(" 草稿 ")])]),t("el-tab-pane",{attrs:{label:"待审核",name:"pending"}},[t("span",{attrs:{slot:"label"},slot:"label"},[t("i",{staticClass:"el-icon-time"}),e._v(" 待审核 ")])]),t("el-tab-pane",{attrs:{label:"已审核",name:"approved"}},[t("span",{attrs:{slot:"label"},slot:"label"},[t("i",{staticClass:"el-icon-success"}),e._v(" 已审核 ")])]),t("el-tab-pane",{attrs:{label:"已退回",name:"rejected"}},[t("span",{attrs:{slot:"label"},slot:"label"},[t("i",{staticClass:"el-icon-warning"}),e._v(" 已退回 ")])]),t("el-tab-pane",{attrs:{label:"已作废",name:"cancelled"}},[t("span",{attrs:{slot:"label"},slot:"label"},[t("i",{staticClass:"el-icon-delete"}),e._v(" 已作废 ")])]),t("el-tab-pane",{attrs:{label:"全部",name:"all"}})],1)],1),t("div",{staticClass:"body-part-search"},[t("el-form",{ref:"searchForm",attrs:{model:e.searchForm,"label-width":"100px"}},[t("div",{staticClass:"default-filters"},[t("el-row",[t("el-col",{attrs:{span:6}},[t("el-form-item",{attrs:{label:"业绩单号",prop:"performanceNo"}},[t("el-input",{staticClass:"filter-item",attrs:{placeholder:"业绩单号",clearable:"",size:"small"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleSearch.apply(null,arguments)}},model:{value:e.searchForm.performanceNo,callback:function(t){e.$set(e.searchForm,"performanceNo",t)},expression:"searchForm.performanceNo"}})],1)],1),t("el-col",{attrs:{span:6}},[t("el-form-item",{attrs:{label:"合同号",prop:"contractNo"}},[t("el-input",{staticClass:"filter-item",attrs:{placeholder:"合同号",clearable:"",size:"small"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleSearch.apply(null,arguments)}},model:{value:e.searchForm.contractNo,callback:function(t){e.$set(e.searchForm,"contractNo",t)},expression:"searchForm.contractNo"}})],1)],1),t("el-col",{attrs:{span:6}},[t("el-form-item",{attrs:{label:"客户名称",prop:"customerName"}},[t("el-input",{staticClass:"filter-item",attrs:{placeholder:"客户名称",clearable:"",size:"small"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleSearch.apply(null,arguments)}},model:{value:e.searchForm.customerName,callback:function(t){e.$set(e.searchForm,"customerName",t)},expression:"searchForm.customerName"}})],1)],1),t("el-col",{attrs:{span:6}},[t("el-form-item",{attrs:{label:"业务人员",prop:"salesman"}},[t("el-input",{staticClass:"filter-item",attrs:{placeholder:"业务人员",clearable:"",size:"small"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleSearch.apply(null,arguments)}},model:{value:e.searchForm.salesman,callback:function(t){e.$set(e.searchForm,"salesman",t)},expression:"searchForm.salesman"}})],1)],1),t("el-col",{attrs:{span:6}},[t("el-form-item",{attrs:{label:"业绩类型",prop:"performanceType"}},[t("el-select",{staticClass:"filter-item",attrs:{placeholder:"业绩类型",clearable:"",size:"small"},model:{value:e.searchForm.performanceType,callback:function(t){e.$set(e.searchForm,"performanceType",t)},expression:"searchForm.performanceType"}},[t("el-option",{attrs:{label:"有项目",value:"with_case"}}),t("el-option",{attrs:{label:"无项目",value:"without_case"}})],1)],1)],1),t("el-col",{attrs:{span:6}},[t("el-form-item",{attrs:{label:"状态",prop:"status"}},[t("el-select",{staticClass:"filter-item",attrs:{placeholder:"状态",clearable:"",size:"small"},model:{value:e.searchForm.status,callback:function(t){e.$set(e.searchForm,"status",t)},expression:"searchForm.status"}},[t("el-option",{attrs:{label:"草稿",value:"draft"}}),t("el-option",{attrs:{label:"待审核",value:"pending"}}),t("el-option",{attrs:{label:"已审核",value:"approved"}}),t("el-option",{attrs:{label:"已退回",value:"rejected"}}),t("el-option",{attrs:{label:"已作废",value:"cancelled"}})],1)],1)],1),t("el-col",{attrs:{span:6}},[t("el-form-item",{attrs:{label:"创建时间",prop:"createTimeRange"}},[t("el-date-picker",{staticClass:"filter-item",attrs:{type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",size:"small","value-format":"yyyy-MM-dd"},model:{value:e.searchForm.createTimeRange,callback:function(t){e.$set(e.searchForm,"createTimeRange",t)},expression:"searchForm.createTimeRange"}})],1)],1),t("el-col",{attrs:{span:6}},[t("el-form-item",{attrs:{label:"金额范围",prop:"amountRange"}},[t("div",{staticClass:"custom-range-input"},[t("el-input",{staticClass:"custom-range-item",attrs:{placeholder:"最小金额",size:"small"},model:{value:e.searchForm.minAmount,callback:function(t){e.$set(e.searchForm,"minAmount",t)},expression:"searchForm.minAmount"}}),t("span",{staticClass:"custom-range-separator"},[e._v("-")]),t("el-input",{staticClass:"custom-range-item",attrs:{placeholder:"最大金额",size:"small"},model:{value:e.searchForm.maxAmount,callback:function(t){e.$set(e.searchForm,"maxAmount",t)},expression:"searchForm.maxAmount"}})],1)])],1)],1)],1),e.expandSearchVisible?t("div",[t("el-row",[t("el-col",{attrs:{span:6}},[t("el-form-item",{attrs:{label:"项目号",prop:"caseNo"}},[t("el-input",{staticClass:"filter-item",attrs:{placeholder:"项目号",clearable:"",size:"small"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleSearch.apply(null,arguments)}},model:{value:e.searchForm.caseNo,callback:function(t){e.$set(e.searchForm,"caseNo",t)},expression:"searchForm.caseNo"}})],1)],1),t("el-col",{attrs:{span:6}},[t("el-form-item",{attrs:{label:"审核人",prop:"approver"}},[t("el-input",{staticClass:"filter-item",attrs:{placeholder:"审核人",clearable:"",size:"small"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleSearch.apply(null,arguments)}},model:{value:e.searchForm.approver,callback:function(t){e.$set(e.searchForm,"approver",t)},expression:"searchForm.approver"}})],1)],1),t("el-col",{attrs:{span:6}},[t("el-form-item",{attrs:{label:"审核时间",prop:"approveTimeRange"}},[t("el-date-picker",{staticClass:"filter-item",attrs:{type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",size:"small","value-format":"yyyy-MM-dd"},model:{value:e.searchForm.approveTimeRange,callback:function(t){e.$set(e.searchForm,"approveTimeRange",t)},expression:"searchForm.approveTimeRange"}})],1)],1),t("el-col",{attrs:{span:6}},[t("el-form-item",{attrs:{label:"创建人",prop:"creator"}},[t("el-input",{staticClass:"filter-item",attrs:{placeholder:"创建人",clearable:"",size:"small"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleSearch.apply(null,arguments)}},model:{value:e.searchForm.creator,callback:function(t){e.$set(e.searchForm,"creator",t)},expression:"searchForm.creator"}})],1)],1)],1)],1):e._e()]),t("div",{staticClass:"part-search-buttons"},[t("el-button",{attrs:{size:"small",type:"primary",icon:"el-icon-search"},on:{click:e.handleSearch}},[e._v("搜索")]),t("el-button",{attrs:{size:"small",icon:"el-icon-refresh"},on:{click:e.resetSearch}},[e._v("重置")])],1)],1),t("div",{staticClass:"body-part-content"},[t("div",{staticClass:"part-table-header"},[e._m(0),t("div",{staticClass:"part-table-operations"},[t("el-button",{attrs:{size:"small",type:"primary"},on:{click:e.handleExport}},[e._v("导出")]),t("el-button",{attrs:{size:"small",type:"primary"},on:{click:e.handleAdd}},[e._v("新增业绩单")]),t("column-filter",{attrs:{"storage-key":"performance",columns:e.availableColumns,"default-selected":e.defaultSelectedColumns},on:{"update:visible-columns":e.updateVisibleColumns}})],1)]),t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{data:e.tableData,border:"",size:"small","row-key":"id"},on:{"selection-change":e.handleSelectionChange}},[t("el-table-column",{attrs:{type:"selection",width:"80",align:"center"}}),t("el-table-column",{attrs:{type:"index",label:"序号",width:"60",align:"center"}}),e._l(e.visibleColumns,(function(a){return t("el-table-column",{key:a.prop,attrs:{prop:a.prop,label:a.label,width:a.width,"min-width":a.minWidth,"show-overflow-tooltip":a.showOverflowTooltip,align:"center"},scopedSlots:e._u([{key:"default",fn:function(s){return["performanceType"===a.prop?t("el-tag",{attrs:{type:"with_case"===s.row.performanceType?"success":"info",size:"small"}},[e._v(" "+e._s("with_case"===s.row.performanceType?"有项目":"无项目")+" ")]):"status"===a.prop?t("el-tag",{attrs:{type:e.getStatusType(s.row.status),size:"small"}},[e._v(" "+e._s(e.getStatusText(s.row.status))+" ")]):"performanceAllocation"===a.prop?t("div",{staticClass:"allocation-list"},e._l(s.row.allocations,(function(a,s){return t("div",{key:s,staticClass:"allocation-item"},[e._v(" "+e._s(a.name)+": ¥"+e._s(a.amount)+" ("+e._s(a.percentage)+"%) ")])})),0):t("span",[e._v(e._s(s.row[a.prop]))])]}}],null,!0)})})),t("el-table-column",{attrs:{fixed:"right",label:"操作",align:"center",width:"200","class-name":"small-padding fixed-width"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-button",{attrs:{size:"mini",type:"text",icon:"el-icon-view"},on:{click:function(t){return e.handleView(a.row)}}},[e._v("查看")]),"draft"===a.row.status?t("el-button",{attrs:{size:"mini",type:"text",icon:"el-icon-edit"},on:{click:function(t){return e.handleEdit(a.row)}}},[e._v("编辑")]):e._e(),"draft"===a.row.status?t("el-button",{attrs:{size:"mini",type:"text",icon:"el-icon-check"},on:{click:function(t){return e.handleSubmit(a.row)}}},[e._v("提交审核")]):e._e(),["draft","rejected"].includes(a.row.status)?t("el-button",{attrs:{size:"mini",type:"text",icon:"el-icon-delete"},on:{click:function(t){return e.handleDelete(a.row)}}},[e._v("删除")]):e._e()]}}])})],2),t("el-pagination",{directives:[{name:"show",rawName:"v-show",value:e.pagination.total>0,expression:"pagination.total > 0"}],attrs:{total:e.pagination.total,"current-page":e.pagination.currentPage,"page-sizes":[10,20,50,100],"page-size":e.pagination.pageSize,layout:"total, sizes, prev, pager, next, jumper"},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1),t("el-dialog",{attrs:{title:e.dialogTitle,visible:e.dialogVisible,width:"70%","before-close":e.handleDialogClose},on:{"update:visible":function(t){e.dialogVisible=t}}},[e.dialogVisible?t("performance-form",{attrs:{"form-data":e.currentRow,mode:e.dialogMode},on:{save:e.handleSavePerformance,cancel:e.handleDialogClose}}):e._e()],1)],1)},o=[function(){var e=this,t=e._self._c;return t("div",{staticClass:"part-table-title"},[t("span",[e._v("业绩单管理")])])}],r=(a("14d9"),a("e9f5"),a("910d"),a("ab43"),a("c4b3")),l=function(){var e=this,t=e._self._c;return t("div",{staticClass:"performance-form-container"},[t("el-form",{ref:"formRef",attrs:{model:e.form,rules:e.formRules,"label-width":"120px"}},[t("div",{staticClass:"form-section"},[t("h4",{staticClass:"section-title"},[e._v("基础信息")]),t("el-row",{attrs:{gutter:20}},[t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"业绩类型",prop:"performanceType"}},[t("el-radio-group",{on:{change:e.handleTypeChange},model:{value:e.form.performanceType,callback:function(t){e.$set(e.form,"performanceType",t)},expression:"form.performanceType"}},[t("el-radio",{attrs:{label:"with_case"}},[e._v("有项目（有项目）")]),t("el-radio",{attrs:{label:"without_case"}},[e._v("无项目（无项目）")])],1)],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"业绩单号",prop:"performanceNo"}},[t("el-input",{attrs:{disabled:"view"===e.mode,placeholder:"系统自动生成"},model:{value:e.form.performanceNo,callback:function(t){e.$set(e.form,"performanceNo",t)},expression:"form.performanceNo"}})],1)],1)],1),t("el-row",{attrs:{gutter:20}},[t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"选择合同",prop:"contractId"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择合同",filterable:"",remote:"","remote-method":e.searchContracts,loading:e.contractLoading,disabled:"view"===e.mode},on:{change:e.handleContractChange},model:{value:e.form.contractId,callback:function(t){e.$set(e.form,"contractId",t)},expression:"form.contractId"}},e._l(e.contractList,(function(a){return t("el-option",{key:a.id,attrs:{label:`${a.contractNo} - ${a.contractName}`,value:a.id}},[t("span",{staticStyle:{float:"left"}},[e._v(e._s(a.contractNo))]),t("span",{staticStyle:{float:"right",color:"#8492a6","font-size":"13px"}},[e._v(e._s(a.customerName))])])})),1)],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"客户名称",prop:"customerName"}},[t("el-input",{model:{value:e.form.customerName,callback:function(t){e.$set(e.form,"customerName",t)},expression:"form.customerName"}})],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"官费"}},[t("el-input",{model:{value:e.form.officialFee,callback:function(t){e.$set(e.form,"officialFee",t)},expression:"form.officialFee"}})],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"税费"}},[t("el-input",{model:{value:e.form.taxFee,callback:function(t){e.$set(e.form,"taxFee",t)},expression:"form.taxFee"}})],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"渠道费"}},[t("el-input",{model:{value:e.form.channelFee,callback:function(t){e.$set(e.form,"channelFee",t)},expression:"form.channelFee"}})],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"第三方费用"}},[t("el-input",{model:{value:e.form.otherFee,callback:function(t){e.$set(e.form,"otherFee",t)},expression:"form.otherFee"}})],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"代理费"}},[t("el-input",{model:{value:e.form.agentFee,callback:function(t){e.$set(e.form,"agentFee",t)},expression:"form.agentFee"}})],1)],1)],1)],1),"with_case"===e.form.performanceType?t("div",{staticClass:"form-section"},[t("h4",{staticClass:"section-title"},[e._v("已核销请款单")]),t("el-row",{attrs:{gutter:20}},[t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:"选择请款单",prop:"selectedRequests"}},[t("el-button",{attrs:{size:"small",type:"primary",disabled:"view"===e.mode},on:{click:e.showRequestSelector}},[e._v(" 选择已核销请款单 ")]),t("span",{staticStyle:{"margin-left":"10px",color:"#666"}},[e._v("已选择 "+e._s(e.selectedRequests.length)+" 张")])],1)],1)],1),e.selectedRequests.length>0?t("div",{staticClass:"selected-cases"},[t("el-table",{attrs:{data:e.selectedRequests,border:"",size:"small"}},[t("el-table-column",{attrs:{type:"index",label:"序号",width:"60",align:"center"}}),t("el-table-column",{attrs:{prop:"requestNo",label:"请款单号",width:"160"}}),t("el-table-column",{attrs:{prop:"customerName",label:"客户名称","min-width":"180","show-overflow-tooltip":""}}),t("el-table-column",{attrs:{prop:"contractNo",label:"合同号",width:"140"}}),t("el-table-column",{attrs:{prop:"officialFee",label:"官费",width:"120",align:"right"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("¥"+e._s(t.row.officialFee))]}}],null,!1,2907894676)}),t("el-table-column",{attrs:{prop:"serviceFee",label:"服务费(计入业绩)",width:"160",align:"right"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("¥"+e._s(t.row.serviceFee))]}}],null,!1,3462983080)}),t("el-table-column",{attrs:{prop:"writeOffAmount",label:"已核销金额",width:"140",align:"right"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("¥"+e._s(t.row.writeOffAmount))]}}],null,!1,3205599117)}),"view"!==e.mode?t("el-table-column",{attrs:{label:"操作",width:"80",align:"center"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-button",{attrs:{size:"mini",type:"text"},on:{click:function(t){return e.removeRequest(a.$index)}}},[e._v("移除")])]}}],null,!1,2569540921)}):e._e()],1)],1):e._e()],1):e._e(),"without_case"===e.form.performanceType?t("div",{staticClass:"form-section"},[t("h4",{staticClass:"section-title"},[e._v("业绩信息")]),t("el-row",{attrs:{gutter:20}},[t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"到账金额",prop:"receivedAmount"}},[t("el-input",{attrs:{disabled:"view"===e.mode,placeholder:"请输入到账金额"},model:{value:e.form.receivedAmount,callback:function(t){e.$set(e.form,"receivedAmount",t)},expression:"form.receivedAmount"}},[t("template",{slot:"prepend"},[e._v("¥")])],2)],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"业绩金额",prop:"performanceAmount"}},[t("el-input",{attrs:{disabled:"view"===e.mode,placeholder:"请输入业绩金额"},model:{value:e.form.performanceAmount,callback:function(t){e.$set(e.form,"performanceAmount",t)},expression:"form.performanceAmount"}},[t("template",{slot:"prepend"},[e._v("¥")])],2)],1)],1)],1)],1):e._e(),t("div",{staticClass:"form-section"},[t("h4",{staticClass:"section-title"},[e._v(" 业绩分配 "),t("el-button",{staticStyle:{"margin-left":"20px"},attrs:{size:"mini",type:"primary",disabled:"view"===e.mode},on:{click:e.addAllocation}},[e._v(" 添加人员 ")])],1),t("el-table",{attrs:{data:e.form.allocations,border:"",size:"small"}},[t("el-table-column",{attrs:{type:"index",label:"序号",width:"60",align:"center"}}),t("el-table-column",{attrs:{label:"业务人员",width:"200"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"选择业务人员",filterable:"",disabled:"view"===e.mode},on:{change:function(t){return e.handlePersonChange(a.$index,t)}},model:{value:a.row.userId,callback:function(t){e.$set(a.row,"userId",t)},expression:"scope.row.userId"}},e._l(e.businessPersonList,(function(e){return t("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)]}}])}),t("el-table-column",{attrs:{label:"业绩金额",width:"180"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-input",{attrs:{placeholder:"业绩金额",disabled:"view"===e.mode},model:{value:a.row.amount,callback:function(t){e.$set(a.row,"amount",t)},expression:"scope.row.amount"}},[t("template",{slot:"prepend"},[e._v("¥")])],2)]}}])}),t("el-table-column",{attrs:{label:"业绩比例",width:"120",align:"center"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("span",[e._v(e._s(e.calculatePercentage(a.row.amount))+"%")])]}}])}),t("el-table-column",{attrs:{label:"备注"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-input",{attrs:{placeholder:"业绩备注",disabled:"view"===e.mode},model:{value:a.row.remark,callback:function(t){e.$set(a.row,"remark",t)},expression:"scope.row.remark"}})]}}])}),"view"!==e.mode?t("el-table-column",{attrs:{label:"操作",width:"80",align:"center"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-button",{attrs:{size:"mini",type:"text"},on:{click:function(t){return e.removeAllocation(a.$index)}}},[e._v("删除")])]}}],null,!1,2494364259)}):e._e()],1),t("div",{staticClass:"allocation-summary"},[t("el-row",{attrs:{gutter:20}},[t("el-col",{attrs:{span:8}},[t("div",{staticClass:"summary-item"},[t("span",{staticClass:"summary-label"},[e._v("总业绩金额:")]),t("span",{staticClass:"summary-value"},[e._v("¥"+e._s(e.totalAllocatedAmount))])])]),t("el-col",{attrs:{span:8}},[t("div",{staticClass:"summary-item"},[t("span",{staticClass:"summary-label"},[e._v("已分配人数:")]),t("span",{staticClass:"summary-value"},[e._v(e._s(e.form.allocations.length)+"人")])])]),t("el-col",{attrs:{span:8}},["with_case"===e.form.performanceType?t("div",{staticClass:"summary-item"},[t("span",{staticClass:"summary-label"},[e._v("服务费总计:")]),t("span",{staticClass:"summary-value"},[e._v("¥"+e._s(e.totalServiceFee))])]):t("div",{staticClass:"summary-item"},[t("span",{staticClass:"summary-label"},[e._v("差额:")]),t("span",{staticClass:"summary-value",class:{"error-text":0!==e.allocationDifference}},[e._v(" ¥"+e._s(e.allocationDifference)+" ")])])])],1)],1)],1),t("div",{staticClass:"form-section"},[t("h4",{staticClass:"section-title"},[e._v("备注信息")]),t("el-form-item",{attrs:{label:"备注",prop:"remark"}},[t("el-input",{attrs:{type:"textarea",rows:4,disabled:"view"===e.mode,placeholder:"请输入备注信息"},model:{value:e.form.remark,callback:function(t){e.$set(e.form,"remark",t)},expression:"form.remark"}})],1)],1)]),t("el-dialog",{attrs:{title:"选择项目",visible:e.caseSelectorVisible,width:"80%","close-on-click-modal":!1},on:{"update:visible":function(t){e.caseSelectorVisible=t}}},[t("div",{staticClass:"case-selector"},[t("div",{staticClass:"search-area"},[t("el-row",{attrs:{gutter:20}},[t("el-col",{attrs:{span:8}},[t("el-input",{attrs:{placeholder:"项目号",clearable:"",size:"small"},model:{value:e.caseSearch.caseNo,callback:function(t){e.$set(e.caseSearch,"caseNo",t)},expression:"caseSearch.caseNo"}})],1),t("el-col",{attrs:{span:8}},[t("el-input",{attrs:{placeholder:"项目名称",clearable:"",size:"small"},model:{value:e.caseSearch.caseName,callback:function(t){e.$set(e.caseSearch,"caseName",t)},expression:"caseSearch.caseName"}})],1),t("el-col",{attrs:{span:8}},[t("el-button",{attrs:{size:"small",type:"primary"},on:{click:e.searchCases}},[e._v("搜索")])],1)],1)],1),t("el-table",{attrs:{data:e.availableCases,border:"",size:"small",height:"400"},on:{"selection-change":e.handleCaseSelection}},[t("el-table-column",{attrs:{type:"selection",width:"80"}}),t("el-table-column",{attrs:{type:"index",label:"序号",width:"60",align:"center"}}),t("el-table-column",{attrs:{prop:"caseNo",label:"项目号",width:"140"}}),t("el-table-column",{attrs:{prop:"caseName",label:"项目名称","min-width":"200","show-overflow-tooltip":""}}),t("el-table-column",{attrs:{prop:"caseType",label:"项目类型",width:"120"}}),t("el-table-column",{attrs:{prop:"status",label:"状态",width:"100",align:"center"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-tag",{attrs:{type:"active"===a.row.status?"success":"info",size:"mini"}},[e._v(" "+e._s("active"===a.row.status?"进行中":"已完成")+" ")])]}}])}),t("el-table-column",{attrs:{prop:"serviceFee",label:"服务费",width:"120",align:"right"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" ¥"+e._s(t.row.serviceFee)+" ")]}}])}),t("el-table-column",{attrs:{prop:"createTime",label:"创建时间",width:"150"}})],1)],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.caseSelectorVisible=!1}}},[e._v("取消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.confirmCaseSelection}},[e._v("确定")])],1)]),t("el-dialog",{attrs:{title:"选择已核销请款单",visible:e.requestSelectorVisible,width:"80%","close-on-click-modal":!1},on:{"update:visible":function(t){e.requestSelectorVisible=t}}},[t("div",{staticClass:"case-selector"},[t("el-table",{attrs:{data:e.availableRequests,border:"",size:"small",height:"400"},on:{"selection-change":e.handleRequestSelection}},[t("el-table-column",{attrs:{type:"selection",width:"80"}}),t("el-table-column",{attrs:{type:"index",label:"序号",width:"60",align:"center"}}),t("el-table-column",{attrs:{prop:"requestNo",label:"请款单号",width:"160"}}),t("el-table-column",{attrs:{prop:"customerName",label:"客户名称","min-width":"180","show-overflow-tooltip":""}}),t("el-table-column",{attrs:{prop:"contractNo",label:"合同号",width:"140"}}),t("el-table-column",{attrs:{prop:"officialFee",label:"官费",width:"120",align:"right"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("¥"+e._s(t.row.officialFee))]}}])}),t("el-table-column",{attrs:{prop:"serviceFee",label:"服务费(计入业绩)",width:"160",align:"right"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("¥"+e._s(t.row.serviceFee))]}}])}),t("el-table-column",{attrs:{prop:"writeOffAmount",label:"已核销金额",width:"140",align:"right"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("¥"+e._s(t.row.writeOffAmount))]}}])}),t("el-table-column",{attrs:{prop:"status",label:"状态",width:"100",align:"center"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-tag",{attrs:{type:"success",size:"mini"}},[e._v(e._s("approved"===a.row.status?"已核销":"未核销"))])]}}])})],1)],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.requestSelectorVisible=!1}}},[e._v("取消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.confirmRequestSelection}},[e._v("确定")])],1)]),"view"!==e.mode?t("div",{staticClass:"form-footer"},[t("el-button",{on:{click:e.handleCancel}},[e._v("取消")]),t("el-button",{attrs:{type:"primary",loading:e.submitting},on:{click:e.handleSave}},[e._v("保存")]),t("el-button",{attrs:{type:"success",loading:e.submitting},on:{click:e.handleSubmit}},[e._v("保存并提交")])],1):e._e()],1)},n=[],i=(a("d9e2"),a("13d5"),a("f665"),a("9485"),{name:"PerformanceForm",props:{formData:{type:Object,default:()=>({})},mode:{type:String,default:"add",validator:e=>["add","edit","view"].includes(e)}},data(){return{submitting:!1,contractLoading:!1,form:{performanceNo:"",performanceType:"with_case",contractId:"",contractNo:"",contractName:"",customerName:"",selectedCases:[],selectedRequests:[],receivedAmount:"",performanceAmount:"",allocations:[],remark:""},formRules:{performanceType:[{required:!0,message:"请选择业绩类型",trigger:"change"}],contractId:[{required:!0,message:"请选择合同",trigger:"change"}],selectedRequests:[{validator:(e,t,a)=>{"with_case"!==this.form.performanceType||t&&0!==t.length||a(new Error("请选择至少一张已核销请款单")),a()},trigger:"change"}],receivedAmount:[{validator:(e,t,a)=>{"without_case"!==this.form.performanceType||t||a(new Error("请输入到账金额")),a()},trigger:"blur"}],allocations:[{validator:(e,t,a)=>{t&&0!==t.length||a(new Error("请至少添加一个业绩分配")),a()},trigger:"change"}]},contractList:[],businessPersonList:[],selectedCases:[],selectedRequests:[],caseSelectorVisible:!1,caseSearch:{caseNo:"",caseName:""},availableCases:[],tempSelectedCases:[],requestSelectorVisible:!1,availableRequests:[],tempSelectedRequests:[]}},computed:{totalAllocatedAmount(){return this.form.allocations.reduce((e,t)=>e+(parseFloat(t.amount)||0),0).toFixed(2)},totalServiceFee(){return this.selectedRequests.reduce((e,t)=>e+(parseFloat(t.serviceFee)||0),0).toFixed(2)},allocationDifference(){if("without_case"===this.form.performanceType){const e=parseFloat(this.form.performanceAmount)||0,t=parseFloat(this.totalAllocatedAmount)||0;return(e-t).toFixed(2)}return 0}},watch:{formData:{handler(e){e&&this.initForm(e)},immediate:!0,deep:!0}},created(){this.initData(),"add"===this.mode&&this.generatePerformanceNo()},methods:{initData(){this.businessPersonList=[{id:"1",name:"张三",department:"商务部"},{id:"2",name:"李四",department:"商务部"},{id:"3",name:"王五",department:"商务部"},{id:"4",name:"赵六",department:"商务部"}]},initForm(e){e&&Object.keys(e).length>0&&(this.form={...this.form,...e},this.selectedCases=e.selectedCases||[])},generatePerformanceNo(){this.form.performanceNo="YJ"+Date.now().toString().slice(-8)},searchContracts(e){""!==e?(this.contractLoading=!0,setTimeout(()=>{this.contractList=[{id:"1",contractNo:"HT202401001",contractName:"知识产权服务合同",customerName:"华为技术有限公司"},{id:"2",contractNo:"HT202401002",contractName:"专利申请代理合同",customerName:"腾讯科技有限公司"},{id:"3",contractNo:"HT202401003",contractName:"商标注册服务合同",customerName:"阿里巴巴集团"}].filter(t=>t.contractNo.toLowerCase().includes(e.toLowerCase())||t.contractName.toLowerCase().includes(e.toLowerCase())||t.customerName.toLowerCase().includes(e.toLowerCase())),this.contractLoading=!1},300)):this.contractList=[]},handleContractChange(e){const t=this.contractList.find(t=>t.id===e);t&&(this.form.contractNo=t.contractNo,this.form.contractName=t.contractName,this.form.customerName=t.customerName,this.selectedCases=[],this.form.allocations=[],this.selectedRequests=[],this.form.selectedRequests=[])},handleTypeChange(e){"with_case"===e?(this.form.receivedAmount="",this.form.performanceAmount=""):(this.selectedCases=[],this.selectedRequests=[],this.form.selectedRequests=[]),this.form.allocations=[]},showRequestSelector(){this.form.contractId?(this.searchRequests(),this.requestSelectorVisible=!0):this.$message.warning("请先选择合同")},searchRequests(){this.availableRequests=Array.from({length:10}).map((e,t)=>{const a=6e3+12e3*Math.random(),s=parseFloat((a*(.5+.4*Math.random())).toFixed(2)),o=parseFloat((a-s).toFixed(2)),r=parseFloat((s+o).toFixed(2));return{id:"req_"+(t+1),requestNo:"QK"+String(Date.now()+t).slice(-8),customerName:this.form.customerName,contractNo:this.form.contractNo,officialFee:o.toFixed(2),serviceFee:s.toFixed(2),writeOffAmount:r.toFixed(2),status:"approved",writtenOff:!0}}).filter(e=>!this.selectedRequests.find(t=>t.id===e.id))},handleRequestSelection(e){this.tempSelectedRequests=e},confirmRequestSelection(){this.selectedRequests=[...this.selectedRequests,...this.tempSelectedRequests],this.form.selectedRequests=this.selectedRequests,this.requestSelectorVisible=!1,this.tempSelectedRequests=[],this.autoAllocatePerformance()},removeRequest(e){this.selectedRequests.splice(e,1),this.form.selectedRequests=this.selectedRequests,this.autoAllocatePerformance()},showCaseSelector(){this.form.contractId?(this.searchCases(),this.caseSelectorVisible=!0):this.$message.warning("请先选择合同")},searchCases(){this.availableCases=Array.from({length:10}).map((e,t)=>({id:"case_"+(t+1),caseNo:"AN"+String(Date.now()+t).slice(-8),caseName:`项目名称${t+1} - 专利申请`,caseType:["发明专利","实用新型","外观设计"][Math.floor(3*Math.random())],status:Math.random()>.3?"active":"completed",serviceFee:(5e3+15e3*Math.random()).toFixed(2),createTime:new Date(Date.now()-30*Math.random()*24*60*60*1e3).toLocaleString()})).filter(e=>!this.selectedCases.find(t=>t.id===e.id))},handleCaseSelection(e){this.tempSelectedCases=e},confirmCaseSelection(){this.selectedCases=[...this.selectedCases,...this.tempSelectedCases],this.caseSelectorVisible=!1,this.tempSelectedCases=[],this.autoAllocatePerformance()},removeCase(e){this.selectedCases.splice(e,1),this.autoAllocatePerformance()},autoAllocatePerformance(){if("with_case"===this.form.performanceType&&this.selectedRequests.length>0){const e=parseFloat(this.totalServiceFee);0===this.form.allocations.length&&this.addAllocation(),this.form.allocations.length>0&&this.$set(this.form.allocations,0,{...this.form.allocations[0],amount:e.toFixed(2)})}},addAllocation(){this.form.allocations.push({userId:"",userName:"",amount:"",remark:""})},removeAllocation(e){this.form.allocations.splice(e,1)},handlePersonChange(e,t){const a=this.businessPersonList.find(e=>e.id===t);a&&this.$set(this.form.allocations,e,{...this.form.allocations[e],userName:a.name})},calculatePercentage(e){const t="with_case"===this.form.performanceType?parseFloat(this.totalServiceFee):parseFloat(this.form.performanceAmount)||0;return 0===t?0:((parseFloat(e)||0)/t*100).toFixed(1)},validateForm(){return new Promise(e=>{this.$refs.formRef.validate(t=>{if(t){if(0===this.form.allocations.length)return this.$message.error("请至少添加一个业绩分配"),void e(!1);for(let t=0;t<this.form.allocations.length;t++){const a=this.form.allocations[t];if(!a.userId)return this.$message.error(`第${t+1}个业绩分配未选择人员`),void e(!1);if(!a.amount||parseFloat(a.amount)<=0)return this.$message.error(`第${t+1}个业绩分配金额无效`),void e(!1)}if("without_case"===this.form.performanceType){const t=Math.abs(parseFloat(this.allocationDifference));if(t>.01)return this.$message.error("业绩分配总额与业绩金额不匹配"),void e(!1)}e(!0)}else e(!1)})})},async handleSave(){const e=await this.validateForm();if(!e)return;this.submitting=!0;const t={...this.form,selectedCases:this.selectedCases,selectedRequests:this.selectedRequests,totalAmount:"with_case"===this.form.performanceType?this.totalServiceFee:this.form.performanceAmount};setTimeout(()=>{this.$emit("save",t),this.submitting=!1},1e3)},async handleSubmit(){const e=await this.validateForm();if(!e)return;this.submitting=!0;const t={...this.form,selectedCases:this.selectedCases,selectedRequests:this.selectedRequests,totalAmount:"with_case"===this.form.performanceType?this.totalServiceFee:this.form.performanceAmount,status:"pending"};setTimeout(()=>{this.$emit("save",t),this.submitting=!1},1e3)},handleCancel(){this.$emit("cancel")}}}),c=i,u=(a("027b"),a("2877")),m=Object(u["a"])(c,l,n,!1,null,"70fb483c",null),d=m.exports,p={name:"Performance",components:{ColumnFilter:r["a"],PerformanceForm:d},data(){return{componentKey:0,loading:!1,expandSearchVisible:!0,dialogVisible:!1,dialogMode:"add",currentRow:null,searchForm:{performanceNo:"",contractNo:"",customerName:"",salesman:"",performanceType:"",status:"",createTimeRange:[],minAmount:"",maxAmount:"",caseNo:"",approver:"",approveTimeRange:[],creator:""},visibleColumns:[],availableColumns:[{prop:"performanceNo",label:"业绩单号",minWidth:"140"},{prop:"contractNo",label:"合同号",minWidth:"140"},{prop:"contractName",label:"合同名称",minWidth:"180",showOverflowTooltip:!0},{prop:"customerName",label:"客户名称",minWidth:"150"},{prop:"performanceType",label:"业绩类型",width:"100"},{prop:"caseNo",label:"关联项目",minWidth:"140"},{prop:"totalAmount",label:"业绩总金额",minWidth:"120"},{prop:"performanceAllocation",label:"业绩分配",minWidth:"200"},{prop:"status",label:"状态",width:"100"},{prop:"creator",label:"创建人",width:"100"},{prop:"createTime",label:"创建时间",minWidth:"160"},{prop:"approver",label:"审核人",width:"100"},{prop:"approveTime",label:"审核时间",minWidth:"160"},{prop:"remark",label:"备注",minWidth:"150",showOverflowTooltip:!0},{prop:"claimStatus",label:"认领状态",width:"100"}],defaultSelectedColumns:["performanceNo","contractNo","customerName","performanceType","totalAmount","performanceAllocation","status","creator","createTime"],tableData:[],pagination:{currentPage:1,pageSize:10,total:800},selectedRows:[],activeStatus:"draft"}},computed:{dialogTitle(){const e={add:"新增业绩单",edit:"编辑业绩单",view:"查看业绩单"};return e[this.dialogMode]||"业绩单"},currentRoute(){return this.$route.path}},watch:{currentRoute:{handler(){this.fetchData()},immediate:!0},$route:{handler(){this.refreshComponent()},immediate:!0,deep:!0}},created(){this.updateVisibleColumns(this.defaultSelectedColumns),this.fetchData()},mounted(){const e=this.$route.query.status;e&&(this.activeStatus=e,this.handleStatusTabClick())},methods:{refreshComponent(){this.componentKey+=1},updateVisibleColumns(e){const t=Array.isArray(e)?e:e&&"object"===typeof e?Object.keys(e).filter(t=>e[t]):[];this.visibleColumns=this.availableColumns.filter(e=>t.includes(e.prop)),0===this.visibleColumns.length&&this.availableColumns.length>0&&(this.visibleColumns=[...this.availableColumns])},getStatusType(e){const t={draft:"info",pending:"warning",approved:"success",rejected:"danger",cancelled:"info"};return t[e]||"info"},getStatusText(e){const t={draft:"草稿",pending:"待审核",approved:"已审核",rejected:"已退回",cancelled:"已作废"};return t[e]||e},resetSearch(){this.searchForm={performanceNo:"",contractNo:"",customerName:"",salesman:"",performanceType:"",status:"",createTimeRange:[],minAmount:"",maxAmount:"",caseNo:"",approver:"",approveTimeRange:[],creator:""},this.handleSearch()},handleSearch(){this.pagination.currentPage=1,this.fetchData()},handleAdd(){this.dialogMode="add",this.currentRow=null,this.dialogVisible=!0},handleEdit(e){this.dialogMode="edit",this.currentRow={...e,...e.formData||{contractNo:e.contractNo||"",contractName:e.contractName||"",customerName:e.customerName||"",performanceType:e.performanceType||"without_case",selectedCases:e.caseNo?[{caseNo:e.caseNo,caseName:"项目名称",serviceFee:e.totalAmount}]:[],allocations:e.allocations||[{id:1,name:"",percentage:100,amount:e.totalAmount||0}],totalAmount:e.totalAmount||0,remark:e.remark||""}},this.dialogVisible=!0},handleView(e){this.dialogMode="view",this.currentRow={...e},this.dialogVisible=!0},handleSubmit(e){this.$confirm("确定要提交审核吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{this.loading=!0,setTimeout(()=>{e.status="pending",this.$message.success("提交审核成功"),this.loading=!1,this.fetchData()},1e3)})},handleUnclaim(e){this.$confirm("确定要退回认领状态吗？退回后该业绩单将变为未认领状态。","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{this.loading=!0,setTimeout(()=>{e.claimStatus="unclaimed",this.$message.success("退回认领成功"),this.loading=!1,this.fetchData()},1e3)})},handleDelete(e){this.$confirm("确定要删除这条业绩单吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{this.loading=!0,setTimeout(()=>{const t=this.tableData.findIndex(t=>t.id===e.id);t>-1&&this.tableData.splice(t,1),this.$message.success("删除成功"),this.loading=!1},1e3)})},handleExport(){console.log("导出业绩单数据"),this.$message.info("导出功能开发中...")},handleDialogClose(){this.dialogVisible=!1,this.currentRow=null},handleSavePerformance(e){console.log("保存业绩单:",e),this.loading=!0,setTimeout(()=>{if("add"===this.dialogMode){const t={id:Date.now().toString(),performanceNo:"YJ"+String(Date.now()).slice(-5),contractNo:e.contractNo||"",contractName:e.contractName||"",customerName:e.customerName||"",performanceType:e.performanceType,caseNo:e.selectedCases&&e.selectedCases.length>0?e.selectedCases.map(e=>e.caseNo).join(", "):"",totalAmount:e.totalAmount,allocations:e.allocations||[],status:e.isDraft?"draft":"pending",creator:"当前用户",createTime:(new Date).toISOString().replace("T"," ").slice(0,19),approver:"",approveTime:"",remark:e.remark||"",claimStatus:"unclaimed",formData:e};this.tableData.unshift(t),this.pagination.total+=1}else if("edit"===this.dialogMode){const t=this.tableData.findIndex(e=>e.id===this.currentRow.id);if(t>-1){const a={...this.tableData[t],contractNo:e.contractNo||"",contractName:e.contractName||"",customerName:e.customerName||"",performanceType:e.performanceType,caseNo:e.selectedCases&&e.selectedCases.length>0?e.selectedCases.map(e=>e.caseNo).join(", "):"",totalAmount:e.totalAmount,allocations:e.allocations||[],status:e.isDraft?"draft":"pending",remark:e.remark||"",formData:e};this.$set(this.tableData,t,a)}}this.loading=!1,this.dialogVisible=!1,this.$message.success("add"===this.dialogMode?"新增成功":"更新成功")},1e3)},fetchData(){this.loading=!0,setTimeout(()=>{const e=[];for(let t=0;t<10;t++){const a=new Date,s=Math.floor(365*Math.random()),o=new Date(a.getTime()-24*s*60*60*1e3),r=e=>e.toISOString().replace("T"," ").slice(0,19),l=["draft","pending","approved","rejected","cancelled"],n=["with_case","without_case"],i=["claimed","unclaimed"],c=[],u=Math.floor(3*Math.random())+1,m=Math.floor(5e4*Math.random())+5e3;for(let e=0;e<u;e++){const t=Number((m/u).toFixed(2));c.push({id:e+1,name:"业务员"+(e+1),percentage:Number((100/u).toFixed(2)),amount:t})}e.push({id:(t+1).toString(),performanceNo:"YJ"+String(2e4+t).padStart(5,"0"),contractNo:"LS"+String(1e4+t).padStart(5,"0"),contractName:"知识产权服务合同"+(t+1),customerName:"客户"+String(t+1).padStart(2,"0"),performanceType:n[Math.floor(Math.random()*n.length)],caseNo:Math.random()>.5?"AN"+String(3e4+t).padStart(5,"0"):"",totalAmount:m.toFixed(2),allocations:c,status:l[Math.floor(Math.random()*l.length)],creator:"创建人"+String(t+1).padStart(2,"0"),createTime:r(o),approver:Math.random()>.3?"审核人"+String(t+1).padStart(2,"0"):"",approveTime:Math.random()>.3?r(new Date(o.getTime()+864e5)):"",remark:"业绩单备注"+(t+1),claimStatus:i[Math.floor(Math.random()*i.length)]})}this.tableData=e,this.loading=!1},500)},handleSelectionChange(e){this.selectedRows=e},handleSizeChange(e){this.pagination.pageSize=e,this.fetchData()},handleCurrentChange(e){this.pagination.currentPage=e,this.fetchData()},handleStatusTabClick(e){"all"===this.activeStatus?this.searchForm.status="":this.searchForm.status=this.activeStatus,this.$router.replace({query:{...this.$route.query,status:this.activeStatus}}).catch(()=>{}),this.handleSearch()}}},h=p,f=(a("2007"),Object(u["a"])(h,s,o,!1,null,"7b2f9f38",null));t["default"]=f.exports},a640:function(e,t,a){"use strict";var s=a("d039");e.exports=function(e,t){var a=[][e];return!!a&&s((function(){a.call(null,t||function(){return 1},1)}))}},ab36:function(e,t,a){"use strict";var s=a("861d"),o=a("9112");e.exports=function(e,t){s(t)&&"cause"in t&&o(e,"cause",t.cause)}},aeb0:function(e,t,a){"use strict";var s=a("9bf2").f;e.exports=function(e,t,a){a in e||s(e,a,{configurable:!0,get:function(){return t[a]},set:function(e){t[a]=e}})}},b980:function(e,t,a){"use strict";var s=a("d039"),o=a("5c6c");e.exports=!s((function(){var e=new Error("a");return!("stack"in e)||(Object.defineProperty(e,"stack",o(1,7)),7!==e.stack)}))},c4b3:function(e,t,a){"use strict";var s=function(){var e=this,t=e._self._c;return t("div",{staticClass:"column-filter"},[t("el-button",{attrs:{type:e.buttonType,size:e.buttonSize,icon:e.buttonIcon},on:{click:e.showDialog}},[e._v(" "+e._s(e.buttonText)+" ")]),t("el-dialog",{attrs:{title:e.dialogTitle,visible:e.dialogVisible,width:"500px","append-to-body":""},on:{"update:visible":function(t){e.dialogVisible=t}}},[t("div",{staticClass:"column-filter-container"},[t("el-checkbox",{on:{change:e.handleSelectAllChange},model:{value:e.selectAllColumns,callback:function(t){e.selectAllColumns=t},expression:"selectAllColumns"}},[e._v("全选")]),t("el-divider"),t("el-checkbox-group",{on:{change:e.handleColumnChange},model:{value:e.selectedColumns,callback:function(t){e.selectedColumns=t},expression:"selectedColumns"}},[t("el-row",{attrs:{gutter:10}},e._l(e.availableColumns,(function(a){return t("el-col",{key:a.prop,attrs:{span:8}},[t("el-checkbox",{attrs:{label:a.prop}},[e._v(e._s(a.label))])],1)})),1)],1)],1),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:e.resetColumns}},[e._v("重置")]),t("el-button",{attrs:{size:"small",type:"primary"},on:{click:e.saveColumnSettings}},[e._v("确 定")])],1)])],1)},o=[],r=(a("e9f5"),a("7d54"),a("ab43"),{name:"ColumnFilter",props:{storageKey:{type:String,required:!0},columns:{type:Array,required:!0},defaultSelected:{type:Array,required:!0},buttonType:{type:String,default:"primary"},buttonSize:{type:String,default:"small"},buttonIcon:{type:String,default:"el-icon-s-operation"},buttonText:{type:String,default:"列筛选"},dialogTitle:{type:String,default:"列筛选设置"}},data(){return{dialogVisible:!1,selectedColumns:[...this.defaultSelected],selectAllColumns:!1,visibleColumns:{}}},computed:{availableColumns(){return this.columns}},created(){this.loadColumnSettings()},methods:{showDialog(){this.dialogVisible=!0},handleSelectAllChange(e){this.selectedColumns=e?this.availableColumns.map(e=>e.prop):[],this.updateVisibleColumns()},handleColumnChange(){this.selectAllColumns=this.selectedColumns.length===this.availableColumns.length,this.updateVisibleColumns()},updateVisibleColumns(){const e={};this.availableColumns.forEach(t=>{e[t.prop]=!1}),this.selectedColumns.forEach(t=>{e[t]=!0}),this.visibleColumns=e,this.$emit("update:visible-columns",{...e})},saveColumnSettings(){try{localStorage.setItem(this.storageKey+"Columns",JSON.stringify(this.selectedColumns)),localStorage.setItem(this.storageKey+"VisibleColumns",JSON.stringify(this.visibleColumns)),this.dialogVisible=!1,this.$message.success("列设置已保存"),this.$emit("update:visible-columns",{...this.visibleColumns})}catch(e){console.error("保存列设置失败",e),this.$message.error("保存列设置失败")}},loadColumnSettings(){try{const e=localStorage.getItem(this.storageKey+"Columns"),t=localStorage.getItem(this.storageKey+"VisibleColumns");e?(this.selectedColumns=JSON.parse(e),this.selectAllColumns=this.selectedColumns.length===this.availableColumns.length):(this.selectedColumns=[...this.defaultSelected],this.selectAllColumns=this.selectedColumns.length===this.availableColumns.length),t?this.visibleColumns=JSON.parse(t):this.updateVisibleColumns(),this.$emit("update:visible-columns",{...this.visibleColumns})}catch(e){console.error("加载列设置失败",e),this.resetColumns()}},resetColumns(){this.selectedColumns=[...this.defaultSelected],this.selectAllColumns=this.selectedColumns.length===this.availableColumns.length,this.updateVisibleColumns()}}}),l=r,n=(a("ec91"),a("2877")),i=Object(n["a"])(l,s,o,!1,null,null,null);t["a"]=i.exports},d2bb:function(e,t,a){"use strict";var s=a("7282"),o=a("861d"),r=a("1d80"),l=a("3bbe");e.exports=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,a={};try{e=s(Object.prototype,"__proto__","set"),e(a,[]),t=a instanceof Array}catch(n){}return function(a,s){return r(a),l(s),o(a)?(t?e(a,s):a.__proto__=s,a):a}}():void 0)},d58f:function(e,t,a){"use strict";var s=a("59ed"),o=a("7b0b"),r=a("44ad"),l=a("07fa"),n=TypeError,i="Reduce of empty array with no initial value",c=function(e){return function(t,a,c,u){var m=o(t),d=r(m),p=l(m);if(s(a),0===p&&c<2)throw new n(i);var h=e?p-1:0,f=e?-1:1;if(c<2)while(1){if(h in d){u=d[h],h+=f;break}if(h+=f,e?h<0:p<=h)throw new n(i)}for(;e?h>=0:p>h;h+=f)h in d&&(u=a(u,d[h],h,m));return u}};e.exports={left:c(!1),right:c(!0)}},d9e2:function(e,t,a){"use strict";var s=a("23e7"),o=a("cfe9"),r=a("2ba4"),l=a("e5cb"),n="WebAssembly",i=o[n],c=7!==new Error("e",{cause:7}).cause,u=function(e,t){var a={};a[e]=l(e,t,c),s({global:!0,constructor:!0,arity:1,forced:c},a)},m=function(e,t){if(i&&i[e]){var a={};a[e]=l(n+"."+e,t,c),s({target:n,stat:!0,constructor:!0,arity:1,forced:c},a)}};u("Error",(function(e){return function(t){return r(e,this,arguments)}})),u("EvalError",(function(e){return function(t){return r(e,this,arguments)}})),u("RangeError",(function(e){return function(t){return r(e,this,arguments)}})),u("ReferenceError",(function(e){return function(t){return r(e,this,arguments)}})),u("SyntaxError",(function(e){return function(t){return r(e,this,arguments)}})),u("TypeError",(function(e){return function(t){return r(e,this,arguments)}})),u("URIError",(function(e){return function(t){return r(e,this,arguments)}})),m("CompileError",(function(e){return function(t){return r(e,this,arguments)}})),m("LinkError",(function(e){return function(t){return r(e,this,arguments)}})),m("RuntimeError",(function(e){return function(t){return r(e,this,arguments)}}))},e391:function(e,t,a){"use strict";var s=a("577e");e.exports=function(e,t){return void 0===e?arguments.length<2?"":t:s(e)}},e5cb:function(e,t,a){"use strict";var s=a("d066"),o=a("1a2d"),r=a("9112"),l=a("3a9b"),n=a("d2bb"),i=a("e893"),c=a("aeb0"),u=a("7156"),m=a("e391"),d=a("ab36"),p=a("6f19"),h=a("83ab"),f=a("c430");e.exports=function(e,t,a,b){var v="stackTraceLimit",g=b?2:1,y=e.split("."),w=y[y.length-1],C=s.apply(null,y);if(C){var S=C.prototype;if(!f&&o(S,"cause")&&delete S.cause,!a)return C;var _=s("Error"),k=t((function(e,t){var a=m(b?t:e,void 0),s=b?new C(e):new C;return void 0!==a&&r(s,"message",a),p(s,k,s.stack,2),this&&l(S,this)&&u(s,this,k),arguments.length>g&&d(s,arguments[g]),s}));if(k.prototype=S,"Error"!==w?n?n(k,_):i(k,_,{name:!0}):h&&v in C&&(c(k,C,v),c(k,C,"prepareStackTrace")),i(k,C),!f)try{S.name!==w&&r(S,"name",w),S.constructor=k}catch(N){}return k}}},ec91:function(e,t,a){"use strict";a("3741")}}]);