(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-6f7f278e"],{"13d5":function(t,e,a){"use strict";var i=a("23e7"),o=a("d58f").left,n=a("a640"),l=a("1212"),s=a("9adc"),r=!s&&l>79&&l<83,c=r||!n("reduce");i({target:"Array",proto:!0,forced:c},{reduce:function(t){var e=arguments.length;return o(this,t,e,e>1?arguments[1]:void 0)}})},8558:function(t,e,a){"use strict";var i=a("cfe9"),o=a("b5db"),n=a("c6b6"),l=function(t){return o.slice(0,t.length)===t};t.exports=function(){return l("Bun/")?"BUN":l("Cloudflare-Workers")?"CLOUDFLARE":l("Deno/")?"DENO":l("Node.js/")?"NODE":i.Bun&&"string"==typeof Bun.version?"BUN":i.Deno&&"object"==typeof Deno.version?"DENO":"process"===n(i.process)?"NODE":i.window&&i.document?"BROWSER":"REST"}()},"935d":function(t,e,a){"use strict";a("ab96")},9485:function(t,e,a){"use strict";var i=a("23e7"),o=a("2266"),n=a("59ed"),l=a("825a"),s=a("46c4"),r=TypeError;i({target:"Iterator",proto:!0,real:!0},{reduce:function(t){l(this),n(t);var e=s(this),a=arguments.length<2,i=a?void 0:arguments[1],c=0;if(o(e,(function(e){a?(a=!1,i=e):i=t(i,e,c),c++}),{IS_RECORD:!0}),a)throw new r("Reduce of empty iterator with no initial value");return i}})},"9adc":function(t,e,a){"use strict";var i=a("8558");t.exports="NODE"===i},a42c:function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t._self._c;return e("div",{staticClass:"invoice-create-container"},[e("div",{staticClass:"body-part-search"},[e("el-form",{attrs:{model:t.searchForm,"label-width":"100px"}},[e("el-row",[e("el-col",{attrs:{span:6}},[e("el-form-item",{attrs:{label:"申请单号"}},[e("el-input",{attrs:{size:"small",placeholder:"请输入申请单号"},model:{value:t.searchForm.applicationNo,callback:function(e){t.$set(t.searchForm,"applicationNo",e)},expression:"searchForm.applicationNo"}})],1)],1),e("el-col",{attrs:{span:6}},[e("el-form-item",{attrs:{label:"申请人"}},[e("el-input",{attrs:{size:"small",placeholder:"请输入申请人"},model:{value:t.searchForm.applicant,callback:function(e){t.$set(t.searchForm,"applicant",e)},expression:"searchForm.applicant"}})],1)],1),e("el-col",{attrs:{span:6}},[e("el-form-item",{attrs:{label:"客户名称"}},[e("el-input",{attrs:{size:"small",placeholder:"请输入客户名称"},model:{value:t.searchForm.clientName,callback:function(e){t.$set(t.searchForm,"clientName",e)},expression:"searchForm.clientName"}})],1)],1),e("el-col",{attrs:{span:6}},[e("el-form-item",{attrs:{label:"申请时间"}},[e("el-date-picker",{attrs:{size:"small",type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期"},model:{value:t.searchForm.applicationDate,callback:function(e){t.$set(t.searchForm,"applicationDate",e)},expression:"searchForm.applicationDate"}})],1)],1)],1),e("el-row",[e("el-col",{attrs:{span:6}},[e("el-form-item",{attrs:{label:"合同名称"}},[e("el-input",{attrs:{size:"small",placeholder:"请输入合同名称"},model:{value:t.searchForm.contractName,callback:function(e){t.$set(t.searchForm,"contractName",e)},expression:"searchForm.contractName"}})],1)],1),e("el-col",{attrs:{span:6}},[e("el-form-item",{attrs:{label:"发票类型"}},[e("el-select",{attrs:{size:"small",placeholder:"请选择"},model:{value:t.searchForm.invoiceType,callback:function(e){t.$set(t.searchForm,"invoiceType",e)},expression:"searchForm.invoiceType"}},[e("el-option",{attrs:{label:"增值税专用发票",value:"special"}}),e("el-option",{attrs:{label:"增值税普通发票",value:"general"}}),e("el-option",{attrs:{label:"电子发票",value:"electronic"}})],1)],1)],1),e("el-col",{attrs:{span:6}},[e("el-form-item",{attrs:{label:"开票金额"}},[e("el-input-number",{attrs:{size:"small",placeholder:"最小值"},model:{value:t.searchForm.amountMin,callback:function(e){t.$set(t.searchForm,"amountMin",e)},expression:"searchForm.amountMin"}}),e("span",{staticStyle:{margin:"0 5px"}},[t._v("至")]),e("el-input-number",{attrs:{size:"small",placeholder:"最大值"},model:{value:t.searchForm.amountMax,callback:function(e){t.$set(t.searchForm,"amountMax",e)},expression:"searchForm.amountMax"}})],1)],1)],1)],1),e("div",{staticClass:"part-search-buttons"},[e("el-button",{attrs:{size:"small",type:"primary"},on:{click:t.handleSearch}},[t._v("查询")]),e("el-button",{attrs:{size:"small"},on:{click:t.handleReset}},[t._v("重置")])],1)],1),e("div",{staticClass:"body-part-content"},[e("div",{staticClass:"part-table-header"},[e("div",{staticClass:"part-table-title"},[t._v(" 发票开具申请单 ")]),e("div",{staticClass:"part-table-buttons"},[e("el-button",{attrs:{size:"small",type:"primary"},on:{click:t.handleAdd}},[t._v("新增申请")])],1)]),e("div",{staticClass:"statistics-panel"},[e("el-row",{attrs:{gutter:20}},[e("el-col",{attrs:{span:6}},[e("div",{staticClass:"stat-item"},[e("div",{staticClass:"stat-label"},[t._v("合同总额")]),e("div",{staticClass:"stat-value"},[t._v(t._s(t._f("currency")(t.statistics.contractTotal)))])])]),e("el-col",{attrs:{span:6}},[e("div",{staticClass:"stat-item"},[e("div",{staticClass:"stat-label"},[t._v("实际到款总额")]),e("div",{staticClass:"stat-value"},[t._v(t._s(t._f("currency")(t.statistics.actualPaymentTotal)))])])]),e("el-col",{attrs:{span:6}},[e("div",{staticClass:"stat-item"},[e("div",{staticClass:"stat-label"},[t._v("已开票总额")]),e("div",{staticClass:"stat-value"},[t._v(t._s(t._f("currency")(t.statistics.invoicedTotal)))])])]),e("el-col",{attrs:{span:6}},[e("div",{staticClass:"stat-item"},[e("div",{staticClass:"stat-label"},[t._v("未开票金额")]),e("div",{staticClass:"stat-value uninvoiced"},[t._v(t._s(t._f("currency")(t.statistics.uninvoicedAmount)))])])])],1)],1),e("el-table",{staticStyle:{width:"100%"},attrs:{size:"small",data:t.tableData,border:""}},[e("el-table-column",{attrs:{type:"index",label:"序号",width:"50"}}),e("el-table-column",{attrs:{prop:"applicationNo",label:"申请单号","show-overflow-tooltip":""}}),e("el-table-column",{attrs:{prop:"applicant",label:"申请人","show-overflow-tooltip":""}}),e("el-table-column",{attrs:{prop:"department",label:"所属部门","show-overflow-tooltip":""}}),e("el-table-column",{attrs:{prop:"contractName",label:"合同名称","show-overflow-tooltip":""}}),e("el-table-column",{attrs:{prop:"clientName",label:"客户名称","show-overflow-tooltip":""}}),e("el-table-column",{attrs:{prop:"invoiceAmount",label:"开票金额","show-overflow-tooltip":""}}),e("el-table-column",{attrs:{prop:"invoiceType",label:"发票类型","show-overflow-tooltip":""}}),e("el-table-column",{attrs:{prop:"applicationDate",label:"申请时间",width:"160","show-overflow-tooltip":""}}),e("el-table-column",{attrs:{prop:"flowStatus",label:"流程状态","show-overflow-tooltip":""}}),e("el-table-column",{attrs:{fixed:"right",label:"操作",width:"180"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("el-button",{attrs:{size:"small",type:"text"},on:{click:function(e){return t.handleView(a.row)}}},[t._v("查看")]),e("el-button",{attrs:{size:"small",type:"text"},on:{click:function(e){return t.handleEdit(a.row)}}},[t._v("编辑")]),e("el-button",{attrs:{size:"small",type:"text"},on:{click:function(e){return t.handleDelete(a.row)}}},[t._v("删除")])]}}])})],1),e("el-pagination",{attrs:{"current-page":t.currentPage,"page-sizes":[10,20,30,50],"page-size":t.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:t.total},on:{"size-change":t.handleSizeChange,"current-change":t.handleCurrentChange}})],1),e("el-dialog",{attrs:{title:t.dialogTitle,visible:t.dialogVisible,width:"90%"},on:{"update:visible":function(e){t.dialogVisible=e}}},[e("div",{staticClass:"invoice-form"},[e("el-form",{ref:"invoiceForm",attrs:{model:t.invoiceForm,rules:t.rules,"label-width":"120px"}},[e("div",{staticClass:"form-section"},[e("h3",[t._v("基本信息")]),e("el-row",{attrs:{gutter:20}},[e("el-col",{attrs:{span:8}},[e("el-form-item",{attrs:{label:"申请时间",prop:"applicationDate"}},[e("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"date",placeholder:"选择日期",disabled:t.isViewMode},model:{value:t.invoiceForm.applicationDate,callback:function(e){t.$set(t.invoiceForm,"applicationDate",e)},expression:"invoiceForm.applicationDate"}})],1)],1),e("el-col",{attrs:{span:8}},[e("el-form-item",{attrs:{label:"申请人",prop:"applicant"}},[e("el-input",{attrs:{placeholder:"请输入申请人",disabled:t.isViewMode},model:{value:t.invoiceForm.applicant,callback:function(e){t.$set(t.invoiceForm,"applicant",e)},expression:"invoiceForm.applicant"}})],1)],1),e("el-col",{attrs:{span:8}},[e("el-form-item",{attrs:{label:"所属部门",prop:"department"}},[e("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择所属部门",disabled:t.isViewMode},model:{value:t.invoiceForm.department,callback:function(e){t.$set(t.invoiceForm,"department",e)},expression:"invoiceForm.department"}},t._l(t.departmentOptions,(function(t){return e("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1)],1)],1)],1)],1),e("div",{staticClass:"form-section"},[e("h3",[t._v("关联合同信息")]),e("el-row",{attrs:{gutter:20}},[e("el-col",{attrs:{span:12}},[e("el-form-item",{attrs:{label:"对应合同名称",prop:"contractName"}},[e("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择合同",filterable:"",disabled:t.isViewMode},on:{change:t.onContractChange},model:{value:t.invoiceForm.contractName,callback:function(e){t.$set(t.invoiceForm,"contractName",e)},expression:"invoiceForm.contractName"}},t._l(t.contractOptions,(function(t){return e("el-option",{key:t.value,attrs:{label:t.label,value:t.value,title:t.label}})})),1)],1)],1),e("el-col",{attrs:{span:12}},[e("el-form-item",{attrs:{label:"合同编号",prop:"contractNo"}},[e("el-input",{attrs:{placeholder:"选择合同后自动填充",disabled:!0},model:{value:t.invoiceForm.contractNo,callback:function(e){t.$set(t.invoiceForm,"contractNo",e)},expression:"invoiceForm.contractNo"}})],1)],1)],1),t.contractAmountInfo.contractAmount?e("div",{staticClass:"contract-amount-info"},[e("el-row",{attrs:{gutter:20}},[e("el-col",{attrs:{span:8}},[e("div",{staticClass:"amount-info-item"},[e("span",{staticClass:"label"},[t._v("合同金额：")]),e("span",{staticClass:"value"},[t._v(t._s(t._f("currency")(t.contractAmountInfo.contractAmount)))])])]),e("el-col",{attrs:{span:8}},[e("div",{staticClass:"amount-info-item"},[e("span",{staticClass:"label"},[t._v("实际到款：")]),e("span",{staticClass:"value"},[t._v(t._s(t._f("currency")(t.contractAmountInfo.actualPayment)))])])]),e("el-col",{attrs:{span:8}},[e("div",{staticClass:"amount-info-item"},[e("span",{staticClass:"label"},[t._v("开票上限：")]),e("span",{staticClass:"value limit"},[t._v(t._s(t._f("currency")(t.contractAmountInfo.invoiceLimit)))])])])],1)],1):t._e()],1),e("div",{staticClass:"form-section"},[e("h3",[t._v("购买方开票信息")]),e("el-row",{attrs:{gutter:20}},[e("el-col",{attrs:{span:12}},[e("el-form-item",{attrs:{label:"名称",prop:"buyerName"}},[e("el-input",{attrs:{placeholder:"请输入购买方名称",disabled:t.isViewMode},model:{value:t.invoiceForm.buyerName,callback:function(e){t.$set(t.invoiceForm,"buyerName",e)},expression:"invoiceForm.buyerName"}})],1)],1),e("el-col",{attrs:{span:12}},[e("el-form-item",{attrs:{label:"纳税人识别号",prop:"buyerTaxId"}},[e("el-input",{attrs:{placeholder:"请输入纳税人识别号",disabled:t.isViewMode},model:{value:t.invoiceForm.buyerTaxId,callback:function(e){t.$set(t.invoiceForm,"buyerTaxId",e)},expression:"invoiceForm.buyerTaxId"}})],1)],1)],1),e("el-row",{attrs:{gutter:20}},[e("el-col",{attrs:{span:12}},[e("el-form-item",{attrs:{label:"地址、电话",prop:"buyerAddress"}},[e("el-input",{attrs:{placeholder:"请输入地址、电话",disabled:t.isViewMode},model:{value:t.invoiceForm.buyerAddress,callback:function(e){t.$set(t.invoiceForm,"buyerAddress",e)},expression:"invoiceForm.buyerAddress"}})],1)],1),e("el-col",{attrs:{span:12}},[e("el-form-item",{attrs:{label:"开户银行及账号",prop:"buyerBankAccount"}},[e("el-input",{attrs:{placeholder:"请输入开户银行及账号",disabled:t.isViewMode},model:{value:t.invoiceForm.buyerBankAccount,callback:function(e){t.$set(t.invoiceForm,"buyerBankAccount",e)},expression:"invoiceForm.buyerBankAccount"}})],1)],1)],1)],1),e("div",{staticClass:"form-section"},[e("h3",[t._v("发票信息")]),e("el-row",{attrs:{gutter:20}},[e("el-col",{attrs:{span:8}},[e("el-form-item",{attrs:{label:"发票类型",prop:"invoiceType"}},[e("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择发票类型",disabled:t.isViewMode},model:{value:t.invoiceForm.invoiceType,callback:function(e){t.$set(t.invoiceForm,"invoiceType",e)},expression:"invoiceForm.invoiceType"}},[e("el-option",{attrs:{label:"增值税专用发票",value:"special"}}),e("el-option",{attrs:{label:"增值税普通发票",value:"general"}}),e("el-option",{attrs:{label:"电子发票",value:"electronic"}})],1)],1)],1),e("el-col",{attrs:{span:8}},[e("el-form-item",{attrs:{label:"本次开票金额",prop:"invoiceAmount"}},[e("el-input-number",{staticStyle:{width:"100%"},attrs:{precision:2,min:0,"controls-position":"right",disabled:t.isViewMode},on:{change:t.onAmountChange},model:{value:t.invoiceForm.invoiceAmount,callback:function(e){t.$set(t.invoiceForm,"invoiceAmount",e)},expression:"invoiceForm.invoiceAmount"}})],1)],1),e("el-col",{attrs:{span:8}},[t.amountWarning?e("div",{staticClass:"amount-warning"},[e("i",{staticClass:"el-icon-warning"}),t._v(" "+t._s(t.amountWarning)+" ")]):t._e()])],1)],1),e("div",{staticClass:"form-section"},[e("h3",[t._v("开票内容")]),e("div",{staticClass:"invoice-items-table"},[e("el-table",{staticStyle:{width:"100%"},attrs:{data:t.invoiceForm.items,border:""}},[e("el-table-column",{attrs:{type:"index",label:"序号",width:"60"}}),e("el-table-column",{attrs:{prop:"itemName",label:"开票项目"},scopedSlots:t._u([{key:"default",fn:function(a){return[a.row.editing?e("el-input",{attrs:{size:"small",disabled:t.isViewMode},model:{value:a.row.itemName,callback:function(e){t.$set(a.row,"itemName",e)},expression:"scope.row.itemName"}}):e("span",[t._v(t._s(a.row.itemName))])]}}])}),e("el-table-column",{attrs:{prop:"specification",label:"规格型号","min-width":"120"},scopedSlots:t._u([{key:"default",fn:function(a){return[a.row.editing?e("el-input",{attrs:{size:"small",disabled:t.isViewMode},model:{value:a.row.specification,callback:function(e){t.$set(a.row,"specification",e)},expression:"scope.row.specification"}}):e("span",[t._v(t._s(a.row.specification))])]}}])}),e("el-table-column",{attrs:{prop:"unit",label:"计量单位",width:"100"},scopedSlots:t._u([{key:"default",fn:function(a){return[a.row.editing?e("el-input",{attrs:{size:"small",disabled:t.isViewMode},model:{value:a.row.unit,callback:function(e){t.$set(a.row,"unit",e)},expression:"scope.row.unit"}}):e("span",[t._v(t._s(a.row.unit))])]}}])}),e("el-table-column",{attrs:{prop:"quantity",label:"数量",width:"100"},scopedSlots:t._u([{key:"default",fn:function(a){return[a.row.editing?e("el-input-number",{staticStyle:{width:"100%"},attrs:{size:"small",min:0,precision:2,"controls-position":"right",disabled:t.isViewMode},on:{change:function(e){return t.calculateItemAmount(a.row)}},model:{value:a.row.quantity,callback:function(e){t.$set(a.row,"quantity",e)},expression:"scope.row.quantity"}}):e("span",[t._v(t._s(a.row.quantity))])]}}])}),e("el-table-column",{attrs:{prop:"unitPrice",label:"单价",width:"120"},scopedSlots:t._u([{key:"default",fn:function(a){return[a.row.editing?e("el-input-number",{staticStyle:{width:"100%"},attrs:{size:"small",min:0,precision:2,"controls-position":"right",disabled:t.isViewMode},on:{change:function(e){return t.calculateItemAmount(a.row)}},model:{value:a.row.unitPrice,callback:function(e){t.$set(a.row,"unitPrice",e)},expression:"scope.row.unitPrice"}}):e("span",[t._v(t._s(t._f("currency")(a.row.unitPrice)))])]}}])}),e("el-table-column",{attrs:{prop:"amount",label:"金额",width:"120"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("span",[t._v(t._s(t._f("currency")(a.row.amount)))])]}}])}),t.isViewMode?t._e():e("el-table-column",{attrs:{fixed:"right",label:"操作",width:"120"},scopedSlots:t._u([{key:"default",fn:function(a){return[a.row.editing?e("el-button",{attrs:{size:"small",type:"text"},on:{click:function(e){return t.saveItem(a.row,a.$index)}}},[t._v("保存")]):t._e(),a.row.editing?e("el-button",{attrs:{size:"small",type:"text"},on:{click:function(e){return t.cancelEdit(a.row,a.$index)}}},[t._v("取消")]):t._e(),a.row.editing?t._e():e("el-button",{attrs:{size:"small",type:"text"},on:{click:function(e){return t.editItem(a.row)}}},[t._v("编辑")]),e("el-button",{attrs:{size:"small",type:"text"},on:{click:function(e){return t.removeItem(a.$index)}}},[t._v("删除")])]}}],null,!1,1782209994)})],1),t.isViewMode?t._e():e("div",{staticClass:"add-item-btn"},[e("el-button",{attrs:{size:"small",type:"primary",plain:""},on:{click:t.addNewItem}},[t._v("新增开票项目")])],1),e("div",{staticClass:"total-amount"},[e("span",{staticClass:"label"},[t._v("合计金额：")]),e("span",{staticClass:"value"},[t._v(t._s(t._f("currency")(t.totalItemsAmount)))])])],1)]),t.isViewMode?e("div",{staticClass:"form-actions"},[e("el-button",{on:{click:function(e){t.dialogVisible=!1}}},[t._v("关闭")])],1):e("div",{staticClass:"form-actions"},[e("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(e){return t.submitForm("invoiceForm")}}},[t._v("提交申请")]),e("el-button",{on:{click:function(e){t.dialogVisible=!1}}},[t._v("取消")]),e("el-button",{attrs:{type:"warning"},on:{click:t.saveAsDraft}},[t._v("保存草稿")])],1)])],1)])],1)},o=[],n=(a("14d9"),a("13d5"),a("e9f5"),a("f665"),a("ab43"),a("9485"),{name:"InvoiceCreate",data(){return{searchForm:{applicationNo:"",applicant:"",clientName:"",applicationDate:"",contractName:"",invoiceType:"",amountMin:"",amountMax:""},tableData:[],currentPage:1,pageSize:10,total:0,dialogVisible:!1,dialogTitle:"新增发票申请",isViewMode:!1,statistics:{contractTotal:0,actualPaymentTotal:0,invoicedTotal:0,uninvoicedAmount:0},contractAmountInfo:{contractAmount:0,actualPayment:0,invoiceLimit:0},amountWarning:"",departmentOptions:[{value:"info_management",label:"信息与商务管理学院"},{value:"finance",label:"财务部"},{value:"business",label:"商务部"},{value:"technology",label:"技术部"}],contractOptions:[{value:"contract1",label:"技术服务合同001",contractNo:"JSFWHT001",contractAmount:1e5,actualPayment:8e4},{value:"contract2",label:"软件开发合同002",contractNo:"RJKFHT002",contractAmount:2e5,actualPayment:15e4},{value:"contract3",label:"系统维护合同003",contractNo:"XTWGHT003",contractAmount:5e4,actualPayment:5e4}],invoiceForm:{applicationNo:"",applicationDate:new Date,applicant:"许景如",department:"info_management",contractName:"",contractNo:"",buyerName:"",buyerTaxId:"",buyerAddress:"",buyerBankAccount:"",invoiceType:"special",invoiceAmount:0,items:[],flowStatus:"draft",createTime:new Date},rules:{applicant:[{required:!0,message:"请输入申请人",trigger:"blur"}],department:[{required:!0,message:"请选择所属部门",trigger:"change"}],buyerName:[{required:!0,message:"请输入购买方名称",trigger:"blur"}],buyerTaxId:[{required:!0,message:"请输入纳税人识别号",trigger:"blur"}],invoiceType:[{required:!0,message:"请选择发票类型",trigger:"change"}],invoiceAmount:[{required:!0,message:"请输入开票金额",trigger:"blur"},{type:"number",min:.01,message:"开票金额必须大于0",trigger:"blur"}]}}},computed:{totalItemsAmount(){return this.invoiceForm.items.reduce((t,e)=>t+(e.amount||0),0)}},filters:{currency(t){return t?"¥"+parseFloat(t).toLocaleString("zh-CN",{minimumFractionDigits:2,maximumFractionDigits:2}):"¥0.00"}},created(){this.getList(),this.getStatistics()},methods:{getList(){this.tableData=Array.from({length:15}).map((t,e)=>({id:e+1,applicationNo:"FPSP"+(2023e3+e),applicant:"申请人"+(e+1),department:e%4===0?"信息与商务管理学院":e%4===1?"财务部":e%4===2?"商务部":"技术部",contractName:"合同"+(e+1),clientName:"客户"+(e+1),invoiceAmount:(1e4+1e3*e).toFixed(2),invoiceType:e%3===0?"增值税专用发票":e%3===1?"增值税普通发票":"电子发票",applicationDate:"2025-07-"+(e%30+1),flowStatus:e%4===0?"草稿":e%4===1?"审核中":e%4===2?"已通过":"已完成"})),this.total=50},getStatistics(){this.statistics={contractTotal:15e5,actualPaymentTotal:12e5,invoicedTotal:8e5,uninvoicedAmount:4e5}},handleSearch(){console.log("搜索条件:",this.searchForm),this.getList()},handleReset(){this.searchForm={applicationNo:"",applicant:"",clientName:"",applicationDate:"",contractName:"",invoiceType:"",amountMin:"",amountMax:""},this.getList()},handleAdd(){this.dialogTitle="新增发票申请",this.isViewMode=!1,this.resetForm(),this.dialogVisible=!0},handleView(t){this.dialogTitle="查看发票申请",this.isViewMode=!0,this.loadFormData(t),this.dialogVisible=!0},handleEdit(t){this.dialogTitle="编辑发票申请",this.isViewMode=!1,this.loadFormData(t),this.dialogVisible=!0},handleDelete(t){this.$confirm("确认删除该申请单？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{this.$message.success("删除成功"),this.getList()})},onContractChange(t){const e=this.contractOptions.find(e=>e.value===t);e&&(this.invoiceForm.contractNo=e.contractNo,this.contractAmountInfo={contractAmount:e.contractAmount,actualPayment:e.actualPayment,invoiceLimit:Math.max(e.contractAmount,e.actualPayment)}),this.checkAmountLimit()},onAmountChange(){this.checkAmountLimit()},checkAmountLimit(){this.contractAmountInfo.invoiceLimit&&this.invoiceForm.invoiceAmount&&(this.invoiceForm.invoiceAmount>this.contractAmountInfo.invoiceLimit?this.amountWarning=`开票金额不能超过${this.contractAmountInfo.invoiceLimit.toLocaleString()}元`:this.amountWarning="")},addNewItem(){this.invoiceForm.items.push({itemName:"",specification:"",unit:"",quantity:1,unitPrice:0,amount:0,editing:!0})},editItem(t){this.$set(t,"editing",!0),this.$set(t,"_originalData",{...t})},saveItem(t,e){t.itemName?(this.calculateItemAmount(t),this.$set(t,"editing",!1),this.$delete(t,"_originalData")):this.$message.warning("请输入开票项目")},cancelEdit(t,e){t._originalData&&(Object.assign(t,t._originalData),this.$delete(t,"_originalData")),this.$set(t,"editing",!1)},removeItem(t){this.invoiceForm.items.splice(t,1)},calculateItemAmount(t){t.amount=(t.quantity||0)*(t.unitPrice||0)},resetForm(){this.invoiceForm={applicationNo:"",applicationDate:new Date,applicant:"许景如",department:"info_management",contractName:"",contractNo:"",buyerName:"",buyerTaxId:"",buyerAddress:"",buyerBankAccount:"",invoiceType:"special",invoiceAmount:0,items:[],flowStatus:"draft",createTime:new Date},this.contractAmountInfo={contractAmount:0,actualPayment:0,invoiceLimit:0},this.amountWarning=""},loadFormData(t){this.invoiceForm={...t,items:[{itemName:"技术服务费",specification:"",unit:"项",quantity:1,unitPrice:1e4,amount:1e4}]}},submitForm(t){this.$refs[t].validate(t=>{if(t){if(this.amountWarning)return void this.$message.warning("请修正开票金额后再提交");console.log("提交表单:",this.invoiceForm),this.$message.success("申请提交成功"),this.dialogVisible=!1,this.getList()}})},saveAsDraft(){console.log("保存草稿:",this.invoiceForm),this.$message.success("草稿保存成功"),this.dialogVisible=!1,this.getList()},handleSizeChange(t){this.pageSize=t,this.getList()},handleCurrentChange(t){this.currentPage=t,this.getList()}}}),l=n,s=(a("935d"),a("2877")),r=Object(s["a"])(l,i,o,!1,null,"79d96024",null);e["default"]=r.exports},a640:function(t,e,a){"use strict";var i=a("d039");t.exports=function(t,e){var a=[][t];return!!a&&i((function(){a.call(null,e||function(){return 1},1)}))}},ab96:function(t,e,a){},d58f:function(t,e,a){"use strict";var i=a("59ed"),o=a("7b0b"),n=a("44ad"),l=a("07fa"),s=TypeError,r="Reduce of empty array with no initial value",c=function(t){return function(e,a,c,u){var m=o(e),p=n(m),d=l(m);if(i(a),0===d&&c<2)throw new s(r);var v=t?d-1:0,b=t?-1:1;if(c<2)while(1){if(v in p){u=p[v],v+=b;break}if(v+=b,t?v<0:d<=v)throw new s(r)}for(;t?v>=0:d>v;v+=b)v in p&&(u=a(u,p[v],v,m));return u}};t.exports={left:c(!1),right:c(!0)}}}]);