(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-7c1f293c"],{"13d5":function(e,t,a){"use strict";var l=a("23e7"),s=a("d58f").left,r=a("a640"),o=a("1212"),i=a("9adc"),c=!i&&o>79&&o<83,n=c||!r("reduce");l({target:"Array",proto:!0,forced:n},{reduce:function(e){var t=arguments.length;return s(this,e,t,t>1?arguments[1]:void 0)}})},"5a57":function(e,t,a){},"6f3d":function(e,t,a){"use strict";a.r(t);var l=function(){var e=this,t=e._self._c;return t("div",{key:e.componentKey,staticClass:"my-contract-container"},[t("div",{staticClass:"contract-status-tabs"},[t("el-tabs",{attrs:{type:"card"},on:{"tab-click":e.handleStatusTabClick},model:{value:e.activeStatus,callback:function(t){e.activeStatus=t},expression:"activeStatus"}},[t("el-tab-pane",{attrs:{label:"草稿",name:"draft"}},[t("span",{attrs:{slot:"label"},slot:"label"},[t("i",{staticClass:"el-icon-edit-outline"}),e._v(" 草稿 ")])]),t("el-tab-pane",{attrs:{label:"全部",name:"all"}}),t("el-tab-pane",{attrs:{label:"审批中",name:"pending"}},[t("span",{attrs:{slot:"label"},slot:"label"},[t("i",{staticClass:"el-icon-edit-outline"}),e._v(" 审批中 ")])]),t("el-tab-pane",{attrs:{label:"已完成",name:"completed"}},[t("span",{attrs:{slot:"label"},slot:"label"},[t("i",{staticClass:"el-icon-success"}),e._v(" 已完成 ")])])],1)],1),t("div",{staticClass:"body-part-search"},[t("el-form",{ref:"searchForm",attrs:{model:e.searchForm,"label-width":"100px"}},[t("div",{staticClass:"default-filters"},[t("el-row",[t("el-col",{attrs:{span:6}},[t("el-form-item",{attrs:{label:"客户名称",prop:"customerName"}},[t("el-input",{staticClass:"filter-item",attrs:{placeholder:"客户名称",clearable:"",size:"small"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleSearch.apply(null,arguments)}},model:{value:e.searchForm.customerName,callback:function(t){e.$set(e.searchForm,"customerName",t)},expression:"searchForm.customerName"}})],1)],1),t("el-col",{attrs:{span:6}},[t("el-form-item",{attrs:{label:"纸件状态",prop:"paperStatus"}},[t("el-select",{staticClass:"filter-item",attrs:{placeholder:"纸件状态",size:"small",clearable:""},model:{value:e.searchForm.paperStatus,callback:function(t){e.$set(e.searchForm,"paperStatus",t)},expression:"searchForm.paperStatus"}},[t("el-option",{attrs:{label:"是",value:"是"}}),t("el-option",{attrs:{label:"否",value:"否"}})],1)],1)],1),t("el-col",{attrs:{span:6}},[t("el-form-item",{attrs:{label:"合同编号",prop:"contractNumber"}},[t("el-input",{staticClass:"filter-item",attrs:{placeholder:"合同编号",clearable:"",size:"small"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleSearch.apply(null,arguments)}},model:{value:e.searchForm.contractNumber,callback:function(t){e.$set(e.searchForm,"contractNumber",t)},expression:"searchForm.contractNumber"}})],1)],1),t("el-col",{attrs:{span:6}},[t("el-form-item",{attrs:{label:"合同代码",prop:"contractCode"}},[t("el-input",{staticClass:"filter-item",attrs:{placeholder:"合同代码",clearable:"",size:"small"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleSearch.apply(null,arguments)}},model:{value:e.searchForm.contractCode,callback:function(t){e.$set(e.searchForm,"contractCode",t)},expression:"searchForm.contractCode"}})],1)],1)],1),t("el-row",[t("el-col",{attrs:{span:6}},[t("el-form-item",{attrs:{label:"合同服务费",prop:"serviceFee"}},[t("div",{staticClass:"custom-range-input"},[t("el-input",{staticClass:"custom-range-item",attrs:{placeholder:"数字",size:"small"},model:{value:e.searchForm.serviceFeeMin,callback:function(t){e.$set(e.searchForm,"serviceFeeMin",t)},expression:"searchForm.serviceFeeMin"}}),t("span",{staticClass:"custom-range-separator"},[e._v("到")]),t("el-input",{staticClass:"custom-range-item",attrs:{placeholder:"数字",size:"small"},model:{value:e.searchForm.serviceFeeMax,callback:function(t){e.$set(e.searchForm,"serviceFeeMax",t)},expression:"searchForm.serviceFeeMax"}})],1)])],1),t("el-col",{attrs:{span:6}},[t("el-form-item",{attrs:{label:"总金额",prop:"totalAmount"}},[t("div",{staticClass:"custom-range-input"},[t("el-input",{staticClass:"custom-range-item",attrs:{placeholder:"数字",size:"small"},model:{value:e.searchForm.totalAmountMin,callback:function(t){e.$set(e.searchForm,"totalAmountMin",t)},expression:"searchForm.totalAmountMin"}}),t("span",{staticClass:"custom-range-separator"},[e._v("到")]),t("el-input",{staticClass:"custom-range-item",attrs:{placeholder:"数字",size:"small"},model:{value:e.searchForm.totalAmountMax,callback:function(t){e.$set(e.searchForm,"totalAmountMax",t)},expression:"searchForm.totalAmountMax"}})],1)])],1),t("el-col",{attrs:{span:6}},[t("el-form-item",{attrs:{label:"项目数量",prop:"caseCount"}},[t("div",{staticClass:"custom-range-input"},[t("el-input",{staticClass:"custom-range-item",attrs:{placeholder:"数字",size:"small"},model:{value:e.searchForm.caseCountMin,callback:function(t){e.$set(e.searchForm,"caseCountMin",t)},expression:"searchForm.caseCountMin"}}),t("span",{staticClass:"custom-range-separator"},[e._v("到")]),t("el-input",{staticClass:"custom-range-item",attrs:{placeholder:"数字",size:"small"},model:{value:e.searchForm.caseCountMax,callback:function(t){e.$set(e.searchForm,"caseCountMax",t)},expression:"searchForm.caseCountMax"}})],1)])],1),t("el-col",{attrs:{span:6}},[t("el-form-item",{attrs:{label:"乙方签约公司",prop:"partyBCompany"}},[t("el-select",{staticClass:"filter-item",attrs:{placeholder:"乙方签约公司",clearable:"",size:"small"},model:{value:e.searchForm.partyBCompanyId,callback:function(t){e.$set(e.searchForm,"partyBCompanyId",t)},expression:"searchForm.partyBCompanyId"}},e._l(e.partyBCompanyOptions,(function(e){return t("el-option",{key:e.value||e.id,attrs:{label:e.label||e.name,value:e.value||e.id}})})),1)],1)],1)],1),t("el-row",[t("el-col",{attrs:{span:6}},[t("el-form-item",{attrs:{label:"业务人员",prop:"salesman"}},[t("SelectPerson",{attrs:{placeholder:"业务人员",clearable:"",size:"small"},model:{value:e.searchForm.salesman,callback:function(t){e.$set(e.searchForm,"salesman",t)},expression:"searchForm.salesman"}})],1)],1),t("el-col",{attrs:{span:6}},[t("el-form-item",{attrs:{label:"签约日期",prop:"signDateStart"}},[t("el-date-picker",{staticClass:"filter-item",attrs:{type:"daterange","range-separator":"至","start-placeholder":"签约日期","end-placeholder":"签约日期","value-format":"yyyy-MM-dd",size:"small"},model:{value:e.searchForm.signDateRange,callback:function(t){e.$set(e.searchForm,"signDateRange",t)},expression:"searchForm.signDateRange"}})],1)],1),t("el-col",{attrs:{span:6}},[t("el-form-item",{attrs:{label:"甲方联系人",prop:"partyAContact"}},[t("el-input",{staticClass:"filter-item",attrs:{placeholder:"甲方联系人",clearable:"",size:"small"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleSearch.apply(null,arguments)}},model:{value:e.searchForm.partyAContact,callback:function(t){e.$set(e.searchForm,"partyAContact",t)},expression:"searchForm.partyAContact"}})],1)],1),t("el-col",{attrs:{span:6}},[t("el-form-item",{attrs:{label:"联系电话",prop:"partyAPhone"}},[t("el-input",{staticClass:"filter-item",attrs:{placeholder:"联系电话",clearable:""},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleSearch.apply(null,arguments)}},model:{value:e.searchForm.partyAPhone,callback:function(t){e.$set(e.searchForm,"partyAPhone",t)},expression:"searchForm.partyAPhone"}})],1)],1)],1)],1),e.expandSearchVisible?t("div",[t("el-row",[t("el-col",{attrs:{span:6}},[t("el-form-item",{attrs:{label:"合同名称",prop:"contractName"}},[t("el-input",{staticClass:"filter-item",attrs:{placeholder:"合同名称",clearable:"",size:"small"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleSearch.apply(null,arguments)}},model:{value:e.searchForm.contractName,callback:function(t){e.$set(e.searchForm,"contractName",t)},expression:"searchForm.contractName"}})],1)],1),t("el-col",{attrs:{span:6}},[t("el-form-item",{attrs:{label:"技术主导",prop:"technicalDirector"}},[t("el-input",{staticClass:"filter-item",attrs:{placeholder:"技术主导",clearable:"",size:"small"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleSearch.apply(null,arguments)}},model:{value:e.searchForm.technicalDirector,callback:function(t){e.$set(e.searchForm,"technicalDirector",t)},expression:"searchForm.technicalDirector"}})],1)],1),t("el-col",{attrs:{span:6}},[t("el-form-item",{attrs:{label:"乙方签约人",prop:"partyBSigner"}},[t("el-input",{staticClass:"filter-item",attrs:{placeholder:"乙方签约人",clearable:"",size:"small"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleSearch.apply(null,arguments)}},model:{value:e.searchForm.partyBSigner,callback:function(t){e.$set(e.searchForm,"partyBSigner",t)},expression:"searchForm.partyBSigner"}})],1)],1),t("el-col",{attrs:{span:6}},[t("el-form-item",{attrs:{label:"业务服务类型",prop:"serviceType"}},[t("el-select",{staticClass:"filter-item",attrs:{placeholder:"业务服务类型",clearable:"",size:"small"},model:{value:e.searchForm.serviceType,callback:function(t){e.$set(e.searchForm,"serviceType",t)},expression:"searchForm.serviceType"}},e._l(e.serviceTypeOptions,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)],1)],1),t("el-row",[t("el-col",{attrs:{span:6}},[t("el-form-item",{attrs:{label:"创建人",prop:"creator"}},[t("el-input",{staticClass:"filter-item",attrs:{placeholder:"创建人",clearable:""},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleSearch.apply(null,arguments)}},model:{value:e.searchForm.creator,callback:function(t){e.$set(e.searchForm,"creator",t)},expression:"searchForm.creator"}})],1)],1),t("el-col",{attrs:{span:6}},[t("el-form-item",{attrs:{label:"修改人",prop:"updater"}},[t("el-input",{staticClass:"filter-item",attrs:{placeholder:"修改人",clearable:"",size:"small"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleSearch.apply(null,arguments)}},model:{value:e.searchForm.updater,callback:function(t){e.$set(e.searchForm,"updater",t)},expression:"searchForm.updater"}})],1)],1)],1)],1):e._e()]),t("div",{staticClass:"part-search-buttons"},[t("el-button",{attrs:{size:"small",type:"primary",icon:"el-icon-search"},on:{click:e.handleSearch}},[e._v("搜索")]),t("el-button",{attrs:{size:"small",icon:"el-icon-refresh"},on:{click:e.resetSearch}},[e._v("重置")])],1)],1),t("div",{staticClass:"body-part-content"},[t("div",{staticClass:"part-table-header"},[e._m(0),t("div",{staticClass:"part-table-operations"},[t("el-button",{attrs:{size:"small",type:"primary"},on:{click:e.handleExport}},[e._v("导出")]),t("el-button",{attrs:{size:"small",type:"primary"},on:{click:e.handleAdd}},[e._v("新增")])],1)]),t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{data:e.tableData,border:"",size:"small","row-key":"id"},on:{"selection-change":e.handleSelectionChange}},[t("el-table-column",{attrs:{type:"selection",width:"80",align:"center"}}),t("el-table-column",{attrs:{type:"index",label:"序号",width:"60",align:"center"}}),e._l(e.visibleColumns,(function(e){return t("el-table-column",{key:e.prop,attrs:{prop:e.prop,label:e.label,width:e.width,"min-width":e.minWidth,"show-overflow-tooltip":e.showOverflowTooltip,align:"center"}})})),t("el-table-column",{attrs:{fixed:"right",label:"操作",align:"center",width:"120","class-name":"small-padding fixed-width"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-button",{attrs:{size:"mini",type:"text",icon:"el-icon-view"},on:{click:function(t){return e.handleView(a.row)}}},[e._v("查看")])]}}])})],2),t("el-pagination",{directives:[{name:"show",rawName:"v-show",value:e.pagination.total>0,expression:"pagination.total > 0"}],attrs:{total:e.pagination.total,"current-page":e.pagination.currentPage,"page-sizes":[10,20,50,100],"page-size":e.pagination.pageSize,layout:"total, sizes, prev, pager, next, jumper"},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1),t("el-dialog",{attrs:{title:"导出excel清单",visible:e.exportDialogVisible,width:"900px","append-to-body":""},on:{"update:visible":function(t){e.exportDialogVisible=t}}},[t("div",{staticClass:"export-dialog-content"},[t("div",{staticClass:"export-main-container"},[t("div",{staticClass:"fields-selection-area"},[t("div",{staticClass:"fields-grid"},[t("el-checkbox",{model:{value:e.exportFields.contractNo.selected,callback:function(t){e.$set(e.exportFields.contractNo,"selected",t)},expression:"exportFields.contractNo.selected"}},[e._v("合同流水号")]),t("el-checkbox",{model:{value:e.exportFields.contractNumber.selected,callback:function(t){e.$set(e.exportFields.contractNumber,"selected",t)},expression:"exportFields.contractNumber.selected"}},[e._v("合同编号")]),t("el-checkbox",{model:{value:e.exportFields.contractCode.selected,callback:function(t){e.$set(e.exportFields.contractCode,"selected",t)},expression:"exportFields.contractCode.selected"}},[e._v("合同代码")]),t("el-checkbox",{model:{value:e.exportFields.contractName.selected,callback:function(t){e.$set(e.exportFields.contractName,"selected",t)},expression:"exportFields.contractName.selected"}},[e._v("合同名称")]),t("el-checkbox",{model:{value:e.exportFields.serviceType.selected,callback:function(t){e.$set(e.exportFields.serviceType,"selected",t)},expression:"exportFields.serviceType.selected"}},[e._v("业务服务类型")]),t("el-checkbox",{model:{value:e.exportFields.summary.selected,callback:function(t){e.$set(e.exportFields.summary,"selected",t)},expression:"exportFields.summary.selected"}},[e._v("合同摘要")]),t("el-checkbox",{model:{value:e.exportFields.customerName.selected,callback:function(t){e.$set(e.exportFields.customerName,"selected",t)},expression:"exportFields.customerName.selected"}},[e._v("客户名称")]),t("el-checkbox",{model:{value:e.exportFields.opportunityNo.selected,callback:function(t){e.$set(e.exportFields.opportunityNo,"selected",t)},expression:"exportFields.opportunityNo.selected"}},[e._v("对应商机号")]),t("el-checkbox",{model:{value:e.exportFields.opportunityName.selected,callback:function(t){e.$set(e.exportFields.opportunityName,"selected",t)},expression:"exportFields.opportunityName.selected"}},[e._v("对应商机名称")]),t("el-checkbox",{model:{value:e.exportFields.serviceFee.selected,callback:function(t){e.$set(e.exportFields.serviceFee,"selected",t)},expression:"exportFields.serviceFee.selected"}},[e._v("合同服务费")]),t("el-checkbox",{model:{value:e.exportFields.summary2.selected,callback:function(t){e.$set(e.exportFields.summary2,"selected",t)},expression:"exportFields.summary2.selected"}},[e._v("合同摘要")]),t("el-checkbox",{model:{value:e.exportFields.totalAmount.selected,callback:function(t){e.$set(e.exportFields.totalAmount,"selected",t)},expression:"exportFields.totalAmount.selected"}},[e._v("总金额")]),t("el-checkbox",{model:{value:e.exportFields.caseCount.selected,callback:function(t){e.$set(e.exportFields.caseCount,"selected",t)},expression:"exportFields.caseCount.selected"}},[e._v("项目数量")]),t("el-checkbox",{model:{value:e.exportFields.partyAContact.selected,callback:function(t){e.$set(e.exportFields.partyAContact,"selected",t)},expression:"exportFields.partyAContact.selected"}},[e._v("甲方联系人")]),t("el-checkbox",{model:{value:e.exportFields.partyAPhone.selected,callback:function(t){e.$set(e.exportFields.partyAPhone,"selected",t)},expression:"exportFields.partyAPhone.selected"}},[e._v("联系电话")]),t("el-checkbox",{model:{value:e.exportFields.partyAAddress.selected,callback:function(t){e.$set(e.exportFields.partyAAddress,"selected",t)},expression:"exportFields.partyAAddress.selected"}},[e._v("甲方签约地址")]),t("el-checkbox",{model:{value:e.exportFields.salesman.selected,callback:function(t){e.$set(e.exportFields.salesman,"selected",t)},expression:"exportFields.salesman.selected"}},[e._v("业务人员")]),t("el-checkbox",{model:{value:e.exportFields.technicalDirector.selected,callback:function(t){e.$set(e.exportFields.technicalDirector,"selected",t)},expression:"exportFields.technicalDirector.selected"}},[e._v("技术主导")]),t("el-checkbox",{model:{value:e.exportFields.partyBSigner.selected,callback:function(t){e.$set(e.exportFields.partyBSigner,"selected",t)},expression:"exportFields.partyBSigner.selected"}},[e._v("乙方签约人")]),t("el-checkbox",{model:{value:e.exportFields.partyBPhone.selected,callback:function(t){e.$set(e.exportFields.partyBPhone,"selected",t)},expression:"exportFields.partyBPhone.selected"}},[e._v("乙方手机")]),t("el-checkbox",{model:{value:e.exportFields.signDate.selected,callback:function(t){e.$set(e.exportFields.signDate,"selected",t)},expression:"exportFields.signDate.selected"}},[e._v("签约日期")]),t("el-checkbox",{model:{value:e.exportFields.creator.selected,callback:function(t){e.$set(e.exportFields.creator,"selected",t)},expression:"exportFields.creator.selected"}},[e._v("创建人")]),t("el-checkbox",{model:{value:e.exportFields.createTime.selected,callback:function(t){e.$set(e.exportFields.createTime,"selected",t)},expression:"exportFields.createTime.selected"}},[e._v("创建时间")]),t("el-checkbox",{model:{value:e.exportFields.status.selected,callback:function(t){e.$set(e.exportFields.status,"selected",t)},expression:"exportFields.status.selected"}},[e._v("合同状态")]),t("el-checkbox",{model:{value:e.exportFields.lastProcessTime.selected,callback:function(t){e.$set(e.exportFields.lastProcessTime,"selected",t)},expression:"exportFields.lastProcessTime.selected"}},[e._v("最后处理时间")]),t("el-checkbox",{model:{value:e.exportFields.processRemark.selected,callback:function(t){e.$set(e.exportFields.processRemark,"selected",t)},expression:"exportFields.processRemark.selected"}},[e._v("对接人部门")])],1)]),t("div",{staticClass:"selected-fields-area"},[t("div",{staticClass:"selected-header"},[e._v("已选字段")]),t("div",{staticClass:"selected-fields-list"},e._l(e.selectedFieldsList,(function(a){return t("div",{key:a.key,staticClass:"selected-field-item"},[e._v(" "+e._s(a.label)+" ")])})),0)])]),t("div",{staticClass:"template-selection-area"},[t("el-row",{attrs:{gutter:20}},[t("el-col",{attrs:{span:6}},[t("span",{staticClass:"template-label"},[e._v("导出模板")]),t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"默认"},model:{value:e.exportTemplate,callback:function(t){e.exportTemplate=t},expression:"exportTemplate"}},[t("el-option",{attrs:{label:"默认",value:"default"}})],1)],1),t("el-col",{attrs:{span:6}},[t("span",{staticClass:"template-label"},[e._v("模板名称")]),t("el-input",{attrs:{placeholder:"输入模板名称"},model:{value:e.templateName,callback:function(t){e.templateName=t},expression:"templateName"}})],1),t("el-col",{attrs:{span:2}},[t("el-button",{staticStyle:{"margin-top":"25px"},attrs:{type:"primary"},on:{click:e.saveTemplate}},[e._v("保存")])],1)],1)],1)]),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:e.selectAllFields}},[e._v("全选")]),t("el-button",{on:{click:e.clearAllFields}},[e._v("全不选")]),t("el-button",{on:{click:function(t){e.exportDialogVisible=!1}}},[e._v("取消")]),t("el-button",{attrs:{size:"small",type:"primary"},on:{click:e.handleConfirmExport}},[e._v("导出")])],1)])],1)},s=[function(){var e=this,t=e._self._c;return t("div",{staticClass:"part-table-title"},[t("span",[e._v("我的合同")])])}],r=(a("14d9"),a("13d5"),a("e9f5"),a("910d"),a("f665"),a("7d54"),a("ab43"),a("9485"),a("88a7"),a("271a"),a("5494"),a("512b")),o=a("35ad"),i=a("89c4"),c={name:"MyContract",components:{SelectPerson:r["a"]},data(){return{componentKey:0,loading:!1,expandSearchVisible:!0,showAdvanced:!1,searchForm:{serialNumber:"",businessServiceType:"",contractSummary:"",officialFee:"",validPeriodStart:"",validPeriodEnd:"",caseCount:"",partyAPhone:"",partyAEmail:"",partyBSigner:"",signDateStart:"",signDateEnd:"",contractTerms:"",guarantor:"",partyAAddress:"",partyBAddress:"",partyBPhone:"",createTimeStart:"",createTimeEnd:"",customerName:"",paperStatus:"",contractNumber:"",contractCode:"",serviceType:"",totalAmountMin:"",totalAmountMax:"",serviceFeeMin:"",serviceFeeMax:"",caseCountMin:"",caseCountMax:"",partyBCompanyId:"",salesman:"",signDateRange:[],partyAContact:"",contractName:"",technicalDirector:"",creator:"",updater:""},visibleColumns:[],availableColumns:[{prop:"contractNo",label:"合同流水号"},{prop:"contractNumber",label:"合同编号",width:"120"},{prop:"contractCode",label:"合同代码",width:"120"},{prop:"contractName",label:"合同名称",minWidth:"150"},{prop:"serviceType",label:"业务服务类型",width:"120"},{prop:"summary",label:"合同摘要",minWidth:"180",showOverflowTooltip:!0},{prop:"customerName",label:"客户",minWidth:"150"},{prop:"opportunityNo",label:"对应商机号",width:"120"},{prop:"opportunityName",label:"对应商机名称",minWidth:"150"},{prop:"serviceFee",label:"总服务费",width:"100"},{prop:"officialFee",label:"总官费",width:"100"},{prop:"totalAmount",label:"总金额",width:"100"},{prop:"validPeriod",label:"合同有效期",width:"160"},{prop:"caseCount",label:"项目数量",width:"90"},{prop:"partyAContact",label:"甲方联系人",width:"110"},{prop:"partyAPhone",label:"联系电话",width:"120"},{prop:"partyAEmail",label:"联系人邮箱",width:"150",showOverflowTooltip:!0},{prop:"partyAAddress",label:"甲方签约地址",minWidth:"180",showOverflowTooltip:!0},{prop:"salesman",label:"业务人员",width:"100"},{prop:"technicalDirector",label:"技术主导",width:"100"},{prop:"technicalDepartment",label:"技术主导部门",width:"120"},{prop:"partyBCompany",label:"乙方公司",minWidth:"150"},{prop:"partyBAddress",label:"乙方签约地址",minWidth:"180",showOverflowTooltip:!0},{prop:"partyBSigner",label:"乙方签约人",width:"110"},{prop:"partyBPhone",label:"乙方签约人手机",width:"130"},{prop:"signDate",label:"签约日期",width:"120"},{prop:"remark",label:"合同备注",minWidth:"150",showOverflowTooltip:!0},{prop:"creator",label:"创建人",width:"100"},{prop:"createTime",label:"创建时间",width:"160"},{prop:"updater",label:"修改人",width:"100"},{prop:"updateTime",label:"修改时间",width:"160"},{prop:"status",label:"合同状态",width:"100"},{prop:"additionalTerms",label:"附加条款",minWidth:"150",showOverflowTooltip:!0},{prop:"lastProcessTime",label:"最后处理时间",width:"160"},{prop:"processRemark",label:"流程备注",minWidth:"150",showOverflowTooltip:!0},{prop:"officialFee",label:"实际官费",width:"100"},{prop:"actualOfficialFee",label:"实收官费",width:"100"},{prop:"actualServiceFee",label:"实收服务费",width:"100"},{prop:"lastPaymentDate",label:"最后收款日期",width:"120"},{prop:"pendingOfficialFee",label:"待收官费",width:"120"},{prop:"pendingServiceFee",label:"待收服务费",width:"120"},{prop:"totalPending",label:"总待收",width:"120"},{prop:"paperStatus",label:"纸件状态",width:"120"}],defaultSelectedColumns:["contractNumber","contractName","serviceType","serviceFee","officialFee","salesman","technicalDirector","partyBCompany","status","lastProcessTime","technicalDirector","lastProcessTime","status","officialFee","actualOfficialFee","actualServiceFee","lastPaymentDate","paperStatus","totalAmount","officialFee","actualOfficialFee","actualServiceFee","lastPaymentDate","pendingOfficialFee","pendingServiceFee","totalPending"],tableData:[],pagination:{currentPage:1,pageSize:10,total:800},selectedRows:[],activeStatus:"all",exportDialogVisible:!1,exportTemplate:"default",templateName:"",exportTemplates:[{label:"默认",value:"default"}],templateConfigs:{default:{name:"默认",fields:["contractCode","contractName","customerName","serviceType","serviceFee","totalAmount","caseCount","partyAContact","salesman","technicalDirector","signDate","status"]}},exportFields:{contractNo:{label:"合同流水号",selected:!1},contractNumber:{label:"合同编号",selected:!1},contractCode:{label:"合同代码",selected:!0},contractName:{label:"合同名称",selected:!0},serviceType:{label:"业务服务类型",selected:!1},summary:{label:"合同摘要",selected:!1},customerName:{label:"客户名称",selected:!0},opportunityNo:{label:"对应商机号",selected:!0},opportunityName:{label:"对应商机名称",selected:!0},serviceFee:{label:"合同服务费",selected:!0},summary2:{label:"合同摘要",selected:!1},totalAmount:{label:"总金额",selected:!1},caseCount:{label:"项目数量",selected:!0},partyAContact:{label:"甲方联系人",selected:!0},partyAPhone:{label:"联系电话",selected:!1},partyAAddress:{label:"甲方签约地址",selected:!1},salesman:{label:"业务人员",selected:!0},technicalDirector:{label:"技术主导",selected:!0},partyBSigner:{label:"乙方签约人",selected:!1},partyBPhone:{label:"乙方手机",selected:!1},signDate:{label:"签约日期",selected:!0},creator:{label:"创建人",selected:!0},createTime:{label:"创建时间",selected:!1},status:{label:"合同状态",selected:!0},lastProcessTime:{label:"最后处理时间",selected:!1},processRemark:{label:"对接人部门",selected:!1}},partyBCompanyOptions:[],serviceTypeOptions:[]}},computed:{selectedFieldsList(){return Object.keys(this.exportFields).filter(e=>this.exportFields[e].selected).map(e=>({key:e,label:this.exportFields[e].label}))},currentRoute(){return this.$route.path}},watch:{currentRoute:{handler(){this.fetchData()},immediate:!0},$route:{handler(){this.refreshComponent()},immediate:!0,deep:!0}},created(){this.updateVisibleColumns(this.defaultSelectedColumns),this.loadFilterOptions(),this.fetchData()},mounted(){this.setupMutationObserver(),window.addEventListener("popstate",this.handlePopState);const e=this.$route.query.status;e&&(this.activeStatus=e,this.handleStatusTabClick())},beforeDestroy(){this.observer&&this.observer.disconnect(),window.removeEventListener("popstate",this.handlePopState)},methods:{async loadFilterOptions(){try{const[e,t]=await Promise.all([i["a"].ourCompany.getOptions(),i["a"].businessService.getOptions()]);if(e&&e.data){const t=e.data.data||e.data;this.partyBCompanyOptions=(t||[]).map(e=>({label:e.name||e.company_name||e.label,value:e.id||e.value}))}if(t&&t.data){const e=t.data.data||t.data;this.serviceTypeOptions=(e||[]).map(e=>({label:e.name||e.label,value:e.value||e.name}))}}catch(e){console.error("加载筛选选项失败",e),this.partyBCompanyOptions=[],this.serviceTypeOptions=[]}},setupMutationObserver(){const e=document.querySelector(".my-contract-container");if(!e)return;const t={attributes:!0,childList:!0,subtree:!0};this.observer=new MutationObserver(()=>{}),this.observer.observe(e,t)},refreshComponent(){this.componentKey+=1},handlePopState(){this.refreshComponent(),this.fetchData()},updateVisibleColumns(e){const t=Array.isArray(e)?e:e&&"object"===typeof e?Object.keys(e).filter(t=>e[t]):[];this.visibleColumns=this.availableColumns.filter(e=>t.includes(e.prop)),0===this.visibleColumns.length&&this.availableColumns.length>0&&(this.visibleColumns=[...this.availableColumns])},resetSearch(){this.searchForm={serialNumber:"",businessServiceType:"",contractSummary:"",officialFee:"",validPeriodStart:"",validPeriodEnd:"",caseCount:"",partyAPhone:"",partyAEmail:"",partyBSigner:"",signDateStart:"",signDateEnd:"",contractTerms:"",guarantor:"",partyAAddress:"",partyBAddress:"",partyBPhone:"",createTimeStart:"",createTimeEnd:"",customerName:"",paperStatus:"",contractNumber:"",contractCode:"",serviceType:"",totalAmountMin:"",totalAmountMax:"",serviceFeeMin:"",serviceFeeMax:"",caseCountMin:"",caseCountMax:"",partyBCompanyId:"",salesman:"",signDateRange:[],partyAContact:"",contractName:"",technicalDirector:"",creator:"",updater:""},this.handleSearch()},handleSearch(){this.pagination.currentPage=1,this.fetchData()},handleAdd(){this.$router.push({path:"/contract/add"})},handleExport(){this.exportDialogVisible=!0,this.handleTemplateChange(this.exportTemplate)},updateSelectedFields(){},selectAllFields(){Object.keys(this.exportFields).forEach(e=>{this.exportFields[e].selected=!0})},clearAllFields(){Object.keys(this.exportFields).forEach(e=>{this.exportFields[e].selected=!1})},async handleConfirmExport(){const e=Object.keys(this.exportFields).filter(e=>this.exportFields[e].selected).map(e=>({prop:e,label:this.exportFields[e].label}));if(0!==e.length)try{const t=this.buildQueryParams();t.selected_fields=JSON.stringify(e),t.my_contracts_only=!0;const a=await o["a"].exportContracts(t);this.downloadFile(a),this.$message.success("导出成功")}catch(t){console.error("导出失败",t),this.$message.error("导出失败")}finally{this.exportDialogVisible=!1}else this.$message.warning("请至少选择一个导出字段")},downloadFile(e){const t=new Blob([e.data]),a=document.createElement("a");a.href=URL.createObjectURL(t),a.download=`合同列表_${(new Date).toISOString().slice(0,10)}.xlsx`,document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(a.href)},handleView(e){this.$router.push({path:"/contract/view",query:{id:e.id||"0",contractNo:e.contractNo||e.contractId,type:"确认中"}})},async handleDelete(e){try{await this.$confirm("确定要作废合同吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"})}catch(t){return}try{await o["a"].deleteContract(e.id),this.$message.success("已作废"),this.fetchData()}catch(t){console.error("作废失败",t),this.$message.error("作废失败")}},async fetchData(){this.loading=!0;try{const e=this.buildQueryParams();e.page_size=this.pagination.pageSize,e.page=this.pagination.currentPage;const t=await o["a"].getContractList(e);if(t&&t.data&&t.data.success){const e=t.data.data,a=e.data||[],l=e.total||0;this.tableData=(a||[]).map(this.transformRowData),this.pagination.total=l||0}else this.tableData=[],this.pagination.total=0}catch(e){console.error("获取合同列表失败",e),this.tableData=[],this.pagination.total=0}finally{this.loading=!1}},buildQueryParams(){const e=this.searchForm,t={};return e.customerName&&(t.customer_name=e.customerName),e.paperStatus&&(t.paper_status=e.paperStatus),e.contractNumber&&(t.contract_no=e.contractNumber),e.contractCode&&(t.contract_code=e.contractCode),e.serviceType&&(t.service_type=e.serviceType),e.serviceFeeMin&&(t.min_service_fee=e.serviceFeeMin),e.serviceFeeMax&&(t.max_service_fee=e.serviceFeeMax),e.totalAmountMin&&(t.min_amount=e.totalAmountMin),e.totalAmountMax&&(t.max_amount=e.totalAmountMax),e.caseCountMin&&(t.min_case_count=e.caseCountMin),e.caseCountMax&&(t.max_case_count=e.caseCountMax),e.partyBCompanyId&&(t.party_b_company_id=e.partyBCompanyId),Array.isArray(e.signDateRange)&&2===e.signDateRange.length&&(t.sign_date_start=e.signDateRange[0],t.sign_date_end=e.signDateRange[1]),e.partyAContact&&(t.party_a_contact=e.partyAContact),e.partyAPhone&&(t.party_a_phone=e.partyAPhone),e.creator&&(t.creator=e.creator),e.updater&&(t.updater=e.updater),e.contractName&&(t.contract_name=e.contractName),e.technicalDirector&&(t.technical_director=e.technicalDirector),e.partyBSigner&&(t.party_b_signer=e.partyBSigner),e.salesman&&(/^\d+$/.test(String(e.salesman))&&(t.business_person_id=e.salesman),t.salesman=e.salesman),this.searchForm.status&&(t.status=this.searchForm.status),t.my_contracts_only=!0,t},transformRowData(e){var t;const a=(e,t,a="")=>{try{var l;return null!==(l=t.split(".").reduce((e,t)=>e&&null!=e[t]?e[t]:void 0,e))&&void 0!==l?l:a}catch(s){return a}};return{id:e.id,contractNo:e.contract_no,contractNumber:e.contract_no,contractCode:e.contract_code,contractName:e.contract_name,serviceType:e.service_type,summary:e.summary,customerName:a(e,"customer.customer_name"),opportunityNo:e.opportunity_no,opportunityName:e.opportunity_name,serviceFee:null!==(t=e.total_service_fee)&&void 0!==t?t:e.service_fee,officialFee:e.official_fee,totalAmount:e.total_amount,validPeriod:e.validity_start_date&&e.validity_end_date?`${e.validity_start_date} 至 ${e.validity_end_date}`:"",caseCount:e.case_count,partyAContact:a(e,"partyAContact.contact_name"),partyAPhone:e.party_a_phone,partyAEmail:e.party_a_email,partyAAddress:e.party_a_address,salesman:a(e,"business_person.real_name"),technicalDirector:a(e,"technical_director.real_name"),technicalDepartment:e.technical_department,partyBCompany:a(e,"party_b_company.name")||a(e,"party_b_company.company_name"),partyBAddress:e.party_b_address,partyBSigner:a(e,"party_b_signer.real_name"),partyBPhone:e.party_b_phone,signDate:e.signing_date,remark:e.remark,creator:a(e,"creator.real_name"),createTime:e.created_at,updater:a(e,"updater.real_name"),updateTime:e.updated_at,status:e.status,additionalTerms:e.additional_terms,lastProcessTime:e.last_process_time,processRemark:e.process_remark,paperStatus:e.paper_status}},handleSelectionChange(e){this.selectedRows=e},handleSizeChange(e){this.pagination.pageSize=e,this.fetchData()},handleCurrentChange(e){this.pagination.currentPage=e,this.fetchData()},handleStatusTabClick(e){"all"===this.activeStatus?this.searchForm.status="":"draft"===this.activeStatus?this.searchForm.status="草稿":"pending"===this.activeStatus?this.searchForm.status="审批中":"completed"===this.activeStatus&&(this.searchForm.status="已完成"),this.$router.replace({query:{...this.$route.query,status:this.activeStatus}}).catch(()=>{}),this.handleSearch()},handleTemplateChange(e){if(this.templateConfigs[e]){const t=this.templateConfigs[e];this.templateName=t.name,Object.keys(this.exportFields).forEach(e=>{this.exportFields[e].selected=t.fields.includes(this.exportFields[e].prop)}),this.$message.success("已加载模板："+t.name)}},refreshTemplates(){this.loading=!0,setTimeout(()=>{this.loading=!1,this.$message.success("模板列表已刷新")},500)},saveTemplate(){if(!this.templateName.trim())return void this.$message.warning("请输入模板名称");const e=Object.values(this.exportFields).filter(e=>e.selected).map(e=>e.prop);if(0===e.length)return void this.$message.warning("请至少选择一个字段");const t=this.exportTemplates.find(e=>e.label===this.templateName);t?this.$confirm(`模板"${this.templateName}"已存在，是否覆盖？`,"确认",{confirmButtonText:"覆盖",cancelButtonText:"取消",type:"warning"}).then(()=>{this.doSaveTemplate(e)}):this.doSaveTemplate(e)},doSaveTemplate(e){const t=this.templateName.toLowerCase().replace(/\s+/g,"_"),a={label:this.templateName,value:t},l={name:this.templateName,fields:e},s=this.exportTemplates.findIndex(e=>e.value===t);-1===s&&this.exportTemplates.push(a),this.templateConfigs[t]=l,this.exportTemplate=t,this.$message.success(`模板"${this.templateName}"保存成功`)},deleteTemplate(e){["default","simple","detailed","finance"].includes(e)?this.$message.warning("系统预设模板不能删除"):this.$confirm("确认删除此模板？","确认",{confirmButtonText:"删除",cancelButtonText:"取消",type:"warning"}).then(()=>{const t=this.exportTemplates.findIndex(t=>t.value===e);-1!==t&&this.exportTemplates.splice(t,1),delete this.templateConfigs[e],this.exportTemplate===e&&(this.exportTemplate="default",this.handleTemplateChange("default")),this.$message.success("模板删除成功")})}}},n=c,p=(a("c331"),a("2877")),d=Object(p["a"])(n,l,s,!1,null,"0bafdbac",null);t["default"]=d.exports},8558:function(e,t,a){"use strict";var l=a("cfe9"),s=a("b5db"),r=a("c6b6"),o=function(e){return s.slice(0,e.length)===e};e.exports=function(){return o("Bun/")?"BUN":o("Cloudflare-Workers")?"CLOUDFLARE":o("Deno/")?"DENO":o("Node.js/")?"NODE":l.Bun&&"string"==typeof Bun.version?"BUN":l.Deno&&"object"==typeof Deno.version?"DENO":"process"===r(l.process)?"NODE":l.window&&l.document?"BROWSER":"REST"}()},9485:function(e,t,a){"use strict";var l=a("23e7"),s=a("2266"),r=a("59ed"),o=a("825a"),i=a("46c4"),c=TypeError;l({target:"Iterator",proto:!0,real:!0},{reduce:function(e){o(this),r(e);var t=i(this),a=arguments.length<2,l=a?void 0:arguments[1],n=0;if(s(t,(function(t){a?(a=!1,l=t):l=e(l,t,n),n++}),{IS_RECORD:!0}),a)throw new c("Reduce of empty iterator with no initial value");return l}})},"9adc":function(e,t,a){"use strict";var l=a("8558");e.exports="NODE"===l},a640:function(e,t,a){"use strict";var l=a("d039");e.exports=function(e,t){var a=[][e];return!!a&&l((function(){a.call(null,t||function(){return 1},1)}))}},c331:function(e,t,a){"use strict";a("5a57")},d58f:function(e,t,a){"use strict";var l=a("59ed"),s=a("7b0b"),r=a("44ad"),o=a("07fa"),i=TypeError,c="Reduce of empty array with no initial value",n=function(e){return function(t,a,n,p){var d=s(t),m=r(d),u=o(d);if(l(a),0===u&&n<2)throw new i(c);var h=e?u-1:0,b=e?-1:1;if(n<2)while(1){if(h in m){p=m[h],h+=b;break}if(h+=b,e?h<0:u<=h)throw new i(c)}for(;e?h>=0:u>h;h+=b)h in m&&(p=a(p,m[h],h,d));return p}};e.exports={left:n(!1),right:n(!0)}}}]);