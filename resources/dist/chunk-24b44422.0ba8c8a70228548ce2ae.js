(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-24b44422"],{"0a61":function(e,t,a){},"184f":function(e,t,a){},"1e5a":function(e,t,a){"use strict";var s=a("23e7"),o=a("9961"),r=a("dad2");s({target:"Set",proto:!0,real:!0,forced:!r("symmetricDifference")},{symmetricDifference:o})},"1e70":function(e,t,a){"use strict";var s=a("23e7"),o=a("a5f7"),r=a("dad2"),i=!r("difference",(function(e){return 0===e.size}));s({target:"Set",proto:!0,real:!0,forced:i},{difference:o})},3156:function(e,t,a){"use strict";a("4dc9")},"384f":function(e,t,a){"use strict";var s=a("e330"),o=a("5388"),r=a("cb27"),i=r.Set,l=r.proto,c=s(l.forEach),n=s(l.keys),d=n(new i).next;e.exports=function(e,t,a){return a?o({iterator:n(e),next:d},t):c(e,t)}},"395e":function(e,t,a){"use strict";var s=a("dc19"),o=a("cb27").has,r=a("8e16"),i=a("7f65"),l=a("5388"),c=a("2a62");e.exports=function(e){var t=s(this),a=i(e);if(r(t)<a.size)return!1;var n=a.getIterator();return!1!==l(n,(function(e){if(!o(t,e))return c(n,"normal",!1)}))}},"4dc9":function(e,t,a){},5388:function(e,t,a){"use strict";var s=a("c65b");e.exports=function(e,t,a){var o,r,i=a?e:e.iterator,l=e.next;while(!(o=s(l,i)).done)if(r=t(o.value),void 0!==r)return r}},"68df":function(e,t,a){"use strict";var s=a("dc19"),o=a("8e16"),r=a("384f"),i=a("7f65");e.exports=function(e){var t=s(this),a=i(e);return!(o(t)>a.size)&&!1!==r(t,(function(e){if(!a.includes(e))return!1}),!0)}},7282:function(e,t,a){"use strict";var s=a("e330"),o=a("59ed");e.exports=function(e,t,a){try{return s(o(Object.getOwnPropertyDescriptor(e,t)[a]))}catch(r){}}},"72c3":function(e,t,a){"use strict";var s=a("23e7"),o=a("e9bc"),r=a("dad2");s({target:"Set",proto:!0,real:!0,forced:!r("union")},{union:o})},7419:function(e){e.exports=JSON.parse('[{"en":"Afghanistan","cn":"阿富汗","code":"+93","short_code":"AF"},{"en":"Alaska(U.S.A)","cn":"阿拉斯加","code":"+1907","short_code":"US"},{"en":"Albania","cn":"阿尔巴尼亚","code":"+355","short_code":"AL"},{"en":"Algeria","cn":"阿尔及利亚","code":"+213","short_code":"DZ"},{"en":"American Samoa","cn":"美属萨摩亚","code":"+684","short_code":"AS"},{"en":"Andorra","cn":"安道尔共和国","code":"+376","short_code":"AD"},{"en":"Angola","cn":"安哥拉","code":"+244","short_code":"AO"},{"en":"Anguilla","cn":"安圭拉岛","code":"+1254","short_code":"AI"},{"en":"Antigua and Barbuda","cn":"安提瓜和巴布达","code":"+1268","short_code":"AG"},{"en":"Argentina","cn":"阿根廷","code":"+54","short_code":"AR"},{"en":"Armenia","cn":"亚美尼亚","code":"+374","short_code":"AM"},{"en":"Aruba","cn":"阿鲁巴岛","code":"+297","short_code":"AW"},{"en":"Ascension","cn":"阿森松","code":"+247","short_code":"AC"},{"en":"Australia","cn":"澳大利亚","code":"+61","short_code":"AU"},{"en":"Austria","cn":"奥地利","code":"+43","short_code":"AT"},{"en":"Azerbaijan","cn":"阿塞拜疆","code":"+994","short_code":"AZ"},{"en":"Bahamas","cn":"巴哈马","code":"+1242","short_code":"BS"},{"en":"Bahrain","cn":"巴林","code":"+973","short_code":"BH"},{"en":"Bangladesh","cn":"孟加拉国","code":"+880","short_code":"BD"},{"en":"Barbados","cn":"巴巴多斯","code":"+1246","short_code":"BB"},{"en":"Belarus","cn":"白俄罗斯","code":"+375","short_code":"BY"},{"en":"Belgium","cn":"比利时","code":"+32","short_code":"BE"},{"en":"Belize","cn":"伯利兹","code":"+501","short_code":"BZ"},{"en":"Benin","cn":"贝宁","code":"+229","short_code":"BJ"},{"en":"Bermuda Is","cn":"百慕大群岛","code":"+1441","short_code":"BM"},{"en":"Bhutan","cn":"不丹","code":"+975","short_code":"BT"},{"en":"Bolivia","cn":"玻利维亚","code":"+591","short_code":"BO"},{"en":"Bosnia And Herzegovina","cn":"波斯尼亚和黑塞哥维那","code":"+387","short_code":"BA"},{"en":"Botswana","cn":"博茨瓦纳","code":"+267","short_code":"BW"},{"en":"Brazil","cn":"巴西","code":"+55","short_code":"BR"},{"en":"Brunei","cn":"文莱","code":"+673","short_code":"BN"},{"en":"Bulgaria","cn":"保加利亚","code":"+359","short_code":"BG"},{"en":"Burkina Faso","cn":"布基纳法索","code":"+226","short_code":"BF"},{"en":"Burma","cn":"缅甸","code":"+95","short_code":"MM"},{"en":"Burundi","cn":"布隆迪","code":"+257","short_code":"BI"},{"en":"Cambodia","cn":"柬埔寨","code":"+855","short_code":"KH"},{"en":"Cameroon","cn":"喀麦隆","code":"+237","short_code":"CM"},{"en":"Canada","cn":"加拿大","code":"+1","short_code":"CA"},{"en":"Cape Verde","cn":"佛得角","code":"+238","short_code":"CV"},{"en":"Cayman Is","cn":"开曼群岛","code":"+1345","short_code":"KY"},{"en":"Central African Republic","cn":"中非共和国","code":"+236","short_code":"CF"},{"en":"Chad","cn":"乍得","code":"+235","short_code":"TD"},{"en":"Chile","cn":"智利","code":"+56","short_code":"CL"},{"en":"China","cn":"中国","code":"+86","short_code":"CN"},{"en":"Colombia","cn":"哥伦比亚","code":"+57","short_code":"CO"},{"en":"Congo","cn":"刚果","code":"+242","short_code":"CG"},{"en":"Cook Is","cn":"库克群岛","code":"+682","short_code":"CK"},{"en":"Costa Rica","cn":"哥斯达黎加","code":"+506","short_code":"CR"},{"en":"Cuba","cn":"古巴","code":"+53","short_code":"CU"},{"en":"Cyprus","cn":"塞浦路斯","code":"+357","short_code":"CY"},{"en":"Czech Republic","cn":"捷克","code":"+420","short_code":"CZ"},{"en":"Denmark","cn":"丹麦","code":"+45","short_code":"DK"},{"en":"Djibouti","cn":"吉布提","code":"+253","short_code":"DJ"},{"en":"Dominica Rep","cn":"多米尼加共和国","code":"+1809","short_code":"DO"},{"en":"DR Congo","cn":"民主刚果","code":"+243","short_code":"CD"},{"en":"Ecuador","cn":"厄瓜多尔","code":"+593","short_code":"EC"},{"en":"Egypt","cn":"埃及","code":"+20","short_code":"EG"},{"en":"El Salvador","cn":"萨尔瓦多","code":"+503","short_code":"SV"},{"en":"Estonia","cn":"爱沙尼亚","code":"+372","short_code":"EE"},{"en":"Ethiopia","cn":"埃塞俄比亚","code":"+251","short_code":"ET"},{"en":"Falkland Islands","cn":"福克兰群岛","code":"+500","short_code":"FK"},{"en":"Fiji","cn":"斐济","code":"+679","short_code":"FJ"},{"en":"Finland","cn":"芬兰","code":"+358","short_code":"FI"},{"en":"France","cn":"法国","code":"+33","short_code":"FR"},{"en":"French Guiana","cn":"法属圭亚那","code":"+594","short_code":"GF"},{"en":"French Polynesia","cn":"法属玻利尼西亚","code":"+689","short_code":"PF"},{"en":"Gabon","cn":"加蓬","code":"+241","short_code":"GA"},{"en":"Gambia","cn":"冈比亚","code":"+220","short_code":"GM"},{"en":"Georgia","cn":"格鲁吉亚","code":"+995","short_code":"GE"},{"en":"Germany","cn":"德国","code":"+49","short_code":"DE"},{"en":"Ghana","cn":"加纳","code":"+233","short_code":"GH"},{"en":"Gibraltar","cn":"直布罗陀","code":"+350","short_code":"GI"},{"en":"Greece","cn":"希腊","code":"+30","short_code":"GR"},{"en":"Grenada","cn":"格林纳达","code":"+1473","short_code":"GD"},{"en":"Guam","cn":"关岛","code":"+1671","short_code":"GU"},{"en":"Guatemala","cn":"危地马拉","code":"+502","short_code":"GT"},{"en":"Guinea","cn":"几内亚","code":"+224","short_code":"GN"},{"en":"Guyana","cn":"圭亚那","code":"+592","short_code":"GY"},{"en":"Haiti","cn":"海地","code":"+509","short_code":"HT"},{"en":"Honduras","cn":"洪都拉斯","code":"+504","short_code":"HN"},{"en":"Hongkong","cn":"香港","code":"+852","short_code":"HK"},{"en":"Hungary","cn":"匈牙利","code":"+36","short_code":"HU"},{"en":"Iceland","cn":"冰岛","code":"+354","short_code":"IS"},{"en":"India","cn":"印度","code":"+91","short_code":"IN"},{"en":"Indonesia","cn":"印度尼西亚","code":"+62","short_code":"ID"},{"en":"Iran","cn":"伊朗","code":"+98","short_code":"IR"},{"en":"Iraq","cn":"伊拉克","code":"+964","short_code":"IQ"},{"en":"Ireland","cn":"爱尔兰","code":"+353","short_code":"IE"},{"en":"Israel","cn":"以色列","code":"+972","short_code":"IL"},{"en":"Italy","cn":"意大利","code":"+39","short_code":"IT"},{"en":"Ivory Coast","cn":"科特迪瓦","code":"+225","short_code":"CI"},{"en":"Jamaica","cn":"牙买加","code":"+1876","short_code":"JM"},{"en":"Japan","cn":"日本","code":"+81","short_code":"JP"},{"en":"Jordan","cn":"约旦","code":"+962","short_code":"JO"},{"en":"Kazakhstan","cn":"哈萨克斯坦","code":"+7","short_code":"KZ"},{"en":"Kenya","cn":"肯尼亚","code":"+254","short_code":"KE"},{"en":"Korea","cn":"韩国","code":"+82","short_code":"KR"},{"en":"Kosovo","cn":"科索沃","code":"+383","short_code":"XK"},{"en":"Kuwait","cn":"科威特","code":"+965","short_code":"KW"},{"en":"Kyrgyzstan","cn":"吉尔吉斯坦","code":"+996","short_code":"KG"},{"en":"Laos","cn":"老挝","code":"+856","short_code":"LA"},{"en":"Latvia","cn":"拉脱维亚","code":"+371","short_code":"LV"},{"en":"Lebanon","cn":"黎巴嫩","code":"+961","short_code":"LB"},{"en":"Lesotho","cn":"莱索托","code":"+266","short_code":"LS"},{"en":"Liberia","cn":"利比里亚","code":"+231","short_code":"LR"},{"en":"Libya","cn":"利比亚","code":"+218","short_code":"LY"},{"en":"Liechtenstein","cn":"列支敦士登","code":"+423","short_code":"LI"},{"en":"Lithuania","cn":"立陶宛","code":"+370","short_code":"LT"},{"en":"Luxembourg","cn":"卢森堡","code":"+352","short_code":"LU"},{"en":"Macao","cn":"澳门","code":"+853","short_code":"MO"},{"en":"Madagascar","cn":"马达加斯加","code":"+261","short_code":"MG"},{"en":"Malawi","cn":"马拉维","code":"+265","short_code":"MW"},{"en":"Malaysia","cn":"马来西亚","code":"+60","short_code":"MY"},{"en":"Maldives","cn":"马尔代夫","code":"+960","short_code":"MV"},{"en":"Mali","cn":"马里","code":"+223","short_code":"ML"},{"en":"Malta","cn":"马耳他","code":"+356","short_code":"MT"},{"en":"Mariana Is","cn":"马里亚那群岛","code":"+1670","short_code":"MP"},{"en":"Martinique","cn":"马提尼克","code":"+596","short_code":"MQ"},{"en":"Mauritius","cn":"毛里求斯","code":"+230","short_code":"MU"},{"en":"Mexico","cn":"墨西哥","code":"+52","short_code":"MX"},{"en":"Moldova","cn":"摩尔多瓦","code":"+373","short_code":"MD"},{"en":"Monaco","cn":"摩纳哥","code":"+377","short_code":"MC"},{"en":"Mongolia","cn":"蒙古","code":"+976","short_code":"MN"},{"en":"Montenegro","cn":"黑山","code":"+382","short_code":"ME"},{"en":"Montserrat Is","cn":"蒙特塞拉特岛","code":"+1664","short_code":"MS"},{"en":"Morocco","cn":"摩洛哥","code":"+212","short_code":"MA"},{"en":"Mozambique","cn":"莫桑比克","code":"+258","short_code":"MZ"},{"en":"Namibia","cn":"纳米比亚","code":"+264","short_code":"NA"},{"en":"Nauru","cn":"瑙鲁","code":"+674","short_code":"NR"},{"en":"Nepal","cn":"尼泊尔","code":"+977","short_code":"NP"},{"en":"Netherlands","cn":"荷兰","code":"+31","short_code":"NL"},{"en":"Netherlands Antilles","cn":"荷属安的列斯","code":"+599","short_code":"AN"},{"en":"New Zealand","cn":"新西兰","code":"+64","short_code":"NZ"},{"en":"Nicaragua","cn":"尼加拉瓜","code":"+505","short_code":"NI"},{"en":"Niger","cn":"尼日尔","code":"+227","short_code":"NE"},{"en":"Nigeria","cn":"尼日利亚","code":"+234","short_code":"NG"},{"en":"North Korea","cn":"朝鲜","code":"+850","short_code":"KP"},{"en":"North Macedonia","cn":"北马其顿","code":"+389","short_code":"MK"},{"en":"Norway","cn":"挪威","code":"+47","short_code":"NO"},{"en":"Oman","cn":"阿曼","code":"+968","short_code":"OM"},{"en":"Pakistan","cn":"巴基斯坦","code":"+92","short_code":"PK"},{"en":"Palestine","cn":"巴勒斯坦","code":"+970","short_code":"PS"},{"en":"Panama","cn":"巴拿马","code":"+507","short_code":"PA"},{"en":"Papua New Guinea","cn":"巴布亚新几内亚","code":"+675","short_code":"PG"},{"en":"Paraguay","cn":"巴拉圭","code":"+595","short_code":"PY"},{"en":"Peru","cn":"秘鲁","code":"+51","short_code":"PE"},{"en":"Philippines","cn":"菲律宾","code":"+63","short_code":"PH"},{"en":"Poland","cn":"波兰","code":"+48","short_code":"PL"},{"en":"Portugal","cn":"葡萄牙","code":"+351","short_code":"PT"},{"en":"Puerto Rico","cn":"波多黎各","code":"+1787","short_code":"PR"},{"en":"Qatar","cn":"卡塔尔","code":"+974","short_code":"QA"},{"en":"Republic of Croatia","cn":"克罗地亚共和国","code":"+385","short_code":"HR"},{"en":"Reunion","cn":"留尼旺","code":"+262","short_code":"RE"},{"en":"Romania","cn":"罗马尼亚","code":"+40","short_code":"RO"},{"en":"Russia","cn":"俄罗斯","code":"+7","short_code":"RU"},{"en":"Saint Lucia","cn":"圣卢西亚","code":"+1758","short_code":"LC"},{"en":"Saint Vincent","cn":"圣文森特","code":"+1784","short_code":"VC"},{"en":"Samoa","cn":"萨摩亚","code":"+685","short_code":"WS"},{"en":"San Marino","cn":"圣马力诺","code":"+378","short_code":"SM"},{"en":"Sao Tome and Principe","cn":"圣多美和普林西比","code":"+239","short_code":"ST"},{"en":"Saudi Arabia","cn":"沙特阿拉伯","code":"+966","short_code":"SA"},{"en":"Senegal","cn":"塞内加尔","code":"+221","short_code":"SN"},{"en":"Seychelles","cn":"塞舌尔","code":"+248","short_code":"SC"},{"en":"Sierra Leone","cn":"塞拉利昂","code":"+232","short_code":"SL"},{"en":"Singapore","cn":"新加坡","code":"+65","short_code":"SG"},{"en":"Slovakia","cn":"斯洛伐克","code":"+421","short_code":"SK"},{"en":"Slovenia","cn":"斯洛文尼亚","code":"+386","short_code":"SI"},{"en":"Solomon Is","cn":"所罗门群岛","code":"+677","short_code":"SB"},{"en":"Somali","cn":"索马里","code":"+252","short_code":"SO"},{"en":"South Africa","cn":"南非","code":"+27","short_code":"ZA"},{"en":"South Sudan","cn":"南苏丹","code":"+211","short_code":"SS"},{"en":"Spain","cn":"西班牙","code":"+34","short_code":"ES"},{"en":"Sri Lanka","cn":"斯里兰卡","code":"+94","short_code":"LK"},{"en":"Sudan","cn":"苏丹","code":"+249","short_code":"SD"},{"en":"Suriname","cn":"苏里南","code":"+597","short_code":"SR"},{"en":"Swaziland","cn":"斯威士兰","code":"+268","short_code":"SZ"},{"en":"Sweden","cn":"瑞典","code":"+46","short_code":"SE"},{"en":"Switzerland","cn":"瑞士","code":"+41","short_code":"CH"},{"en":"Syria","cn":"叙利亚","code":"+963","short_code":"SY"},{"en":"Taiwan","cn":"台湾省","code":"+886","short_code":"TW"},{"en":"Tajikstan","cn":"塔吉克斯坦","code":"+992","short_code":"TJ"},{"en":"Tanzania","cn":"坦桑尼亚","code":"+255","short_code":"TZ"},{"en":"Thailand","cn":"泰国","code":"+66","short_code":"TH"},{"en":"Timor-Leste","cn":"东帝汶","code":"+670","short_code":"TL"},{"en":"Togo","cn":"多哥","code":"+228","short_code":"TG"},{"en":"Tonga","cn":"汤加","code":"+676","short_code":"TO"},{"en":"Trinidad and Tobago","cn":"特立尼达和多巴哥","code":"+1868","short_code":"TT"},{"en":"Tunisia","cn":"突尼斯","code":"+216","short_code":"TN"},{"en":"Turkey","cn":"土耳其","code":"+90","short_code":"TR"},{"en":"Turkmenistan","cn":"土库曼斯坦","code":"+993","short_code":"TM"},{"en":"Uganda","cn":"乌干达","code":"+256","short_code":"UG"},{"en":"Ukraine","cn":"乌克兰","code":"+380","short_code":"UA"},{"en":"United Arab Emirates","cn":"阿拉伯联合酋长国","code":"+971","short_code":"AE"},{"en":"United Kingdom","cn":"英国","code":"+44","short_code":"GB"},{"en":"United States of America","cn":"美国","code":"+1","short_code":"US"},{"en":"Uruguay","cn":"乌拉圭","code":"+598","short_code":"UY"},{"en":"Uzbekistan","cn":"乌兹别克斯坦","code":"+998","short_code":"UZ"},{"en":"Vatican City","cn":"梵蒂冈","code":"+379","short_code":"VA"},{"en":"Venezuela","cn":"委内瑞拉","code":"+58","short_code":"VE"},{"en":"Vietnam","cn":"越南","code":"+84","short_code":"VN"},{"en":"Yemen","cn":"也门","code":"+967","short_code":"YE"},{"en":"Zambia","cn":"赞比亚","code":"+260","short_code":"ZM"},{"en":"Zimbabwe","cn":"津巴布韦","code":"+263","short_code":"ZW"}]')},"79a4":function(e,t,a){"use strict";var s=a("23e7"),o=a("d039"),r=a("953b"),i=a("dad2"),l=!i("intersection",(function(e){return 2===e.size&&e.has(1)&&e.has(2)}))||o((function(){return"3,2"!==String(Array.from(new Set([1,2,3]).intersection(new Set([3,2]))))}));s({target:"Set",proto:!0,real:!0,forced:l},{intersection:r})},"7f65":function(e,t,a){"use strict";var s=a("59ed"),o=a("825a"),r=a("c65b"),i=a("5926"),l=a("46c4"),c="Invalid size",n=RangeError,d=TypeError,p=Math.max,m=function(e,t){this.set=e,this.size=p(t,0),this.has=s(e.has),this.keys=s(e.keys)};m.prototype={getIterator:function(){return l(o(r(this.keys,this.set)))},includes:function(e){return r(this.has,this.set,e)}},e.exports=function(e){o(e);var t=+e.size;if(t!==t)throw new d(c);var a=i(t);if(a<0)throw new n(c);return new m(e,a)}},"83b9e":function(e,t,a){"use strict";var s=a("cb27"),o=a("384f"),r=s.Set,i=s.add;e.exports=function(e){var t=new r;return o(e,(function(e){i(t,e)})),t}},"8b00":function(e,t,a){"use strict";var s=a("23e7"),o=a("68df"),r=a("dad2"),i=!r("isSubsetOf",(function(e){return e}));s({target:"Set",proto:!0,real:!0,forced:i},{isSubsetOf:o})},"8e16":function(e,t,a){"use strict";var s=a("7282"),o=a("cb27");e.exports=s(o.proto,"size","get")||function(e){return e.size}},"953b":function(e,t,a){"use strict";var s=a("dc19"),o=a("cb27"),r=a("8e16"),i=a("7f65"),l=a("384f"),c=a("5388"),n=o.Set,d=o.add,p=o.has;e.exports=function(e){var t=s(this),a=i(e),o=new n;return r(t)>a.size?c(a.getIterator(),(function(e){p(t,e)&&d(o,e)})):l(t,(function(e){a.includes(e)&&d(o,e)})),o}},9961:function(e,t,a){"use strict";var s=a("dc19"),o=a("cb27"),r=a("83b9e"),i=a("7f65"),l=a("5388"),c=o.add,n=o.has,d=o.remove;e.exports=function(e){var t=s(this),a=i(e).getIterator(),o=r(t);return l(a,(function(e){n(t,e)?d(o,e):c(o,e)})),o}},a4e7:function(e,t,a){"use strict";var s=a("23e7"),o=a("395e"),r=a("dad2"),i=!r("isSupersetOf",(function(e){return!e}));s({target:"Set",proto:!0,real:!0,forced:i},{isSupersetOf:o})},a5f7:function(e,t,a){"use strict";var s=a("dc19"),o=a("cb27"),r=a("83b9e"),i=a("8e16"),l=a("7f65"),c=a("384f"),n=a("5388"),d=o.has,p=o.remove;e.exports=function(e){var t=s(this),a=l(e),o=r(t);return i(t)<=a.size?c(t,(function(e){a.includes(e)&&p(o,e)})):n(a.getIterator(),(function(e){d(t,e)&&p(o,e)})),o}},b4bc:function(e,t,a){"use strict";var s=a("dc19"),o=a("cb27").has,r=a("8e16"),i=a("7f65"),l=a("384f"),c=a("5388"),n=a("2a62");e.exports=function(e){var t=s(this),a=i(e);if(r(t)<=a.size)return!1!==l(t,(function(e){if(a.includes(e))return!1}),!0);var d=a.getIterator();return!1!==c(d,(function(e){if(o(t,e))return n(d,"normal",!1)}))}},c0cb:function(e,t,a){"use strict";a("184f")},c1a1:function(e,t,a){"use strict";var s=a("23e7"),o=a("b4bc"),r=a("dad2"),i=!r("isDisjointFrom",(function(e){return!e}));s({target:"Set",proto:!0,real:!0,forced:i},{isDisjointFrom:o})},cb27:function(e,t,a){"use strict";var s=a("e330"),o=Set.prototype;e.exports={Set:Set,add:s(o.add),has:s(o.has),remove:s(o["delete"]),proto:o}},d0e9:function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e._self._c;return t("div",{staticClass:"contract-view-container"},[t("div",{staticClass:"operation-bar"},[t("div",{staticClass:"contract-info"},[t("span",{staticClass:"title"},[e._v("合同详情")]),e.contractNo?t("span",{staticClass:"contract-number"},[e._v("合同流水号："+e._s(e.contractNo))]):e._e()]),t("div",{staticClass:"operation-buttons"},[t("el-button",{attrs:{type:"success",size:"small",icon:"el-icon-refresh",loading:e.loading},on:{click:e.handleSave}},[e._v("保存")]),t("el-button",{attrs:{type:"danger",size:"small",icon:"el-icon-delete"},on:{click:e.handleDelete}},[e._v("删除")]),t("el-button",{attrs:{type:"info",size:"small",icon:"el-icon-back"},on:{click:e.handleReturn}},[e._v("返回")])],1)]),t("div",{staticClass:"body-part-content"},[t("el-tabs",{attrs:{type:"border-card"},model:{value:e.activeTab,callback:function(t){e.activeTab=t},expression:"activeTab"}},[t("el-tab-pane",{attrs:{label:"合同信息",name:"contractInfo"}},[t("div",{staticClass:"form-container"},[t("el-form",{ref:"form",staticClass:"contract-form",attrs:{model:e.form,"label-width":"120px",rules:e.formRules}},[t("el-row",{attrs:{gutter:20}},[t("el-col",{attrs:{span:6}},[t("el-form-item",{attrs:{label:"客户",prop:"customerId",required:""}},[t("el-select",{staticStyle:{width:"100%"},attrs:{filterable:"",remote:"","reserve-keyword":"",placeholder:"请选择客户","remote-method":e.searchCustomers,loading:e.customerLoading},on:{change:e.handleCustomerChange,focus:e.handleCustomerFocus},model:{value:e.form.customerId,callback:function(t){e.$set(e.form,"customerId",t)},expression:"form.customerId"}},e._l(e.customerOptions,(function(e){return t("el-option",{key:e.id,attrs:{label:e.customer_name||e.customerName,value:e.id}})})),1)],1)],1),t("el-col",{attrs:{span:6}},[t("el-form-item",{attrs:{label:"合同编号"}},[t("el-input",{attrs:{placeholder:"提交后自动生成",disabled:""},model:{value:e.form.contractNo,callback:function(t){e.$set(e.form,"contractNo",t)},expression:"form.contractNo"}})],1)],1),t("el-col",{attrs:{span:6}},[t("el-form-item",{attrs:{label:"合同代码"}},[t("el-input",{attrs:{placeholder:"请输入合同代码"},model:{value:e.form.contractCode,callback:function(t){e.$set(e.form,"contractCode",t)},expression:"form.contractCode"}})],1)],1),t("el-col",{attrs:{span:6}},[t("el-form-item",{attrs:{label:"合同状态"}},[t("el-input",{attrs:{placeholder:"草稿",disabled:""},model:{value:e.form.status,callback:function(t){e.$set(e.form,"status",t)},expression:"form.status"}})],1)],1)],1),t("el-row",{attrs:{gutter:20}},[t("el-col",{attrs:{span:6}},[t("el-form-item",{attrs:{label:"合同类型",prop:"contractType",required:""}},[t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择合同类型"},on:{change:e.handleContractTypeChange},model:{value:e.form.contractType,callback:function(t){e.$set(e.form,"contractType",t)},expression:"form.contractType"}},[t("el-option",{attrs:{label:"标准合同",value:"standard"}}),t("el-option",{attrs:{label:"非标合同",value:"non-standard"}})],1)],1)],1),t("el-col",{attrs:{span:6}},[t("el-form-item",{attrs:{label:"业务服务类型",prop:"serviceType",required:""}},["standard"===e.form.contractType?t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择类型"},model:{value:e.form.serviceType,callback:function(t){e.$set(e.form,"serviceType",t)},expression:"form.serviceType"}},e._l(e.businessServiceTypes,(function(a){return t("el-option-group",{key:a.category,attrs:{label:a.category}},e._l(a.items,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)})),1):"non-standard"===e.form.contractType?t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择类型（可多选）",multiple:"","collapse-tags":""},model:{value:e.form.serviceType,callback:function(t){e.$set(e.form,"serviceType",t)},expression:"form.serviceType"}},e._l(e.businessServiceTypes,(function(a){return t("el-option-group",{key:a.category,attrs:{label:a.category}},e._l(a.items,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)})),1):t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请先选择合同类型",disabled:""},model:{value:e.form.serviceType,callback:function(t){e.$set(e.form,"serviceType",t)},expression:"form.serviceType"}})],1)],1),t("el-col",{attrs:{span:6}},[t("el-form-item",{attrs:{label:"合同名称",prop:"contractName",required:""}},[t("el-input",{attrs:{placeholder:"请输入合同名称"},model:{value:e.form.contractName,callback:function(t){e.$set(e.form,"contractName",t)},expression:"form.contractName"}})],1)],1),t("el-col",{attrs:{span:6}},[t("el-form-item",{attrs:{label:"业务人员",prop:"businessPersonId",required:""}},[t("SelectPerson",{attrs:{placeholder:"业务人员",clearable:""},on:{change:e.handleBusinessPersonChange},model:{value:e.form.businessPersonId,callback:function(t){e.$set(e.form,"businessPersonId",t)},expression:"form.businessPersonId"}})],1)],1),t("el-col",{attrs:{span:6}},[t("el-form-item",{attrs:{label:"纸件状态",prop:"paperStatus",required:""}},[t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择"},model:{value:e.form.paperStatus,callback:function(t){e.$set(e.form,"paperStatus",t)},expression:"form.paperStatus"}},[t("el-option",{attrs:{label:"是",value:"1"}}),t("el-option",{attrs:{label:"否",value:"0"}})],1)],1)],1)],1),t("el-row",{attrs:{gutter:20}},[t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"合同摘要"}},[t("el-input",{attrs:{maxlength:"300","show-word-limit":"",type:"textarea",rows:3,placeholder:"请输入内容"},model:{value:e.form.summary,callback:function(t){e.$set(e.form,"summary",t)},expression:"form.summary"}})],1)],1),t("el-col",{attrs:{span:6}},[t("el-form-item",{attrs:{label:"技术主导",prop:"technicalDirectorId"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:e.form.customerId?0===e.technicalDirectorOptions.length?"该客户暂无技术主导联系人":"请选择技术主导":"请先选择客户",filterable:"",disabled:!e.form.customerId||0===e.technicalDirectorOptions.length},on:{change:e.handleTechnicalDirectorChange},model:{value:e.form.technicalDirectorId,callback:function(t){e.$set(e.form,"technicalDirectorId",t)},expression:"form.technicalDirectorId"}},e._l(e.technicalDirectorOptions,(function(e){return t("el-option",{key:e.id,attrs:{label:e.contact_name||e.name,value:e.id}})})),1)],1)],1),t("el-col",{attrs:{span:6}},[t("el-form-item",{attrs:{label:"技术主导部门"}},[t("el-input",{attrs:{placeholder:"自动带出",disabled:""},model:{value:e.form.technicalDepartment,callback:function(t){e.$set(e.form,"technicalDepartment",t)},expression:"form.technicalDepartment"}})],1)],1)],1),t("el-divider",{attrs:{"content-position":"left"}},[e._v("甲方信息")]),t("el-row",{attrs:{gutter:20}},[t("el-col",{attrs:{span:6}},[t("el-form-item",{attrs:{label:"甲方联系人",prop:"partyAContactId",required:""}},[t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择联系人"},on:{change:e.handlePartyAContactChange},model:{value:e.form.partyAContactId,callback:function(t){e.$set(e.form,"partyAContactId",t)},expression:"form.partyAContactId"}},e._l(e.customerContacts,(function(e){return t("el-option",{key:e.id,attrs:{label:e.contact_name,value:e.id}})})),1)],1)],1),t("el-col",{attrs:{span:6}},[t("el-form-item",{attrs:{label:"甲方电话"}},[t("el-input",{attrs:{placeholder:"自动带出"},model:{value:e.form.partyAPhone,callback:function(t){e.$set(e.form,"partyAPhone",t)},expression:"form.partyAPhone"}})],1)],1),t("el-col",{attrs:{span:6}},[t("el-form-item",{attrs:{label:"甲方邮箱"}},[t("el-input",{attrs:{placeholder:"自动带出"},model:{value:e.form.partyAEmail,callback:function(t){e.$set(e.form,"partyAEmail",t)},expression:"form.partyAEmail"}})],1)],1)],1),t("el-row",{attrs:{gutter:20}},[t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:"甲方签约地址",prop:"partyAAddress",required:""}},[t("el-input",{attrs:{placeholder:"请输入甲方签约地址"},model:{value:e.form.partyAAddress,callback:function(t){e.$set(e.form,"partyAAddress",t)},expression:"form.partyAAddress"}})],1)],1)],1),t("el-divider",{attrs:{"content-position":"left"}},[e._v("乙方信息")]),t("el-row",{attrs:{gutter:20}},[t("el-col",{attrs:{span:6}},[t("el-form-item",{attrs:{label:"乙方签约人",prop:"partyBSignerId",required:""}},[t("SelectPerson",{attrs:{placeholder:"请选择签约人",clearable:""},on:{change:e.handlePartyBSignerChange},model:{value:e.form.partyBSignerId,callback:function(t){e.$set(e.form,"partyBSignerId",t)},expression:"form.partyBSignerId"}})],1)],1),t("el-col",{attrs:{span:6}},[t("el-form-item",{attrs:{label:"乙方手机"}},[t("el-input",{attrs:{placeholder:"自动带出"},model:{value:e.form.partyBPhone,callback:function(t){e.$set(e.form,"partyBPhone",t)},expression:"form.partyBPhone"}})],1)],1),t("el-col",{attrs:{span:6}},[t("el-form-item",{attrs:{label:"签约日期",prop:"signingDate"}},[t("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"date",placeholder:"选择日期"},model:{value:e.form.signingDate,callback:function(t){e.$set(e.form,"signingDate",t)},expression:"form.signingDate"}})],1)],1)],1),t("el-row",{attrs:{gutter:20}},[t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"乙方签约公司",prop:"partyBCompanyId",required:""}},[t("el-select",{staticStyle:{width:"100%"},on:{change:e.handleCompanyChange},model:{value:e.form.partyBCompanyId,callback:function(t){e.$set(e.form,"partyBCompanyId",t)},expression:"form.partyBCompanyId"}},e._l(e.ourCompanyOptions,(function(e){return t("el-option",{key:e.id,attrs:{label:e.label||e.short_name,value:e.id}})})),1)],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"乙方签约地址"}},[t("el-input",{attrs:{placeholder:"自动带出"},model:{value:e.form.partyBAddress,callback:function(t){e.$set(e.form,"partyBAddress",t)},expression:"form.partyBAddress"}})],1)],1)],1),t("el-divider",{attrs:{"content-position":"left"}},[e._v("金额信息")]),t("el-row",{attrs:{gutter:20}},[t("el-col",{attrs:{span:6}},[t("el-form-item",{attrs:{label:"服务费",prop:"serviceFee"}},[t("el-input",{attrs:{placeholder:"0.00"},on:{change:e.updateTotalAmount},model:{value:e.form.serviceFee,callback:function(t){e.$set(e.form,"serviceFee",t)},expression:"form.serviceFee"}})],1)],1),t("el-col",{attrs:{span:6}},[t("el-form-item",{attrs:{label:"官费",prop:"officialFee"}},[t("el-input",{attrs:{placeholder:"0.00"},on:{change:e.updateTotalAmount},model:{value:e.form.officialFee,callback:function(t){e.$set(e.form,"officialFee",t)},expression:"form.officialFee"}})],1)],1),t("el-col",{attrs:{span:6}},[t("el-form-item",{attrs:{label:"渠道费",prop:"channelFee"}},[t("el-input",{attrs:{placeholder:"0.00"},on:{change:e.updateTotalAmount},model:{value:e.form.channelFee,callback:function(t){e.$set(e.form,"channelFee",t)},expression:"form.channelFee"}})],1)],1),t("el-col",{attrs:{span:6}},[t("el-form-item",{attrs:{label:"总服务费",prop:"totalServiceFee"}},[t("el-input",{attrs:{placeholder:"0.00",disabled:""},model:{value:e.form.totalServiceFee,callback:function(t){e.$set(e.form,"totalServiceFee",t)},expression:"form.totalServiceFee"}})],1)],1)],1),t("el-row",{attrs:{gutter:20}},[t("el-col",{attrs:{span:6}},[t("el-form-item",{attrs:{label:"总金额",prop:"totalAmount"}},[t("el-input",{attrs:{placeholder:"0.00",disabled:""},model:{value:e.form.totalAmount,callback:function(t){e.$set(e.form,"totalAmount",t)},expression:"form.totalAmount"}})],1)],1),t("el-col",{attrs:{span:6}},[t("el-form-item",{attrs:{label:"合同有效期",prop:"validity"}},[t("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期"},model:{value:e.form.validity,callback:function(t){e.$set(e.form,"validity",t)},expression:"form.validity"}})],1)],1),t("el-col",{attrs:{span:6}},[t("el-form-item",{attrs:{label:"创建人",prop:"creator"}},[t("el-input",{attrs:{disabled:""},model:{value:e.form.creator,callback:function(t){e.$set(e.form,"creator",t)},expression:"form.creator"}})],1)],1),t("el-col",{attrs:{span:6}},[t("el-form-item",{attrs:{label:"创建时间",prop:"createTime"}},[t("el-input",{attrs:{disabled:""},model:{value:e.form.createTime,callback:function(t){e.$set(e.form,"createTime",t)},expression:"form.createTime"}})],1)],1)],1),t("el-row",{attrs:{gutter:20}},[t("el-col",{attrs:{span:6}},[t("el-form-item",{attrs:{label:"更新人",prop:"updater"}},[t("el-input",{attrs:{disabled:""},model:{value:e.form.updater,callback:function(t){e.$set(e.form,"updater",t)},expression:"form.updater"}})],1)],1),t("el-col",{attrs:{span:6}},[t("el-form-item",{attrs:{label:"更新时间",prop:"updateTime"}},[t("el-input",{attrs:{disabled:""},model:{value:e.form.updateTime,callback:function(t){e.$set(e.form,"updateTime",t)},expression:"form.updateTime"}})],1)],1)],1),t("el-row",{attrs:{gutter:20}},[t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:"合同备注"}},[t("el-input",{attrs:{type:"textarea",placeholder:"请输入合同备注"},model:{value:e.form.remark,callback:function(t){e.$set(e.form,"remark",t)},expression:"form.remark"}})],1)],1)],1),t("el-divider",{attrs:{"content-position":"left"}},[e._v("服务明细")]),t("div",{staticClass:"service-detail"},[t("div",{staticClass:"service-header"},[t("el-button",{attrs:{size:"small",type:"primary"},on:{click:e.handleAddService}},[e._v("添加")])],1),t("el-table",{staticStyle:{width:"100%"},attrs:{data:e.form.serviceList,border:""}},[t("el-table-column",{attrs:{type:"selection",width:"80"}}),t("el-table-column",{attrs:{type:"index",label:"序号",width:"60"}}),t("el-table-column",{attrs:{prop:"serviceName",label:"服务内容","min-width":"160"}}),t("el-table-column",{attrs:{prop:"serviceDescription",label:"项目名称","min-width":"160"}}),t("el-table-column",{attrs:{prop:"amount",label:"服务费",width:"120"}}),t("el-table-column",{attrs:{prop:"currency",label:"官费",width:"80"}}),t("el-table-column",{attrs:{prop:"totalAmount",label:"备注",width:"120"}}),t("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-button",{attrs:{size:"small",type:"text"},on:{click:function(t){return e.handleEditService(a.row)}}},[e._v("修改")]),t("el-button",{attrs:{size:"small",type:"text"},on:{click:function(t){return e.handleDeleteService(a.row)}}},[e._v("删除")])]}}])})],1)],1),t("el-row",{staticStyle:{"margin-top":"20px"},attrs:{gutter:20}},[t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:"附加条款"}},[t("el-input",{attrs:{type:"textarea",maxlength:"500","show-word-limit":"",rows:4,placeholder:"请输入附加条款内容"},model:{value:e.form.additionalTerms,callback:function(t){e.$set(e.form,"additionalTerms",t)},expression:"form.additionalTerms"}})],1)],1)],1),t("el-row",{attrs:{gutter:20}},[t("el-col",{staticClass:"text-center",attrs:{span:24}},[t("el-button",{attrs:{size:"small",type:"primary"},on:{click:e.handlePreview}},[e._v("合同预览")])],1)],1)],1)],1)]),t("el-tab-pane",{attrs:{label:"附件",name:"attachments"}},[t("div",{staticClass:"attachment-container"},[t("div",{staticClass:"attachment-header"},[t("el-button",{attrs:{size:"small",type:"primary",icon:"el-icon-upload"},on:{click:e.handleUpload}},[e._v("新增")])],1),t("el-table",{staticStyle:{width:"100%"},attrs:{data:e.attachmentList,border:""}},[t("el-table-column",{attrs:{type:"selection",width:"55"}}),t("el-table-column",{attrs:{type:"index",label:"序号",width:"80"}}),t("el-table-column",{attrs:{prop:"file_type",label:"文件大类",width:"120"}}),t("el-table-column",{attrs:{prop:"file_sub_type",label:"文件小类",width:"120"}}),t("el-table-column",{attrs:{prop:"file_name",label:"文件名称"}}),t("el-table-column",{attrs:{prop:"upload_time",label:"上传时间",width:"180"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e.formatDateTime(t.row.upload_time))+" ")]}}])}),t("el-table-column",{attrs:{prop:"file_name",label:"文件",width:"100"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-button",{attrs:{size:"small",type:"text"},on:{click:function(t){return e.handleDownload(a.row)}}},[e._v("下载")])]}}])}),t("el-table-column",{attrs:{label:"上传人员",width:"120"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(t.row.uploader?t.row.uploader.name:"未知")+" ")]}}])}),t("el-table-column",{attrs:{label:"操作",width:"150",fixed:"right"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-button",{attrs:{size:"small",type:"text"},on:{click:function(t){return e.handleDownload(a.row)}}},[e._v("下载")]),t("el-button",{staticClass:"delete-button",attrs:{size:"small",type:"text"},on:{click:function(t){return e.handleDeleteFile(a.row)}}},[e._v("删除")])]}}])})],1)],1)]),t("el-tab-pane",{attrs:{label:"项目信息",name:"caseInfo"}},[t("div",{staticClass:"case-container"},[t("div",{staticClass:"contract-status-tip",staticStyle:{"margin-bottom":"15px"}},["已完成"!==e.form.status?t("el-alert",{attrs:{title:"提示：合同审批通过后，项目信息将自动推送到立项管理模块",type:"info",closable:!1,"show-icon":""}}):t("el-alert",{attrs:{title:"合同已审批通过，项目信息已推送到立项管理模块",type:"success",closable:!1,"show-icon":""}})],1),t("div",{staticClass:"case-header"},[t("el-button",{attrs:{size:"small",type:"primary",icon:"el-icon-plus"},on:{click:e.handleAddCase}},[e._v("新增项目")])],1),t("el-table",{staticStyle:{width:"100%"},attrs:{data:e.caseList,border:""}},[t("el-table-column",{attrs:{type:"selection",width:"55"}}),t("el-table-column",{attrs:{type:"index",label:"序号",width:"80"}}),t("el-table-column",{attrs:{prop:"case_code",label:"项目编号",width:"180"}}),t("el-table-column",{attrs:{prop:"case_name",label:"项目名称","min-width":"150"}}),t("el-table-column",{attrs:{prop:"case_type",label:"项目类型",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e.getCaseTypeText(t.row.case_type))+" ")]}}])}),t("el-table-column",{attrs:{prop:"case_subtype",label:"业务类型",width:"120"}}),t("el-table-column",{attrs:{prop:"application_type",label:"申请类型",width:"120"}}),t("el-table-column",{attrs:{prop:"product_name",label:"产品信息",width:"150"},scopedSlots:e._u([{key:"default",fn:function(a){return[a.row.product?t("span",[e._v(" "+e._s(a.row.product.product_name)+" "),a.row.product.specification?t("span",{staticClass:"product-spec"},[e._v(" ("+e._s(a.row.product.specification)+") ")]):e._e()]):t("span",[e._v("-")])]}}])}),t("el-table-column",{attrs:{prop:"application_no",label:"申请号",width:"120"}}),t("el-table-column",{attrs:{prop:"registration_no",label:"注册号",width:"120"}}),t("el-table-column",{attrs:{prop:"country_code",label:"国家（地区）",width:"100"}}),t("el-table-column",{attrs:{prop:"case_status",label:"记录状态",width:"100"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-tag",{attrs:{type:e.getRecordStatusType(a.row.case_status),size:"small"}},[e._v(" "+e._s(e.getCaseStatusText(a.row.case_status))+" ")])]}}])}),t("el-table-column",{attrs:{prop:"is_filed",label:"立项状态",width:"100"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-tag",{attrs:{type:a.row.is_filed?"success":"warning",size:"small"}},[e._v(" "+e._s(a.row.is_filed?"已立项":"待立项")+" ")])]}}])}),t("el-table-column",{attrs:{prop:"real_case",label:"项目状态",width:"120"},scopedSlots:e._u([{key:"default",fn:function(a){return[a.row.real_case?t("div",[t("el-tag",{attrs:{type:e.getRealCaseStatusType(a.row.real_case.case_status),size:"small"}},[e._v(" "+e._s(a.row.real_case.case_status_text)+" ")]),t("div",{staticClass:"case-info",staticStyle:{"font-size":"12px",color:"#999","margin-top":"2px"}},[e._v(" 立项时间: "+e._s(e.formatDate(a.row.real_case.created_at))+" ")])],1):t("span",{staticStyle:{color:"#999"}},[e._v("未立项")])]}}])}),t("el-table-column",{attrs:{prop:"case_description",label:"备注","min-width":"150"}}),t("el-table-column",{attrs:{label:"操作",width:"150",fixed:"right"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-button",{attrs:{size:"small",type:"text"},on:{click:function(t){return e.handleEditCase(a.row)}}},[e._v("编辑")]),t("el-button",{staticClass:"delete-button",attrs:{size:"small",type:"text"},on:{click:function(t){return e.handleDeleteCase(a.row)}}},[e._v("删除")])]}}])})],1)],1)]),t("el-tab-pane",{attrs:{label:"审批流程",name:"processInfo"}},[t("div",{staticClass:"process-container"},[t("WorkflowProgress",{ref:"workflowProgress",attrs:{"business-type":"contract","business-id":e.contractId,"can-start":!0,"can-cancel":!0,"created-by":e.form.createdBy},on:{"workflow-started":e.handleWorkflowStarted,"workflow-cancelled":e.handleWorkflowCancelled,"workflow-restarted":e.handleWorkflowRestarted,"task-processed":e.handleTaskProcessed}})],1)])],1)],1),t("el-dialog",{attrs:{title:"项目详情 - "+e.caseDetail.caseName,visible:e.caseDetailDialogVisible,width:"85%","append-to-body":""},on:{"update:visible":function(t){e.caseDetailDialogVisible=t}}},[t("el-tabs",{attrs:{type:"border-card"},model:{value:e.caseActiveTab,callback:function(t){e.caseActiveTab=t},expression:"caseActiveTab"}},[t("el-tab-pane",{attrs:{label:"基本信息",name:"basicInfo"}},[t("el-form",{attrs:{model:e.caseDetail,"label-width":"130px"}},[t("el-row",{attrs:{gutter:20}},[t("el-col",{attrs:{span:8}},[t("el-form-item",{attrs:{label:"客户名称",prop:"clientName"}},[t("el-input",{attrs:{placeholder:"自动带出",disabled:!0},model:{value:e.caseDetail.clientName,callback:function(t){e.$set(e.caseDetail,"clientName",t)},expression:"caseDetail.clientName"}})],1)],1),t("el-col",{attrs:{span:8}},[t("el-form-item",{attrs:{label:"项目类型",prop:"caseType"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择"},on:{change:e.handleDetailCaseTypeChange},model:{value:e.caseDetail.caseType,callback:function(t){e.$set(e.caseDetail,"caseType",t)},expression:"caseDetail.caseType"}},[t("el-option",{attrs:{label:"专利",value:"专利"}}),t("el-option",{attrs:{label:"商标",value:"商标"}}),t("el-option",{attrs:{label:"版权",value:"版权"}}),t("el-option",{attrs:{label:"科服",value:"科服"}})],1)],1)],1),t("el-col",{attrs:{span:8}},[t("el-form-item",{attrs:{label:"申请国家(地区)",prop:"applyCountry"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择"},model:{value:e.caseDetail.applyCountry,callback:function(t){e.$set(e.caseDetail,"applyCountry",t)},expression:"caseDetail.applyCountry"}},[t("el-option",{attrs:{label:"中国",value:"中国"}}),t("el-option",{attrs:{label:"美国",value:"美国"}}),t("el-option",{attrs:{label:"欧盟",value:"欧盟"}}),t("el-option",{attrs:{label:"日本",value:"日本"}})],1)],1)],1)],1),t("el-row",{attrs:{gutter:20}},[t("el-col",{attrs:{span:8}},[t("el-form-item",{attrs:{label:"业务类型",prop:"businessType"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择"},model:{value:e.caseDetail.businessType,callback:function(t){e.$set(e.caseDetail,"businessType",t)},expression:"caseDetail.businessType"}},[t("el-option",{attrs:{label:"申请",value:"申请"}}),t("el-option",{attrs:{label:"复审",value:"复审"}}),t("el-option",{attrs:{label:"无效",value:"无效"}}),t("el-option",{attrs:{label:"普通新申请",value:"普通新申请"}}),t("el-option",{attrs:{label:"其他",value:"其他"}})],1)],1)],1),t("el-col",{attrs:{span:8}},[t("el-form-item",{attrs:{label:"申请类型",prop:"applyType"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择"},model:{value:e.caseDetail.applyType,callback:function(t){e.$set(e.caseDetail,"applyType",t)},expression:"caseDetail.applyType"}},[t("el-option",{attrs:{label:"普通",value:"普通"}}),t("el-option",{attrs:{label:"加急",value:"加急"}}),t("el-option",{attrs:{label:"特急",value:"特急"}})],1)],1)],1),t("el-col",{attrs:{span:8}},[t("el-form-item",{attrs:{label:"售前支持",prop:"presaleSupport"}},[t("SelectPerson",{attrs:{placeholder:"售前支持",clearable:"",size:"small"},model:{value:e.caseDetail.presaleSupport,callback:function(t){e.$set(e.caseDetail,"presaleSupport",t)},expression:"caseDetail.presaleSupport"}})],1)],1)],1),t("el-row",{attrs:{gutter:20}},[t("el-col",{attrs:{span:8}},[t("el-form-item",{attrs:{label:"预项名称",prop:"preAwardName"}},[t("el-input",{attrs:{placeholder:"请输入预项名称"},model:{value:e.caseDetail.preAwardName,callback:function(t){e.$set(e.caseDetail,"preAwardName",t)},expression:"caseDetail.preAwardName"}})],1)],1),t("el-col",{attrs:{span:8}},[t("el-form-item",{attrs:{label:"技术主导",prop:"techLeader"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择"},model:{value:e.caseDetail.techLeader,callback:function(t){e.$set(e.caseDetail,"techLeader",t)},expression:"caseDetail.techLeader"}},e._l(e.techLeaderOptions,(function(e){return t("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1)],1),t("el-col",{attrs:{span:8}},[t("el-form-item",{attrs:{label:"资料对接-技术",prop:"techContact"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择"},model:{value:e.caseDetail.techContact,callback:function(t){e.$set(e.caseDetail,"techContact",t)},expression:"caseDetail.techContact"}},e._l(e.techContactOptions,(function(e){return t("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1)],1)],1),t("el-row",{attrs:{gutter:20}},[t("el-col",{attrs:{span:8}},["商标"===e.caseDetail.caseType?t("el-form-item",{attrs:{label:"商标类别",prop:"trademarkCategory"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择"},model:{value:e.caseDetail.trademarkCategory,callback:function(t){e.$set(e.caseDetail,"trademarkCategory",t)},expression:"caseDetail.trademarkCategory"}},[t("el-option",{attrs:{label:"第01类",value:"第01类"}}),t("el-option",{attrs:{label:"第02类",value:"第02类"}}),t("el-option",{attrs:{label:"第03类",value:"第03类"}}),t("el-option",{attrs:{label:"第04类",value:"第04类"}}),t("el-option",{attrs:{label:"第05类",value:"第05类"}}),t("el-option",{attrs:{label:"第06类",value:"第06类"}}),t("el-option",{attrs:{label:"第07类",value:"第07类"}}),t("el-option",{attrs:{label:"第08类",value:"第08类"}}),t("el-option",{attrs:{label:"第09类",value:"第09类"}}),t("el-option",{attrs:{label:"第10类",value:"第10类"}})],1)],1):e._e()],1),t("el-col",{attrs:{span:8}},["科服"===e.caseDetail.caseType?t("el-form-item",{attrs:{label:"科技服务名称",prop:"techServiceName"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择",disabled:e.caseDetail.isAuthorized},model:{value:e.caseDetail.techServiceName,callback:function(t){e.$set(e.caseDetail,"techServiceName",t)},expression:"caseDetail.techServiceName"}},[t("el-option",{attrs:{label:"咨询",value:"咨询"}}),t("el-option",{attrs:{label:"培训",value:"培训"}}),t("el-option",{attrs:{label:"调查",value:"调查"}}),t("el-option",{attrs:{label:"其他",value:"其他"}})],1)],1):e._e()],1),t("el-col",{attrs:{span:8}},[t("el-form-item",{attrs:{label:"项目状态",prop:"status"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择"},model:{value:e.caseDetail.status,callback:function(t){e.$set(e.caseDetail,"status",t)},expression:"caseDetail.status"}},[t("el-option",{attrs:{label:"准备中",value:"准备中"}}),t("el-option",{attrs:{label:"已申请",value:"已申请"}}),t("el-option",{attrs:{label:"已受理",value:"已受理"}}),t("el-option",{attrs:{label:"实审中",value:"实审中"}}),t("el-option",{attrs:{label:"已授权",value:"已授权"}}),t("el-option",{attrs:{label:"已驳回",value:"已驳回"}})],1)],1)],1)],1),t("el-row",{attrs:{gutter:20}},[t("el-col",{attrs:{span:8}},[t("el-form-item",{attrs:{label:"是否已有项目",prop:"isAuthorized"}},[t("el-radio-group",{model:{value:e.caseDetail.isAuthorized,callback:function(t){e.$set(e.caseDetail,"isAuthorized",t)},expression:"caseDetail.isAuthorized"}},[t("el-radio",{attrs:{label:!0}},[e._v("是")]),t("el-radio",{attrs:{label:!1}},[e._v("否")])],1)],1)],1),e.caseDetail.isAuthorized?t("el-col",{attrs:{span:8}},[t("el-form-item",{attrs:{label:"项目编号",prop:"projectNo"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择项目编号"},model:{value:e.caseDetail.projectNo,callback:function(t){e.$set(e.caseDetail,"projectNo",t)},expression:"caseDetail.projectNo"}},[t("el-option",{attrs:{label:"项目1",value:"项目1"}}),t("el-option",{attrs:{label:"项目2",value:"项目2"}}),t("el-option",{attrs:{label:"项目3",value:"项目3"}})],1)],1)],1):e._e(),"专利"===e.caseDetail.caseType?t("el-col",{attrs:{span:8}},[t("el-form-item",{attrs:{label:"申请号",prop:"applyNo"}},[t("el-input",{attrs:{placeholder:"请输入申请号",disabled:e.caseDetail.isAuthorized||"普通新申请"===e.caseDetail.businessType},model:{value:e.caseDetail.applyNo,callback:function(t){e.$set(e.caseDetail,"applyNo",t)},expression:"caseDetail.applyNo"}})],1)],1):e._e(),"商标"===e.caseDetail.caseType?t("el-col",{attrs:{span:8}},[t("el-form-item",{attrs:{label:"注册号",prop:"registrationNo"}},[t("el-input",{attrs:{placeholder:"请输入注册号",disabled:e.caseDetail.isAuthorized},model:{value:e.caseDetail.registrationNo,callback:function(t){e.$set(e.caseDetail,"registrationNo",t)},expression:"caseDetail.registrationNo"}})],1)],1):e._e(),"版权"===e.caseDetail.caseType?t("el-col",{attrs:{span:8}},[t("el-form-item",{attrs:{label:"受理号",prop:"acceptanceNo"}},[t("el-input",{attrs:{placeholder:"请输入受理号",disabled:e.caseDetail.isAuthorized},model:{value:e.caseDetail.acceptanceNo,callback:function(t){e.$set(e.caseDetail,"acceptanceNo",t)},expression:"caseDetail.acceptanceNo"}})],1)],1):e._e()],1),t("el-row",{attrs:{gutter:20}},[["专利","商标","版权"].includes(e.caseDetail.caseType)?[t("el-col",{attrs:{span:8}},[t("el-form-item",{attrs:{label:"代理机构",prop:"agency"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择"},model:{value:e.caseDetail.agency,callback:function(t){e.$set(e.caseDetail,"agency",t)},expression:"caseDetail.agency"}},[t("el-option",{attrs:{label:"睿道知识产权代理有限公司",value:"睿道知识产权代理有限公司"}}),t("el-option",{attrs:{label:"北京睿道科技有限公司",value:"北京睿道科技有限公司"}})],1)],1)],1)]:e._e()],2),t("el-form-item",{attrs:{label:"项目备注",prop:"remark"}},[t("el-input",{attrs:{type:"textarea",maxlength:"300","show-word-limit":"",placeholder:"请输入项目备注",rows:4},model:{value:e.caseDetail.remark,callback:function(t){e.$set(e.caseDetail,"remark",t)},expression:"caseDetail.remark"}})],1)],1),e.caseViewMode?e._e():t("div",{staticClass:"case-operation"},[t("el-button",{attrs:{size:"small",type:"primary"},on:{click:e.saveCaseBasicInfo}},[e._v("保存")]),t("el-button",{on:{click:e.cancelCaseEdit}},[e._v("取消")])],1)],1),t("el-tab-pane",{attrs:{label:"费用信息",name:"feeInfo"}},[t("div",{staticClass:"fee-container"},[t("div",{staticClass:"fee-header"},[t("span",{staticClass:"fee-title"},[e._v("服务费 "+e._s(e.feesTableData.serviceFeeTotal)+" RMB")]),t("el-button",{attrs:{size:"small",type:"primary"},on:{click:e.handleAddFee}},[e._v("新增")])],1),t("el-table",{staticStyle:{width:"100%","margin-bottom":"20px"},attrs:{data:e.feesTableData.serviceFees,border:""}},[t("el-table-column",{attrs:{prop:"feeName",label:"服务内容"}}),t("el-table-column",{attrs:{prop:"feeDescription",label:"项目名称","min-width":"200"}}),t("el-table-column",{attrs:{prop:"amount",label:"服务费",width:"120"}}),t("el-table-column",{attrs:{prop:"currency",label:"官费",width:"120"}}),t("el-table-column",{attrs:{prop:"exchangeRate",label:"备注",width:"120"}}),t("el-table-column",{attrs:{label:"操作",width:"150",fixed:"right"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-button",{attrs:{size:"small",type:"text",disabled:e.caseViewMode},on:{click:function(t){return e.handleEditFee(a.row)}}},[e._v("修改")]),t("el-button",{staticClass:"delete-button",attrs:{size:"small",type:"text",disabled:e.caseViewMode},on:{click:function(t){return e.handleDeleteFee(a.row)}}},[e._v("删除")])]}}])})],1),t("div",{staticClass:"fee-header"},[t("span",{staticClass:"fee-title"},[e._v("官费 "+e._s(e.feesTableData.officialFeeTotal)+" RMB")]),t("el-button",{attrs:{size:"small",type:"primary"},on:{click:e.addOfficialFee}},[e._v("新增")])],1),t("el-table",{staticStyle:{width:"100%"},attrs:{data:e.feesTableData.officialFees,border:""}},[t("el-table-column",{attrs:{prop:"feeName",label:"费用名称"}}),t("el-table-column",{attrs:{prop:"feeDescription",label:"费用描述","min-width":"200"}}),t("el-table-column",{attrs:{prop:"amount",label:"金额",width:"120"}}),t("el-table-column",{attrs:{prop:"currency",label:"币别",width:"120"}}),t("el-table-column",{attrs:{prop:"exchangeRate",label:"换算前金额",width:"120"}}),t("el-table-column",{attrs:{prop:"exchangeMethod",label:"换算前币别",width:"120"}}),t("el-table-column",{attrs:{label:"操作",width:"150",fixed:"right"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-button",{attrs:{size:"small",type:"text",disabled:e.caseViewMode},on:{click:function(t){return e.handleEditOfficialFee(a.row)}}},[e._v("修改")]),t("el-button",{staticClass:"delete-button",attrs:{size:"small",type:"text",disabled:e.caseViewMode},on:{click:function(t){return e.handleDeleteOfficialFee(a.row)}}},[e._v("删除")])]}}])})],1)],1)]),t("el-tab-pane",{attrs:{label:"附件信息",name:"attachmentInfo"}},[t("div",{staticClass:"attachment-header"},[t("el-button",{attrs:{size:"small",type:"primary"},on:{click:e.handleAddCaseAttachment}},[e._v("新增")])],1),t("el-table",{staticStyle:{width:"100%"},attrs:{data:e.caseAttachments,border:""}},[t("el-table-column",{attrs:{type:"index",label:"序号",width:"60"}}),t("el-table-column",{attrs:{prop:"file_type",label:"文件大类",width:"120"}}),t("el-table-column",{attrs:{prop:"file_category",label:"文件小类",width:"120"}}),t("el-table-column",{attrs:{prop:"file_name",label:"文件名称"}}),t("el-table-column",{attrs:{prop:"file_desc",label:"文件描述"}}),t("el-table-column",{attrs:{prop:"upload_time",label:"上传时间",width:"180"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e.formatDateTime(t.row.upload_time))+" ")]}}])}),t("el-table-column",{attrs:{label:"上传人员",width:"120"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(t.row.uploader?t.row.uploader.name:"未知")+" ")]}}])}),t("el-table-column",{attrs:{prop:"file",label:"文件",width:"100"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-button",{attrs:{size:"small",type:"text"},on:{click:function(t){return e.downloadCaseFile(a.row)}}},[e._v("下载")])]}}])}),t("el-table-column",{attrs:{label:"操作",width:"150",fixed:"right"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-button",{attrs:{size:"small",type:"text"},on:{click:function(t){return e.handleEditCaseAttachment(a.row)}}},[e._v("修改")]),t("el-button",{staticClass:"delete-button",attrs:{size:"small",type:"text"},on:{click:function(t){return e.handleDeleteCaseAttachment(a.row)}}},[e._v("删除")])]}}])})],1)],1)],1),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.caseDetailDialogVisible=!1}}},[e._v("关闭")]),e.caseViewMode?t("el-button",{attrs:{size:"small",type:"primary"},on:{click:e.switchToCaseEditMode}},[e._v("编辑")]):e._e()],1)],1),t("AddCaseDialog",{ref:"addCaseDialog",attrs:{visible:e.caseFormVisible,"customer-name":e.customerName,"customer-id":e.form.customerId,mode:e.caseFormMode,"case-data":e.currentCaseData},on:{"update:visible":function(t){e.caseFormVisible=t},success:e.handleCaseSuccess,"select-tech-service":e.handleSelectTechService,"select-project":e.handleSelectProject,close:e.handleCaseDialogClose}}),t("EditCaseDialog",{ref:"editCaseDialog",attrs:{visible:e.editCaseDialogVisible,"customer-name":e.customerName,"customer-id":e.form.customerId,"case-data":e.currentEditCaseData},on:{"update:visible":function(t){e.editCaseDialogVisible=t},success:e.handleCaseSuccess,"select-tech-service":e.handleSelectTechService,"select-project":e.handleSelectProject,close:e.handleEditCaseDialogClose}}),t("el-dialog",{attrs:{title:e.attachmentDialogTitle,visible:e.attachmentDialogVisible,width:"500px","append-to-body":""},on:{"update:visible":function(t){e.attachmentDialogVisible=t}}},[t("el-form",{ref:"attachmentForm",attrs:{model:e.attachmentForm,rules:e.attachmentFormRules,"label-width":"100px"}},[t("el-form-item",{attrs:{label:"文件",prop:"file"}},[t("el-upload",{staticClass:"attachment-upload",attrs:{action:"#","auto-upload":!1,"file-list":e.fileList,"on-change":e.handleAttachmentChange,"on-remove":e.handleRemoveAttachment,limit:1}},[t("el-button",{attrs:{size:"small",type:"primary"}},[e._v("选择文件")]),t("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[e._v("请选择文件，大小不超过50MB")])],1)],1),t("el-form-item",{attrs:{label:"文件大类",prop:"fileType"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择文件大类"},on:{change:e.handleFileTypeChange,focus:e.loadFileTypeOptions},model:{value:e.attachmentForm.fileType,callback:function(t){e.$set(e.attachmentForm,"fileType",t)},expression:"attachmentForm.fileType"}},e._l(e.fileTypeOptions,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),t("el-form-item",{attrs:{label:"文件小类",prop:"fileCategory"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择文件小类",disabled:!e.attachmentForm.fileType},on:{change:e.handleFileCategoryChange},model:{value:e.attachmentForm.fileCategory,callback:function(t){e.$set(e.attachmentForm,"fileCategory",t)},expression:"attachmentForm.fileCategory"}},e._l(e.fileCategoryOptions,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),t("el-form-item",{attrs:{label:"文件描述",prop:"fileDesc"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择文件描述",disabled:!e.attachmentForm.fileCategory,filterable:"","allow-create":"","default-first-option":""},model:{value:e.attachmentForm.fileDesc,callback:function(t){e.$set(e.attachmentForm,"fileDesc",t)},expression:"attachmentForm.fileDesc"}},e._l(e.fileDescOptions,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)],1),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.attachmentDialogVisible=!1}}},[e._v("取 消")]),t("el-button",{attrs:{size:"small",type:"primary"},on:{click:e.submitAttachmentForm}},[e._v("确 定")])],1)],1),t("el-dialog",{attrs:{title:e.serviceDialogTitle,visible:e.serviceDialogVisible,width:"600px"},on:{"update:visible":function(t){e.serviceDialogVisible=t}}},[t("el-form",{attrs:{model:e.serviceForm,"label-width":"100px"}},[t("el-form-item",{attrs:{label:"服务内容",required:""}},[t("el-input",{attrs:{placeholder:"请输入服务内容"},model:{value:e.serviceForm.serviceName,callback:function(t){e.$set(e.serviceForm,"serviceName",t)},expression:"serviceForm.serviceName"}})],1),t("el-form-item",{attrs:{label:"项目名称"}},[t("el-input",{attrs:{placeholder:"请输入项目名称"},model:{value:e.serviceForm.serviceDescription,callback:function(t){e.$set(e.serviceForm,"serviceDescription",t)},expression:"serviceForm.serviceDescription"}})],1),t("el-form-item",{attrs:{label:"服务费"}},[t("el-input",{attrs:{placeholder:"0.00",type:"number"},model:{value:e.serviceForm.amount,callback:function(t){e.$set(e.serviceForm,"amount",t)},expression:"serviceForm.amount"}})],1),t("el-form-item",{attrs:{label:"官费"}},[t("el-input",{attrs:{placeholder:"0.00",type:"number"},model:{value:e.serviceForm.currency,callback:function(t){e.$set(e.serviceForm,"currency",t)},expression:"serviceForm.currency"}})],1),t("el-form-item",{attrs:{label:"备注"}},[t("el-input",{attrs:{placeholder:"请输入备注"},model:{value:e.serviceForm.totalAmount,callback:function(t){e.$set(e.serviceForm,"totalAmount",t)},expression:"serviceForm.totalAmount"}})],1)],1),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:e.handleCancelService}},[e._v("取消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.handleSaveService}},[e._v("确定")])],1)],1),t("el-dialog",{staticClass:"contract-preview-dialog",attrs:{title:"合同预览",visible:e.contractPreviewVisible,width:"90%","close-on-click-modal":!1},on:{"update:visible":function(t){e.contractPreviewVisible=t}}},[t("div",{staticClass:"contract-preview-content"},[t("div",{staticClass:"contract-title-page"},[t("div",{staticClass:"contract-header-info"},[t("div",{staticClass:"contract-number"},[e._v("合同编号："+e._s(e.form.contractNo||"提交后自动生成"))])]),t("div",{staticClass:"contract-main-title"},[t("h1",[e._v(e._s(e.form.contractName||"知识产权服务合同"))])]),t("div",{staticClass:"contract-parties"},[t("div",{staticClass:"parties-row"},[t("div",{staticClass:"party-section left-party"},[t("div",{staticClass:"party-label"},[e._v("甲方（委托方）：")]),t("div",{staticClass:"party-content"},[t("div",{staticClass:"party-name"},[e._v(e._s(e.customerName))]),t("div",{staticClass:"party-details"},[t("div",{staticClass:"detail-row"},[t("span",{staticClass:"detail-label"},[e._v("联系人：")]),t("span",{staticClass:"detail-value"},[e._v(e._s(e.partyAContactName))])]),t("div",{staticClass:"detail-row"},[t("span",{staticClass:"detail-label"},[e._v("联系电话：")]),t("span",{staticClass:"detail-value"},[e._v(e._s(e.form.partyAPhone))])]),t("div",{staticClass:"detail-row"},[t("span",{staticClass:"detail-label"},[e._v("电子邮箱：")]),t("span",{staticClass:"detail-value"},[e._v(e._s(e.form.partyAEmail))])]),t("div",{staticClass:"detail-row"},[t("span",{staticClass:"detail-label"},[e._v("地址：")]),t("span",{staticClass:"detail-value"},[e._v(e._s(e.form.partyAAddress))])])])])]),t("div",{staticClass:"party-section right-party"},[t("div",{staticClass:"party-label"},[e._v("乙方（服务方）：")]),t("div",{staticClass:"party-content"},[t("div",{staticClass:"party-name"},[e._v(e._s(e.partyBCompanyName))]),t("div",{staticClass:"party-details"},[t("div",{staticClass:"detail-row"},[t("span",{staticClass:"detail-label"},[e._v("法定代表人：")]),t("span",{staticClass:"detail-value"},[e._v(e._s(e.partyBSignerName))])]),t("div",{staticClass:"detail-row"},[t("span",{staticClass:"detail-label"},[e._v("联系电话：")]),t("span",{staticClass:"detail-value"},[e._v(e._s(e.form.partyBPhone))])]),t("div",{staticClass:"detail-row"},[t("span",{staticClass:"detail-label"},[e._v("地址：")]),t("span",{staticClass:"detail-value"},[e._v(e._s(e.form.partyBAddress))])])])])])])])]),t("div",{staticClass:"contract-content-page"},[t("div",{staticClass:"contract-preamble"},[t("p",{staticClass:"preamble-text"},[e._v(" 根据《中华人民共和国合同法》及相关法律法规的规定，甲乙双方在平等、自愿、公平、诚实信用的基础上， 就甲方委托乙方提供知识产权服务事宜，经协商一致，达成如下协议： ")])]),t("div",{staticClass:"contract-article"},[t("div",{staticClass:"article-title"},[e._v("第一条 服务内容")]),t("div",{staticClass:"article-content"},[t("p",[e._v("1.1 乙方为甲方提供以下知识产权服务：")]),t("div",{staticClass:"service-list"},[t("p",[e._v(e._s(e.getServiceTypeText()))])]),e.form.summary?t("div",{staticClass:"service-description"},[t("p",[e._v("1.2 服务详细说明：")]),t("p",{staticClass:"description-text"},[e._v(e._s(e.form.summary))])]):e._e()])]),e.form.serviceList&&e.form.serviceList.length>0?t("div",{staticClass:"contract-article"},[t("div",{staticClass:"article-title"},[e._v("第二条 服务明细")]),t("div",{staticClass:"article-content"},[t("table",{staticClass:"formal-table"},[t("thead",[t("tr",[t("th",{attrs:{width:"8%"}},[e._v("序号")]),t("th",{attrs:{width:"25%"}},[e._v("服务内容")]),t("th",{attrs:{width:"30%"}},[e._v("项目名称")]),t("th",{attrs:{width:"12%"}},[e._v("服务费(元)")]),t("th",{attrs:{width:"12%"}},[e._v("官费(元)")]),t("th",{attrs:{width:"13%"}},[e._v("备注")])])]),t("tbody",e._l(e.form.serviceList,(function(a,s){return t("tr",{key:s},[t("td",[e._v(e._s(s+1))]),t("td",[e._v(e._s(a.serviceName))]),t("td",[e._v(e._s(a.serviceDescription))]),t("td",{staticClass:"amount-cell"},[e._v(e._s(a.amount))]),t("td",{staticClass:"amount-cell"},[e._v(e._s(a.currency))]),t("td",[e._v(e._s(a.totalAmount))])])})),0)])])]):e._e(),t("div",{staticClass:"contract-article"},[t("div",{staticClass:"article-title"},[e._v("第三条 费用及支付")]),t("div",{staticClass:"article-content"},[t("div",{staticClass:"fee-summary"},[t("div",{staticClass:"fee-row"},[t("span",{staticClass:"fee-label"},[e._v("服务费：")]),t("span",{staticClass:"fee-amount"},[e._v("人民币 "+e._s(e.form.serviceFee)+" 元")])]),t("div",{staticClass:"fee-row"},[t("span",{staticClass:"fee-label"},[e._v("官费：")]),t("span",{staticClass:"fee-amount"},[e._v("人民币 "+e._s(e.form.officialFee)+" 元")])]),parseFloat(e.form.channelFee)>0?t("div",{staticClass:"fee-row"},[t("span",{staticClass:"fee-label"},[e._v("渠道费：")]),t("span",{staticClass:"fee-amount"},[e._v("人民币 "+e._s(e.form.channelFee)+" 元")])]):e._e(),t("div",{staticClass:"fee-row total-fee"},[t("span",{staticClass:"fee-label"},[e._v("合同总金额：")]),t("span",{staticClass:"fee-amount"},[e._v("人民币 "+e._s(e.form.totalAmount)+" 元")])])]),t("p",[e._v("3.1 甲方应按照约定的时间和方式支付上述费用。")]),t("p",[e._v("3.2 具体支付方式和时间安排另行约定。")])])]),t("div",{staticClass:"contract-article"},[t("div",{staticClass:"article-title"},[e._v("第四条 双方权利义务")]),t("div",{staticClass:"article-content"},[t("p",[e._v("4.1 甲方权利义务：")]),t("p",{staticClass:"sub-clause"},[e._v("（1）按时提供必要的技术资料和相关文件；")]),t("p",{staticClass:"sub-clause"},[e._v("（2）按约定支付服务费用；")]),t("p",{staticClass:"sub-clause"},[e._v("（3）配合乙方完成相关服务工作。")]),t("p",[e._v("4.2 乙方权利义务：")]),t("p",{staticClass:"sub-clause"},[e._v("（1）按照专业标准提供知识产权服务；")]),t("p",{staticClass:"sub-clause"},[e._v("（2）及时向甲方通报服务进展情况；")]),t("p",{staticClass:"sub-clause"},[e._v("（3）保守甲方商业秘密和技术秘密。")])])]),t("div",{staticClass:"contract-article"},[t("div",{staticClass:"article-title"},[e._v("第五条 合同期限")]),t("div",{staticClass:"article-content"},[e.form.validity&&2===e.form.validity.length?t("p",[e._v(" 本合同自 "+e._s(e.form.validity[0])+" 起至 "+e._s(e.form.validity[1])+" 止。 ")]):t("p",[e._v(" 本合同自双方签字盖章之日起生效。 ")])])]),e.form.additionalTerms?t("div",{staticClass:"contract-article"},[t("div",{staticClass:"article-title"},[e._v("第六条 其他约定")]),t("div",{staticClass:"article-content"},[t("p",[e._v(e._s(e.form.additionalTerms))])])]):e._e(),t("div",{staticClass:"contract-article"},[t("div",{staticClass:"article-title"},[e._v("第七条 争议解决")]),t("div",{staticClass:"article-content"},[t("p",[e._v("7.1 因履行本合同发生的争议，双方应友好协商解决。")]),t("p",[e._v("7.2 协商不成的，任何一方均可向合同签订地人民法院提起诉讼。")])])]),t("div",{staticClass:"contract-article"},[t("div",{staticClass:"article-title"},[e._v("第八条 合同生效")]),t("div",{staticClass:"article-content"},[t("p",[e._v("8.1 本合同一式两份，甲乙双方各执一份，具有同等法律效力。")]),t("p",[e._v("8.2 本合同自双方签字盖章之日起生效。")])])])]),t("div",{staticClass:"contract-signature-page"},[t("div",{staticClass:"signature-section"},[t("div",{staticClass:"signature-party left-signature"},[t("div",{staticClass:"signature-title"},[e._v("甲方（委托方）")]),t("div",{staticClass:"signature-content"},[t("div",{staticClass:"signature-row"},[t("span",{staticClass:"signature-label"},[e._v("单位名称：")]),t("span",{staticClass:"signature-value"},[e._v(e._s(e.customerName))])]),t("div",{staticClass:"signature-row"},[t("span",{staticClass:"signature-label"},[e._v("法定代表人：")]),t("span",{staticClass:"signature-value"},[e._v("_________________")])]),t("div",{staticClass:"signature-row"},[t("span",{staticClass:"signature-label"},[e._v("授权代表：")]),t("span",{staticClass:"signature-value"},[e._v(e._s(e.partyAContactName))])]),t("div",{staticClass:"signature-row"},[t("span",{staticClass:"signature-label"},[e._v("签字：")]),t("span",{staticClass:"signature-value"},[e._v("_________________")])]),t("div",{staticClass:"signature-row"},[t("span",{staticClass:"signature-label"},[e._v("日期：")]),t("span",{staticClass:"signature-value"},[e._v("_________________")])]),t("div",{staticClass:"signature-row"},[t("span",{staticClass:"signature-label"},[e._v("盖章：")]),t("span",{staticClass:"signature-value"},[e._v("_________________")])])])]),t("div",{staticClass:"signature-party right-signature"},[t("div",{staticClass:"signature-title"},[e._v("乙方（服务方）")]),t("div",{staticClass:"signature-content"},[t("div",{staticClass:"signature-row"},[t("span",{staticClass:"signature-label"},[e._v("单位名称：")]),t("span",{staticClass:"signature-value"},[e._v(e._s(e.partyBCompanyName))])]),t("div",{staticClass:"signature-row"},[t("span",{staticClass:"signature-label"},[e._v("法定代表人：")]),t("span",{staticClass:"signature-value"},[e._v(e._s(e.partyBSignerName))])]),t("div",{staticClass:"signature-row"},[t("span",{staticClass:"signature-label"},[e._v("授权代表：")]),t("span",{staticClass:"signature-value"},[e._v("_________________")])]),t("div",{staticClass:"signature-row"},[t("span",{staticClass:"signature-label"},[e._v("签字：")]),t("span",{staticClass:"signature-value"},[e._v("_________________")])]),t("div",{staticClass:"signature-row"},[t("span",{staticClass:"signature-label"},[e._v("日期：")]),t("span",{staticClass:"signature-value"},[e._v("_________________")])]),t("div",{staticClass:"signature-row"},[t("span",{staticClass:"signature-label"},[e._v("盖章：")]),t("span",{staticClass:"signature-value"},[e._v("_________________")])])])])])])]),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.contractPreviewVisible=!1}}},[e._v("关闭")]),t("el-button",{attrs:{type:"primary"},on:{click:e.printContract}},[e._v("打印合同")]),t("el-button",{attrs:{type:"success"},on:{click:e.exportContractPDF}},[e._v("导出PDF")])],1)]),t("el-dialog",{attrs:{title:"选择项目",visible:e.projectSelectVisible,width:"80%","append-to-body":""},on:{"update:visible":function(t){e.projectSelectVisible=t},open:e.handleProjectSelectOpen}},[t("div",{staticClass:"project-select-container"},[t("div",{staticClass:"search-area"},[t("el-row",{attrs:{gutter:20}},[t("el-col",{attrs:{span:8}},[t("el-input",{attrs:{placeholder:"请输入项目编号或名称",clearable:""},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.searchProjects.apply(null,arguments)}},model:{value:e.projectSelectQuery.keyword,callback:function(t){e.$set(e.projectSelectQuery,"keyword",t)},expression:"projectSelectQuery.keyword"}},[t("el-button",{attrs:{slot:"append",icon:"el-icon-search"},on:{click:e.searchProjects},slot:"append"})],1)],1),t("el-col",{attrs:{span:4}},[t("el-button",{attrs:{type:"primary"},on:{click:e.searchProjects}},[e._v("查询")]),t("el-button",{on:{click:e.resetProjectSearch}},[e._v("重置")])],1)],1)],1),t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.projectSelectLoading,expression:"projectSelectLoading"}],staticStyle:{width:"100%","margin-top":"20px"},attrs:{data:e.projectSelectList,border:"","highlight-current-row":""},on:{"row-click":e.handleProjectRowClick}},[t("el-table-column",{attrs:{type:"index",label:"序号",width:"60"}}),t("el-table-column",{attrs:{prop:"case_code",label:"项目编号",width:"180"}}),t("el-table-column",{attrs:{prop:"case_name",label:"项目名称","min-width":"200"}}),t("el-table-column",{attrs:{prop:"case_type",label:"项目类型",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e.getCaseTypeText(t.row.case_type))+" ")]}}])}),t("el-table-column",{attrs:{prop:"case_status",label:"项目状态",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e.getCaseStatusText(t.row.case_status))+" ")]}}])}),"专利"===e.currentCaseType?t("el-table-column",{attrs:{prop:"application_no",label:"申请号",width:"150"}}):e._e(),"商标"===e.currentCaseType?t("el-table-column",{attrs:{prop:"registration_no",label:"注册号",width:"150"}}):e._e(),"版权"===e.currentCaseType?t("el-table-column",{attrs:{prop:"acceptance_no",label:"受理号",width:"150"}}):e._e(),"科服"===e.currentCaseType?t("el-table-column",{attrs:{prop:"service_name",label:"服务名称",width:"150"}}):e._e(),t("el-table-column",{attrs:{label:"操作",width:"100",fixed:"right"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(t){return e.selectProject(a.row)}}},[e._v("选择")])]}}])})],1),t("el-pagination",{staticStyle:{"margin-top":"20px","text-align":"right"},attrs:{"current-page":e.projectSelectQuery.pageNum,"page-sizes":[10,20,50,100],"page-size":e.projectSelectQuery.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:e.projectSelectTotal},on:{"size-change":e.handleProjectSizeChange,"current-change":e.handleProjectCurrentChange}})],1),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.projectSelectVisible=!1}}},[e._v("取 消")])],1)]),t("el-dialog",{attrs:{title:"选择科技服务事项",visible:e.techServiceSelectVisible,width:"60%","append-to-body":""},on:{"update:visible":function(t){e.techServiceSelectVisible=t},open:e.handleTechServiceSelectOpen}},[t("div",{staticClass:"tech-service-select-container"},[t("el-tree",{directives:[{name:"loading",rawName:"v-loading",value:e.techServiceLoading,expression:"techServiceLoading"}],attrs:{data:e.techServiceTreeData,props:{children:"children",label:"label"},"node-key":"id","expand-on-click-node":!1,"check-on-click-node":!0,"show-checkbox":"","check-strictly":!0},on:{check:e.handleTechServiceCheck},scopedSlots:e._u([{key:"default",fn:function({node:a,data:s}){return t("span",{staticClass:"custom-tree-node"},[t("span",[e._v(e._s(a.label))]),s.description?t("span",{staticClass:"node-description"},[e._v("（"+e._s(s.description)+"）")]):e._e()])}}])})],1),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.techServiceSelectVisible=!1}}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.confirmTechServiceSelect}},[e._v("确 定")])],1)])],1)},o=[],r=(a("14d9"),a("e9f5"),a("910d"),a("f665"),a("ab43"),a("1e70"),a("79a4"),a("c1a1"),a("8b00"),a("a4e7"),a("1e5a"),a("72c3"),a("88a7"),a("271a"),a("5494"),a("512b")),i=a("48d0"),l=function(){var e=this,t=e._self._c;return t("el-dialog",{directives:[{name:"drag-dialog",rawName:"v-drag-dialog"}],attrs:{title:e.caseFormTitle,visible:e.visible,width:"80%","append-to-body":"","custom-class":"draggable-dialog"},on:{"update:visible":function(t){e.visible=t},close:e.handleClose}},[t("el-form",{ref:"caseFormRef",attrs:{model:e.caseForm,rules:e.caseFormRules,"label-width":"130px"}},[t("el-tabs",{model:{value:e.caseFormActiveTab,callback:function(t){e.caseFormActiveTab=t},expression:"caseFormActiveTab"}},[t("el-tab-pane",{attrs:{label:"基本信息",name:"basicInfo"}},[t("el-row",{attrs:{gutter:20}},[t("el-col",{attrs:{span:8}},[t("el-form-item",{attrs:{label:"客户名称",prop:"clientName"}},[t("el-input",{attrs:{placeholder:"自动带出",disabled:!0},model:{value:e.caseForm.clientName,callback:function(t){e.$set(e.caseForm,"clientName",t)},expression:"caseForm.clientName"}})],1)],1),t("el-col",{attrs:{span:8}},[t("el-form-item",{attrs:{label:"项目类型",prop:"caseType"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择"},on:{change:e.handleCaseTypeChange},model:{value:e.caseForm.caseType,callback:function(t){e.$set(e.caseForm,"caseType",t)},expression:"caseForm.caseType"}},[t("el-option",{attrs:{label:"专利",value:"专利"}}),t("el-option",{attrs:{label:"商标",value:"商标"}}),t("el-option",{attrs:{label:"版权",value:"版权"}}),t("el-option",{attrs:{label:"科服",value:"科服"}})],1)],1)],1),t("el-col",{attrs:{span:8}},[t("el-form-item",{attrs:{label:"申请国家(地区)",prop:"applyCountry"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择",filterable:""},on:{change:e.handleCountryChange},model:{value:e.caseForm.applyCountry,callback:function(t){e.$set(e.caseForm,"applyCountry",t)},expression:"caseForm.applyCountry"}},e._l(e.countryOptions,(function(e){return t("el-option",{key:e.short_code,attrs:{label:e.cn,value:e.short_code}})})),1)],1)],1)],1),t("el-row",{attrs:{gutter:20}},[t("el-col",{attrs:{span:8}},[t("el-form-item",{attrs:{label:"业务类型",prop:"businessType"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择",disabled:!e.caseForm.caseType},model:{value:e.caseForm.businessType,callback:function(t){e.$set(e.caseForm,"businessType",t)},expression:"caseForm.businessType"}},e._l(e.businessTypeOptions,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)],1),t("el-col",{attrs:{span:8}},[t("el-form-item",{attrs:{label:"申请类型",prop:"applyType"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择",disabled:!e.caseForm.caseType},on:{change:e.handleApplyTypeChange},model:{value:e.caseForm.applyType,callback:function(t){e.$set(e.caseForm,"applyType",t)},expression:"caseForm.applyType"}},e._l(e.applyTypeOptions,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)],1),t("el-col",{attrs:{span:8}},[t("el-form-item",{attrs:{label:"产品信息",prop:"productInfo"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择产品",disabled:!e.caseForm.caseType,filterable:""},model:{value:e.caseForm.productInfo,callback:function(t){e.$set(e.caseForm,"productInfo",t)},expression:"caseForm.productInfo"}},e._l(e.productOptions,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)],1)],1),t("el-row",{attrs:{gutter:20}},[t("el-col",{attrs:{span:8}},[t("el-form-item",{attrs:{label:"售前支持",prop:"presaleSupport"}},[t("SelectPerson",{attrs:{placeholder:"售前支持",clearable:"",size:"small"},model:{value:e.caseForm.presaleSupport,callback:function(t){e.$set(e.caseForm,"presaleSupport",t)},expression:"caseForm.presaleSupport"}})],1)],1)],1),t("el-row",{attrs:{gutter:20}},[t("el-col",{attrs:{span:8}},[t("el-form-item",{attrs:{label:"预项名称",prop:"preAwardName"}},[t("el-input",{attrs:{placeholder:"请输入预项名称"},model:{value:e.caseForm.preAwardName,callback:function(t){e.$set(e.caseForm,"preAwardName",t)},expression:"caseForm.preAwardName"}})],1)],1),t("el-col",{attrs:{span:8}},[t("el-form-item",{attrs:{label:"技术主导",prop:"techLeader"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择"},model:{value:e.caseForm.techLeader,callback:function(t){e.$set(e.caseForm,"techLeader",t)},expression:"caseForm.techLeader"}},e._l(e.techLeaderOptions,(function(e){return t("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1)],1),t("el-col",{attrs:{span:8}},[t("el-form-item",{attrs:{label:"资料对接-技术",prop:"techContact"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择"},model:{value:e.caseForm.techContact,callback:function(t){e.$set(e.caseForm,"techContact",t)},expression:"caseForm.techContact"}},e._l(e.techContactOptions,(function(e){return t("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1)],1)],1),t("el-row",{attrs:{gutter:20}},[t("el-col",{attrs:{span:8}},["商标"===e.caseForm.caseType?t("el-form-item",{attrs:{label:"商标类别",prop:"trademarkCategory"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择"},model:{value:e.caseForm.trademarkCategory,callback:function(t){e.$set(e.caseForm,"trademarkCategory",t)},expression:"caseForm.trademarkCategory"}},[t("el-option",{attrs:{label:"第01类",value:"第01类"}}),t("el-option",{attrs:{label:"第02类",value:"第02类"}}),t("el-option",{attrs:{label:"第03类",value:"第03类"}}),t("el-option",{attrs:{label:"第04类",value:"第04类"}}),t("el-option",{attrs:{label:"第05类",value:"第05类"}})],1)],1):e._e()],1),t("el-col",{attrs:{span:8}},["科服"===e.caseForm.caseType?t("el-form-item",{attrs:{label:"科技服务名称",prop:"techServiceName"}},[t("el-input",{staticStyle:{cursor:"pointer"},attrs:{placeholder:"请选择科技服务名称",readonly:"",disabled:e.caseForm.isAuthorized},on:{click:e.handleSelectTechService},model:{value:e.caseForm.techServiceNameDisplay,callback:function(t){e.$set(e.caseForm,"techServiceNameDisplay",t)},expression:"caseForm.techServiceNameDisplay"}},[t("el-button",{attrs:{slot:"append",icon:"el-icon-search",disabled:e.caseForm.isAuthorized},on:{click:e.handleSelectTechService},slot:"append"})],1)],1):e._e()],1)],1),t("el-row",{attrs:{gutter:20}},[t("el-col",{attrs:{span:8}},[t("el-form-item",{attrs:{label:"是否已有项目",prop:"isAuthorized"}},[t("el-radio-group",{model:{value:e.caseForm.isAuthorized,callback:function(t){e.$set(e.caseForm,"isAuthorized",t)},expression:"caseForm.isAuthorized"}},[t("el-radio",{attrs:{label:!0}},[e._v("是")]),t("el-radio",{attrs:{label:!1}},[e._v("否")])],1)],1)],1),e.caseForm.isAuthorized?t("el-col",{attrs:{span:8}},[t("el-form-item",{attrs:{label:"项目编号",prop:"projectNo"}},[t("el-input",{staticStyle:{cursor:"pointer"},attrs:{placeholder:"请选择项目编号",readonly:""},on:{click:e.handleSelectProject},model:{value:e.caseForm.projectNoDisplay,callback:function(t){e.$set(e.caseForm,"projectNoDisplay",t)},expression:"caseForm.projectNoDisplay"}},[t("el-button",{attrs:{slot:"append",icon:"el-icon-search"},on:{click:e.handleSelectProject},slot:"append"})],1)],1)],1):e._e(),"专利"===e.caseForm.caseType?t("el-col",{attrs:{span:8}},[t("el-form-item",{attrs:{label:"申请号",prop:"applyNo"}},[t("el-input",{attrs:{placeholder:"请输入申请号",disabled:e.caseForm.isAuthorized||"普通新申请"===e.caseForm.businessType},model:{value:e.caseForm.applyNo,callback:function(t){e.$set(e.caseForm,"applyNo",t)},expression:"caseForm.applyNo"}})],1)],1):e._e(),"商标"===e.caseForm.caseType?t("el-col",{attrs:{span:8}},[t("el-form-item",{attrs:{label:"注册号",prop:"registrationNo"}},[t("el-input",{attrs:{placeholder:"请输入注册号",disabled:e.caseForm.isAuthorized},model:{value:e.caseForm.registrationNo,callback:function(t){e.$set(e.caseForm,"registrationNo",t)},expression:"caseForm.registrationNo"}})],1)],1):e._e(),"版权"===e.caseForm.caseType?t("el-col",{attrs:{span:8}},[t("el-form-item",{attrs:{label:"受理号",prop:"acceptanceNo"}},[t("el-input",{attrs:{placeholder:"请输入受理号",disabled:e.caseForm.isAuthorized},model:{value:e.caseForm.acceptanceNo,callback:function(t){e.$set(e.caseForm,"acceptanceNo",t)},expression:"caseForm.acceptanceNo"}})],1)],1):e._e()],1),t("el-form-item",{attrs:{label:"项目备注",prop:"remark"}},[t("el-input",{attrs:{type:"textarea",maxlength:"300","show-word-limit":"",placeholder:"请输入项目备注",rows:4},model:{value:e.caseForm.remark,callback:function(t){e.$set(e.caseForm,"remark",t)},expression:"caseForm.remark"}})],1)],1),t("el-tab-pane",{attrs:{label:"费用信息",name:"feeInfo"}},[t("div",{staticClass:"fee-form-section"},[t("div",{staticClass:"section-header"},[t("span",{staticClass:"section-title"},[e._v("服务费")]),t("el-button",{attrs:{size:"small",type:"primary",icon:"el-icon-plus"},on:{click:e.openServiceFeeDialog}},[e._v("添加服务费")])],1),t("el-table",{staticStyle:{width:"100%"},attrs:{data:e.caseForm.serviceFees,border:""}},[t("el-table-column",{attrs:{prop:"feeName",label:"费用名称",width:"150"}}),t("el-table-column",{attrs:{prop:"feeDescription",label:"项目名称",width:"200"}}),t("el-table-column",{attrs:{prop:"amount",label:"服务费",width:"120"}}),t("el-table-column",{attrs:{prop:"currency",label:"币种",width:"80"}}),t("el-table-column",{attrs:{prop:"remarks",label:"备注","min-width":"150"}}),t("el-table-column",{attrs:{label:"操作",width:"200"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-button",{attrs:{size:"mini"},on:{click:function(t){return e.editServiceFee(a.$index)}}},[e._v("编辑")]),t("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(t){return e.removeServiceFee(a.$index)}}},[e._v("删除")])]}}])})],1)],1),t("div",{staticClass:"fee-form-section"},[t("div",{staticClass:"section-header"},[t("span",{staticClass:"section-title"},[e._v("官费")]),t("el-button",{attrs:{size:"small",type:"primary",icon:"el-icon-plus"},on:{click:e.openOfficialFeeDialog}},[e._v("添加官费")])],1),t("el-table",{staticStyle:{width:"100%"},attrs:{data:e.caseForm.officialFees,border:""}},[t("el-table-column",{attrs:{prop:"feeName",label:"费用名称",width:"150"}}),t("el-table-column",{attrs:{prop:"feeDescription",label:"费用描述",width:"200"}}),t("el-table-column",{attrs:{prop:"amount",label:"金额",width:"120"}}),t("el-table-column",{attrs:{prop:"currency",label:"币种",width:"80"}}),t("el-table-column",{attrs:{prop:"dueDate",label:"缴费期限",width:"120"}}),t("el-table-column",{attrs:{prop:"remarks",label:"备注","min-width":"150"}}),t("el-table-column",{attrs:{label:"操作",width:"200"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-button",{attrs:{size:"mini"},on:{click:function(t){return e.editOfficialFee(a.$index)}}},[e._v("编辑")]),t("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(t){return e.removeOfficialFee(a.$index)}}},[e._v("删除")])]}}])})],1)],1)]),t("el-tab-pane",{attrs:{label:"附件信息",name:"caseAttachmentInfo"}},[t("div",{staticClass:"case-attachment-container"},[t("div",{staticClass:"attachment-header"},[t("el-button",{attrs:{size:"small",type:"primary"},on:{click:e.openAttachmentDialog}},[e._v("新增附件")])],1),t("el-table",{staticStyle:{width:"100%"},attrs:{data:e.caseForm.attachments,border:""}},[t("el-table-column",{attrs:{prop:"file_type",label:"文件大类",width:"120"}}),t("el-table-column",{attrs:{prop:"file_sub_type",label:"文件小类",width:"120"}}),t("el-table-column",{attrs:{prop:"file_desc",label:"文件描述","min-width":"200"}}),t("el-table-column",{attrs:{prop:"file_name",label:"文件名称","min-width":"200"}}),t("el-table-column",{attrs:{label:"操作",width:"150"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-button",{attrs:{size:"mini"},on:{click:function(t){return e.downloadCaseAttachment(a.row)}}},[e._v("下载")]),t("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(t){return e.removeCaseAttachment(a.$index)}}},[e._v("删除")])]}}])})],1)],1)])],1)],1),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:e.handleCancel}},[e._v("取 消")]),t("el-button",{attrs:{size:"small",type:"primary",loading:e.caseFormSubmitting},on:{click:e.submitCaseForm}},[e._v("确 定")])],1),t("el-dialog",{attrs:{title:"添加服务费",visible:e.serviceFeeDialogVisible,width:"600px","append-to-body":""},on:{"update:visible":function(t){e.serviceFeeDialogVisible=t}}},[t("el-form",{attrs:{model:e.currentFeeForm,"label-width":"100px"}},[t("el-form-item",{attrs:{label:"费用名称"}},[t("el-input",{attrs:{placeholder:"请输入费用名称"},model:{value:e.currentFeeForm.feeName,callback:function(t){e.$set(e.currentFeeForm,"feeName",t)},expression:"currentFeeForm.feeName"}})],1),t("el-form-item",{attrs:{label:"项目名称"}},[t("el-input",{attrs:{placeholder:"请输入项目名称"},model:{value:e.currentFeeForm.feeDescription,callback:function(t){e.$set(e.currentFeeForm,"feeDescription",t)},expression:"currentFeeForm.feeDescription"}})],1),t("el-form-item",{attrs:{label:"服务费"}},[t("el-input",{attrs:{placeholder:"0.00",type:"number"},model:{value:e.currentFeeForm.amount,callback:function(t){e.$set(e.currentFeeForm,"amount",t)},expression:"currentFeeForm.amount"}})],1),t("el-form-item",{attrs:{label:"币种"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"币种"},model:{value:e.currentFeeForm.currency,callback:function(t){e.$set(e.currentFeeForm,"currency",t)},expression:"currentFeeForm.currency"}},[t("el-option",{attrs:{label:"RMB",value:"RMB"}}),t("el-option",{attrs:{label:"USD",value:"USD"}}),t("el-option",{attrs:{label:"EUR",value:"EUR"}})],1)],1),t("el-form-item",{attrs:{label:"备注"}},[t("el-input",{attrs:{placeholder:"备注"},model:{value:e.currentFeeForm.remarks,callback:function(t){e.$set(e.currentFeeForm,"remarks",t)},expression:"currentFeeForm.remarks"}})],1)],1),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.serviceFeeDialogVisible=!1}}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.saveServiceFee}},[e._v("确 定")])],1)],1),t("el-dialog",{attrs:{title:"添加官费",visible:e.officialFeeDialogVisible,width:"600px","append-to-body":""},on:{"update:visible":function(t){e.officialFeeDialogVisible=t}}},[t("el-form",{attrs:{model:e.currentFeeForm,"label-width":"100px"}},[t("el-form-item",{attrs:{label:"费用名称"}},[t("el-input",{attrs:{placeholder:"请输入费用名称"},model:{value:e.currentFeeForm.feeName,callback:function(t){e.$set(e.currentFeeForm,"feeName",t)},expression:"currentFeeForm.feeName"}})],1),t("el-form-item",{attrs:{label:"费用描述"}},[t("el-input",{attrs:{placeholder:"请输入费用描述"},model:{value:e.currentFeeForm.feeDescription,callback:function(t){e.$set(e.currentFeeForm,"feeDescription",t)},expression:"currentFeeForm.feeDescription"}})],1),t("el-form-item",{attrs:{label:"金额"}},[t("el-input",{attrs:{placeholder:"0.00",type:"number"},model:{value:e.currentFeeForm.amount,callback:function(t){e.$set(e.currentFeeForm,"amount",t)},expression:"currentFeeForm.amount"}})],1),t("el-form-item",{attrs:{label:"币种"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"币种"},model:{value:e.currentFeeForm.currency,callback:function(t){e.$set(e.currentFeeForm,"currency",t)},expression:"currentFeeForm.currency"}},[t("el-option",{attrs:{label:"RMB",value:"RMB"}}),t("el-option",{attrs:{label:"USD",value:"USD"}}),t("el-option",{attrs:{label:"EUR",value:"EUR"}})],1)],1),t("el-form-item",{attrs:{label:"备注"}},[t("el-input",{attrs:{placeholder:"备注"},model:{value:e.currentFeeForm.remarks,callback:function(t){e.$set(e.currentFeeForm,"remarks",t)},expression:"currentFeeForm.remarks"}})],1)],1),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.officialFeeDialogVisible=!1}}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.saveOfficialFee}},[e._v("确 定")])],1)],1),t("el-dialog",{attrs:{title:"新增附件",visible:e.attachmentDialogVisible,width:"600px","append-to-body":""},on:{"update:visible":function(t){e.attachmentDialogVisible=t}}},[t("el-form",{attrs:{model:e.currentAttachmentForm,"label-width":"100px"}},[t("el-form-item",{attrs:{label:"文件大类"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"选择大类"},on:{change:e.handleAttachmentFileTypeChange},model:{value:e.currentAttachmentForm.file_type,callback:function(t){e.$set(e.currentAttachmentForm,"file_type",t)},expression:"currentAttachmentForm.file_type"}},e._l(e.fileTypeOptions,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),t("el-form-item",{attrs:{label:"文件小类"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"选择小类",disabled:!e.currentAttachmentForm.file_type},on:{change:e.handleAttachmentFileSubTypeChange},model:{value:e.currentAttachmentForm.file_sub_type,callback:function(t){e.$set(e.currentAttachmentForm,"file_sub_type",t)},expression:"currentAttachmentForm.file_sub_type"}},e._l(e.getFileSubTypeOptions(e.currentAttachmentForm.file_type),(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),t("el-form-item",{attrs:{label:"文件描述"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择文件描述",disabled:!e.currentAttachmentForm.file_sub_type},model:{value:e.currentAttachmentForm.file_desc,callback:function(t){e.$set(e.currentAttachmentForm,"file_desc",t)},expression:"currentAttachmentForm.file_desc"}},e._l(e.getFileDescriptionOptions(e.currentAttachmentForm.file_type,e.currentAttachmentForm.file_sub_type),(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),t("el-form-item",{attrs:{label:"文件上传"}},[t("el-upload",{attrs:{action:e.uploadUrl,headers:e.uploadHeaders,"on-success":e.handleAttachmentUploadSuccess,"on-error":e.handleAttachmentUploadError,"before-upload":e.beforeAttachmentUpload,"show-file-list":!1,accept:"*"}},[t("el-button",{attrs:{size:"small",type:"primary",icon:"el-icon-upload",loading:e.attachmentUploading}},[e._v(" "+e._s(e.currentAttachmentForm.file_name?"重新上传":"选择文件")+" ")])],1),e.currentAttachmentForm.file_name?t("div",{staticStyle:{"margin-top":"5px","font-size":"12px",color:"#666"}},[e._v(" 已上传："+e._s(e.currentAttachmentForm.file_name)+" ")]):e._e()],1)],1),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.attachmentDialogVisible=!1}}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.handleAddCaseAttachment}},[e._v("确 定")])],1)],1),t("el-dialog",{attrs:{title:"添加服务费",visible:e.serviceFeeDialogVisible,width:"600px","append-to-body":""},on:{"update:visible":function(t){e.serviceFeeDialogVisible=t}}},[t("el-form",{attrs:{model:e.currentFeeForm,"label-width":"100px"}},[t("el-form-item",{attrs:{label:"费用名称"}},[t("el-input",{attrs:{placeholder:"请输入费用名称"},model:{value:e.currentFeeForm.feeName,callback:function(t){e.$set(e.currentFeeForm,"feeName",t)},expression:"currentFeeForm.feeName"}})],1),t("el-form-item",{attrs:{label:"项目名称"}},[t("el-input",{attrs:{placeholder:"请输入项目名称"},model:{value:e.currentFeeForm.feeDescription,callback:function(t){e.$set(e.currentFeeForm,"feeDescription",t)},expression:"currentFeeForm.feeDescription"}})],1),t("el-form-item",{attrs:{label:"服务费"}},[t("el-input",{attrs:{placeholder:"0.00",type:"number"},model:{value:e.currentFeeForm.amount,callback:function(t){e.$set(e.currentFeeForm,"amount",t)},expression:"currentFeeForm.amount"}})],1),t("el-form-item",{attrs:{label:"币种"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"币种"},model:{value:e.currentFeeForm.currency,callback:function(t){e.$set(e.currentFeeForm,"currency",t)},expression:"currentFeeForm.currency"}},[t("el-option",{attrs:{label:"RMB",value:"RMB"}}),t("el-option",{attrs:{label:"USD",value:"USD"}}),t("el-option",{attrs:{label:"EUR",value:"EUR"}})],1)],1),t("el-form-item",{attrs:{label:"备注"}},[t("el-input",{attrs:{placeholder:"备注"},model:{value:e.currentFeeForm.remarks,callback:function(t){e.$set(e.currentFeeForm,"remarks",t)},expression:"currentFeeForm.remarks"}})],1)],1),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.serviceFeeDialogVisible=!1}}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.saveServiceFee}},[e._v("确 定")])],1)],1),t("el-dialog",{attrs:{title:"添加官费",visible:e.officialFeeDialogVisible,width:"600px","append-to-body":""},on:{"update:visible":function(t){e.officialFeeDialogVisible=t}}},[t("el-form",{attrs:{model:e.currentFeeForm,"label-width":"100px"}},[t("el-form-item",{attrs:{label:"费用名称"}},[t("el-input",{attrs:{placeholder:"请输入费用名称"},model:{value:e.currentFeeForm.feeName,callback:function(t){e.$set(e.currentFeeForm,"feeName",t)},expression:"currentFeeForm.feeName"}})],1),t("el-form-item",{attrs:{label:"费用描述"}},[t("el-input",{attrs:{placeholder:"请输入费用描述"},model:{value:e.currentFeeForm.feeDescription,callback:function(t){e.$set(e.currentFeeForm,"feeDescription",t)},expression:"currentFeeForm.feeDescription"}})],1),t("el-form-item",{attrs:{label:"金额"}},[t("el-input",{attrs:{placeholder:"0.00",type:"number"},model:{value:e.currentFeeForm.amount,callback:function(t){e.$set(e.currentFeeForm,"amount",t)},expression:"currentFeeForm.amount"}})],1),t("el-form-item",{attrs:{label:"币种"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"币种"},model:{value:e.currentFeeForm.currency,callback:function(t){e.$set(e.currentFeeForm,"currency",t)},expression:"currentFeeForm.currency"}},[t("el-option",{attrs:{label:"RMB",value:"RMB"}}),t("el-option",{attrs:{label:"USD",value:"USD"}}),t("el-option",{attrs:{label:"EUR",value:"EUR"}})],1)],1),t("el-form-item",{attrs:{label:"缴费期限"}},[t("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"date",placeholder:"选择日期"},model:{value:e.currentFeeForm.dueDate,callback:function(t){e.$set(e.currentFeeForm,"dueDate",t)},expression:"currentFeeForm.dueDate"}})],1),t("el-form-item",{attrs:{label:"备注"}},[t("el-input",{attrs:{placeholder:"备注"},model:{value:e.currentFeeForm.remarks,callback:function(t){e.$set(e.currentFeeForm,"remarks",t)},expression:"currentFeeForm.remarks"}})],1)],1),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.officialFeeDialogVisible=!1}}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.saveOfficialFee}},[e._v("确 定")])],1)],1)],1)},c=[],n=(a("7d54"),a("f6b0")),d=a("89c4"),p=a("d3ff"),m=a("a417"),u={name:"AddCaseDialog",components:{SelectPerson:r["a"]},props:{visible:{type:Boolean,default:!1},customerName:{type:String,default:""},customerId:{type:[String,Number],default:null},mode:{type:String,default:"add"},caseData:{type:Object,default:()=>({})}},data(){return{caseFormTitle:"新增项目",caseFormActiveTab:"basicInfo",caseFormSubmitting:!1,caseForm:{id:void 0,clientName:"",caseType:"",businessType:"",applyType:"",applyCountry:"",presaleSupport:"",preAwardName:"",techLeader:"",techContact:"",trademarkCategory:"",techServiceName:"",techServiceNameDisplay:"",isAuthorized:!1,projectNo:"",projectNoDisplay:"",applyNo:"",registrationNo:"",acceptanceNo:"",productInfo:"",remark:"",serviceFees:[],officialFees:[],attachments:[]},caseFormRules:{caseType:[{required:!0,message:"请选择项目类型",trigger:"change"}],applyCountry:[{required:!0,message:"请选择申请国家",trigger:"change"}],businessType:[{required:!0,message:"请选择业务类型",trigger:"change"}],preAwardName:[{required:!0,message:"请输入预项名称",trigger:"blur"}],techLeader:[{required:!0,message:"请选择技术主导",trigger:"change"}]},countryOptions:[],businessTypeOptions:[],applyTypeOptions:[],productOptions:[],techLeaderOptions:[],techContactOptions:[],fileTypeOptions:[],fileSubTypeOptions:{},fileDescriptionOptions:{},serviceFeeDialogVisible:!1,officialFeeDialogVisible:!1,attachmentDialogVisible:!1,currentFeeForm:{},currentAttachmentForm:{},editingFeeIndex:-1,editingFeeType:"",fileList:[],attachmentUploading:!1}},computed:{uploadUrl(){return m["a"].host+"/api/upload"},uploadHeaders(){return{Authorization:localStorage.getItem("token")||sessionStorage.getItem("token")||""}}},watch:{visible(e){e&&this.initDialog()},mode(){this.updateTitle()}},mounted(){this.initializeCountryOptions(),this.loadFileTypeOptions()},methods:{initDialog(){this.updateTitle(),this.resetCaseForm(),"add"===this.mode?this.caseForm.clientName=this.customerName:"edit"!==this.mode&&"copy"!==this.mode||this.loadCaseData(),this.loadTechLeaderOptions(),this.caseForm.caseType?(this.loadBusinessTypeOptions(this.caseForm.caseType),this.loadApplyTypeOptions(this.caseForm.caseType),this.loadProductOptions(this.caseForm.caseType,this.caseForm.applyType)):(this.businessTypeOptions=[],this.applyTypeOptions=[],this.productOptions=[])},updateTitle(){switch(this.mode){case"add":this.caseFormTitle="新增项目";break;case"edit":this.caseFormTitle="编辑项目";break;case"copy":this.caseFormTitle="复制项目";break;default:this.caseFormTitle="新增项目"}},loadCaseData(){if(this.caseData&&Object.keys(this.caseData).length>0){const e=this.caseData;this.caseForm={id:"copy"===this.mode?void 0:e.id,clientName:this.customerName,caseType:e.case_type||"",businessType:e.case_subtype||"",applyType:e.application_type||"",applyCountry:e.country_code||"",presaleSupport:e.presale_support||"",preAwardName:e.case_name||"",techLeader:e.tech_leader||"",techContact:e.tech_contact||"",trademarkCategory:e.trademark_category||"",isAuthorized:1===e.is_authorized,techServiceName:e.tech_service_name||"",techServiceNameDisplay:e.tech_service_name||"",projectNo:e.project_no||"",projectNoDisplay:e.project_no||"",applyNo:e.application_no||"",registrationNo:e.registration_no||"",acceptanceNo:e.acceptance_no||"",productInfo:e.product_id||"",remark:e.case_description||"",serviceFees:this.formatFeeData(e.service_fees||[]),officialFees:this.formatFeeData(e.official_fees||[]),attachments:this.formatAttachmentData(e.attachments||[])}}},initializeCountryOptions(){this.countryOptions=p["a"]||[]},handleCaseTypeChange(e){this.caseForm.businessType="",this.caseForm.applyType="",this.caseForm.applyNo="",this.caseForm.registrationNo="",this.caseForm.acceptanceNo="",this.caseForm.trademarkCategory="",this.caseForm.techServiceName="",this.caseForm.productInfo="",this.loadBusinessTypeOptions(e),this.loadApplyTypeOptions(e),this.loadProductOptions(e)},handleCountryChange(e){console.log("国家变化:",e)},handleApplyTypeChange(e){this.caseForm.productInfo="",this.loadProductOptions(this.caseForm.caseType,e)},async loadBusinessTypeOptions(e){if(e)try{const t=await d["a"].businessService.getList({category:e,status:1,page:1,limit:999});console.log("业务类型API响应:",t.data),t.data&&0===t.data.code?(this.businessTypeOptions=t.data.data.list.map(e=>({label:e.name,value:e.name})),console.log("业务类型选项:",this.businessTypeOptions)):console.error("业务类型API返回错误:",t.data)}catch(t){console.error("加载业务类型选项失败:",t),this.businessTypeOptions=[]}else this.businessTypeOptions=[]},async loadApplyTypeOptions(e){if(e)try{const t={case_type:e,page:1,limit:999},a=await d["a"].applyType.getList(t);console.log("申请类型API响应:",a.data),a.data&&0===a.data.code?(this.applyTypeOptions=a.data.data.list.map(e=>({label:e.applyTypeName,value:e.applyTypeName})),console.log("申请类型选项:",this.applyTypeOptions)):console.error("申请类型API返回错误:",a.data)}catch(t){console.error("加载申请类型选项失败:",t),this.applyTypeOptions=[]}else this.applyTypeOptions=[]},async loadProductOptions(e,t=null){if(e)try{const a={case_type:[e],is_valid:1,page:1,limit:999};t&&(a.apply_type=t);const s=await d["a"].product.getList(a);console.log("产品信息API响应:",s.data),s.data&&0===s.data.code?(this.productOptions=s.data.data.list.map(e=>({label:`${e.productName}${e.specification?` (${e.specification})`:""}`,value:e.id,productCode:e.productCode,productName:e.productName,specification:e.specification,officialFee:e.officialFee,standardPrice:e.standardPrice,minPrice:e.minPrice})),console.log("产品信息选项:",this.productOptions)):console.error("产品信息API返回错误:",s.data)}catch(a){console.error("加载产品信息选项失败:",a),this.productOptions=[]}else this.productOptions=[]},async loadTechLeaderOptions(){try{if(!this.customerId)return this.techLeaderOptions=[],void(this.techContactOptions=[]);const e=await n["a"].getContactList({customer_id:this.customerId,contact_type:"技术主导"});if(e.data&&e.data.success){const t=e.data.data.list||[];this.techLeaderOptions=t.map(e=>({id:e.id,name:e.name||e.contact_name,contactType:e.contactType||e.contact_type_text})),this.techContactOptions=[...this.techLeaderOptions]}}catch(e){console.error("加载技术主导选项失败:",e),this.techLeaderOptions=[],this.techContactOptions=[]}},handleSelectTechService(){this.$emit("select-tech-service")},handleSelectProject(){this.caseForm.caseType?this.$emit("select-project",this.caseForm.caseType):this.$message.warning("请先选择项目类型")},openServiceFeeDialog(){this.currentFeeForm={feeName:"",feeDescription:"",amount:"",currency:"RMB",remarks:""},this.editingFeeIndex=-1,this.editingFeeType="service",this.serviceFeeDialogVisible=!0},editServiceFee(e){this.currentFeeForm={...this.caseForm.serviceFees[e]},this.editingFeeIndex=e,this.editingFeeType="service",this.serviceFeeDialogVisible=!0},saveServiceFee(){this.currentFeeForm.feeName&&this.currentFeeForm.amount?(this.editingFeeIndex>=0?this.$set(this.caseForm.serviceFees,this.editingFeeIndex,{...this.currentFeeForm}):this.caseForm.serviceFees.push({...this.currentFeeForm}),this.serviceFeeDialogVisible=!1,this.$message.success("服务费保存成功")):this.$message.error("费用名称和金额不能为空")},addServiceFee(){this.caseForm.serviceFees.push({...this.currentFeeForm}),this.serviceFeeDialogVisible=!1},removeServiceFee(e){this.caseForm.serviceFees.splice(e,1)},openOfficialFeeDialog(){this.currentFeeForm={feeName:"",feeDescription:"",amount:"",currency:"RMB",dueDate:"",remarks:""},this.editingFeeIndex=-1,this.editingFeeType="official",this.officialFeeDialogVisible=!0},editOfficialFee(e){this.currentFeeForm={...this.caseForm.officialFees[e]},this.editingFeeIndex=e,this.editingFeeType="official",this.officialFeeDialogVisible=!0},saveOfficialFee(){this.currentFeeForm.feeName&&this.currentFeeForm.amount?(this.editingFeeIndex>=0?this.$set(this.caseForm.officialFees,this.editingFeeIndex,{...this.currentFeeForm}):this.caseForm.officialFees.push({...this.currentFeeForm}),this.officialFeeDialogVisible=!1,this.$message.success("官费保存成功")):this.$message.error("费用名称和金额不能为空")},addOfficialFee(){this.caseForm.officialFees.push({...this.currentFeeForm}),this.officialFeeDialogVisible=!1},removeOfficialFee(e){this.caseForm.officialFees.splice(e,1)},openAttachmentDialog(){this.currentAttachmentForm={file_type:"",file_sub_type:"",file_desc:"",file_name:"",file_path:"",file_size:0,file:null},this.fileList=[],this.attachmentDialogVisible=!0},handleAddCaseAttachment(){this.currentAttachmentForm.file_type&&this.currentAttachmentForm.file_sub_type&&this.currentAttachmentForm.file_desc?this.currentAttachmentForm.file_path?(this.caseForm.attachments.push({...this.currentAttachmentForm,upload_time:(new Date).toISOString(),uploader:"当前用户"}),this.attachmentDialogVisible=!1,this.$message.success("附件添加成功")):this.$message.error("请先上传文件"):this.$message.error("文件大类、小类和描述不能为空")},removeCaseAttachment(e){this.caseForm.attachments.splice(e,1)},beforeAttachmentUpload(e){const t=e.size/1024/1024<50;return t||this.$message.error("上传文件大小不能超过 50MB!"),t},handleAttachmentUploadSuccess(e,t){this.attachmentUploading=!1,e.success?(this.currentAttachmentForm.file_name=t.name,this.currentAttachmentForm.file_path=e.data.file_path||e.data.path,this.currentAttachmentForm.file_size=t.size,this.$message.success("文件上传成功")):this.$message.error(e.message||"文件上传失败")},handleAttachmentUploadError(e){this.attachmentUploading=!1,console.error("文件上传失败:",e),this.$message.error("文件上传失败")},getFileSubTypeOptions(e){return this.fileSubTypeOptions[e]||[]},getFileDescriptionOptions(e,t){const a=`${e||""}::${t||""}`;return this.fileDescriptionOptions[a]||[]},async handleFileTypeChange(e,t){e.file_sub_type="",await this.loadFileSubTypeOptions(e.file_type)},handleFileUploadSuccess(e,t,a){e.success?(this.caseForm.attachments[a].file_name=t.name,this.caseForm.attachments[a].file_path=e.data.path,this.caseForm.attachments[a].file_size=t.size,this.$message.success("文件上传成功")):this.$message.error("文件上传失败："+e.message)},handleFileUploadError(e){this.$message.error("文件上传失败"),console.error("文件上传失败:",e)},beforeFileUpload(e){const t=e.size/1024/1024<50;return t||this.$message.error("上传文件大小不能超过 50MB!"),t},downloadCaseAttachment(e){e.file_path&&window.open(e.file_path)},async handleAttachmentFileTypeChange(e){this.currentAttachmentForm.file_sub_type="",this.currentAttachmentForm.file_desc="",await this.loadFileSubTypeOptions(e)},async handleAttachmentFileSubTypeChange(e){this.currentAttachmentForm.file_desc="",await this.loadFileDescriptionOptions(this.currentAttachmentForm.file_type,e),this.$nextTick(()=>{this.$forceUpdate()})},resetCaseForm(){this.caseForm={id:void 0,clientName:"",caseType:"",businessType:"",applyType:"",applyCountry:"",presaleSupport:"",preAwardName:"",techLeader:"",techContact:"",trademarkCategory:"",techServiceName:"",techServiceNameDisplay:"",isAuthorized:!1,projectNo:"",projectNoDisplay:"",applyNo:"",registrationNo:"",acceptanceNo:"",productInfo:"",remark:"",serviceFees:[],officialFees:[],attachments:[]},this.$refs.caseFormRef&&this.$refs.caseFormRef.clearValidate()},async submitCaseForm(){try{const t=await this.$refs.caseFormRef.validate();if(!t)return void this.$message.error("请完善必填信息");this.caseFormSubmitting=!0;const a={"专利":1,"商标":2,"版权":3,"科服":4},s=this.countryOptions.find(e=>e.short_code===this.caseForm.applyCountry),o=s?s.cn:this.caseForm.applyCountry,r={customer_id:this.customerId,contract_id:this.$route.query.id,case_name:this.caseForm.preAwardName,case_type:a[this.caseForm.caseType]||this.caseForm.caseType,case_subtype:this.caseForm.businessType,application_type:this.caseForm.applyType,country_code:o,application_no:this.caseForm.applyNo,registration_no:this.caseForm.registrationNo,acceptance_no:this.caseForm.acceptanceNo,case_status:"add"===this.mode?2:void 0,presale_support:""!==this.caseForm.presaleSupport&&null!==this.caseForm.presaleSupport&&void 0!==this.caseForm.presaleSupport?Number(this.caseForm.presaleSupport):void 0,tech_leader:""!==this.caseForm.techLeader&&null!==this.caseForm.techLeader&&void 0!==this.caseForm.techLeader?Number(this.caseForm.techLeader):void 0,tech_contact:""!==this.caseForm.techContact&&null!==this.caseForm.techContact&&void 0!==this.caseForm.techContact?Number(this.caseForm.techContact):void 0,is_authorized:"boolean"===typeof this.caseForm.isAuthorized?this.caseForm.isAuthorized?1:0:void 0,project_no:this.caseForm.projectNo||void 0,tech_service_name:this.caseForm.techServiceName||void 0,trademark_category:this.caseForm.trademarkCategory||void 0,product_id:""!==this.caseForm.productInfo&&null!==this.caseForm.productInfo&&void 0!==this.caseForm.productInfo?Number(this.caseForm.productInfo):void 0,case_description:this.caseForm.remark,service_fees:this.caseForm.serviceFees||[],official_fees:this.caseForm.officialFees||[],attachments:this.caseForm.attachments||[]};let i;var e;if(Object.keys(r).forEach(e=>{""!==r[e]&&null!==r[e]&&void 0!==r[e]||delete r[e]}),i="edit"===this.mode&&this.caseForm.id?await n["a"].updateContractCaseRecord(this.caseForm.id,r):await n["a"].createContractCaseRecord(r),i.data&&i.data.success)this.$message.success("edit"===this.mode?"项目更新成功":"项目创建成功"),this.$emit("success",i.data.data),this.handleClose();else this.$message.error(("edit"===this.mode?"项目更新失败：":"项目创建失败：")+((null===(e=i.data)||void 0===e?void 0:e.message)||"未知错误"))}catch(t){console.error("提交项目表单失败:",t),this.$message.error("edit"===this.mode?"项目更新失败，请重试":"项目创建失败，请重试")}finally{this.caseFormSubmitting=!1}},handleCancel(){this.handleClose()},handleClose(){this.$emit("update:visible",!1),this.$emit("close")},setSelectedProject(e){this.caseForm.projectNo=e.id,this.caseForm.projectNoDisplay=`${e.case_code} - ${e.case_name}`,"专利"===this.caseForm.caseType&&e.application_no?this.caseForm.applyNo=e.application_no:"商标"===this.caseForm.caseType&&e.registration_no?this.caseForm.registrationNo=e.registration_no:"版权"===this.caseForm.caseType&&e.acceptance_no?this.caseForm.acceptanceNo=e.acceptance_no:"科服"===this.caseForm.caseType&&e.service_name&&(this.caseForm.techServiceName=e.service_name)},setSelectedTechService(e){this.caseForm.techServiceName=e.id,this.caseForm.techServiceNameDisplay=e.name},formatFeeData(e){return Array.isArray(e)?e.map(e=>({id:e.id||null,feeName:e.fee_name||e.feeName||"",feeDescription:e.fee_description||e.feeDescription||"",amount:e.amount||"",currency:e.currency||"RMB",dueDate:e.due_date||e.dueDate||"",remarks:e.remarks||""})):[]},formatAttachmentData(e){return Array.isArray(e)?e.map(e=>({id:e.id||null,file_type:e.file_type||"",file_sub_type:e.file_sub_type||"",file_desc:e.file_desc||e.file_description||"",file_name:e.file_name||"",file_url:e.file_url||"",file_size:e.file_size||"",upload_time:e.upload_time||""})):[]},async loadFileTypeOptions(){try{const e=await d["a"].fileCategory.getList({page:1,limit:999,isValid:1});if(console.log("文件大类API响应:",e.data),e.data&&0===e.data.code){const t=[...new Set(e.data.data.list.map(e=>e.mainCategory))];this.fileTypeOptions=t.filter(e=>e).map(e=>({value:e,label:e})),console.log("文件大类选项:",this.fileTypeOptions)}else console.error("文件大类API返回错误:",e.data),this.fileTypeOptions=[{label:"技术文档",value:"技术文档"},{label:"法律文档",value:"法律文档"},{label:"商务文档",value:"商务文档"},{label:"其他文档",value:"其他文档"}]}catch(e){console.error("加载文件大类选项失败:",e),this.fileTypeOptions=[{label:"技术文档",value:"技术文档"},{label:"法律文档",value:"法律文档"},{label:"商务文档",value:"商务文档"},{label:"其他文档",value:"其他文档"}]}},async loadFileSubTypeOptions(e){try{if(!e)return void(this.fileSubTypeOptions[e]=[]);const t=await d["a"].fileCategory.getList({page:1,limit:999,mainCategory:e,isValid:1});if(console.log(`文件小类API响应(${e}):`,t.data),t.data&&0===t.data.code){const a=[...new Set(t.data.data.list.map(e=>e.subCategory))];this.fileSubTypeOptions[e]=a.filter(e=>e).map(e=>({value:e,label:e})),console.log(`文件小类选项(${e}):`,this.fileSubTypeOptions[e])}else console.error("文件小类API返回错误:",t.data),this.fileSubTypeOptions[e]=[{label:"申请文件",value:"申请文件"},{label:"证明文件",value:"证明文件"},{label:"授权文件",value:"授权文件"},{label:"其他",value:"其他"}]}catch(t){console.error("加载文件小类选项失败:",t),this.fileSubTypeOptions[e]=[{label:"申请文件",value:"申请文件"},{label:"证明文件",value:"证明文件"},{label:"授权文件",value:"授权文件"},{label:"其他",value:"其他"}]}},async loadFileDescriptionOptions(e,t){try{if(!e||!t){const a=`${e||""}::${t||""}`;return void this.$set(this.fileDescriptionOptions,a,[])}const a={page:1,limit:999,fileCategoryMajor:e,fileCategoryMinor:t,isValid:1},s=await d["a"].fileDescription.getList(a);if(console.log("文件描述API响应:",s.data),s.data&&0===s.data.code){const a=s.data.data.list||[],o=`${e||""}::${t||""}`,r=a.map(e=>({value:e.description||e.fileName||e.file_name||e.fileDescription||e.file_description||e.name||"描述-"+e.id,label:e.description||e.fileName||e.file_name||e.fileDescription||e.file_description||e.name||"描述-"+e.id}));this.$set(this.fileDescriptionOptions,o,r),console.log(`文件描述选项(${o}):`,this.fileDescriptionOptions[o])}else{const a=`${e||""}::${t||""}`;this.$set(this.fileDescriptionOptions,a,[{label:t,value:t},{label:"其他",value:"其他"}]),console.error("文件描述API返回错误:",s.data)}}catch(a){console.error("加载文件描述选项失败:",a);const s=`${e||""}::${t||""}`;this.$set(this.fileDescriptionOptions,s,[{label:t,value:t},{label:"其他",value:"其他"}])}}}},h=u,f=(a("c0cb"),a("2877")),v=Object(f["a"])(h,l,c,!1,null,"42e16960",null),b=v.exports,y=function(){var e=this,t=e._self._c;return t("div",[t("el-dialog",{directives:[{name:"drag-dialog",rawName:"v-drag-dialog"}],staticClass:"case-dialog",attrs:{title:e.dialogTitle,visible:e.visible,width:"80%","before-close":e.handleCancel,"append-to-body":"","custom-class":"draggable-dialog"},on:{"update:visible":function(t){e.visible=t}}},[t("el-tabs",{attrs:{type:"border-card"},model:{value:e.activeTab,callback:function(t){e.activeTab=t},expression:"activeTab"}},[t("el-tab-pane",{attrs:{label:"基本信息",name:"basicInfo"}},[t("el-form",{ref:"caseForm",staticClass:"case-form",attrs:{model:e.caseForm,rules:e.rules,"label-width":"130px"}},[t("el-row",{attrs:{gutter:20}},[t("el-col",{attrs:{span:8}},[t("el-form-item",{attrs:{label:"客户名称",prop:"clientName"}},[t("el-input",{attrs:{placeholder:"自动带出",disabled:!0},model:{value:e.caseForm.clientName,callback:function(t){e.$set(e.caseForm,"clientName",t)},expression:"caseForm.clientName"}})],1)],1),t("el-col",{attrs:{span:8}},[t("el-form-item",{attrs:{label:"项目类型",prop:"caseType"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择"},on:{change:e.handleCaseTypeChange},model:{value:e.caseForm.caseType,callback:function(t){e.$set(e.caseForm,"caseType",t)},expression:"caseForm.caseType"}},[t("el-option",{attrs:{label:"专利",value:"专利"}}),t("el-option",{attrs:{label:"商标",value:"商标"}}),t("el-option",{attrs:{label:"版权",value:"版权"}}),t("el-option",{attrs:{label:"科服",value:"科服"}})],1)],1)],1),t("el-col",{attrs:{span:8}},[t("el-form-item",{attrs:{label:"申请国家(地区)",prop:"applyCountry"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择",filterable:""},on:{change:e.handleCountryChange},model:{value:e.caseForm.applyCountry,callback:function(t){e.$set(e.caseForm,"applyCountry",t)},expression:"caseForm.applyCountry"}},e._l(e.countryOptions,(function(e){return t("el-option",{key:e.short_code,attrs:{label:e.cn,value:e.short_code}})})),1)],1)],1)],1),t("el-row",{attrs:{gutter:20}},[t("el-col",{attrs:{span:8}},[t("el-form-item",{attrs:{label:"业务类型",prop:"businessType"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择",disabled:!e.caseForm.caseType},model:{value:e.caseForm.businessType,callback:function(t){e.$set(e.caseForm,"businessType",t)},expression:"caseForm.businessType"}},e._l(e.businessTypeOptions,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)],1),t("el-col",{attrs:{span:8}},[t("el-form-item",{attrs:{label:"申请类型",prop:"applyType"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择",disabled:!e.caseForm.caseType},on:{change:e.handleApplyTypeChange},model:{value:e.caseForm.applyType,callback:function(t){e.$set(e.caseForm,"applyType",t)},expression:"caseForm.applyType"}},e._l(e.applyTypeOptions,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)],1),t("el-col",{attrs:{span:8}},[t("el-form-item",{attrs:{label:"产品信息",prop:"productInfo"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择产品",disabled:!e.caseForm.caseType,filterable:""},model:{value:e.caseForm.productInfo,callback:function(t){e.$set(e.caseForm,"productInfo",t)},expression:"caseForm.productInfo"}},e._l(e.productOptions,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)],1)],1),t("el-row",{attrs:{gutter:20}},[t("el-col",{attrs:{span:8}},[t("el-form-item",{attrs:{label:"售前支持",prop:"presaleSupport"}},[t("SelectPerson",{attrs:{placeholder:"售前支持",clearable:"",size:"small"},model:{value:e.caseForm.presaleSupport,callback:function(t){e.$set(e.caseForm,"presaleSupport",t)},expression:"caseForm.presaleSupport"}})],1)],1)],1),t("el-row",{attrs:{gutter:20}},[t("el-col",{attrs:{span:8}},[t("el-form-item",{attrs:{label:"预项名称",prop:"preAwardName"}},[t("el-input",{attrs:{placeholder:"请输入预项名称"},model:{value:e.caseForm.preAwardName,callback:function(t){e.$set(e.caseForm,"preAwardName",t)},expression:"caseForm.preAwardName"}})],1)],1),t("el-col",{attrs:{span:8}},[t("el-form-item",{attrs:{label:"技术主导",prop:"techLeader"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择"},model:{value:e.caseForm.techLeader,callback:function(t){e.$set(e.caseForm,"techLeader",t)},expression:"caseForm.techLeader"}},e._l(e.techLeaderOptions,(function(e){return t("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1)],1),t("el-col",{attrs:{span:8}},[t("el-form-item",{attrs:{label:"资料对接-技术",prop:"techContact"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择"},model:{value:e.caseForm.techContact,callback:function(t){e.$set(e.caseForm,"techContact",t)},expression:"caseForm.techContact"}},e._l(e.techContactOptions,(function(e){return t("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1)],1)],1),t("el-row",{attrs:{gutter:20}},[t("el-col",{attrs:{span:8}},["商标"===e.caseForm.caseType?t("el-form-item",{attrs:{label:"商标类别",prop:"trademarkCategory"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择"},model:{value:e.caseForm.trademarkCategory,callback:function(t){e.$set(e.caseForm,"trademarkCategory",t)},expression:"caseForm.trademarkCategory"}},[t("el-option",{attrs:{label:"第01类",value:"第01类"}}),t("el-option",{attrs:{label:"第02类",value:"第02类"}}),t("el-option",{attrs:{label:"第03类",value:"第03类"}}),t("el-option",{attrs:{label:"第04类",value:"第04类"}}),t("el-option",{attrs:{label:"第05类",value:"第05类"}})],1)],1):e._e()],1),t("el-col",{attrs:{span:8}},["科服"===e.caseForm.caseType?t("el-form-item",{attrs:{label:"科技服务名称",prop:"techServiceName"}},[t("el-input",{staticStyle:{cursor:"pointer"},attrs:{placeholder:"请选择科技服务名称",readonly:"",disabled:e.caseForm.isAuthorized},on:{click:e.handleSelectTechService},model:{value:e.caseForm.techServiceNameDisplay,callback:function(t){e.$set(e.caseForm,"techServiceNameDisplay",t)},expression:"caseForm.techServiceNameDisplay"}},[t("el-button",{attrs:{slot:"append",icon:"el-icon-search",disabled:e.caseForm.isAuthorized},on:{click:e.handleSelectTechService},slot:"append"})],1)],1):e._e()],1)],1),t("el-row",{attrs:{gutter:20}},[t("el-col",{attrs:{span:8}},[t("el-form-item",{attrs:{label:"是否已有项目",prop:"isAuthorized"}},[t("el-radio-group",{model:{value:e.caseForm.isAuthorized,callback:function(t){e.$set(e.caseForm,"isAuthorized",t)},expression:"caseForm.isAuthorized"}},[t("el-radio",{attrs:{label:!0}},[e._v("是")]),t("el-radio",{attrs:{label:!1}},[e._v("否")])],1)],1)],1),e.caseForm.isAuthorized?t("el-col",{attrs:{span:8}},[t("el-form-item",{attrs:{label:"项目编号",prop:"projectNo"}},[t("el-input",{staticStyle:{cursor:"pointer"},attrs:{placeholder:"请选择项目编号",readonly:""},on:{click:e.handleSelectProject},model:{value:e.caseForm.projectNoDisplay,callback:function(t){e.$set(e.caseForm,"projectNoDisplay",t)},expression:"caseForm.projectNoDisplay"}},[t("el-button",{attrs:{slot:"append",icon:"el-icon-search"},on:{click:e.handleSelectProject},slot:"append"})],1)],1)],1):e._e(),"专利"===e.caseForm.caseType?t("el-col",{attrs:{span:8}},[t("el-form-item",{attrs:{label:"申请号",prop:"applyNo"}},[t("el-input",{attrs:{placeholder:"请输入申请号",disabled:e.caseForm.isAuthorized||"普通新申请"===e.caseForm.businessType},model:{value:e.caseForm.applyNo,callback:function(t){e.$set(e.caseForm,"applyNo",t)},expression:"caseForm.applyNo"}})],1)],1):e._e(),"商标"===e.caseForm.caseType?t("el-col",{attrs:{span:8}},[t("el-form-item",{attrs:{label:"注册号",prop:"registrationNo"}},[t("el-input",{attrs:{placeholder:"请输入注册号",disabled:e.caseForm.isAuthorized},model:{value:e.caseForm.registrationNo,callback:function(t){e.$set(e.caseForm,"registrationNo",t)},expression:"caseForm.registrationNo"}})],1)],1):e._e(),"版权"===e.caseForm.caseType?t("el-col",{attrs:{span:8}},[t("el-form-item",{attrs:{label:"受理号",prop:"acceptanceNo"}},[t("el-input",{attrs:{placeholder:"请输入受理号",disabled:e.caseForm.isAuthorized},model:{value:e.caseForm.acceptanceNo,callback:function(t){e.$set(e.caseForm,"acceptanceNo",t)},expression:"caseForm.acceptanceNo"}})],1)],1):e._e()],1),t("el-form-item",{attrs:{label:"项目备注",prop:"remark"}},[t("el-input",{attrs:{type:"textarea",maxlength:"300","show-word-limit":"",placeholder:"请输入项目备注",rows:4},model:{value:e.caseForm.remark,callback:function(t){e.$set(e.caseForm,"remark",t)},expression:"caseForm.remark"}})],1)],1)],1),t("el-tab-pane",{attrs:{label:"费用信息",name:"feeInfo"}},[t("div",{staticClass:"fee-form-section"},[t("div",{staticClass:"section-header"},[t("span",{staticClass:"section-title"},[e._v("服务费")]),t("el-button",{attrs:{size:"small",type:"primary",icon:"el-icon-plus"},on:{click:e.openServiceFeeDialog}},[e._v("添加服务费")])],1),t("el-table",{staticStyle:{width:"100%"},attrs:{data:e.caseForm.serviceFees,border:""}},[t("el-table-column",{attrs:{prop:"feeName",label:"费用名称",width:"150"}}),t("el-table-column",{attrs:{prop:"feeDescription",label:"项目名称",width:"200"}}),t("el-table-column",{attrs:{prop:"amount",label:"服务费",width:"120"}}),t("el-table-column",{attrs:{prop:"currency",label:"币种",width:"80"}}),t("el-table-column",{attrs:{prop:"remarks",label:"备注","min-width":"150"}}),t("el-table-column",{attrs:{label:"操作",width:"200"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-button",{attrs:{size:"mini"},on:{click:function(t){return e.editServiceFee(a.$index)}}},[e._v("编辑")]),t("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(t){return e.removeServiceFee(a.$index)}}},[e._v("删除")])]}}])})],1)],1),t("div",{staticClass:"fee-form-section"},[t("div",{staticClass:"section-header"},[t("span",{staticClass:"section-title"},[e._v("官费")]),t("el-button",{attrs:{size:"small",type:"primary",icon:"el-icon-plus"},on:{click:e.openOfficialFeeDialog}},[e._v("添加官费")])],1),t("el-table",{staticStyle:{width:"100%"},attrs:{data:e.caseForm.officialFees,border:""}},[t("el-table-column",{attrs:{prop:"feeName",label:"费用名称",width:"150"}}),t("el-table-column",{attrs:{prop:"feeDescription",label:"费用描述",width:"200"}}),t("el-table-column",{attrs:{prop:"amount",label:"金额",width:"120"}}),t("el-table-column",{attrs:{prop:"currency",label:"币种",width:"80"}}),t("el-table-column",{attrs:{prop:"remarks",label:"备注","min-width":"150"}}),t("el-table-column",{attrs:{label:"操作",width:"200"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-button",{attrs:{size:"mini"},on:{click:function(t){return e.editOfficialFee(a.$index)}}},[e._v("编辑")]),t("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(t){return e.removeOfficialFee(a.$index)}}},[e._v("删除")])]}}])})],1)],1)]),t("el-tab-pane",{attrs:{label:"附件信息",name:"attachmentInfo"}},[t("div",{staticClass:"case-attachment-container"},[t("div",{staticClass:"attachment-header"},[t("el-button",{attrs:{size:"small",type:"primary"},on:{click:e.openAttachmentDialog}},[e._v("新增附件")])],1),t("el-table",{staticStyle:{width:"100%"},attrs:{data:e.caseForm.attachments,border:""}},[t("el-table-column",{attrs:{prop:"file_type",label:"文件大类",width:"120"}}),t("el-table-column",{attrs:{prop:"file_sub_type",label:"文件小类",width:"120"}}),t("el-table-column",{attrs:{prop:"file_desc",label:"文件描述","min-width":"200"}}),t("el-table-column",{attrs:{prop:"file_name",label:"文件名称","min-width":"200"}}),t("el-table-column",{attrs:{label:"操作",width:"150"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-button",{attrs:{size:"mini"},on:{click:function(t){return e.downloadCaseAttachment(a.row)}}},[e._v("下载")]),t("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(t){return e.removeCaseAttachment(a.$index)}}},[e._v("删除")])]}}])})],1)],1)])],1),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:e.handleCancel}},[e._v("取 消")]),t("el-button",{attrs:{size:"small",type:"primary",loading:e.caseFormSubmitting},on:{click:e.submitCaseForm}},[e._v("确 定")])],1)],1),t("el-dialog",{attrs:{title:"添加服务费",visible:e.serviceFeeDialogVisible,width:"600px","append-to-body":""},on:{"update:visible":function(t){e.serviceFeeDialogVisible=t}}},[t("el-form",{attrs:{model:e.currentFeeForm,"label-width":"100px"}},[t("el-form-item",{attrs:{label:"费用名称"}},[t("el-input",{attrs:{placeholder:"请输入费用名称"},model:{value:e.currentFeeForm.feeName,callback:function(t){e.$set(e.currentFeeForm,"feeName",t)},expression:"currentFeeForm.feeName"}})],1),t("el-form-item",{attrs:{label:"项目名称"}},[t("el-input",{attrs:{placeholder:"请输入项目名称"},model:{value:e.currentFeeForm.feeDescription,callback:function(t){e.$set(e.currentFeeForm,"feeDescription",t)},expression:"currentFeeForm.feeDescription"}})],1),t("el-form-item",{attrs:{label:"服务费"}},[t("el-input",{attrs:{placeholder:"0.00",type:"number"},model:{value:e.currentFeeForm.amount,callback:function(t){e.$set(e.currentFeeForm,"amount",t)},expression:"currentFeeForm.amount"}})],1),t("el-form-item",{attrs:{label:"币种"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"币种"},model:{value:e.currentFeeForm.currency,callback:function(t){e.$set(e.currentFeeForm,"currency",t)},expression:"currentFeeForm.currency"}},[t("el-option",{attrs:{label:"RMB",value:"RMB"}}),t("el-option",{attrs:{label:"USD",value:"USD"}}),t("el-option",{attrs:{label:"EUR",value:"EUR"}})],1)],1),t("el-form-item",{attrs:{label:"备注"}},[t("el-input",{attrs:{placeholder:"备注"},model:{value:e.currentFeeForm.remarks,callback:function(t){e.$set(e.currentFeeForm,"remarks",t)},expression:"currentFeeForm.remarks"}})],1)],1),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.serviceFeeDialogVisible=!1}}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.saveServiceFee}},[e._v("确 定")])],1)],1),t("el-dialog",{attrs:{title:"添加官费",visible:e.officialFeeDialogVisible,width:"600px","append-to-body":""},on:{"update:visible":function(t){e.officialFeeDialogVisible=t}}},[t("el-form",{attrs:{model:e.currentFeeForm,"label-width":"100px"}},[t("el-form-item",{attrs:{label:"费用名称"}},[t("el-input",{attrs:{placeholder:"请输入费用名称"},model:{value:e.currentFeeForm.feeName,callback:function(t){e.$set(e.currentFeeForm,"feeName",t)},expression:"currentFeeForm.feeName"}})],1),t("el-form-item",{attrs:{label:"费用描述"}},[t("el-input",{attrs:{placeholder:"请输入费用描述"},model:{value:e.currentFeeForm.feeDescription,callback:function(t){e.$set(e.currentFeeForm,"feeDescription",t)},expression:"currentFeeForm.feeDescription"}})],1),t("el-form-item",{attrs:{label:"金额"}},[t("el-input",{attrs:{placeholder:"0.00",type:"number"},model:{value:e.currentFeeForm.amount,callback:function(t){e.$set(e.currentFeeForm,"amount",t)},expression:"currentFeeForm.amount"}})],1),t("el-form-item",{attrs:{label:"币种"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"币种"},model:{value:e.currentFeeForm.currency,callback:function(t){e.$set(e.currentFeeForm,"currency",t)},expression:"currentFeeForm.currency"}},[t("el-option",{attrs:{label:"RMB",value:"RMB"}}),t("el-option",{attrs:{label:"USD",value:"USD"}}),t("el-option",{attrs:{label:"EUR",value:"EUR"}})],1)],1),t("el-form-item",{attrs:{label:"备注"}},[t("el-input",{attrs:{placeholder:"备注"},model:{value:e.currentFeeForm.remarks,callback:function(t){e.$set(e.currentFeeForm,"remarks",t)},expression:"currentFeeForm.remarks"}})],1)],1),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.officialFeeDialogVisible=!1}}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.saveOfficialFee}},[e._v("确 定")])],1)],1),t("el-dialog",{attrs:{title:"新增附件",visible:e.attachmentDialogVisible,width:"600px","append-to-body":""},on:{"update:visible":function(t){e.attachmentDialogVisible=t}}},[t("el-form",{attrs:{model:e.currentAttachmentForm,"label-width":"100px"}},[t("el-form-item",{attrs:{label:"文件大类"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择文件大类"},on:{change:e.handleAttachmentFileTypeChange},model:{value:e.currentAttachmentForm.file_type,callback:function(t){e.$set(e.currentAttachmentForm,"file_type",t)},expression:"currentAttachmentForm.file_type"}},e._l(e.fileTypeOptions,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),t("el-form-item",{attrs:{label:"文件小类"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择文件小类",disabled:!e.currentAttachmentForm.file_type},on:{change:e.handleAttachmentFileSubTypeChange},model:{value:e.currentAttachmentForm.file_sub_type,callback:function(t){e.$set(e.currentAttachmentForm,"file_sub_type",t)},expression:"currentAttachmentForm.file_sub_type"}},e._l(e.getFileSubTypeOptions(e.currentAttachmentForm.file_type),(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),t("el-form-item",{attrs:{label:"文件描述"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择文件描述",disabled:!e.currentAttachmentForm.file_sub_type},model:{value:e.currentAttachmentForm.file_desc,callback:function(t){e.$set(e.currentAttachmentForm,"file_desc",t)},expression:"currentAttachmentForm.file_desc"}},e._l(e.getFileDescriptionOptions(e.currentAttachmentForm.file_type,e.currentAttachmentForm.file_sub_type),(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),t("el-form-item",{attrs:{label:"文件上传"}},[t("el-upload",{attrs:{action:e.uploadUrl,headers:e.uploadHeaders,"on-success":e.handleAttachmentUploadSuccess,"on-error":e.handleAttachmentUploadError,"before-upload":e.beforeAttachmentUpload,"show-file-list":!1,accept:"*"}},[t("el-button",{attrs:{size:"small",type:"primary",icon:"el-icon-upload",loading:e.attachmentUploading}},[e._v(" "+e._s(e.currentAttachmentForm.file_name?"重新上传":"选择文件")+" ")])],1),e.currentAttachmentForm.file_name?t("div",{staticStyle:{"margin-top":"5px","font-size":"12px",color:"#666"}},[e._v(" 已上传："+e._s(e.currentAttachmentForm.file_name)+" ")]):e._e()],1)],1),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.attachmentDialogVisible=!1}}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.saveAttachment}},[e._v("确 定")])],1)],1)],1)},_=[],g=a("5f87"),F={name:"EditCaseDialog",components:{SelectPerson:r["a"]},props:{visible:{type:Boolean,default:!1},caseData:{type:Object,default:()=>({})},customerId:{type:[String,Number],required:!0},customerName:{type:String,default:""}},data(){return{activeTab:"basicInfo",caseFormSubmitting:!1,caseForm:{id:"",clientName:"",caseType:"",businessType:"",applyType:"",applyCountry:"",presaleSupport:"",preAwardName:"",techLeader:"",techContact:"",trademarkCategory:"",isAuthorized:!1,techServiceName:"",techServiceNameDisplay:"",projectNo:"",projectNoDisplay:"",applyNo:"",registrationNo:"",productInfo:"",remark:"",serviceFees:[],officialFees:[],attachments:[]},rules:{caseType:[{required:!0,message:"请选择项目类型",trigger:"change"}],applyCountry:[{required:!0,message:"请选择申请国家",trigger:"change"}],businessType:[{required:!0,message:"请选择业务类型",trigger:"change"}],preAwardName:[{required:!0,message:"请输入预项名称",trigger:"blur"}],techLeader:[{required:!0,message:"请选择技术主导",trigger:"change"}],applyType:[{required:!0,message:"请选择申请类型",trigger:"change"}]},businessTypeOptions:[],applyTypeOptions:[],productOptions:[],countryOptions:[],techLeaderOptions:[],techContactOptions:[],fileTypeOptions:[],fileSubTypeOptions:{},fileDescriptionOptions:{},serviceFeeDialogVisible:!1,officialFeeDialogVisible:!1,attachmentDialogVisible:!1,currentFeeForm:{},currentAttachmentForm:{},editingFeeIndex:-1,editingFeeType:"",attachmentUploading:!1}},computed:{dialogTitle(){return"编辑项目"},uploadUrl(){return m["a"].host+"/api/upload"},uploadHeaders(){return{Authorization:localStorage.getItem("token")||sessionStorage.getItem("token")||""}}},watch:{visible(e){e&&this.initDialog()},caseData:{handler(e){e&&Object.keys(e).length>0&&this.loadCaseData(e)},immediate:!0,deep:!0}},created(){this.initializeCountryOptions(),this.loadFileTypeOptions(),console.log("EditCaseDialog created, caseForm.id:",this.caseForm.id)},methods:{buildRequiredCasePayload(){const e={"专利":1,"商标":2,"版权":3,"科服":4},t={customer_id:Number(this.customerId),contract_id:this.$route.query.id,case_name:this.caseForm.preAwardName||"项目名称",case_type:e[this.caseForm.caseType]||this.caseForm.caseType||1,case_subtype:this.caseForm.businessType||"",application_type:this.caseForm.applyType||"",country_code:this.caseForm.applyCountry||"",application_no:this.caseForm.applyNo||"",registration_no:this.caseForm.registrationNo||"",case_description:this.caseForm.remark||""};return t},initDialog(){this.resetCaseForm(),this.loadTechLeaderOptions(),this.loadTechContactOptions(),this.caseData&&Object.keys(this.caseData).length>0&&this.loadCaseData(this.caseData)},resetCaseForm(){this.caseForm={id:"",clientName:this.customerName,caseType:"",businessType:"",applyType:"",applyCountry:"",presaleSupport:"",preAwardName:"",techLeader:"",techContact:"",trademarkCategory:"",isAuthorized:!1,techServiceName:"",techServiceNameDisplay:"",projectNo:"",projectNoDisplay:"",applyNo:"",registrationNo:"",acceptanceNo:"",productInfo:"",remark:"",serviceFees:[],officialFees:[],attachments:[]},this.businessTypeOptions=[],this.applyTypeOptions=[],this.productOptions=[],this.activeTab="basicInfo"},async loadCaseData(e){try{const a=await n["a"].getContractCaseRecord(e.id);if(a.data&&a.data.success){var t;const e=a.data.data,s=(null===(t=this.countryOptions.find(t=>t.cn===e.country_code))||void 0===t?void 0:t.short_code)||e.country_code;await this.loadTechLeaderOptions(),await this.loadTechContactOptions(),this.caseForm={id:e.id,clientName:this.customerName,caseType:this.getCaseTypeText(e.case_type),businessType:e.case_subtype||"",applyType:e.application_type||"",applyCountry:s,presaleSupport:e.presale_support||0===e.presale_support?Number(e.presale_support):"",preAwardName:e.case_name||"",techLeader:e.tech_leader||0===e.tech_leader?e.tech_leader:"",techContact:e.tech_contact||0===e.tech_contact?e.tech_contact:"",trademarkCategory:e.trademark_category||"",isAuthorized:!!e.is_authorized,techServiceName:e.tech_service_name||"",techServiceNameDisplay:e.tech_service_name_display||e.tech_service_name||"",projectNo:e.project_no||"",projectNoDisplay:this.formatProjectDisplay(e.project_no_display,e.project_no,e.case_code,e.case_name),applyNo:e.application_no||"",registrationNo:e.registration_no||"",acceptanceNo:e.acceptance_no||"",productInfo:e.product_id||"",remark:e.case_description||"",serviceFees:this.formatFeeData(e.service_fees||[]),officialFees:this.formatFeeData(e.official_fees||[]),attachments:this.formatAttachmentData(e.attachments||[])},this.$nextTick(()=>{if(this.caseForm.techContact){const e=this.caseForm.techContact,t=this.techContactOptions.find(t=>String(t.id)===String(e));console.log("techContact 调试信息:",{originalValue:this.caseForm.techContact,techContactId:e,foundContact:t,techContactOptions:this.techContactOptions}),t?(this.caseForm.techContact=e,this.$forceUpdate()):(console.warn("未找到对应的技术联系人:",e,this.techContactOptions),this.caseForm.techContact="")}}),this.caseForm.caseType&&(await this.loadBusinessTypeOptions(this.caseForm.caseType),await this.loadApplyTypeOptions(this.caseForm.caseType),await this.loadProductOptions(this.caseForm.caseType,this.caseForm.applyType)),this.$forceUpdate()}}catch(a){console.error("加载项目数据失败:",a),this.$message.error("加载项目数据失败")}},getCaseTypeText(e){const t={1:"专利",2:"商标",3:"版权",4:"科服"};return t[e]||e},formatProjectDisplay(e,t,a,s){return e&&e!==t?e:t&&a&&s?`${a} - ${s}`:t||""},async handleCaseTypeChange(e){this.caseForm.businessType="",this.caseForm.applyType="",this.caseForm.applyNo="",this.caseForm.registrationNo="",this.caseForm.acceptanceNo="",this.caseForm.trademarkCategory="",this.caseForm.techServiceName="",await this.loadBusinessTypeOptions(e),await this.loadApplyTypeOptions(e)},handleCountryChange(e){console.log("国家变化:",e)},async loadBusinessTypeOptions(e){if(e)try{const t=await d["a"].businessService.getList({category:e,status:1,page:1,limit:999});t.data&&0===t.data.code&&(this.businessTypeOptions=t.data.data.list.map(e=>({label:e.name,value:e.name})))}catch(t){console.error("加载业务类型选项失败:",t),this.businessTypeOptions=[]}else this.businessTypeOptions=[]},async loadApplyTypeOptions(e){if(e)try{const t=await d["a"].applyType.getList({case_type:e,page:1,limit:999});t.data&&0===t.data.code&&(this.applyTypeOptions=t.data.data.list.map(e=>({label:e.applyTypeName||e.apply_type_name,value:e.applyTypeName||e.apply_type_name})))}catch(t){console.error("加载申请类型选项失败:",t),this.applyTypeOptions=[]}else this.applyTypeOptions=[]},async loadTechLeaderOptions(){try{const e=await n["a"].getContactList({customer_id:this.customerId,contact_type:"技术主导"});if(e.data&&e.data.success){const t=e.data.data&&(e.data.data.list||e.data.data)||[];this.techLeaderOptions=t.map(e=>({id:e.id,name:e.name||e.contact_name}))}}catch(e){console.error("加载技术主导选项失败:",e),this.techLeaderOptions=[]}},async loadTechContactOptions(){try{const e=await n["a"].getContactList({customer_id:this.customerId,contact_type:"技术主导"});if(e.data&&e.data.success){const t=e.data.data&&(e.data.data.list||e.data.data)||[];this.techContactOptions=t.map(e=>({id:e.id,name:e.name||e.contact_name})),console.log("技术联系人选项加载完成:",this.techContactOptions)}}catch(e){console.error("加载技术联系人选项失败:",e),this.techContactOptions=[]}},async loadProductOptions(e,t=null){if(e)try{const a={case_type:[e],is_valid:1,page:1,limit:999};t&&(a.apply_type=t);const s=await d["a"].product.getList(a);console.log("产品信息API响应:",s.data),s.data&&0===s.data.code?(this.productOptions=s.data.data.list.map(e=>({label:`${e.productName}${e.specification?` (${e.specification})`:""}`,value:e.id,productCode:e.productCode,productName:e.productName,specification:e.specification,officialFee:e.officialFee,standardPrice:e.standardPrice,minPrice:e.minPrice})),console.log("产品信息选项:",this.productOptions)):console.error("产品信息API返回错误:",s.data)}catch(a){console.error("加载产品信息选项失败:",a),this.productOptions=[]}else this.productOptions=[]},handleApplyTypeChange(e){this.caseForm.productInfo="",this.loadProductOptions(this.caseForm.caseType,e)},initializeCountryOptions(){this.countryOptions=p["a"]||[]},async submitCaseForm(){try{await this.$refs.caseForm.validate(),this.caseFormSubmitting=!0;const t={"专利":1,"商标":2,"版权":3,"科服":4},a=this.countryOptions.find(e=>e.short_code===this.caseForm.applyCountry),s=a?a.cn:this.caseForm.applyCountry,o={customer_id:parseInt(this.customerId),contract_id:this.$route.query.id?parseInt(this.$route.query.id):null,case_name:this.caseForm.preAwardName,case_type:t[this.caseForm.caseType]||this.caseForm.caseType,case_subtype:this.caseForm.businessType,application_type:this.caseForm.applyType,country_code:s,application_no:this.caseForm.applyNo||null,registration_no:this.caseForm.registrationNo||null,acceptance_no:this.caseForm.acceptanceNo||null,presale_support:""!==this.caseForm.presaleSupport&&null!==this.caseForm.presaleSupport?Number(this.caseForm.presaleSupport):null,tech_leader:""!==this.caseForm.techLeader&&null!==this.caseForm.techLeader?Number(this.caseForm.techLeader):null,tech_contact:""!==this.caseForm.techContact&&null!==this.caseForm.techContact?Number(this.caseForm.techContact):null,is_authorized:"boolean"===typeof this.caseForm.isAuthorized?this.caseForm.isAuthorized?1:0:null,project_no:this.caseForm.projectNo||null,tech_service_name:this.caseForm.techServiceName||null,trademark_category:this.caseForm.trademarkCategory||null,product_id:""!==this.caseForm.productInfo&&null!==this.caseForm.productInfo&&void 0!==this.caseForm.productInfo?Number(this.caseForm.productInfo):null,case_description:this.caseForm.remark||null};Object.keys(o).forEach(e=>{""!==o[e]&&null!==o[e]&&void 0!==o[e]||["customer_id","case_name","case_type"].includes(e)||delete o[e]});const r=await n["a"].updateContractCaseRecord(this.caseForm.id,o);var e;if(r.data&&r.data.success)this.$message.success("项目更新成功"),this.$emit("success"),this.handleCancel();else this.$message.error((null===(e=r.data)||void 0===e?void 0:e.message)||"项目更新失败")}catch(t){console.error("项目更新失败:",t),this.$message.error("项目更新失败")}finally{this.caseFormSubmitting=!1}},handleCancel(){this.$emit("update:visible",!1),this.$emit("close")},handleSelectTechService(){this.$emit("select-tech-service")},handleSelectProject(){this.caseForm.caseType?this.$emit("select-project",this.caseForm.caseType):this.$message.warning("请先选择项目类型")},setSelectedProject(e){this.caseForm.projectNo=e.id,this.caseForm.projectNoDisplay=`${e.case_code} - ${e.case_name}`,"专利"===this.caseForm.caseType&&e.application_no?this.caseForm.applyNo=e.application_no:"商标"===this.caseForm.caseType&&e.registration_no?this.caseForm.registrationNo=e.registration_no:"版权"===this.caseForm.caseType&&e.acceptance_no?this.caseForm.acceptanceNo=e.acceptance_no:"科服"===this.caseForm.caseType&&e.service_name&&(this.caseForm.techServiceName=e.service_name)},setSelectedTechService(e){this.caseForm.techServiceName=e.id,this.caseForm.techServiceNameDisplay=e.name},formatFeeData(e){return Array.isArray(e)?e.map(e=>({id:e.id||null,feeName:e.fee_name||e.feeName||"",feeDescription:e.fee_description||e.feeDescription||"",amount:e.amount||"",currency:e.currency||"RMB",remarks:e.remarks||""})):[]},formatAttachmentData(e){return Array.isArray(e)?e.map(e=>({id:e.id||null,file_type:e.file_type||"",file_sub_type:e.file_sub_type||"",file_desc:e.file_desc||e.file_description||"",file_name:e.file_name||"",file_path:e.file_path||"",file_size:e.file_size||0})):[]},openServiceFeeDialog(){this.currentFeeForm={feeName:"",feeDescription:"",amount:"",currency:"RMB",remarks:""},this.editingFeeIndex=-1,this.editingFeeType="service",this.serviceFeeDialogVisible=!0},editServiceFee(e){this.currentFeeForm={...this.caseForm.serviceFees[e]},this.editingFeeIndex=e,this.editingFeeType="service",this.serviceFeeDialogVisible=!0},saveServiceFee(){this.currentFeeForm.feeName&&this.currentFeeForm.amount?(this.editingFeeIndex>=0?this.$set(this.caseForm.serviceFees,this.editingFeeIndex,{...this.currentFeeForm}):this.caseForm.serviceFees.push({...this.currentFeeForm}),this.serviceFeeDialogVisible=!1,this.$message.success("服务费保存成功")):this.$message.error("费用名称和金额不能为空")},removeServiceFee(e){this.caseForm.serviceFees.splice(e,1),this.$message.success("服务费删除成功")},openOfficialFeeDialog(){this.currentFeeForm={feeName:"",feeDescription:"",amount:"",currency:"RMB",remarks:""},this.editingFeeIndex=-1,this.editingFeeType="official",this.officialFeeDialogVisible=!0},editOfficialFee(e){this.currentFeeForm={...this.caseForm.officialFees[e]},this.editingFeeIndex=e,this.editingFeeType="official",this.officialFeeDialogVisible=!0},saveOfficialFee(){this.currentFeeForm.feeName&&this.currentFeeForm.amount?(this.editingFeeIndex>=0?this.$set(this.caseForm.officialFees,this.editingFeeIndex,{...this.currentFeeForm}):this.caseForm.officialFees.push({...this.currentFeeForm}),this.officialFeeDialogVisible=!1,this.$message.success("官费保存成功")):this.$message.error("费用名称和金额不能为空")},removeOfficialFee(e){this.caseForm.officialFees.splice(e,1),this.$message.success("官费删除成功")},openAttachmentDialog(){this.currentAttachmentForm={file_type:"",file_sub_type:"",file_desc:"",file_name:"",file_path:"",file_size:0,file:null},this.attachmentDialogVisible=!0,console.log("打开附件对话框，当前项目ID:",this.caseForm.id),console.log("当前文件小类选项:",this.fileSubTypeOptions),console.log("当前上传URL:",this.uploadUrl),console.log("当前token:",Object(g["i"])()),console.log("当前uploadHeaders:",this.uploadHeaders)},saveAttachment(){this.currentAttachmentForm.file_type&&this.currentAttachmentForm.file_sub_type&&this.currentAttachmentForm.file_desc?this.currentAttachmentForm.file_path?(this.caseForm.attachments.push({...this.currentAttachmentForm}),this.attachmentDialogVisible=!1,this.$message.success("附件添加成功")):this.$message.error("请先上传文件"):this.$message.error("文件大类、小类和描述不能为空")},removeCaseAttachment(e){this.caseForm.attachments.splice(e,1),this.$message.success("附件删除成功")},downloadCaseAttachment(e){e.file_path?(console.log("下载附件:",Object({NODE_ENV:"production",BASE_URL:"/"}).VUE_APP_BASE_API+"/storage/"+e.file_path),window.open(m["a"].host+"/storage/"+e.file_path,"_blank")):this.$message.warning("文件路径不存在")},async handleAttachmentFileTypeChange(e){this.currentAttachmentForm.file_sub_type="",this.currentAttachmentForm.file_desc="",await this.loadFileSubTypeOptions(e),this.$nextTick(()=>{this.$forceUpdate()})},async handleAttachmentFileSubTypeChange(e){this.currentAttachmentForm.file_desc="",await this.loadFileDescriptionOptions(this.currentAttachmentForm.file_type,e),this.$nextTick(()=>{this.$forceUpdate()})},handleFileUploadError(){this.$message.error("文件上传失败")},beforeAttachmentUpload(e){this.attachmentUploading=!0;const t=e.size/1024/1024<20;return t||(this.$message.error("上传文件大小不能超过 20MB!"),this.attachmentUploading=!1),t},handleAttachmentUploadSuccess(e,t){this.attachmentUploading=!1,e.success?(this.currentAttachmentForm.file_name=t.name,this.currentAttachmentForm.file_path=e.data.file_path||e.data.path,this.currentAttachmentForm.file_size=t.size,this.$message.success("文件上传成功")):this.$message.error(e.message||"文件上传失败")},handleAttachmentUploadError(e){this.attachmentUploading=!1,console.error("文件上传失败:",e),this.$message.error("文件上传失败")},async loadFileTypeOptions(){try{const e=await d["a"].fileCategory.getList({page:1,limit:999,isValid:1});if(console.log("文件大类API响应:",e.data),e.data&&0===e.data.code){const t=[...new Set(e.data.data.list.map(e=>e.mainCategory))];this.fileTypeOptions=t.filter(e=>e).map(e=>({value:e,label:e})),console.log("文件大类选项:",this.fileTypeOptions)}else console.error("文件大类API返回错误:",e.data)}catch(e){console.error("加载文件大类选项失败:",e),this.fileTypeOptions=[]}},async loadFileSubTypeOptions(e){try{if(!e)return void this.$set(this.fileSubTypeOptions,e,[]);const t=await d["a"].fileCategory.getList({page:1,limit:999,mainCategory:e,isValid:1});if(console.log(`文件小类API响应(${e}):`,t.data),t.data&&0===t.data.code){const a=t.data.data.list.filter(e=>e.subCategory).map(e=>({value:e.subCategory,label:e.subCategory}));this.$set(this.fileSubTypeOptions,e,a),console.log(`文件小类选项(${e}):`,this.fileSubTypeOptions[e])}else this.$set(this.fileSubTypeOptions,e,[]),console.error("文件小类API返回错误:",t.data)}catch(t){console.error("加载文件小类选项失败:",t),this.$set(this.fileSubTypeOptions,e,[])}},async loadFileDescriptionOptions(e,t){try{if(!e||!t){const a=`${e||""}::${t||""}`;return void this.$set(this.fileDescriptionOptions,a,[])}const a={page:1,limit:999,fileCategoryMajor:e,fileCategoryMinor:t,isValid:1},s=await d["a"].fileDescription.getList(a);if(console.log("文件描述API响应:",s.data),s.data&&0===s.data.code){const a=s.data.data.list||[],o=`${e||""}::${t||""}`,r=a.map(e=>({value:e.fileName||e.file_name||e.fileDescription||e.file_description||e.name||"描述-"+e.id,label:e.fileName||e.file_name||e.fileDescription||e.file_description||e.name||"描述-"+e.id}));this.$set(this.fileDescriptionOptions,o,r),console.log(`文件描述选项(${o}):`,this.fileDescriptionOptions[o])}else{const a=`${e||""}::${t||""}`;this.$set(this.fileDescriptionOptions,a,[]),console.error("文件描述API返回错误:",s.data)}}catch(a){console.error("加载文件描述选项失败:",a);const s=`${e||""}::${t||""}`;this.$set(this.fileDescriptionOptions,s,[])}},getFileDescriptionOptions(e,t){const a=`${e||""}::${t||""}`;return this.fileDescriptionOptions[a]||[]},getFileSubTypeOptions(e){const t=this.fileSubTypeOptions[e]||[];return console.log(`getFileSubTypeOptions(${e}):`,t),t}}},C=F,w=(a("3156"),Object(f["a"])(C,y,_,!1,null,"78f509df",null)),S=w.exports,T=a("35ad"),D=a("c24f"),k={name:"ContractView",components:{SelectPerson:r["a"],WorkflowProgress:i["a"],AddCaseDialog:b,EditCaseDialog:S},directives:{dragDialog:{bind(e,t,a,s){const o=e.querySelector(".el-dialog__header"),r=e.querySelector(".el-dialog");o.style.cursor="move";const i=r.currentStyle||window.getComputedStyle(r,null);o.onmousedown=e=>{const t=e.clientX-o.offsetLeft,a=e.clientY-o.offsetTop;let s,l;i.left.includes("%")?(s=+document.body.clientWidth*(+i.left.replace(/%/g,"")/100),l=+document.body.clientHeight*(+i.top.replace(/%/g,"")/100)):(s=+i.left.replace(/\px/g,""),l=+i.top.replace(/\px/g,"")),document.onmousemove=function(e){const o=e.clientX-t,i=e.clientY-a;r.style.left=o+s+"px",r.style.top=i+l+"px"},document.onmouseup=function(e){document.onmousemove=null,document.onmouseup=null}}}}},data(){return{loading:!1,activeTab:"contractInfo",contractNo:"",contractId:null,isEditMode:!0,customerName:"",businessPersonName:"",technicalDirectorName:"",partyAContactName:"",partyBSignerName:"",partyBCompanyName:"",customerOptions:[],customerContacts:[],technicalDirectorOptions:[],ourCompanyOptions:[],userOptions:[],customerLoading:!1,loadingStates:{customers:!1,technicalDirectors:!1,ourCompanies:!1,users:!1},form:{customerId:"",contractNo:"",contractCode:"",contractName:"",contractType:"",serviceType:"",status:"草稿",summary:"",businessPersonId:"",technicalDirectorId:"",technicalDepartment:"",paperStatus:"0",partyAContactId:"",partyAPhone:"",partyAEmail:"",partyAAddress:"",partyBSignerId:"",partyBPhone:"",partyBCompanyId:"",partyBAddress:"",serviceFee:0,officialFee:0,channelFee:0,totalServiceFee:0,totalAmount:0,signingDate:"",validity:null,additionalTerms:"",remark:"",serviceList:[],creator:"",createTime:"",updater:"",updateTime:""},formRules:{customerId:[{required:!0,message:"请选择客户",trigger:"change"}],contractName:[{required:!0,message:"请输入合同名称",trigger:"blur"}],contractType:[{required:!0,message:"请选择合同类型",trigger:"change"}],serviceType:[{required:!0,message:"请选择业务服务类型",trigger:"change"}],businessPersonId:[{required:!0,message:"请选择业务人员",trigger:"change"}],partyAContactId:[{required:!0,message:"请选择甲方联系人",trigger:"change"}],partyAAddress:[{required:!0,message:"请输入甲方签约地址",trigger:"blur"}],partyBSignerId:[{required:!0,message:"请选择乙方签约人",trigger:"change"}],partyBCompanyId:[{required:!0,message:"请选择乙方签约公司",trigger:"change"}]},attachmentList:[],caseAttachments:[{id:1,fileType:"文档",fileCategory:"申请文件",fileName:"专利申请书.pdf",fileDesc:"智能家居控制系统发明专利申请书",uploadTime:"2024-01-12 10:30:15",uploader:"张工程师",file:"patent_application.pdf"},{id:2,fileType:"文档",fileCategory:"技术文件",fileName:"技术交底书.docx",fileDesc:"详细的技术方案说明文档",uploadTime:"2024-01-12 14:20:30",uploader:"张工程师",file:"technical_disclosure.docx"},{id:3,fileType:"图片",fileCategory:"附图",fileName:"系统架构图.png",fileDesc:"智能家居系统整体架构示意图",uploadTime:"2024-01-13 09:15:45",uploader:"李工程师",file:"system_architecture.png"}],caseList:[],caseDetailDialogVisible:!1,caseActiveTab:"basicInfo",caseViewMode:!0,caseDetail:{id:"",caseName:"",caseType:"",businessType:"",applyType:"",agency:"",support:"",productName:"",applyNo:"",applyDate:"",trademarkCategory:"",applyCountry:"",remark:"",clientName:""},caseFormVisible:!1,caseFormMode:"add",currentCaseData:{},currentCaseType:"",editCaseDialogVisible:!1,currentEditCaseData:{},techLeaderOptions:[],techContactOptions:[],projectSelectVisible:!1,projectSelectList:[],projectSelectLoading:!1,projectSelectQuery:{keyword:"",pageNum:1,pageSize:10},projectSelectTotal:0,techServiceSelectVisible:!1,techServiceTreeData:[],techServiceLoading:!1,selectedTechService:null,caseFeeList:[],caseAttachmentList:[],fileSubTypeOptions:{technical:[{label:"技术交底书",value:"disclosure"},{label:"技术方案",value:"solution"},{label:"图纸",value:"drawing"}],legal:[{label:"委托书",value:"authorization"},{label:"声明书",value:"declaration"},{label:"证明文件",value:"certificate"}],financial:[{label:"发票",value:"invoice"},{label:"收据",value:"receipt"},{label:"付款凭证",value:"payment"}],other:[{label:"其他",value:"other"}]},uploadUrl:window.location.protocol+"//127.0.0.1:8017/api/upload",uploadHeaders:{Authorization:"Bearer "+(this.$store?this.$store.getters.token:"")},attachmentDialogVisible:!1,attachmentDialogTitle:"",attachmentForm:{id:void 0,fileType:"",fileCategory:"",fileName:"",fileDesc:"",file:null},attachmentFormRules:{fileType:[{required:!0,message:"请选择文件大类",trigger:"change"}],fileCategory:[{required:!0,message:"请选择文件小类",trigger:"change"}],fileDesc:[{required:!0,message:"请输入文件描述",trigger:"blur"}],file:[{required:!0,message:"请选择文件",trigger:"change"}]},fileList:[],fileTypeOptions:[],fileCategoryOptions:[],fileDescOptions:[],serviceDialogVisible:!1,serviceDialogTitle:"添加服务",serviceForm:{id:null,serviceName:"",serviceDescription:"",amount:0,currency:0,totalAmount:""},contractPreviewVisible:!1,feesTableData:{serviceFeeTotal:"0.00",officialFeeTotal:"0.00",serviceFees:[],officialFees:[]},businessServiceTypes:[{category:"专利",items:[{value:"专利申请",label:"专利申请"},{value:"实用新型申请",label:"实用新型申请"},{value:"外观申请",label:"外观申请"},{value:"专利无效宣告",label:"专利无效宣告"},{value:"无效宣告答辩",label:"无效宣告答辩"},{value:"专利复审",label:"专利复审"},{value:"专利转让",label:"专利转让"},{value:"专利变更",label:"专利变更"},{value:"专利年费代缴",label:"专利年费代缴"},{value:"海外单一国申请",label:"海外单一国申请"},{value:"PCT国际阶段",label:"PCT国际阶段"},{value:"PCT国家阶段",label:"PCT国家阶段"},{value:"香港登记",label:"香港登记"},{value:"澳门登记",label:"澳门登记"},{value:"公众意见",label:"公众意见"},{value:"翻译",label:"翻译"},{value:"许可备案",label:"许可备案"},{value:"专利海关备案",label:"专利海关备案"},{value:"办理专利薄附本",label:"办理专利薄附本"},{value:"专利权评价报告",label:"专利权评价报告"},{value:"集成电路布图登记",label:"集成电路布图登记"},{value:"优先审查",label:"优先审查"},{value:"快速预审",label:"快速预审"},{value:"代理机构变更",label:"代理机构变更"},{value:"资产评估",label:"资产评估"},{value:"发明人变更",label:"发明人变更"},{value:"专利权人更名",label:"专利权人更名"},{value:"专利导航分析",label:"专利导航分析"},{value:"专利稳定性分析",label:"专利稳定性分析"},{value:"无效宣告检索分析",label:"无效宣告检索分析"},{value:"专利微导航",label:"专利微导航"},{value:"侵权比对分析",label:"侵权比对分析"},{value:"新创性检索",label:"新创性检索"},{value:"侵权检索",label:"侵权检索"}]},{category:"商标",items:[{value:"商标注册申请",label:"商标注册申请"},{value:"撤回商标注册申请",label:"撤回商标注册申请"}]},{category:"版权",items:[{value:"版权登记",label:"版权登记"}]},{category:"科服",items:[{value:"知识产权贯标",label:"知识产权贯标"},{value:"两融合贯标",label:"两融合贯标"},{value:"项目申报",label:"项目申报"},{value:"项目验收",label:"项目验收"}]}]}},created(){this.initializeData(),this.$route.query.id&&this.getContractDetail()},computed:{},methods:{handleContractTypeChange(e){this.form.serviceType="standard"===e?"":"non-standard"===e?[]:""},async initializeData(){try{await Promise.all([this.loadOurCompanyOptions(),this.loadCustomerOptions(),this.loadUserOptions()]),this.setDefaultCreatorInfo()}catch(e){console.error("初始化数据失败:",e)}},setDefaultCreatorInfo(){if(!this.isEditMode){const e=new Date;this.form.creator="当前用户",this.form.createTime=e.toISOString().slice(0,19).replace("T"," ")}},async getContractDetail(){try{this.loading=!0;const p=this.$route.query.id;this.contractId=p;const m=await T["a"].getContract(p);if(m.data.success){var e,t,a,s,o,r,i,l,c,n,d;const p=m.data.data;await Promise.all([this.loadCustomerOptions(),this.loadUserOptions(),this.loadOurCompanyOptions()]),this.form={...this.form,customerId:p.customer_id,contractNo:p.contract_no,contractCode:p.contract_code,contractName:p.contract_name,contractType:p.contract_type||"standard",serviceType:p.service_type||("non-standard"===p.contract_type?[]:""),businessPersonId:p.business_person_id,technicalDirectorId:p.technical_director_id,technicalDepartment:p.technical_department,paperStatus:p.paper_status?"1":"0",partyAContactId:p.party_a_contact_id,partyAPhone:p.party_a_phone,partyAEmail:p.party_a_email,partyAAddress:p.party_a_address,partyBSignerId:p.party_b_signer_id,partyBPhone:p.party_b_phone,partyBCompanyId:p.party_b_company_id,partyBAddress:p.party_b_address,serviceFee:p.service_fee,officialFee:p.official_fee,channelFee:p.channel_fee,totalServiceFee:p.total_service_fee,totalAmount:p.total_amount,signingDate:p.signing_date,validity:p.validity_start_date&&p.validity_end_date?[p.validity_start_date,p.validity_end_date]:null,additionalTerms:p.additional_terms,remark:p.remark,summary:p.summary,creator:(null===(e=p.creator)||void 0===e?void 0:e.real_name)||(null===(t=p.creator)||void 0===t?void 0:t.name)||"",createdBy:p.created_by,createTime:p.created_at,updater:(null===(a=p.updater)||void 0===a?void 0:a.real_name)||(null===(s=p.updater)||void 0===s?void 0:s.name)||"",updateTime:p.updated_at},this.contractNo=p.contract_no,this.customerName=(null===(o=p.customer)||void 0===o?void 0:o.customer_name)||"",this.businessPersonName=(null===(r=p.businessPerson)||void 0===r?void 0:r.name)||"",this.technicalDirectorName=(null===(i=p.technicalDirector)||void 0===i?void 0:i.name)||"",this.partyAContactName=(null===(l=p.partyAContact)||void 0===l?void 0:l.contact_name)||"",this.partyBSignerName=(null===(c=p.partyBSigner)||void 0===c?void 0:c.name)||"",this.partyBCompanyName=(null===(n=p.partyBCompany)||void 0===n?void 0:n.short_name)||(null===(d=p.partyBCompany)||void 0===d?void 0:d.company_name)||"",p.services&&p.services.length>0&&(this.form.serviceList=p.services.map(e=>({id:e.id,serviceName:e.service_name,serviceDescription:e.service_description,amount:e.amount,currency:e.official_fee,totalAmount:e.remark}))),p.attachments&&p.attachments.length>0&&(this.attachmentList=p.attachments.map(e=>({id:e.id,file_name:e.file_name,file_type:e.file_type,file_sub_type:e.file_sub_type,upload_time:e.upload_time||e.created_at,uploader:e.uploader}))),p.customer_id&&await this.handleCustomerChange(p.customer_id),await this.loadCaseList(),this.$nextTick(()=>{this.$forceUpdate()})}}catch(p){console.error("获取合同详情失败:",p),this.$message.error("获取合同详情失败")}finally{this.loading=!1}},async handleCustomerChange(e){if(!e)return this.customerContacts=[],this.technicalDirectorOptions=[],this.form.partyAContactId="",this.form.partyAPhone="",this.form.partyAEmail="",this.form.businessPersonId="",this.form.technicalDirectorId="",void(this.form.technicalDepartment="");try{const t=await n["a"].get(e);if(t.data&&t.data.success){const e=t.data.data;this.customerContacts=e.contacts||[],e.business_person_id&&(this.form.businessPersonId=e.business_person_id),this.technicalDirectorOptions=(e.contacts||[]).filter(e=>"技术主导"===e.contact_type_text||"技术人员"===e.contact_type_text).map(e=>({id:e.id,name:e.contact_name,department:e.department,phone:e.phone,email:e.email}))}}catch(t){console.error("获取客户详情失败:",t)}},async loadOurCompanyOptions(){if(!(this.loadingStates.ourCompanies||this.ourCompanyOptions.length>0)){this.loadingStates.ourCompanies=!0;try{const e=await d["a"].ourCompany.getOptions();e.data&&0===e.data.code&&(this.ourCompanyOptions=e.data.data||[])}catch(e){console.error("加载我方公司选项失败:",e)}finally{this.loadingStates.ourCompanies=!1}}},async handleSave(){try{this.loading=!0;const e=await this.$refs.form.validate();if(!e)return void this.$message.error("请完善必填信息");const t={customer_id:this.form.customerId,contract_name:this.form.contractName,contract_type:this.form.contractType,service_type:this.form.serviceType,business_person_id:this.form.businessPersonId,technical_director_id:this.form.technicalDirectorId,technical_department:this.form.technicalDepartment,paper_status:this.form.paperStatus,party_a_contact_id:this.form.partyAContactId,party_a_phone:this.form.partyAPhone,party_a_email:this.form.partyAEmail,party_a_address:this.form.partyAAddress,party_b_signer_id:this.form.partyBSignerId,party_b_phone:this.form.partyBPhone,party_b_company_id:this.form.partyBCompanyId,party_b_address:this.form.partyBAddress,service_fee:parseFloat(this.form.serviceFee||0),official_fee:parseFloat(this.form.officialFee||0),channel_fee:parseFloat(this.form.channelFee||0),total_service_fee:parseFloat(this.form.totalServiceFee||0),total_amount:parseFloat(this.form.totalAmount||0),signing_date:this.form.signingDate,validity_start_date:this.form.validity?this.form.validity[0]:null,validity_end_date:this.form.validity?this.form.validity[1]:null,summary:this.form.summary,additional_terms:this.form.additionalTerms,remark:this.form.remark,contract_code:this.form.contractCode||null,services:this.form.serviceList.map(e=>({service_name:e.serviceName,service_description:e.serviceDescription,amount:parseFloat(e.amount||0),official_fee:parseFloat(e.currency||0),remark:e.totalAmount}))},a=await T["a"].updateContract(this.$route.query.id,t);a.data.success?(this.$message.success(a.data.message),await this.getContractDetail()):this.$message.error(a.data.message||"保存失败")}catch(t){var e;console.error("保存失败:",t),this.$message.error("保存失败："+((null===(e=t.response)||void 0===e||null===(e=e.data)||void 0===e?void 0:e.message)||t.message))}finally{this.loading=!1}},handleEdit(){this.$message.success("进入编辑模式")},handleCancel(){this.$router.go(-1)},handleDelete(){this.$confirm("确认删除该合同?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{this.$message.success("删除成功")})},handleTransfer(){this.$message.success("开始流转")},handleReturn(){this.$router.go(-1)},handleMove(){this.$message.success("开始移交")},updateTotalAmount(){const e=parseFloat(this.form.serviceFee||0),t=parseFloat(this.form.officialFee||0),a=parseFloat(this.form.channelFee||0);this.form.totalServiceFee=(e+a).toFixed(2),this.form.totalAmount=(e+t+a).toFixed(2)},async loadUserOptions(){if(!(this.loadingStates.users||this.userOptions.length>0)){this.loadingStates.users=!0;try{const e=await D["default"].getList({pageSize:1e3});e.data&&e.data.success&&(this.userOptions=e.data.data.data||[])}catch(e){console.error("加载用户选项失败:",e)}finally{this.loadingStates.users=!1}}},async loadCustomerOptions(){this.customerLoading=!0;try{const e=await n["a"].getList({pageSize:100});e.data&&e.data.success&&(this.customerOptions=e.data.data.list||[])}catch(e){console.error("加载客户选项失败:",e)}finally{this.customerLoading=!1}},async searchCustomers(e){if(e){this.customerLoading=!0;try{const t=await n["a"].getList({name:e,pageSize:50});t.data&&t.data.success&&(this.customerOptions=t.data.data.list||[])}catch(t){console.error("搜索客户失败:",t)}finally{this.customerLoading=!1}}else await this.loadCustomerOptions()},async handleCustomerFocus(){0===this.customerOptions.length&&await this.loadCustomerOptions()},handleBusinessPersonChange(e,t){console.log("业务人员变更:",e,t)},async handlePartyAContactChange(e){if(!e)return this.form.partyAPhone="",void(this.form.partyAEmail="");const t=this.customerContacts.find(t=>t.id===e);t&&(this.form.partyAPhone=t.phone||"",this.form.partyAEmail=t.email||"")},async handlePartyBSignerChange(e){if(e)try{const t=await D["default"].getDetail(e);if(t&&t.data&&t.data.success){const e=t.data.data;e&&e.phone&&(this.form.partyBPhone=e.phone)}}catch(t){console.error("获取签约人信息失败:",t)}else this.form.partyBPhone=""},async handleTechnicalDirectorChange(e){if(e)try{const t=this.technicalDirectorOptions.find(t=>t.id===e);t&&(this.form.technicalDepartment=t.department||"")}catch(t){console.error("获取技术主导部门失败:",t)}else this.form.technicalDepartment=""},async handleCompanyChange(e){if(e)try{const t=this.ourCompanyOptions.find(t=>t.id===e);if(t&&t.address)return void(this.form.partyBAddress=t.address);const a=await d["a"].ourCompany.getDetail(e);if(a.data&&0===a.data.code){const e=a.data.data;this.form.partyBAddress=e.address||""}}catch(t){console.error("获取公司地址失败:",t)}else this.form.partyBAddress=""},handlePreview(){this.contractPreviewVisible=!0},getServiceTypeText(){const e={trademark:"商标注册服务",patent:"专利申请服务",copyright:"版权登记服务",software:"软件著作权登记服务"};return e[this.form.serviceType]||this.form.serviceType||"知识产权服务"},printContract(){const e=document.querySelector(".contract-preview-dialog");e&&e.classList.add("print-mode"),setTimeout(()=>{window.print(),setTimeout(()=>{e&&e.classList.remove("print-mode")},1e3)},100)},exportContractPDF(){this.printContract()},switchToCaseEditMode(){this.caseViewMode=!1},saveCaseBasicInfo(){this.$message.success("保存成功"),this.caseViewMode=!0},cancelCaseEdit(){this.caseViewMode=!0},handleAddFee(){this.$message.info("新增服务费功能")},handleEditFee(e){this.$message.info("编辑服务费功能")},handleDeleteFee(e){this.$message.info("删除服务费功能")},handleEditOfficialFee(e){this.$message.info("编辑官费功能")},handleDeleteOfficialFee(e){this.$message.info("删除官费功能")},async loadCaseList(){try{const e=this.$route.query.id;if(!e)return;const t=await n["a"].getContractCaseRecords({contract_id:e,page:1,page_size:999});if(t.data&&t.data.success){const e=t.data.data;this.caseList=e.list||e||[],console.log("加载的项目列表:",this.caseList),console.log("项目列表数量:",this.caseList.length),this.caseList.length>0&&(console.log("第一个项目的字段:",Object.keys(this.caseList[0])),console.log("第一个项目的数据:",this.caseList[0]))}else console.error("API返回失败:",t.data)}catch(e){console.error("加载项目列表失败:",e),this.caseList=[]}},formatDateTime(e){if(!e)return"";const t=new Date(e);return t.toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"})},getCaseTypeText(e){const t={1:"专利",2:"商标",3:"版权",4:"科服"};return t[e]||e},getCaseStatusText(e){const t={1:"草稿",2:"待立项",3:"已提交",4:"处理中",5:"已授权",6:"已驳回",7:"已完成"};return t[e]||e},getRecordStatusType(e){const t={1:"info",2:"warning",3:"primary",4:"warning",5:"success",6:"danger",7:"success"};return t[e]||"info"},getRealCaseStatusType(e){const t={1:"info",2:"warning",3:"primary",4:"warning",5:"success",6:"danger",7:"success",8:"primary",9:"warning",10:"info"};return t[e]||"info"},formatDate(e){if(!e)return"";const t=new Date(e);return t.toLocaleDateString("zh-CN")},async loadFileTypeOptions(){try{const e=await d["a"].fileCategory.getList({page:1,limit:999,isValid:1});if(e.data&&0===e.data.code){const t=[...new Set(e.data.data.list.map(e=>e.mainCategory))];this.fileTypeOptions=t.filter(e=>e).map(e=>({label:e,value:e}))}}catch(e){console.error("加载文件类型失败:",e),this.fileTypeOptions=[{label:"技术文档",value:"技术文档"},{label:"法律文档",value:"法律文档"},{label:"商务文档",value:"商务文档"},{label:"其他文档",value:"其他文档"}]}},async handleFileTypeChange(e){if(this.attachmentForm.fileCategory="",this.attachmentForm.fileDesc="",this.fileCategoryOptions=[],this.fileDescOptions=[],e)try{const t=await d["a"].fileCategory.getList({page:1,limit:999,isValid:1,mainCategory:e});if(t.data&&0===t.data.code){const e=[...new Set(t.data.data.list.map(e=>e.subCategory))];this.fileCategoryOptions=e.filter(e=>e).map(e=>({label:e,value:e}))}}catch(t){console.error("加载文件小类失败:",t),this.fileCategoryOptions=[{label:"申请文件",value:"申请文件"},{label:"证明文件",value:"证明文件"},{label:"授权文件",value:"授权文件"},{label:"其他",value:"其他"}]}},async handleFileCategoryChange(e){if(this.attachmentForm.fileDesc="",this.fileDescOptions=[],e&&this.attachmentForm.fileType)try{const t=await d["a"].fileDescription.getList({page:1,limit:999,isValid:1,fileCategoryMajor:this.attachmentForm.fileType,fileCategoryMinor:e});t.data&&0===t.data.code&&(this.fileDescOptions=t.data.data.list.map(e=>({label:e.description,value:e.description})))}catch(t){console.error("加载文件描述失败:",t),this.fileDescOptions=[{label:e,value:e},{label:"其他",value:"其他"}]}},generatePreviewContent(){return`\n        <!DOCTYPE html>\n        <html>\n        <head>\n          <meta charset="UTF-8">\n          <title>合同预览 - ${this.form.contractName}</title>\n          <style>\n            body { font-family: Arial, sans-serif; margin: 20px; line-height: 1.6; }\n            .header { text-align: center; margin-bottom: 30px; }\n            .title { font-size: 24px; font-weight: bold; margin-bottom: 10px; }\n            .contract-no { color: #666; }\n            .section { margin-bottom: 20px; }\n            .section-title { font-size: 18px; font-weight: bold; margin-bottom: 10px; border-bottom: 2px solid #333; }\n            .info-row { display: flex; margin-bottom: 8px; }\n            .info-label { width: 120px; font-weight: bold; }\n            .info-value { flex: 1; }\n            .service-table { width: 100%; border-collapse: collapse; margin-top: 10px; }\n            .service-table th, .service-table td { border: 1px solid #ddd; padding: 8px; text-align: left; }\n            .service-table th { background-color: #f2f2f2; }\n            @media print { body { margin: 0; } }\n          </style>\n        </head>\n        <body>\n          <div class="header">\n            <div class="title">${this.form.contractName||"合同名称"}</div>\n            <div class="contract-no">合同编号：${this.form.contractNo||"待生成"}</div>\n          </div>\n\n          <div class="section">\n            <div class="section-title">基本信息</div>\n            <div class="info-row">\n              <div class="info-label">客户：</div>\n              <div class="info-value">${this.customerName}</div>\n            </div>\n            <div class="info-row">\n              <div class="info-label">业务类型：</div>\n              <div class="info-value">${this.form.serviceType}</div>\n            </div>\n            <div class="info-row">\n              <div class="info-label">业务人员：</div>\n              <div class="info-value">${this.businessPersonName}</div>\n            </div>\n            <div class="info-row">\n              <div class="info-label">技术主导：</div>\n              <div class="info-value">${this.technicalDirectorName}</div>\n            </div>\n            <div class="info-row">\n              <div class="info-label">签约日期：</div>\n              <div class="info-value">${this.form.signingDate||""}</div>\n            </div>\n          </div>\n\n          <div class="section">\n            <div class="section-title">甲方信息</div>\n            <div class="info-row">\n              <div class="info-label">联系人：</div>\n              <div class="info-value">${this.partyAContactName}</div>\n            </div>\n            <div class="info-row">\n              <div class="info-label">电话：</div>\n              <div class="info-value">${this.form.partyAPhone||""}</div>\n            </div>\n            <div class="info-row">\n              <div class="info-label">邮箱：</div>\n              <div class="info-value">${this.form.partyAEmail||""}</div>\n            </div>\n            <div class="info-row">\n              <div class="info-label">地址：</div>\n              <div class="info-value">${this.form.partyAAddress||""}</div>\n            </div>\n          </div>\n\n          <div class="section">\n            <div class="section-title">乙方信息</div>\n            <div class="info-row">\n              <div class="info-label">签约人：</div>\n              <div class="info-value">${this.partyBSignerName}</div>\n            </div>\n            <div class="info-row">\n              <div class="info-label">手机：</div>\n              <div class="info-value">${this.form.partyBPhone||""}</div>\n            </div>\n            <div class="info-row">\n              <div class="info-label">公司：</div>\n              <div class="info-value">${this.partyBCompanyName}</div>\n            </div>\n            <div class="info-row">\n              <div class="info-label">地址：</div>\n              <div class="info-value">${this.form.partyBAddress||""}</div>\n            </div>\n          </div>\n\n          <div class="section">\n            <div class="section-title">金额信息</div>\n            <div class="info-row">\n              <div class="info-label">服务费：</div>\n              <div class="info-value">¥${this.form.serviceFee||0}</div>\n            </div>\n            <div class="info-row">\n              <div class="info-label">官费：</div>\n              <div class="info-value">¥${this.form.officialFee||0}</div>\n            </div>\n            <div class="info-row">\n              <div class="info-label">渠道费：</div>\n              <div class="info-value">¥${this.form.channelFee||0}</div>\n            </div>\n            <div class="info-row">\n              <div class="info-label">总金额：</div>\n              <div class="info-value">¥${this.form.totalAmount||0}</div>\n            </div>\n          </div>\n\n          ${this.form.serviceList&&this.form.serviceList.length>0?`\n          <div class="section">\n            <div class="section-title">服务明细</div>\n            <table class="service-table">\n              <thead>\n                <tr>\n                  <th>服务内容</th>\n                  <th>项目名称</th>\n                  <th>服务费</th>\n                  <th>官费</th>\n                  <th>备注</th>\n                </tr>\n              </thead>\n              <tbody>\n                ${this.form.serviceList.map(e=>`\n                  <tr>\n                    <td>${e.serviceName||""}</td>\n                    <td>${e.serviceDescription||""}</td>\n                    <td>¥${e.amount||0}</td>\n                    <td>¥${e.currency||0}</td>\n                    <td>${e.totalAmount||""}</td>\n                  </tr>\n                `).join("")}\n              </tbody>\n            </table>\n          </div>\n          `:""}\n\n          ${this.form.additionalTerms?`\n          <div class="section">\n            <div class="section-title">附加条款</div>\n            <div>${this.form.additionalTerms}</div>\n          </div>\n          `:""}\n\n          ${this.form.remark?`\n          <div class="section">\n            <div class="section-title">备注</div>\n            <div>${this.form.remark}</div>\n          </div>\n          `:""}\n        </body>\n        </html>\n      `},handleAddService(){this.serviceDialogTitle="添加服务",this.serviceForm={id:null,serviceName:"",serviceDescription:"",amount:0,currency:0,totalAmount:""},this.serviceDialogVisible=!0},handleEditService(e){this.serviceDialogTitle="编辑服务",this.serviceForm={id:e.id,serviceName:e.serviceName,serviceDescription:e.serviceDescription,amount:e.amount,currency:e.currency,totalAmount:e.totalAmount},this.serviceDialogVisible=!0},handleDeleteService(e){this.$confirm("确认删除该服务项目?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{const t=this.form.serviceList.findIndex(t=>t.id===e.id);t>-1&&(this.form.serviceList.splice(t,1),this.$message.success("删除成功"),this.updateTotalAmount())}).catch(()=>{this.$message.info("已取消删除")})},handleSaveService(){if(this.serviceForm.serviceName){if(this.serviceForm.id){const e=this.form.serviceList.findIndex(e=>e.id===this.serviceForm.id);e>-1&&this.form.serviceList.splice(e,1,{...this.serviceForm})}else this.serviceForm.id=Date.now(),this.form.serviceList.push({...this.serviceForm});this.serviceDialogVisible=!1,this.updateTotalAmount(),this.$message.success("保存成功")}else this.$message.error("请输入服务内容")},handleCancelService(){this.serviceDialogVisible=!1},handleUpload(){this.resetAttachmentForm(),this.attachmentDialogTitle="新增附件",this.attachmentDialogVisible=!0,this.fileList=[]},async handleDownload(e){try{const t=this.$route.query.id,a=await T["a"].downloadContractAttachment(t,e.id),s=window.URL.createObjectURL(new Blob([a.data])),o=document.createElement("a");o.href=s,o.setAttribute("download",e.file_name),document.body.appendChild(o),o.click(),document.body.removeChild(o),window.URL.revokeObjectURL(s),this.$message.success("下载成功")}catch(t){console.error("下载失败:",t),this.$message.error("下载失败")}},async handleDeleteFile(e){this.$confirm(`确认删除文件：${e.file_name}?`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{const t=this.$route.query.id;await T["a"].deleteContractAttachment(t,e.id);const a=this.attachmentList.findIndex(t=>t.id===e.id);-1!==a&&this.attachmentList.splice(a,1),this.$message.success("删除成功")}catch(t){console.error("删除失败:",t),this.$message.error("删除失败")}}).catch(()=>{this.$message.info("已取消删除")})},resetAttachmentForm(){this.attachmentForm={id:void 0,fileType:"",fileCategory:"",fileName:"",fileDesc:"",file:null},this.$refs.attachmentForm&&this.$refs.attachmentForm.clearValidate()},async submitAttachmentForm(){this.$refs.attachmentForm.validate(async e=>{if(e)try{const e=this.$route.query.id;if(!this.attachmentForm.file)return void this.$message.error("请选择要上传的文件");const t=new FormData;t.append("file",this.attachmentForm.file),t.append("file_type",this.attachmentForm.fileType),t.append("file_sub_type",this.attachmentForm.fileCategory),t.append("file_desc",this.attachmentForm.fileDesc||"");const a=await T["a"].uploadContractAttachment(e,t);a.data&&a.data.success?(this.attachmentList.push(a.data.data),this.$message.success("附件上传成功"),this.attachmentDialogVisible=!1):this.$message.error(a.data.message||"上传失败")}catch(t){console.error("上传附件失败:",t),this.$message.error("上传失败")}})},handleAttachmentChange(e,t){this.fileList=t,"ready"===e.status&&(this.attachmentForm.fileName=e.name,this.attachmentForm.file=e.raw)},handleRemoveAttachment(e,t){this.fileList=t,0===t.length&&(this.attachmentForm.file=null,this.attachmentForm.fileName="")},handleAddCase(){this.caseFormMode="add",this.currentCaseData={},this.caseFormVisible=!0},handleSelectProject(e){e?(this.currentCaseType=e,this.projectSelectVisible=!0):this.$message.warning("请先选择项目类型")},handleProjectSelectOpen(){this.resetProjectSearch(),this.searchProjects()},resetProjectSearch(){this.projectSelectQuery={keyword:"",pageNum:1,pageSize:10},this.projectSelectList=[],this.projectSelectTotal=0},async searchProjects(){this.projectSelectLoading=!0;try{const e={page:this.projectSelectQuery.pageNum,page_size:this.projectSelectQuery.pageSize};if(this.currentCaseType&&"all"!==this.currentCaseType){const t={"专利":1,"商标":2,"版权":3,"科服":4};e.case_type=t[this.currentCaseType]||this.currentCaseType}this.projectSelectQuery.keyword&&(e.case_name=this.projectSelectQuery.keyword);const t=await n["a"].getCaseList(e);if(t.data&&t.data.success){const e=t.data.data;this.projectSelectList=e.list||e||[],this.projectSelectTotal=e.total||0}}catch(e){console.error("搜索项目失败:",e),this.$message.error("搜索项目失败")}finally{this.projectSelectLoading=!1}},handleProjectRowClick(e){this.selectProject(e)},selectProject(e){this.$refs.addCaseDialog&&this.$refs.addCaseDialog.setSelectedProject&&this.$refs.addCaseDialog.setSelectedProject(e),this.$refs.editCaseDialog&&this.$refs.editCaseDialog.setSelectedProject&&this.$refs.editCaseDialog.setSelectedProject(e),this.projectSelectVisible=!1,this.$message.success("项目选择成功")},handleProjectSizeChange(e){this.projectSelectQuery.pageSize=e,this.projectSelectQuery.pageNum=1,this.searchProjects()},handleProjectCurrentChange(e){this.projectSelectQuery.pageNum=e,this.searchProjects()},handleSelectTechService(){this.techServiceSelectVisible=!0},async handleTechServiceSelectOpen(){this.techServiceLoading=!0;try{const e=await d["a"].techServiceRegion.getTreeData();e.data&&e.data.success&&(this.techServiceTreeData=e.data.data||[])}catch(e){console.error("加载科技服务树数据失败:",e),this.$message.error("加载科技服务数据失败")}finally{this.techServiceLoading=!1}},handleTechServiceCheck(e,t){t.checkedNodes.length>0?this.selectedTechService=t.checkedNodes[0]:this.selectedTechService=null},confirmTechServiceSelect(){this.selectedTechService?(this.$refs.addCaseDialog&&this.$refs.addCaseDialog.setSelectedTechService&&this.$refs.addCaseDialog.setSelectedTechService(this.selectedTechService),this.techServiceSelectVisible=!1,this.$message.success("科技服务选择成功")):this.$message.warning("请选择科技服务事项")},handleEditCase(e){e.is_filed?this.$message.warning("该项目已立项，不允许编辑"):(this.currentEditCaseData={...e},this.editCaseDialogVisible=!0)},handleCopyCase(e){this.caseFormMode="copy",this.currentCaseData={...e},this.caseFormVisible=!0},handleCaseSuccess(){this.loadCaseList()},handleCaseDialogClose(){this.currentCaseData={}},handleEditCaseDialogClose(){this.currentEditCaseData={}},async handleDeleteCase(e){this.$confirm(`确认删除项目：${e.case_name||e.caseName}?`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{if(e.is_filed)return void this.$message.error("该项目已立项，不允许删除");const a=await n["a"].deleteContractCaseRecord(e.id);if(a.data&&a.data.success){const t=this.caseList.findIndex(t=>t.id===e.id);-1!==t&&this.caseList.splice(t,1),this.$message.success("项目删除成功")}else{var t;this.$message.error((null===(t=a.data)||void 0===t?void 0:t.message)||"删除失败")}}catch(s){var a;console.error("删除项目失败:",s),this.$message.error("删除项目失败："+((null===(a=s.response)||void 0===a||null===(a=a.data)||void 0===a?void 0:a.message)||s.message))}}).catch(()=>{this.$message.info("已取消删除")})},handleDetailCaseTypeChange(){},handleWorkflowStarted(){this.$message.success("审批流程已发起"),this.$refs.workflowProgress&&this.$refs.workflowProgress.refresh(),this.getContractDetail()},handleWorkflowCancelled(){this.$message.success("审批流程已取消"),this.$refs.workflowProgress&&this.$refs.workflowProgress.refresh(),this.getContractDetail()},handleWorkflowRestarted(){this.$message.success("审批流程已重新发起"),this.$refs.workflowProgress&&this.$refs.workflowProgress.refresh(),this.getContractDetail()},handleTaskProcessed(){this.getContractDetail(),this.$refs.workflowProgress&&this.$refs.workflowProgress.refresh()}}},A=k,$=(a("e7dd"),Object(f["a"])(A,s,o,!1,null,null,null));t["default"]=$.exports},d3ff:function(e,t,a){"use strict";var s=a("7419");t["a"]=s},dad2:function(e,t,a){"use strict";var s=a("d066"),o=function(e){return{size:e,has:function(){return!1},keys:function(){return{next:function(){return{done:!0}}}}}},r=function(e){return{size:e,has:function(){return!0},keys:function(){throw new Error("e")}}};e.exports=function(e,t){var a=s("Set");try{(new a)[e](o(0));try{return(new a)[e](o(-1)),!1}catch(l){if(!t)return!0;try{return(new a)[e](r(-1/0)),!1}catch(c){var i=new a;return i.add(1),i.add(2),t(i[e](r(1/0)))}}}catch(c){return!1}}},dc19:function(e,t,a){"use strict";var s=a("cb27").has;e.exports=function(e){return s(e),e}},e7dd:function(e,t,a){"use strict";a("0a61")},e9bc:function(e,t,a){"use strict";var s=a("dc19"),o=a("cb27").add,r=a("83b9e"),i=a("7f65"),l=a("5388");e.exports=function(e){var t=s(this),a=i(e).getIterator(),c=r(t);return l(a,(function(e){o(c,e)})),c}}}]);