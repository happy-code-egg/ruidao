(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-eae599f8"],{"2e8a":function(e,t,s){"use strict";s("8e71")},"8e71":function(e,t,s){},dac6:function(e,t,s){"use strict";s.r(t);var i=function(){var e=this,t=e._self._c;return t("div",{staticClass:"permission"},[t("div",{staticClass:"body-part-search"},[t("div",[t("el-form",{attrs:{inline:!0,model:e.searchForm}},[t("el-form-item",{attrs:{label:"权限名称"}},[t("el-input",{attrs:{size:"small",placeholder:"权限名称"},model:{value:e.searchForm.name,callback:function(t){e.$set(e.searchForm,"name",t)},expression:"searchForm.name"}})],1),t("el-form-item",{attrs:{label:"权限类型"}},[t("el-select",{attrs:{size:"small",placeholder:"请选择"},model:{value:e.searchForm.type,callback:function(t){e.$set(e.searchForm,"type",t)},expression:"searchForm.type"}},[t("el-option",{attrs:{label:"全部",value:""}}),t("el-option",{attrs:{label:"菜单",value:"menu"}}),t("el-option",{attrs:{label:"页面",value:"page"}}),t("el-option",{attrs:{label:"按钮",value:"button"}}),t("el-option",{attrs:{label:"接口",value:"api"}})],1)],1),t("el-form-item",[t("el-button",{attrs:{size:"small",type:"primary"},on:{click:e.handleSearch}},[e._v("查询")]),t("el-button",{attrs:{size:"small"},on:{click:e.resetSearch}},[e._v("重置")])],1)],1)],1)]),t("div",{staticClass:"body-part-content"},[t("div",{staticClass:"part-table-header"},[t("div",{staticClass:"part-table-title"},[e._v(" 权限管理 ")]),t("div",{staticClass:"part-table-operations"},[t("el-button",{attrs:{size:"small",type:"primary"},on:{click:e.showAddDialog}},[e._v("添加权限")])],1)]),t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{width:"100%","margin-bottom":"20px"},attrs:{data:e.permissionTableData,"row-key":"id",size:"small",border:"","default-expand-all":"","tree-props":{children:"children",hasChildren:"hasChildren"}}},[t("el-table-column",{attrs:{prop:"name",label:"权限名称"}}),t("el-table-column",{attrs:{prop:"code",label:"权限标识"}}),t("el-table-column",{attrs:{prop:"type",align:"center",label:"权限类型",width:"120"},scopedSlots:e._u([{key:"default",fn:function(s){return[t("el-tag",{attrs:{type:e.getTagType(s.row.type)}},[e._v(" "+e._s(e.getTypeName(s.row.type))+" ")])]}}])}),t("el-table-column",{attrs:{prop:"path",label:"路径"}}),t("el-table-column",{attrs:{prop:"sort",align:"center",label:"排序",width:"80"}}),t("el-table-column",{attrs:{align:"center",label:"操作",width:"250",fixed:"right"},scopedSlots:e._u([{key:"default",fn:function(s){return[t("el-button",{attrs:{size:"mini"},on:{click:function(t){return e.handleEdit(s.row)}}},[e._v("编辑")]),"menu"===s.row.type||"page"===s.row.type?t("el-button",{attrs:{size:"mini",type:"success"},on:{click:function(t){return e.handleAddChild(s.row)}}},[e._v("添加子项")]):e._e(),t("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(t){return e.handleDelete(s.row)}}},[e._v("删除")])]}}])})],1)],1),t("el-dialog",{attrs:{title:e.dialogTitle,visible:e.dialogVisible,width:"500px","append-to-body":"","close-on-click-modal":!1},on:{"update:visible":function(t){e.dialogVisible=t}}},[t("el-form",{ref:"permissionForm",attrs:{model:e.permissionForm,rules:e.rules,"label-width":"100px"}},[t("el-form-item",{attrs:{label:"上级权限"}},[t("el-cascader",{staticStyle:{width:"100%"},attrs:{options:e.permissionOptions,props:e.cascaderProps,clearable:"",placeholder:"选择上级权限（可选）",disabled:e.isEdit&&0===e.permissionForm.parentId,"show-all-levels":!1,filterable:""},model:{value:e.permissionForm.parentIdArray,callback:function(t){e.$set(e.permissionForm,"parentIdArray",t)},expression:"permissionForm.parentIdArray"}})],1),t("el-form-item",{attrs:{label:"权限名称",prop:"name"}},[t("el-input",{model:{value:e.permissionForm.name,callback:function(t){e.$set(e.permissionForm,"name",t)},expression:"permissionForm.name"}})],1),t("el-form-item",{attrs:{label:"权限标识",prop:"code"}},[t("el-input",{attrs:{disabled:e.isEdit,placeholder:e.getCodePlaceholder()},model:{value:e.permissionForm.code,callback:function(t){e.$set(e.permissionForm,"code",t)},expression:"permissionForm.code"}}),t("div",{staticClass:"form-help-text"},[t("i",{staticClass:"el-icon-info"}),t("div",{domProps:{innerHTML:e._s(e.getCodeTip())}})])],1),t("el-form-item",{attrs:{label:"权限类型",prop:"type"}},[t("el-select",{attrs:{placeholder:"请选择"},model:{value:e.permissionForm.type,callback:function(t){e.$set(e.permissionForm,"type",t)},expression:"permissionForm.type"}},[t("el-option",{attrs:{label:"菜单",value:"menu"}}),t("el-option",{attrs:{label:"页面",value:"page"}}),t("el-option",{attrs:{label:"按钮",value:"button"}}),t("el-option",{attrs:{label:"接口",value:"api"}})],1)],1),"menu"===e.permissionForm.type||"page"===e.permissionForm.type?t("el-form-item",{attrs:{label:"路径",prop:"path"}},[t("el-input",{model:{value:e.permissionForm.path,callback:function(t){e.$set(e.permissionForm,"path",t)},expression:"permissionForm.path"}})],1):e._e(),t("el-form-item",{attrs:{label:"排序"}},[t("el-input-number",{attrs:{min:1,max:999},model:{value:e.permissionForm.sort,callback:function(t){e.$set(e.permissionForm,"sort",t)},expression:"permissionForm.sort"}})],1),t("el-form-item",{attrs:{label:"描述"}},[t("el-input",{attrs:{type:"textarea",rows:3},model:{value:e.permissionForm.description,callback:function(t){e.$set(e.permissionForm,"description",t)},expression:"permissionForm.description"}})],1)],1),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.dialogVisible=!1}}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.submitForm}},[e._v("确 定")])],1)],1)],1)},r=[],o=(s("14d9"),s("e9f5"),s("910d"),s("7d54"),s("ab43"),s("a732"),{name:"PermissionManagement",data(){return{searchForm:{name:"",type:""},permissionList:[],permissionTableData:[],permissionOptions:[],loading:!1,dialogVisible:!1,dialogTitle:"添加权限",isEdit:!1,isAddChild:!1,parentPermission:null,permissionForm:{id:null,parentId:0,parentIdArray:[],name:"",code:"",type:"menu",path:"",sort:1,description:""},rules:{name:[{required:!0,message:"请输入权限名称",trigger:"blur"}],code:[{required:!0,message:"请输入权限标识",trigger:"blur"}],type:[{required:!0,message:"请选择权限类型",trigger:"change"}],path:[{required:!0,message:"请输入路径",trigger:"blur"}]},cascaderProps:{checkStrictly:!0,value:"id",label:"name",children:"children",emitPath:!0}}},created(){this.fetchData()},methods:{async fetchData(){this.loading=!0;try{const e=await this.$api.permission.getList({keyword:this.searchForm.name,permission_type:this.getTypeValue(this.searchForm.type)});0===e.data.code?(this.permissionList=this.convertApiDataToLocal(e.data.data),this.buildPermissionTree(),this.buildPermissionOptions()):(this.$message.error(e.data.msg||"获取权限列表失败"),this.fetchDataMock())}catch(e){console.error("获取权限列表失败:",e),this.$message.error("获取权限列表失败，使用模拟数据"),this.fetchDataMock()}finally{this.loading=!1}},convertApiDataToLocal(e){const t=e=>({id:e.id,parentId:e.parent_id,name:e.permission_name,code:e.permission_code,type:this.getLocalType(e.permission_type),path:e.resource_url||"",sort:e.sort_order||1,description:"",children:e.children?e.children.map(t):[]});return this.flattenTree(e.map(t))},flattenTree(e){const t=[],s=e=>{e.forEach(e=>{const{children:i,...r}=e;t.push(r),i&&i.length>0&&s(i)})};return s(e),t},getTypeValue(e){const t={menu:1,page:2,button:3,api:4};return e?t[e]:""},getLocalType(e){const t={1:"menu",2:"page",3:"button",4:"api"};return t[e]||"menu"},fetchDataMock(){this.permissionList=[{id:1,parentId:0,name:"系统管理",code:"system",type:"menu",path:"/config/system",sort:1,description:"系统管理模块"},{id:101,parentId:1,name:"用户管理",code:"system:user",type:"menu",path:"/config/system/user",sort:1,description:"用户管理页面"},{id:10101,parentId:101,name:"用户查询",code:"system:user:list",type:"button",path:"",sort:1,description:"用户查询权限"},{id:10102,parentId:101,name:"用户新增",code:"system:user:add",type:"button",path:"",sort:2,description:"用户新增权限"},{id:10103,parentId:101,name:"用户修改",code:"system:user:edit",type:"button",path:"",sort:3,description:"用户修改权限"},{id:10104,parentId:101,name:"用户删除",code:"system:user:delete",type:"button",path:"",sort:4,description:"用户删除权限"},{id:102,parentId:1,name:"角色管理",code:"system:role",type:"menu",path:"/config/system/role",sort:2,description:"角色管理页面"},{id:10201,parentId:102,name:"角色查询",code:"system:role:list",type:"button",path:"",sort:1,description:"角色查询权限"},{id:10202,parentId:102,name:"角色新增",code:"system:role:add",type:"button",path:"",sort:2,description:"角色新增权限"},{id:10203,parentId:102,name:"角色修改",code:"system:role:edit",type:"button",path:"",sort:3,description:"角色修改权限"},{id:10204,parentId:102,name:"角色删除",code:"system:role:delete",type:"button",path:"",sort:4,description:"角色删除权限"},{id:103,parentId:1,name:"权限管理",code:"system:permission",type:"menu",path:"/config/system/permission",sort:3,description:"权限管理页面"},{id:104,parentId:1,name:"部门管理",code:"system:department",type:"menu",path:"/config/system/department",sort:4,description:"部门管理页面"},{id:105,parentId:1,name:"系统日志",code:"system:log",type:"menu",path:"/config/system/log",sort:5,description:"系统日志页面"},{id:2,parentId:0,name:"客户管理",code:"customer",type:"menu",path:"/customer",sort:2,description:"客户管理模块"}];let e=[...this.permissionList];this.searchForm.name&&(e=e.filter(e=>e.name.toLowerCase().includes(this.searchForm.name.toLowerCase()))),this.searchForm.type&&(e=e.filter(e=>e.type===this.searchForm.type)),this.permissionTableData=this.buildPermissionTree(e),this.buildPermissionOptions(),this.loading=!1},buildPermissionTree(e=null){const t=e||this.permissionList;this.permissionTableData=this.convertToTree(t)},convertToTree(e){const t=e.filter(e=>0===e.parentId),s=t=>t.map(t=>{const i=e.filter(e=>e.parentId===t.id);return i.length>0?{...t,children:s(i)}:{...t}});return s(t)},buildPermissionOptions(){const e=this.permissionList.filter(e=>"menu"===e.type||"page"===e.type),t=this.convertToTree(e),s=e=>e.map(e=>({...e,children:e.children?s(e.children):[]}));this.permissionOptions=s(t)},getTypeName(e){switch(e){case"menu":return"菜单";case"page":return"页面";case"button":return"按钮";case"api":return"接口";default:return"未知"}},getTagType(e){switch(e){case"menu":return"primary";case"page":return"info";case"button":return"success";case"api":return"warning";default:return"info"}},getCodePlaceholder(){switch(this.permissionForm.type){case"menu":return"如：system、customer、finance";case"page":return"如：/system/user、/customer/list";case"button":return"如：system:user:add、customer:info:edit";case"api":return"如：api.user.create、api.customer.list";default:return"请输入权限标识"}},getCodeTip(){const e=`\n        <table style="width: 100%; font-size: 11px; border-collapse: collapse; margin-top: 8px;">\n          <thead>\n            <tr style="background-color: #f0f2f5;">\n              <th style="padding: 4px 8px; border: 1px solid #d9d9d9; text-align: left;">权限类型</th>\n              <th style="padding: 4px 8px; border: 1px solid #d9d9d9; text-align: left;">标识格式</th>\n              <th style="padding: 4px 8px; border: 1px solid #d9d9d9; text-align: left;">示例</th>\n              <th style="padding: 4px 8px; border: 1px solid #d9d9d9; text-align: left;">说明</th>\n            </tr>\n          </thead>\n          <tbody>\n            <tr${"menu"===this.permissionForm.type?' style="background-color: #e6f7ff;"':""}>\n              <td style="padding: 4px 8px; border: 1px solid #d9d9d9;"><strong>菜单</strong></td>\n              <td style="padding: 4px 8px; border: 1px solid #d9d9d9;">模块名称</td>\n              <td style="padding: 4px 8px; border: 1px solid #d9d9d9; font-family: monospace;">system、customer</td>\n              <td style="padding: 4px 8px; border: 1px solid #d9d9d9;">简洁英文单词</td>\n            </tr>\n            <tr${"page"===this.permissionForm.type?' style="background-color: #e6f7ff;"':""}>\n              <td style="padding: 4px 8px; border: 1px solid #d9d9d9;"><strong>页面</strong></td>\n              <td style="padding: 4px 8px; border: 1px solid #d9d9d9;">路由路径</td>\n              <td style="padding: 4px 8px; border: 1px solid #d9d9d9; font-family: monospace;">/system/user、/customer/list</td>\n              <td style="padding: 4px 8px; border: 1px solid #d9d9d9;">页面路由形式</td>\n            </tr>\n            <tr${"button"===this.permissionForm.type?' style="background-color: #e6f7ff;"':""}>\n              <td style="padding: 4px 8px; border: 1px solid #d9d9d9;"><strong>按钮</strong></td>\n              <td style="padding: 4px 8px; border: 1px solid #d9d9d9;">冒号分隔</td>\n              <td style="padding: 4px 8px; border: 1px solid #d9d9d9; font-family: monospace;">system:user:add、customer:info:edit</td>\n              <td style="padding: 4px 8px; border: 1px solid #d9d9d9;">模块:功能:操作</td>\n            </tr>\n            <tr${"api"===this.permissionForm.type?' style="background-color: #e6f7ff;"':""}>\n              <td style="padding: 4px 8px; border: 1px solid #d9d9d9;"><strong>接口</strong></td>\n              <td style="padding: 4px 8px; border: 1px solid #d9d9d9;">点号分隔</td>\n              <td style="padding: 4px 8px; border: 1px solid #d9d9d9; font-family: monospace;">api.user.create、api.customer.list</td>\n              <td style="padding: 4px 8px; border: 1px solid #d9d9d9;">API命名空间</td>\n            </tr>\n          </tbody>\n        </table>\n      `;return e},getParentIdPath(e){if(!e||0===e)return[];const t=(e,s,i=[])=>{for(const r of e){const e=[...i,r.id];if(r.id===s)return e;if(r.children&&r.children.length>0){const i=t(r.children,s,e);if(i)return i}}return null},s=t(this.permissionOptions,e);return s||[]},getChildCodePrefix(e){switch(e.type){case"menu":return`/${e.code}/`;case"page":return e.code.replace(/^\//,"").replace(/\//g,":")+":";case"api":return e.code+".";default:return""}},handleSearch(){this.fetchData()},resetSearch(){this.searchForm={name:"",type:""},this.handleSearch()},showAddDialog(){this.dialogTitle="添加权限",this.isEdit=!1,this.isAddChild=!1,this.permissionForm={id:null,parentId:0,parentIdArray:[],name:"",code:"",type:"menu",path:"",sort:1,description:""},this.dialogVisible=!0,this.$nextTick(()=>{this.$refs.permissionForm&&this.$refs.permissionForm.clearValidate()})},handleEdit(e){this.dialogTitle="编辑权限",this.isEdit=!0,this.isAddChild=!1,this.$nextTick(()=>{this.permissionForm={id:e.id,parentId:e.parentId,parentIdArray:this.getParentIdPath(e.parentId),name:e.name,code:e.code,type:e.type,path:e.path||"",sort:e.sort,description:e.description||""},this.dialogVisible=!0,this.$nextTick(()=>{this.$refs.permissionForm&&this.$refs.permissionForm.clearValidate()})})},handleAddChild(e){this.dialogTitle=`添加 "${e.name}" 的子项`,this.isEdit=!1,this.isAddChild=!0,this.parentPermission=e,this.$nextTick(()=>{this.permissionForm={id:null,parentId:e.id,parentIdArray:this.getParentIdPath(e.id),name:"",code:this.getChildCodePrefix(e),type:"button",path:"",sort:1,description:""},this.dialogVisible=!0,this.$nextTick(()=>{this.$refs.permissionForm&&this.$refs.permissionForm.clearValidate()})})},handleDelete(e){const t=this.permissionList.some(t=>t.parentId===e.id);t?this.$message.error("该权限下存在子项，不能删除"):this.$confirm("确认删除该权限吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{const t=await this.$api.permission.delete(e.id);0===t.data.code?(this.$message.success("删除成功!"),this.fetchData()):this.$message.error(t.data.msg||"删除失败")}catch(t){console.error("删除权限失败:",t),this.$message.error("删除失败")}}).catch(()=>{this.$message({type:"info",message:"已取消删除"})})},submitForm(){this.$refs.permissionForm.validate(async e=>{if(e)try{const e=this.permissionForm.parentIdArray&&this.permissionForm.parentIdArray.length>0?this.permissionForm.parentIdArray[this.permissionForm.parentIdArray.length-1]:0,t={permission_code:this.permissionForm.code,permission_name:this.permissionForm.name,parent_id:e,permission_type:this.getTypeValue(this.permissionForm.type),resource_url:this.permissionForm.path,sort_order:this.permissionForm.sort};let s;s=this.isEdit?await this.$api.permission.update(this.permissionForm.id,t):await this.$api.permission.create(t),0===s.data.code?(this.$message.success(this.isEdit?"权限更新成功":"权限创建成功"),this.dialogVisible=!1,this.fetchData()):this.$message.error(s.data.msg||"操作失败")}catch(t){console.error("提交权限信息失败:",t),this.$message.error("操作失败，请稍后重试")}})}}}),a=o,n=(s("2e8a"),s("2877")),d=Object(n["a"])(a,i,r,!1,null,null,null);t["default"]=d.exports}}]);