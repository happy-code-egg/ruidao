(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-3bb10cea"],{"0d26":function(e,t,a){"use strict";var s=a("e330"),r=Error,o=s("".replace),l=function(e){return String(new r(e).stack)}("zxcasd"),i=/\n\s*at [^:]*:[^\n]*/,n=i.test(l);e.exports=function(e,t){if(n&&"string"==typeof e&&!r.prepareStackTrace)while(t--)e=o(e,i,"");return e}},1787:function(e,t,a){"use strict";var s=a("861d");e.exports=function(e){return s(e)||null===e}},"205f":function(e,t,a){"use strict";a("e153")},"2ba4":function(e,t,a){"use strict";var s=a("40d5"),r=Function.prototype,o=r.apply,l=r.call;e.exports="object"==typeof Reflect&&Reflect.apply||(s?l.bind(o):function(){return l.apply(o,arguments)})},"3bbe":function(e,t,a){"use strict";var s=a("1787"),r=String,o=TypeError;e.exports=function(e){if(s(e))return e;throw new o("Can't set "+r(e)+" as a prototype")}},"582a":function(e,t,a){"use strict";var s=function(){var e=this,t=e._self._c;return t("div",{staticClass:"select-applicant-wrapper"},[t("el-button",{attrs:{size:"small",type:"primary",icon:"el-icon-plus",disabled:e.disabled},on:{click:e.handleClick}},[e._v(" 选择申请人 ")]),t("el-dialog",{attrs:{title:"选择申请人",visible:e.dialogVisible,width:"600px","close-on-click-modal":!1,"close-on-press-escape":!0},on:{"update:visible":function(t){e.dialogVisible=t},close:e.handleCancel}},[t("div",{staticClass:"search-section"},[t("el-input",{attrs:{placeholder:"请输入申请人名称、信用代码或地区","prefix-icon":"el-icon-search",clearable:""},on:{clear:e.handleSearch,input:e.handleSearch},model:{value:e.searchKeyword,callback:function(t){e.searchKeyword=t},expression:"searchKeyword"}})],1),t("div",{staticClass:"table-container"},[e.loading||0!==e.filteredApplicantData.length?t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"table",staticStyle:{width:"100%"},attrs:{data:e.filteredApplicantData,"show-checkbox":e.multiple,"check-strictly":!1,height:"400","element-loading-text":"加载申请人数据中..."},on:{"selection-change":e.handleSelectionChange,"row-click":e.handleRowClick}},[e.multiple?t("el-table-column",{attrs:{type:"selection",width:"55",align:"center"}}):e._e(),t("el-table-column",{attrs:{label:"申请人名称",prop:"name","min-width":"200","show-overflow-tooltip":""}}),t("el-table-column",{attrs:{label:"信用代码",prop:"creditCode","min-width":"180","show-overflow-tooltip":""}}),t("el-table-column",{attrs:{label:"省",prop:"province",width:"80"}}),t("el-table-column",{attrs:{label:"市",prop:"city",width:"100"}}),t("el-table-column",{attrs:{label:"地址",prop:"address","min-width":"200","show-overflow-tooltip":""}})],1):t("div",{staticClass:"no-data-tip"},[t("el-empty",{attrs:{description:"该客户暂无申请人数据，请先在客户管理中添加申请人"}})],1)],1),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:e.handleReset}},[e._v("重置")]),t("el-button",{on:{click:e.handleCancel}},[e._v("取消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.handleConfirm}},[e._v("确定")])],1)])],1)},r=[],o=(a("e9f5"),a("910d"),a("f665"),a("7d54"),a("ab43"),a("f6b0")),l={name:"SelectApplicant",model:{prop:"value",event:"input"},props:{value:{type:Array,default:()=>[]},multiple:{type:Boolean,default:!0},disabled:{type:Boolean,default:!1},customerId:{type:[String,Number],default:""}},data(){return{dialogVisible:!1,searchKeyword:"",selectedApplicants:[],loading:!1,originalApplicantData:[],fallbackApplicantData:[{id:"applicant-1",name:"北京科技有限公司",creditCode:"91110000123456789A",province:"北京",city:"北京市",address:"北京市海淀区中关村大街1号"},{id:"applicant-2",name:"上海智能技术有限公司",creditCode:"91310000234567890B",province:"上海",city:"上海市",address:"上海市浦东新区张江路2号"},{id:"applicant-3",name:"深圳创新科技股份有限公司",creditCode:"91440300345678901C",province:"广东",city:"深圳市",address:"深圳市南山区科技园南区3号"},{id:"applicant-4",name:"杭州网络技术有限公司",creditCode:"91330100456789012D",province:"浙江",city:"杭州市",address:"杭州市西湖区文三路4号"},{id:"applicant-5",name:"广州软件开发有限公司",creditCode:"91440100567890123E",province:"广东",city:"广州市",address:"广州市天河区珠江新城5号"},{id:"applicant-6",name:"南京信息技术有限公司",creditCode:"91320100678901234F",province:"江苏",city:"南京市",address:"南京市玄武区中山路6号"},{id:"applicant-7",name:"武汉数据科技有限公司",creditCode:"91420100789012345G",province:"湖北",city:"武汉市",address:"武汉市洪山区光谷大道7号"},{id:"applicant-8",name:"成都人工智能有限公司",creditCode:"91510100890123456H",province:"四川",city:"成都市",address:"成都市高新区天府大道8号"},{id:"applicant-9",name:"西安电子科技有限公司",creditCode:"91610100901234567I",province:"陕西",city:"西安市",address:"西安市雁塔区科技路9号"},{id:"applicant-10",name:"青岛海洋科技有限公司",creditCode:"91370200012345678J",province:"山东",city:"青岛市",address:"青岛市市南区香港中路10号"}]}},computed:{filteredApplicantData(){const e=this.originalApplicantData;if(console.log("SelectApplicant: filteredApplicantData计算",{originalDataLength:this.originalApplicantData.length,dataSourceLength:e.length,customerId:this.customerId}),!this.searchKeyword.trim())return e;const t=this.searchKeyword.trim().toLowerCase();return e.filter(e=>e.name.toLowerCase().includes(t)||e.creditCode&&e.creditCode.toLowerCase().includes(t)||e.province&&e.province.toLowerCase().includes(t)||e.city&&e.city.toLowerCase().includes(t)||e.address&&e.address.toLowerCase().includes(t))}},watch:{value:{immediate:!0,handler(e){this.initSelectedApplicants(e)}},dialogVisible:{handler(e){e&&(console.log("SelectApplicant: 对话框打开, customerId:",this.customerId),this.customerId&&this.loadApplicantData(),this.$nextTick(()=>{this.syncTableSelection()}))}},customerId:{handler(e){e&&this.loadApplicantData()},immediate:!0}},created(){this.customerId&&this.loadApplicantData()},methods:{async loadApplicantData(){if(console.log("SelectApplicant: 开始加载申请人数据, customerId:",this.customerId),this.customerId){this.loading=!0;try{console.log("SelectApplicant: 调用API获取申请人列表, 参数:",{customer_id:this.customerId,page:1,page_size:999});const e=await o["a"].getApplicantList({customer_id:this.customerId,page:1,page_size:999});if(console.log("SelectApplicant: API响应:",e.data),e.data&&e.data.success){const t=e.data.data.list||[];console.log("SelectApplicant: 获取到申请人数据:",t.length,"条"),this.originalApplicantData=t.map(e=>({id:e.id,name:e.applicant_name_cn||e.applicantName||"",creditCode:e.applicant_code||"",province:e.province||"",city:e.city||"",address:e.business_location||e.address||"",type:e.applicant_type||"",country:e.country||""})),console.log("SelectApplicant: 处理后的申请人数据:",this.originalApplicantData)}else console.warn("SelectApplicant: 获取申请人列表失败，API返回:",e.data),console.warn("SelectApplicant: 使用备用数据")}catch(e){console.error("SelectApplicant: 加载申请人数据失败:",e),console.warn("SelectApplicant: 使用备用数据")}finally{this.loading=!1}}else console.warn("SelectApplicant: 未提供客户ID，使用备用数据")},initSelectedApplicants(e){this.selectedApplicants=Array.isArray(e)?[...e]:[]},handleClick(){this.disabled||(console.log("SelectApplicant: 点击选择申请人按钮, customerId:",this.customerId),this.dialogVisible=!0,this.customerId&&0===this.originalApplicantData.length&&(console.log("SelectApplicant: 对话框打开时重新加载数据"),this.loadApplicantData()))},handleSearch(){},handleSelectionChange(e){this.multiple&&(this.selectedApplicants=e)},handleRowClick(e){this.multiple||(this.selectedApplicants=[e],this.handleConfirm())},handleConfirm(){this.emitChange(),this.dialogVisible=!1},handleCancel(){this.initSelectedApplicants(this.value),this.dialogVisible=!1,this.searchKeyword=""},handleReset(){this.selectedApplicants=[],this.searchKeyword="",this.$refs.table&&this.$refs.table.clearSelection&&this.$refs.table.clearSelection()},emitChange(){const e=[...this.selectedApplicants];this.$emit("input",e),this.$emit("change",e)},syncTableSelection(){this.$refs.table&&this.multiple&&(this.$refs.table.clearSelection(),this.selectedApplicants.forEach(e=>{const t=this.filteredApplicantData.find(t=>t.id===e.id);t&&this.$refs.table.toggleRowSelection(t,!0)}))}}},i=l,n=(a("205f"),a("2877")),c=Object(n["a"])(i,s,r,!1,null,"7e143a36",null);t["a"]=c.exports},"6f19":function(e,t,a){"use strict";var s=a("9112"),r=a("0d26"),o=a("b980"),l=Error.captureStackTrace;e.exports=function(e,t,a,i){o&&(l?l(e,t):s(e,"stack",r(a,i)))}},7156:function(e,t,a){"use strict";var s=a("1626"),r=a("861d"),o=a("d2bb");e.exports=function(e,t,a){var l,i;return o&&s(l=t.constructor)&&l!==a&&r(i=l.prototype)&&i!==a.prototype&&o(e,i),e}},a146:function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e._self._c;return t("div",{staticClass:"project-case-form"},[t("div",{staticClass:"form-header"},[t("el-button-group",[t("el-button",{attrs:{icon:"el-icon-back"},on:{click:e.handleCancel}},[e._v("取消")]),e.showSaveButton?t("el-button",{attrs:{type:"primary",icon:"el-icon-document-add"},on:{click:e.handleSave}},[e._v("保存")]):e._e()],1)],1),t("el-form",{ref:"form",staticClass:"case-form",attrs:{model:e.form,rules:e.rules,"label-width":"120px",disabled:e.computedReadOnly}},[t("el-row",[t("el-col",{attrs:{span:6}},[t("el-form-item",{attrs:{label:"立项编号",prop:"proposalNo"}},[t("el-input",{attrs:{placeholder:"输入立项编号"},model:{value:e.form.proposalNo,callback:function(t){e.$set(e.form,"proposalNo",t)},expression:"form.proposalNo"}})],1)],1),t("el-col",{attrs:{span:6}},[t("el-form-item",{attrs:{label:"预项名称",prop:"caseName"}},[t("el-input",{attrs:{placeholder:"输入预项名称"},model:{value:e.form.caseName,callback:function(t){e.$set(e.form,"caseName",t)},expression:"form.caseName"}})],1)],1),t("el-col",{attrs:{span:6}},[t("el-form-item",{attrs:{label:"科技服务名称"}},[t("el-select",{attrs:{placeholder:"请选择"},model:{value:e.form.techServiceName,callback:function(t){e.$set(e.form,"techServiceName",t)},expression:"form.techServiceName"}},e._l(e.techServiceNameOptions,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)],1),t("el-col",{attrs:{span:6}},[t("el-form-item",{attrs:{label:"客户名称"}},[t("el-input",{attrs:{placeholder:"输入客户名称"},model:{value:e.form.customerName,callback:function(t){e.$set(e.form,"customerName",t)},expression:"form.customerName"}})],1)],1)],1),t("el-row",[t("el-col",{attrs:{span:6}},[t("el-form-item",{attrs:{label:"业务人员"}},[t("SelectPerson",{attrs:{multiple:!1,placeholder:"请选择业务人员"},on:{change:e.handleBusinessPersonChange},model:{value:e.form.businessPerson,callback:function(t){e.$set(e.form,"businessPerson",t)},expression:"form.businessPerson"}})],1)],1),t("el-col",{attrs:{span:6}},[t("el-form-item",{attrs:{label:"乙方签约公司"}},[t("el-select",{attrs:{placeholder:"请选择"},model:{value:e.form.company,callback:function(t){e.$set(e.form,"company",t)},expression:"form.company"}},e._l(e.companyOptions,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)],1),t("el-col",{attrs:{span:6}},[t("el-form-item",{attrs:{label:"业务类型"}},[t("el-select",{attrs:{placeholder:"请选择"},model:{value:e.form.businessType,callback:function(t){e.$set(e.form,"businessType",t)},expression:"form.businessType"}},e._l(e.businessTypeOptions,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)],1),t("el-col",{attrs:{span:6}},[t("el-form-item",{attrs:{label:"申请类型"}},[t("el-select",{attrs:{placeholder:"请选择"},model:{value:e.form.applyType,callback:function(t){e.$set(e.form,"applyType",t)},expression:"form.applyType"}},e._l(e.applyTypeOptions,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)],1)],1),t("el-row",[t("el-col",{attrs:{span:6}},[t("el-form-item",{attrs:{label:"售前支持"}},[t("el-input",{attrs:{placeholder:"输入售前支持"},model:{value:e.form.preSales,callback:function(t){e.$set(e.form,"preSales",t)},expression:"form.preSales"}})],1)],1),t("el-col",{attrs:{span:6}},[t("el-form-item",{attrs:{label:"项目年份"}},[t("el-input",{attrs:{placeholder:"需出的的",disabled:""},model:{value:e.form.projectYear,callback:function(t){e.$set(e.form,"projectYear",t)},expression:"form.projectYear"}})],1)],1),t("el-col",{attrs:{span:6}},[t("el-form-item",{attrs:{label:"申报批次"}},[t("el-input",{attrs:{placeholder:"市出求，可收改"},model:{value:e.form.applyBatch,callback:function(t){e.$set(e.form,"applyBatch",t)},expression:"form.applyBatch"}})],1)],1),t("el-col",{attrs:{span:6}},[t("el-form-item",{attrs:{label:"科技服务级别"}},[t("el-select",{attrs:{placeholder:"请选择"},model:{value:e.form.techServiceLevel,callback:function(t){e.$set(e.form,"techServiceLevel",t)},expression:"form.techServiceLevel"}},e._l(e.techServiceLevelOptions,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)],1)],1),t("el-row",[t("el-col",{attrs:{span:6}},[t("el-form-item",{attrs:{label:"主管地"}},[t("el-input",{attrs:{placeholder:"需出的的",disabled:""},model:{value:e.form.supervisoryLocation,callback:function(t){e.$set(e.form,"supervisoryLocation",t)},expression:"form.supervisoryLocation"}})],1)],1),t("el-col",{attrs:{span:6}},[t("el-form-item",{attrs:{label:"主管部门"}},[t("el-input",{attrs:{placeholder:"需出的的",disabled:""},model:{value:e.form.supervisoryDepartment,callback:function(t){e.$set(e.form,"supervisoryDepartment",t)},expression:"form.supervisoryDepartment"}})],1)],1),t("el-col",{attrs:{span:6}},[t("el-form-item",{attrs:{label:"政府预估奖励"}},[t("el-input",{attrs:{placeholder:"输入政府预估奖励"},model:{value:e.form.governmentReward,callback:function(t){e.$set(e.form,"governmentReward",t)},expression:"form.governmentReward"}})],1)],1),t("el-col",{attrs:{span:6}},[t("el-form-item",{attrs:{label:"费用比例"}},[t("el-input",{attrs:{placeholder:"输入费用比例"},model:{value:e.form.costRatio,callback:function(t){e.$set(e.form,"costRatio",t)},expression:"form.costRatio"}})],1)],1)],1),t("el-row",[t("el-col",{attrs:{span:6}},[t("el-form-item",{attrs:{label:"技术对接"}},[t("el-input",{attrs:{placeholder:"输入技术对接"},model:{value:e.form.technicalContact,callback:function(t){e.$set(e.form,"technicalContact",t)},expression:"form.technicalContact"}})],1)],1),t("el-col",{attrs:{span:6}},[t("el-form-item",{attrs:{label:"是否加急"}},[t("el-select",{attrs:{placeholder:"请选择"},model:{value:e.form.isUrgent,callback:function(t){e.$set(e.form,"isUrgent",t)},expression:"form.isUrgent"}},[t("el-option",{attrs:{label:"是",value:"是"}}),t("el-option",{attrs:{label:"否",value:"否"}})],1)],1)],1),t("el-col",{attrs:{span:6}},[t("el-form-item",{attrs:{label:"项目处理人"}},[t("SelectPerson",{attrs:{multiple:!1,placeholder:"请选择项目处理人"},on:{change:e.handleCaseHandlerChange},model:{value:e.form.caseHandler,callback:function(t){e.$set(e.form,"caseHandler",t)},expression:"form.caseHandler"}})],1)],1),t("el-col",{attrs:{span:6}},[t("el-form-item",{attrs:{label:"技术主导"}},[t("SelectPerson",{attrs:{multiple:!1,placeholder:"请选择技术主导"},on:{change:e.handleTechLeaderChange},model:{value:e.form.technicalDirector,callback:function(t){e.$set(e.form,"technicalDirector",t)},expression:"form.technicalDirector"}})],1)],1)],1),t("el-row",[t("el-col",{attrs:{span:6}},[t("el-form-item",{attrs:{label:"客户文号"}},[t("el-input",{attrs:{placeholder:"输入客户文号"},model:{value:e.form.customerFileNumber,callback:function(t){e.$set(e.form,"customerFileNumber",t)},expression:"form.customerFileNumber"}})],1)],1),t("el-col",{attrs:{span:6}},[t("el-form-item",{attrs:{label:"合同编号"}},[t("el-input",{attrs:{placeholder:"输入合同编号"},model:{value:e.form.contractNumber,callback:function(t){e.$set(e.form,"contractNumber",t)},expression:"form.contractNumber"}})],1)],1),t("el-col",{attrs:{span:6}},[t("el-form-item",{attrs:{label:"预计启动日"}},[t("el-date-picker",{attrs:{type:"date",placeholder:"年/月/日"},model:{value:e.form.estimatedStartDate,callback:function(t){e.$set(e.form,"estimatedStartDate",t)},expression:"form.estimatedStartDate"}})],1)],1),t("el-col",{attrs:{span:6}},[t("el-form-item",{attrs:{label:"内部期限"}},[t("el-date-picker",{attrs:{type:"date",placeholder:"年/月/日"},model:{value:e.form.internalDeadline,callback:function(t){e.$set(e.form,"internalDeadline",t)},expression:"form.internalDeadline"}})],1)],1)],1),t("el-row",[t("el-col",{attrs:{span:6}},[t("el-form-item",{attrs:{label:"收单日期"}},[t("el-date-picker",{attrs:{type:"date",placeholder:"年/月/日"},model:{value:e.form.receiptDate,callback:function(t){e.$set(e.form,"receiptDate",t)},expression:"form.receiptDate"}})],1)],1),t("el-col",{attrs:{span:6}},[t("el-form-item",{attrs:{label:"预计完成日"}},[t("el-date-picker",{attrs:{type:"date",placeholder:"年/月/日"},model:{value:e.form.estimatedCompletionDate,callback:function(t){e.$set(e.form,"estimatedCompletionDate",t)},expression:"form.estimatedCompletionDate"}})],1)],1),t("el-col",{attrs:{span:6}},[t("el-form-item",{attrs:{label:"前后付费"}},[t("el-select",{attrs:{placeholder:"请选择"},model:{value:e.form.paymentMethod,callback:function(t){e.$set(e.form,"paymentMethod",t)},expression:"form.paymentMethod"}},[t("el-option",{attrs:{label:"预付",value:"预付"}}),t("el-option",{attrs:{label:"后付",value:"后付"}}),t("el-option",{attrs:{label:"预付后付",value:"预付后付"}})],1)],1)],1),t("el-col",{attrs:{span:6}},[t("el-form-item",{attrs:{label:"预计尾款"}},[t("el-input",{attrs:{placeholder:"数字",type:"number"},model:{value:e.form.estimatedFinalPayment,callback:function(t){e.$set(e.form,"estimatedFinalPayment",t)},expression:"form.estimatedFinalPayment"}})],1)],1)],1),t("el-row",[t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:"合同要求"}},[t("el-input",{attrs:{type:"textarea",placeholder:"输入合同要求",rows:3},model:{value:e.form.contractRequirements,callback:function(t){e.$set(e.form,"contractRequirements",t)},expression:"form.contractRequirements"}})],1)],1)],1),t("el-row",[t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:"项目要求"}},[t("el-input",{attrs:{type:"textarea",placeholder:"输入项目要求",rows:3},model:{value:e.form.projectRequirements,callback:function(t){e.$set(e.form,"projectRequirements",t)},expression:"form.projectRequirements"}})],1)],1)],1),t("el-row",[t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:"特别进展事项"}},[t("el-input",{attrs:{type:"textarea",placeholder:"输入特别进展事项",rows:3},model:{value:e.form.specialProgress,callback:function(t){e.$set(e.form,"specialProgress",t)},expression:"form.specialProgress"}})],1)],1)],1),t("el-row",[t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:"项目备注"}},[t("el-input",{attrs:{type:"textarea",placeholder:"带头求、还可以限编辑",rows:3},model:{value:e.form.remark,callback:function(t){e.$set(e.form,"remark",t)},expression:"form.remark"}})],1)],1)],1),t("el-form-item",{attrs:{label:"申请人"}},[t("SelectApplicant",{attrs:{multiple:!0,disabled:e.computedReadOnly,"customer-id":e.customerIdFromRoute},on:{change:e.handleApplicantChange},model:{value:e.selectedApplicants,callback:function(t){e.selectedApplicants=t},expression:"selectedApplicants"}})],1),t("el-table",{staticStyle:{width:"100%"},attrs:{data:e.applicantList,border:""}},[t("el-table-column",{attrs:{label:"序号",type:"index",width:"50",align:"center"}}),t("el-table-column",{attrs:{prop:"name",label:"申请人名称","min-width":"180"}}),t("el-table-column",{attrs:{prop:"creditCode",label:"信用代码"}}),t("el-table-column",{attrs:{prop:"province",label:"省","min-width":"100"}}),t("el-table-column",{attrs:{prop:"city",label:"市","min-width":"100"}}),t("el-table-column",{attrs:{prop:"address",label:"地址","min-width":"200","show-overflow-tooltip":""}}),t("el-table-column",{attrs:{label:"操作",width:"120",align:"center"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-button",{attrs:{size:"small",type:"text"},on:{click:function(t){return e.deleteApplicant(a.$index)}}},[e._v("删除")])]}}])})],1),t("el-form-item",{staticClass:"process-items",attrs:{label:"处理事项"}},[0!==e.processItems.length||e.computedReadOnly?e._e():t("el-button",{attrs:{size:"small",type:"primary",icon:"el-icon-plus"},on:{click:e.addProcessItem}},[e._v(" 新增处理事项 ")]),e.processItems.length>0&&!e.computedReadOnly?t("span",{staticStyle:{color:"#909399","font-size":"12px"}},[e._v(" 立项阶段只能添加一个处理事项，可以编辑现有处理事项 ")]):e._e()],1),t("el-table",{staticStyle:{width:"100%"},attrs:{data:e.processItems,border:""}},[t("el-table-column",{attrs:{label:"序号",type:"index",width:"50",align:"center"}}),t("el-table-column",{attrs:{prop:"item",label:"处理事项"}}),t("el-table-column",{attrs:{prop:"department",label:"处理部门","min-width":"120"}}),t("el-table-column",{attrs:{prop:"handler",label:"事项处理人","min-width":"120"}}),t("el-table-column",{attrs:{prop:"isReject",label:"是否配案","min-width":"100"}}),t("el-table-column",{attrs:{label:"操作",width:"120",align:"center"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-button",{attrs:{size:"small",type:"text"},on:{click:function(t){return e.editProcessItem(a.$index)}}},[e._v("编辑")])]}}])})],1),t("ProcessItemDialog",{attrs:{"process-item-data":e.currentProcessItemData,"case-type":"科服","case-id":e.caseId,"contract-fee-data":e.contractFeeData,"contract-file-data":e.contractFileData},on:{save:e.handleProcessItemSave,delete:e.handleProcessItemDelete},model:{value:e.processItemDialogVisible,callback:function(t){e.processItemDialogVisible=t},expression:"processItemDialogVisible"}})],1),e.shouldShowWorkflowSection?t("div",{staticClass:"workflow-section"},[t("div",{staticClass:"section-title"},[t("h3",[e._v("审批流程")]),t("el-divider")],1),t("div",{staticClass:"workflow-container"},[t("WorkflowProgress",{ref:"workflowProgress",attrs:{"business-type":"case","business-id":e.caseId,"can-start":e.canStartWorkflow,"can-cancel":e.canCancelWorkflow,"created-by":e.form.createdBy},on:{"workflow-started":e.handleWorkflowStarted,"workflow-cancelled":e.handleWorkflowCancelled,"workflow-restarted":e.handleWorkflowRestarted,"task-processed":e.handleTaskProcessed}})],1)]):e._e()],1)},r=[],o=(a("d9e2"),a("e9f5"),a("910d"),a("7d54"),a("ab43"),a("582a")),l=a("512b"),i=a("21a4"),n=a("48d0"),c=a("f6b0"),p=a("d4f4"),m=a("89c4"),d=a("5f87"),u={name:"ProjectCaseForm",components:{SelectApplicant:o["a"],SelectPerson:l["a"],ProcessItemDialog:i["a"],WorkflowProgress:n["a"]},props:{id:{type:[String,Number],default:""},type:{type:String,default:"draft"},customerId:{type:[String,Number],default:""},contractId:{type:[String,Number],default:""}},data(){return{loading:!1,isFromPending:!1,currentCaseStatus:null,form:{proposalNo:"",caseName:"",techServiceName:"",customerName:"",businessPerson:"",company:"",businessType:"",applyType:"",preSales:"",projectYear:"",applyBatch:"",techServiceLevel:"",supervisoryLocation:"",supervisoryDepartment:"",governmentReward:"",costRatio:"",technicalContact:"",isUrgent:"",caseHandler:"",technicalDirector:"",customerFileNumber:"",contractNumber:"",estimatedStartDate:"",internalDeadline:"",receiptDate:"",estimatedCompletionDate:"",paymentMethod:"",estimatedFinalPayment:"",contractRequirements:"",projectRequirements:"",specialProgress:"",remark:""},rules:{proposalNo:[{required:!0,message:"请输入立项编号",trigger:"blur"}],caseName:[{required:!0,message:"请输入预项名称",trigger:"blur"}],customerName:[{required:!0,message:"请输入客户名称",trigger:"blur"}]},businessPersonOptions:[],companyOptions:[],businessTypeOptions:[],applyTypeOptions:[],techServiceNameOptions:[],techServiceLevelOptions:[],applicantList:[],selectedApplicants:[],processItems:[],processItemDialogVisible:!1,currentProcessItemData:{},customerInfo:null,contractInfo:null,caseId:"",customerIdFromRoute:"",contractIdFromRoute:""}},computed:{showSaveButton(){const e=this.$route.query.from||this.$route.params.from;return"draft"===e||"pending"===e||!e},showReturnButton(){const e=this.$route.query.from||this.$route.params.from;return"to-be-pending"===e},canStartWorkflow(){const e="草稿"===this.form.caseStatus||"处理中"===this.form.caseStatus,t=Object(d["j"])(),a=t?t.id:null,s=this.form.createdBy===a||"草稿"===this.form.caseStatus&&!this.form.createdBy;return e&&s},canCancelWorkflow(){var e;return("立项中"===this.form.caseStatus||"待处理"===this.form.caseStatus)&&this.form.createdBy===(null===(e=this.$store.state.user)||void 0===e?void 0:e.id)},shouldShowWorkflowSection(){return this.caseId&&"new"!==this.caseId},computedReadOnly(){const e=this.$route.query.from||this.$route.params.from,t=this.$route.query.mode||this.$route.params.mode;return"view"===t||"filed"===e}},watch:{selectedApplicants:{handler(e){this.handleApplicantChange(e)},deep:!0}},async created(){this.caseId=this.id||this.$route.query.id||this.$route.params.id,this.customerIdFromRoute=this.customerId||this.$route.query.customerId||this.$route.query.customer_id,this.contractIdFromRoute=this.contractId||this.$route.query.contractId||this.$route.query.contract_id,console.log("初始化参数:",{caseId:this.caseId,customerIdFromRoute:this.customerIdFromRoute,contractIdFromRoute:this.contractIdFromRoute}),await this.initializeData(),this.caseId?await this.fetchCaseDetail():this.prefillDefaultData()},methods:{async initializeData(){this.loading=!0;try{await Promise.all([this.loadBusinessTypeOptions(),this.loadApplyTypeOptions(),this.loadCompanyOptions(),this.loadTechServiceOptions()]),this.customerIdFromRoute?await this.loadCustomerInfo():console.warn("未提供客户ID，申请人功能可能无法正常工作"),this.contractIdFromRoute&&await this.loadContractInfo()}catch(e){console.error("初始化数据失败:",e),this.$message.error("初始化数据失败，请刷新页面重试")}finally{this.loading=!1}},async fetchCaseDetail(){if(this.caseId){this.loading=!0;try{const e=await p["a"].getCase(this.caseId);if(e.data&&e.data.success){const t=e.data.data;this.populateFormData(t)}else this.$message.error("获取项目详情失败")}catch(e){console.error("获取项目详情失败:",e),this.$message.error("获取项目详情失败，请重试")}finally{this.loading=!1}}},prefillDefaultData(){var e;this.form.proposalNo=this.generateProposalNo(),this.form.businessType="项目",this.form.projectYear=(new Date).getFullYear().toString(),this.form.isUrgent="否",this.form.paymentMethod="预付后付",this.form.caseStatus="草稿",this.form.createdBy=null===(e=this.$store.state.user)||void 0===e?void 0:e.id,this.customerInfo&&(this.form.customerName=this.customerInfo.name||this.customerInfo.customer_name||"",this.form.businessPerson=this.customerInfo.business_person_id||""),this.contractInfo&&(this.form.contractNumber=this.contractInfo.contract_no||this.contractInfo.contract_number||"")},populateFormData(e){var t,a;e.customer_id&&!this.customerIdFromRoute&&(this.customerIdFromRoute=e.customer_id,console.log("ProjectCaseForm: 从项目详情更新customerIdFromRoute:",this.customerIdFromRoute)),console.log("ProjectCaseForm: 填充表单数据",e),console.log("ProjectCaseForm: 技术主导数据检查",{tech_leader:e.tech_leader,techLeader:e.techLeader,techLeaderType:typeof e.tech_leader,finalValue:e.tech_leader?String(e.tech_leader):e.techLeader?String(e.techLeader.id):""}),this.form={proposalNo:e.proposal_no||e.case_code||this.generateProposalNo(),caseName:e.case_name||"",techServiceName:e.tech_service_name||"",customerName:(null===(t=e.customer)||void 0===t?void 0:t.customer_name)||"",businessPerson:e.business_person_id||(e.businessPerson?e.businessPerson.id:""),company:e.company||this.getDefaultCompany(),businessType:e.case_subtype||e.business_type||"项目",applyType:e.application_type||"",preSales:e.presale_support||"",projectYear:e.project_year||(new Date).getFullYear().toString(),applyBatch:e.apply_batch||"",techServiceLevel:e.tech_service_level||"",supervisoryLocation:e.supervisory_location||"",supervisoryDepartment:e.supervisory_department||"",governmentReward:e.government_reward||"",costRatio:e.cost_ratio||"",technicalContact:e.technical_contact||"",isUrgent:e.is_urgent||"否",caseHandler:e.case_handler||(e.caseHandler?e.caseHandler.id:""),technicalDirector:e.tech_leader?String(e.tech_leader):e.techLeader?String(e.techLeader.id):"",customerFileNumber:e.customer_file_number||"",contractNumber:e.contract_number||(null===(a=this.contractInfo)||void 0===a?void 0:a.contract_no)||"",estimatedStartDate:e.estimated_start_date||"",internalDeadline:e.internal_deadline||"",receiptDate:e.receipt_date||"",estimatedCompletionDate:e.estimated_completion_date||"",paymentMethod:e.payment_method||"",estimatedFinalPayment:e.estimated_final_payment||"",contractRequirements:e.contract_requirements||"",projectRequirements:e.project_requirements||"",specialProgress:e.special_progress||"",remark:e.remarks||e.remark||""},console.log("ProjectCaseForm: 填充后的表单数据",this.form),this.$nextTick(()=>{this.form.technicalDirector&&console.log("ProjectCaseForm: 强制更新技术主导值",this.form.technicalDirector)}),e.applicant_info&&Array.isArray(e.applicant_info)&&(this.applicantList=e.applicant_info,this.selectedApplicants=[...e.applicant_info]),e.process_items&&Array.isArray(e.process_items)?this.processItems=e.process_items:this.caseId&&this.loadProcessItems()},generateProposalNo(){const e=new Date,t=e.getFullYear(),a=String(e.getMonth()+1).padStart(2,"0"),s=String(e.getDate()).padStart(2,"0"),r=Math.floor(1e3*Math.random()).toString().padStart(3,"0");return`PJ${t}${a}${s}${r}`},getDefaultCompany(){return this.companyOptions.length>0?this.companyOptions[0].value:""},async handleSave(){const e=this.$route.query.from||this.$route.params.from;return"pending"===e?this.saveCase("draft"):this.saveCase()},async saveCase(e=null){try{const r=await this.$refs.form.validate();if(!r)return;this.loading=!0;const o=this.buildFormData();let l;if(null!==e&&(o.case_status=e),console.log("提交的表单数据:",o),l=this.caseId?await p["a"].updateCase(this.caseId,o):await p["a"].createCase(o),l.data&&l.data.success){const a="draft"===e?"保存":"提交";var t;if(this.$message.success(`项目${a}成功`),!this.caseId&&l.data.data&&l.data.data.id)this.caseId=l.data.data.id,this.form.createdBy=l.data.data.created_by||(null===(t=this.$store.state.user)||void 0===t?void 0:t.id),this.form.caseStatus=this.mapNumberToStatusText(l.data.data.case_status||1);return l}var a,s;throw console.error("API返回错误:",l.data),this.$message.error((null===(a=l.data)||void 0===a?void 0:a.message)||"保存失败"),new Error((null===(s=l.data)||void 0===s?void 0:s.message)||"保存失败")}catch(o){var r;if(console.error("保存项目失败:",o),o.response&&o.response.data)console.error("错误详情:",o.response.data),this.$message.error("保存失败: "+(o.response.data.message||(null===(r=o.response.data.errors)||void 0===r||null===(r=r.case_type)||void 0===r?void 0:r[0])||"未知错误"));else this.$message.error("保存失败，请重试");throw o}finally{this.loading=!1}},handleCancel(){this.$router.go(-1)},handleWorkflowStarted(){this.$message.success("审批流程已发起"),setTimeout(()=>{this.$refs.workflowProgress&&this.$refs.workflowProgress.refresh(),this.loadCaseData()},2e3)},handleWorkflowCancelled(){this.$message.success("审批流程已取消"),this.$refs.workflowProgress&&this.$refs.workflowProgress.refresh(),this.loadCaseData()},handleWorkflowRestarted(){this.$message.success("审批流程已重新发起"),this.$refs.workflowProgress&&this.$refs.workflowProgress.refresh(),this.loadCaseData()},handleTaskProcessed(){this.loadCaseData(),this.$refs.workflowProgress&&this.$refs.workflowProgress.refresh()},async loadCaseData(){await this.fetchCaseDetail()},mapNumberToStatusText(e){const t={1:"草稿",2:"待立项",3:"已立项",4:"处理中"};return t[e]||"未知状态"},handleReturn(){this.$confirm("确定要退回该项目吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{this.$message.success("已退回")}).catch(()=>{this.$message.info("已取消退回")})},async loadBusinessTypeOptions(){try{const e=await m["a"].businessService.getList({category:"项目",status:1,page:1,limit:999});e.data&&e.data.success&&(this.businessTypeOptions=e.data.data.list.map(e=>({label:e.name,value:e.name})))}catch(e){console.error("加载业务类型选项失败:",e),this.businessTypeOptions=[{label:"项目",value:"项目"},{label:"科技服务",value:"科技服务"},{label:"政策申报",value:"政策申报"}]}},async loadApplyTypeOptions(){try{console.log("ProjectCaseForm: 开始加载申请类型选项");const e=await m["a"].applyType.getApplyAllByCaseType("项目");if(console.log("ProjectCaseForm: 申请类型API响应",e.data),!e.data||!e.data.success)throw console.warn("ProjectCaseForm: 申请类型API返回失败",e.data),new Error("API返回失败");this.applyTypeOptions=e.data.data.map(e=>({label:e.label||e.value,value:e.value||e.label})),console.log("ProjectCaseForm: 申请类型选项加载成功",this.applyTypeOptions)}catch(e){console.error("ProjectCaseForm: 加载申请类型选项失败",e),this.applyTypeOptions=[{label:"高新技术企业认定",value:"高新技术企业认定"},{label:"科技项目申报",value:"科技项目申报"},{label:"政策补贴申请",value:"政策补贴申请"},{label:"企业认证",value:"企业认证"},{label:"其他项目",value:"其他项目"}],console.log("ProjectCaseForm: 使用默认申请类型选项",this.applyTypeOptions)}},async loadCompanyOptions(){try{this.companyOptions=[{label:"北京知识产权代理有限公司",value:"北京知识产权代理有限公司"},{label:"上海专利事务所",value:"上海专利事务所"},{label:"深圳知识产权服务有限公司",value:"深圳知识产权服务有限公司"}]}catch(e){console.error("加载公司选项失败:",e)}},async loadTechServiceOptions(){try{this.techServiceNameOptions=[{label:"政策申报",value:"政策申报"},{label:"高企认定",value:"高企认定"},{label:"科技项目",value:"科技项目"},{label:"企业认证",value:"企业认证"},{label:"技术咨询",value:"技术咨询"},{label:"其他服务",value:"其他服务"}],this.techServiceLevelOptions=[{label:"国家级",value:"国家级"},{label:"省级",value:"省级"},{label:"市级",value:"市级"},{label:"区级",value:"区级"}]}catch(e){console.error("加载科技服务选项失败:",e)}},async loadCustomerInfo(){if(this.customerIdFromRoute)try{const e=await c["a"].getCustomerDetail(this.customerIdFromRoute);e.data&&e.data.success&&(this.customerInfo=e.data.data,this.form.customerName=this.customerInfo.name||this.customerInfo.customer_name||"",this.form.businessPerson=this.customerInfo.business_person_id||"")}catch(e){console.error("加载客户信息失败:",e),this.$message.warning("加载客户信息失败，请检查客户ID是否正确")}},async loadContractInfo(){this.contractIdFromRoute},buildFormData(){const e={case_type:4,case_name:this.form.caseName,customer_id:this.customerIdFromRoute?parseInt(this.customerIdFromRoute):null,contract_id:this.contractIdFromRoute?parseInt(this.contractIdFromRoute):null,proposal_no:this.form.proposalNo,tech_service_name:this.form.techServiceName,customer_name:this.form.customerName,business_person_id:this.form.businessPerson?parseInt(this.form.businessPerson):null,company:this.form.company,case_subtype:this.form.businessType,application_type:this.form.applyType,presale_support:this.form.preSales,project_year:this.form.projectYear,apply_batch:this.form.applyBatch,tech_service_level:this.form.techServiceLevel,supervisory_location:this.form.supervisoryLocation,supervisory_department:this.form.supervisoryDepartment,government_reward:this.form.governmentReward,cost_ratio:this.form.costRatio,technical_contact:this.form.technicalContact,is_urgent:this.form.isUrgent,case_handler:this.form.caseHandler?parseInt(this.form.caseHandler):null,tech_leader:this.form.technicalDirector?parseInt(this.form.technicalDirector):null,customer_file_number:this.form.customerFileNumber,contract_number:this.form.contractNumber,estimated_start_date:this.form.estimatedStartDate,internal_deadline:this.form.internalDeadline,receipt_date:this.form.receiptDate,estimated_completion_date:this.form.estimatedCompletionDate,payment_method:this.form.paymentMethod,estimated_final_payment:this.form.estimatedFinalPayment,contract_requirements:this.form.contractRequirements,project_requirements:this.form.projectRequirements,special_progress:this.form.specialProgress,remarks:this.form.remark,applicant_info:this.applicantList,process_items:this.processItems};return Object.keys(e).forEach(t=>{""!==e[t]&&null!==e[t]&&void 0!==e[t]||["case_type","case_name","customer_id"].includes(t)||delete e[t]}),e},handleBusinessPersonChange(e){console.log("业务人员变化:",e)},handleTechLeaderChange(e){console.log("技术主导变化:",e)},handleCaseHandlerChange(e){console.log("项目处理人变化:",e)},handleApplicantChange(e){this.applicantList=e.map(e=>({id:e.id,name:e.name,creditCode:e.creditCode,province:e.province,city:e.city,address:e.address,type:e.type,country:e.country}))},deleteApplicant(e){const t=this.applicantList[e];this.applicantList.splice(e,1),this.selectedApplicants=this.selectedApplicants.filter(e=>e.id!==t.id)},addProcessItem(){this.currentProcessItemData={},this.processItemDialogVisible=!0},editProcessItem(e){this.currentProcessItemData={...this.processItems[e]},this.processItemDialogVisible=!0},async handleProcessItemSave(e){try{console.log("处理事项保存成功回调，数据:",e),await this.loadProcessItems(),console.log("处理事项列表已重新加载")}catch(t){console.error("重新加载处理事项列表失败:",t)}},async handleProcessItemDelete(){try{if(this.currentProcessItemData.id){const a=await this.$api.dataConfig.caseProcess.delete(this.currentProcessItemData.id);var e,t;if(console.log("删除处理事项响应:",a.data),a.data&&(a.data.success||0===a.data.code))await this.loadProcessItems(),this.$message.success("处理事项删除成功");else this.$message.error("删除失败："+((null===(e=a.data)||void 0===e?void 0:e.message)||(null===(t=a.data)||void 0===t?void 0:t.msg)||"未知错误"))}else{const e=this.currentProcessItemData.processItem||this.currentProcessItemData.process_name;this.processItems=this.processItems.filter(t=>t.item!==e&&t.process_name!==e),this.$message.success("处理事项删除成功")}}catch(s){var a;console.error("删除处理事项失败:",s),this.$message.error("删除失败："+((null===(a=s.response)||void 0===a||null===(a=a.data)||void 0===a?void 0:a.message)||s.message||"请重试"))}},async loadProcessItems(){if(this.caseId)try{console.log("开始加载处理事项，案件ID:",this.caseId);const e=await this.$api.dataConfig.caseProcess.getByCaseId(this.caseId);if(console.log("处理事项加载响应:",e.data),e.data&&(e.data.success||0===e.data.code)){const t=e.data.data||[];this.processItems=t.map(e=>({...e,item:e.process_name,department:this.getProcessDepartment(),handler:this.getProcessHandler(e),isReject:e.is_assign?"是":"否"})),console.log("处理事项加载成功，数量:",this.processItems.length)}else console.warn("处理事项加载失败:",e.data),this.processItems=[]}catch(e){console.error("加载处理事项失败:",e),this.processItems=[]}else console.log("没有案件ID，跳过加载处理事项")},getProcessDepartment(){return"业务部"},getProcessHandler(e){return e.is_assign&&e.assignee_user&&e.assignee_user.real_name?e.assignee_user.real_name:e.assigned_user&&e.assigned_user.real_name?e.assigned_user.real_name:e.assignee_user_name?e.assignee_user_name:e.assigned_user_name?e.assigned_user_name:"未指定"}}},h=u,f=(a("a359"),a("2877")),b=Object(f["a"])(h,s,r,!1,null,null,null);t["default"]=b.exports},a359:function(e,t,a){"use strict";a("fca4")},ab36:function(e,t,a){"use strict";var s=a("861d"),r=a("9112");e.exports=function(e,t){s(t)&&"cause"in t&&r(e,"cause",t.cause)}},aeb0:function(e,t,a){"use strict";var s=a("9bf2").f;e.exports=function(e,t,a){a in e||s(e,a,{configurable:!0,get:function(){return t[a]},set:function(e){t[a]=e}})}},b980:function(e,t,a){"use strict";var s=a("d039"),r=a("5c6c");e.exports=!s((function(){var e=new Error("a");return!("stack"in e)||(Object.defineProperty(e,"stack",r(1,7)),7!==e.stack)}))},d2bb:function(e,t,a){"use strict";var s=a("7282"),r=a("861d"),o=a("1d80"),l=a("3bbe");e.exports=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,a={};try{e=s(Object.prototype,"__proto__","set"),e(a,[]),t=a instanceof Array}catch(i){}return function(a,s){return o(a),l(s),r(a)?(t?e(a,s):a.__proto__=s,a):a}}():void 0)},d9e2:function(e,t,a){"use strict";var s=a("23e7"),r=a("cfe9"),o=a("2ba4"),l=a("e5cb"),i="WebAssembly",n=r[i],c=7!==new Error("e",{cause:7}).cause,p=function(e,t){var a={};a[e]=l(e,t,c),s({global:!0,constructor:!0,arity:1,forced:c},a)},m=function(e,t){if(n&&n[e]){var a={};a[e]=l(i+"."+e,t,c),s({target:i,stat:!0,constructor:!0,arity:1,forced:c},a)}};p("Error",(function(e){return function(t){return o(e,this,arguments)}})),p("EvalError",(function(e){return function(t){return o(e,this,arguments)}})),p("RangeError",(function(e){return function(t){return o(e,this,arguments)}})),p("ReferenceError",(function(e){return function(t){return o(e,this,arguments)}})),p("SyntaxError",(function(e){return function(t){return o(e,this,arguments)}})),p("TypeError",(function(e){return function(t){return o(e,this,arguments)}})),p("URIError",(function(e){return function(t){return o(e,this,arguments)}})),m("CompileError",(function(e){return function(t){return o(e,this,arguments)}})),m("LinkError",(function(e){return function(t){return o(e,this,arguments)}})),m("RuntimeError",(function(e){return function(t){return o(e,this,arguments)}}))},e153:function(e,t,a){},e391:function(e,t,a){"use strict";var s=a("577e");e.exports=function(e,t){return void 0===e?arguments.length<2?"":t:s(e)}},e5cb:function(e,t,a){"use strict";var s=a("d066"),r=a("1a2d"),o=a("9112"),l=a("3a9b"),i=a("d2bb"),n=a("e893"),c=a("aeb0"),p=a("7156"),m=a("e391"),d=a("ab36"),u=a("6f19"),h=a("83ab"),f=a("c430");e.exports=function(e,t,a,b){var y="stackTraceLimit",v=b?2:1,g=e.split("."),_=g[g.length-1],w=s.apply(null,g);if(w){var I=w.prototype;if(!f&&r(I,"cause")&&delete I.cause,!a)return w;var k=s("Error"),S=t((function(e,t){var a=m(b?t:e,void 0),s=b?new w(e):new w;return void 0!==a&&o(s,"message",a),u(s,S,s.stack,2),this&&l(I,this)&&p(s,this,S),arguments.length>v&&d(s,arguments[v]),s}));if(S.prototype=I,"Error"!==_?i?i(S,k):n(S,k,{name:!0}):h&&y in w&&(c(S,w,y),c(S,w,"prepareStackTrace")),n(S,w),!f)try{I.name!==_&&o(I,"name",_),I.constructor=S}catch(C){}return S}}},fca4:function(e,t,a){}}]);