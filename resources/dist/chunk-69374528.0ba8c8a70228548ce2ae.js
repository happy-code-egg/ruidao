(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-69374528"],{"1e0d":function(e,t,a){},"293c7":function(e,t,a){"use strict";a("1e0d")},"6ab6":function(e,t,a){"use strict";a.r(t);var l=function(){var e=this,t=e._self._c;return t("div",{staticClass:"app-container"},[t("div",{staticClass:"body-part-search"},[t("el-form",{attrs:{model:e.searchForm,"label-width":"100px"}},[t("el-row",[t("el-col",{attrs:{span:6}},[t("el-form-item",{attrs:{label:"合同名称"}},[t("el-input",{attrs:{size:"small",placeholder:"合同名称",clearable:""},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleSearch.apply(null,arguments)}},model:{value:e.searchForm.contract_name,callback:function(t){e.$set(e.searchForm,"contract_name",t)},expression:"searchForm.contract_name"}})],1)],1),t("el-col",{attrs:{span:6}},[t("el-form-item",{attrs:{label:"合同类型"}},[t("el-select",{attrs:{size:"small",placeholder:"合同类型",clearable:""},model:{value:e.searchForm.contract_type,callback:function(t){e.$set(e.searchForm,"contract_type",t)},expression:"searchForm.contract_type"}},[t("el-option",{attrs:{label:"专利合同",value:"专利合同"}}),t("el-option",{attrs:{label:"商标合同",value:"商标合同"}}),t("el-option",{attrs:{label:"版权合同",value:"版权合同"}}),t("el-option",{attrs:{label:"科技服务",value:"科技服务"}}),t("el-option",{attrs:{label:"其他",value:"其他"}})],1)],1)],1),t("el-col",{attrs:{span:6}},[t("el-form-item",{attrs:{label:"客户名称"}},[t("el-input",{attrs:{size:"small",placeholder:"客户名称",clearable:""},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleSearch.apply(null,arguments)}},model:{value:e.searchForm.customer_name,callback:function(t){e.$set(e.searchForm,"customer_name",t)},expression:"searchForm.customer_name"}})],1)],1),t("el-col",{attrs:{span:6}},[t("el-form-item",{attrs:{label:"创建人"}},[t("el-input",{attrs:{size:"small",placeholder:"创建人",clearable:""},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleSearch.apply(null,arguments)}},model:{value:e.searchForm.created_by,callback:function(t){e.$set(e.searchForm,"created_by",t)},expression:"searchForm.created_by"}})],1)],1),t("el-col",{attrs:{span:6}},[t("el-form-item",{attrs:{label:"工作流状态"}},[t("el-select",{attrs:{size:"small",placeholder:"工作流状态",clearable:""},model:{value:e.searchForm.workflow_status,callback:function(t){e.$set(e.searchForm,"workflow_status",t)},expression:"searchForm.workflow_status"}},[t("el-option",{attrs:{label:"未发起",value:""}}),t("el-option",{attrs:{label:"进行中",value:"pending"}}),t("el-option",{attrs:{label:"已完成",value:"completed"}}),t("el-option",{attrs:{label:"已驳回",value:"rejected"}}),t("el-option",{attrs:{label:"已取消",value:"cancelled"}})],1)],1)],1)],1),t("div",{staticClass:"part-search-buttons"},[t("el-button",{attrs:{size:"small",type:"primary"},on:{click:e.handleSearch}},[e._v("查询")]),t("el-button",{attrs:{size:"small"},on:{click:e.resetSearch}},[e._v("重置")])],1)],1)],1),t("div",{staticClass:"body-part-content"},[e._m(0),t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{size:"small",data:e.tableData,border:"","row-key":"id"},on:{"selection-change":e.handleSelectionChange}},[t("el-table-column",{attrs:{type:"selection",width:"80",align:"center"}}),t("el-table-column",{attrs:{type:"index",label:"序号",width:"60",align:"center"}}),t("el-table-column",{attrs:{prop:"contract_name",label:"合同名称",align:"center","min-width":"160"}}),t("el-table-column",{attrs:{prop:"contract_type",label:"合同类型",align:"center",width:"120"}}),t("el-table-column",{attrs:{prop:"contract_status",label:"合同状态",align:"center",width:"100"}}),t("el-table-column",{attrs:{prop:"customer_name",label:"客户名称",align:"center","min-width":"140"}}),t("el-table-column",{attrs:{prop:"total_amount",label:"金额",align:"center",width:"100"}}),t("el-table-column",{attrs:{prop:"created_by",label:"创建人",align:"center",width:"100"}}),t("el-table-column",{attrs:{prop:"created_at",label:"创建时间",align:"center",width:"150"}}),t("el-table-column",{attrs:{prop:"workflow_name",label:"流程名称",align:"center",width:"120"}}),t("el-table-column",{attrs:{label:"流程状态",align:"center",width:"100"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-tag",{attrs:{type:e.getWorkflowStatusType(a.row.workflow_status),size:"mini"}},[e._v(" "+e._s(a.row.workflow_status)+" ")])]}}])}),t("el-table-column",{attrs:{prop:"current_node",label:"当前节点",align:"center",width:"120"}}),t("el-table-column",{attrs:{prop:"current_handler",label:"办理人员",align:"center",width:"100"}}),t("el-table-column",{attrs:{prop:"last_update_time",label:"最后办理时间",align:"center",width:"150"}}),t("el-table-column",{attrs:{label:"停滞天数",align:"center",width:"100"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("span",{class:e.getStopDaysClass(a.row.stop_days)},[e._v(" "+e._s(a.row.stop_days)+"天 ")])]}}])}),t("el-table-column",{attrs:{fixed:"right",label:"操作",align:"center",width:"100","class-name":"small-padding fixed-width"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-button",{attrs:{size:"mini",type:"text"},on:{click:function(t){return e.handleViewProgress(a.row)}}},[e._v("查看流程")])]}}])})],1),t("el-pagination",{directives:[{name:"show",rawName:"v-show",value:e.pagination.total>0,expression:"pagination.total > 0"}],attrs:{total:e.pagination.total,"current-page":e.pagination.currentPage,"page-sizes":[10,20,50,100],"page-size":e.pagination.pageSize,layout:"total, sizes, prev, pager, next, jumper"},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1),t("WorkflowProgressViewer",{attrs:{visible:e.progressDialogVisible,"flow-detail":e.flowDetail,"business-type":"contract"},on:{close:function(t){e.progressDialogVisible=!1}}})],1)},s=[function(){var e=this,t=e._self._c;return t("div",{staticClass:"part-table-header"},[t("div",{staticClass:"part-table-title"},[e._v(" 合同流程 ")])])}],o=(a("14d9"),a("d412")),r={name:"ContractFlow",components:{WorkflowProgressViewer:o["a"]},data(){return{loading:!1,searchForm:{contract_name:"",contract_type:"",customer_name:"",created_by:"",workflow_status:""},tableData:[],pagination:{currentPage:1,pageSize:20,total:0},selectedRows:[],progressDialogVisible:!1,selectedContractRow:null,flowDetail:null}},created(){this.fetchData()},methods:{async fetchData(){this.loading=!0;try{const e={page:this.pagination.currentPage,page_size:this.pagination.pageSize,...this.searchForm},t=await this.$api.reviewProgress.getContractFlows(e);if(t.data.success){const e=t.data.data;this.tableData=e.data||[],this.pagination.total=e.total||0}else this.$message.error(t.data.message||"获取数据失败"),this.tableData=[],this.pagination.total=0}catch(e){console.error("获取合同进度数据失败:",e),this.$message.error("获取数据失败"),this.tableData=[],this.pagination.total=0}finally{this.loading=!1}},handleSearch(){this.pagination.currentPage=1,this.fetchData()},resetSearch(){this.searchForm={contract_name:"",contract_type:"",customer_name:"",created_by:"",workflow_status:""},this.handleSearch()},handleSizeChange(e){this.pagination.pageSize=e,this.fetchData()},handleCurrentChange(e){this.pagination.currentPage=e,this.fetchData()},handleSelectionChange(e){this.selectedRows=e},handleView(e){this.$router.push({name:"ContractView",params:{id:e.id}})},async handleViewProgress(e){try{this.loading=!0;const t=await this.$api.reviewProgress.getContractFlowDetail(e.workflowInstanceId);t.data.success?(this.flowDetail=t.data.data,this.selectedContractRow=e,this.progressDialogVisible=!0):this.$message.error(t.data.message||"获取流程详情失败")}catch(t){console.error("获取合同流程详情失败:",t),this.$message.error("获取流程详情失败")}finally{this.loading=!1}},getWorkflowStatusType(e){const t={"未发起":"info","进行中":"warning","已完成":"success","已驳回":"danger","已取消":"info"};return t[e]||"info"},getStopDaysClass(e){return e<=1?"stop-days-normal":e<=3?"stop-days-warning":"stop-days-danger"}}},i=r,n=(a("293c7"),a("2877")),c=Object(n["a"])(i,l,s,!1,null,"c4a3dce8",null);t["default"]=c.exports},c564:function(e,t,a){},d412:function(e,t,a){"use strict";var l=function(){var e=this,t=e._self._c;return t("el-dialog",{staticClass:"workflow-progress-dialog",attrs:{title:e.dialogTitle,visible:e.visible,width:"80%"},on:{close:e.handleClose}},[e.flowDetail?t("div",{staticClass:"workflow-detail"},[t("div",{staticClass:"detail-section"},[t("h4",[e._v("基本信息")]),t("el-row",[t("el-col",{attrs:{span:12}},[t("div",{staticClass:"detail-item"},[t("label",[e._v("流程名称：")]),t("span",[e._v(e._s(e.flowDetail.flowName))])])]),t("el-col",{attrs:{span:12}},[t("div",{staticClass:"detail-item"},[t("label",[e._v("流程状态：")]),t("el-tag",{attrs:{type:e.getStatusTagType(e.flowDetail.status),size:"small"}},[e._v(" "+e._s(e.getFlowStatusText(e.flowDetail.status))+" ")])],1)])],1),t("el-row",[t("el-col",{attrs:{span:12}},[t("div",{staticClass:"detail-item"},[t("label",[e._v(e._s("contract"===e.businessType?"合同名称":"项目名称")+"：")]),t("span",[e._v(e._s(e.getBusinessName()))])])]),t("el-col",{attrs:{span:12}},[t("div",{staticClass:"detail-item"},[t("label",[e._v(e._s("contract"===e.businessType?"合同类型":"项目类型")+"：")]),t("span",[e._v(e._s(e.getBusinessType()))])])])],1),t("el-row",[t("el-col",{attrs:{span:12}},[t("div",{staticClass:"detail-item"},[t("label",[e._v("客户名称：")]),t("span",[e._v(e._s(e.getCustomerName()))])])]),t("el-col",{attrs:{span:12}},[t("div",{staticClass:"detail-item"},[t("label",[e._v("创建人：")]),t("span",[e._v(e._s(e.getCreatedBy()))])])])],1),t("el-row",[t("el-col",{attrs:{span:12}},[t("div",{staticClass:"detail-item"},[t("label",[e._v("创建时间：")]),t("span",[e._v(e._s(e.flowDetail.createdTime))])])]),e.flowDetail.completedTime?t("el-col",{attrs:{span:12}},[t("div",{staticClass:"detail-item"},[t("label",[e._v("完成时间：")]),t("span",[e._v(e._s(e.flowDetail.completedTime))])])]):e._e()],1)],1),t("div",{staticClass:"detail-section"},[t("h4",[e._v("流程进度")]),t("el-steps",{attrs:{active:e.getActiveStep(),"finish-status":"success","align-center":""}},e._l(e.flowDetail.progress,(function(a,l){return t("el-step",{key:l,attrs:{title:a.nodeName,description:e.getStepDescription(a),status:e.getStepStatus(a,l)}})})),1),t("el-table",{staticStyle:{"margin-top":"20px"},attrs:{data:e.flowDetail.progress,size:"small"}},[t("el-table-column",{attrs:{prop:"nodeName",label:"节点名称",width:"120"}}),t("el-table-column",{attrs:{prop:"status",label:"状态",width:"100"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-tag",{attrs:{type:e.getProgressStatusType(a.row.status),size:"mini"}},[e._v(" "+e._s(e.getProgressStatusText(a.row.status))+" ")])]}}],null,!1,2799007165)}),t("el-table-column",{attrs:{prop:"assignedUser",label:"指派人",width:"100"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("span",[e._v(e._s(a.row.assignedUser||"-"))])]}}],null,!1,2714494074)}),t("el-table-column",{attrs:{prop:"processedUser",label:"处理人",width:"100"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("span",[e._v(e._s(a.row.processedUser||"-"))])]}}],null,!1,2915959536)}),t("el-table-column",{attrs:{prop:"processedTime",label:"处理时间",width:"150"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("span",[e._v(e._s(a.row.processedTime||"-"))])]}}],null,!1,2663297876)}),t("el-table-column",{attrs:{prop:"comment",label:"备注"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("span",[e._v(e._s(a.row.comment||"-"))])]}}],null,!1,2869480376)})],1)],1)]):e._e(),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:e.handleClose}},[e._v("关闭")])],1)])},s=[],o={name:"WorkflowProgressViewer",props:{visible:{type:Boolean,default:!1},flowDetail:{type:Object,default:null},businessType:{type:String,default:"case",validator:e=>["case","contract"].includes(e)}},computed:{dialogTitle(){return"contract"===this.businessType?"合同流程详情":"立项流程详情"}},methods:{handleClose(){this.$emit("close")},getBusinessName(){return this.flowDetail?"contract"===this.businessType?(null===(e=this.flowDetail.contract)||void 0===e?void 0:e.contract_name)||this.flowDetail.contract_name||(null===(t=this.flowDetail.case)||void 0===t?void 0:t.caseName)||"-":(null===(a=this.flowDetail.case)||void 0===a?void 0:a.caseName)||this.flowDetail.caseName||"-":"-";var e,t,a},getBusinessType(){return this.flowDetail?"contract"===this.businessType?(null===(e=this.flowDetail.contract)||void 0===e?void 0:e.contract_type)||this.flowDetail.contract_type||(null===(t=this.flowDetail.case)||void 0===t?void 0:t.caseType)||"-":(null===(a=this.flowDetail.case)||void 0===a?void 0:a.caseType)||this.flowDetail.caseType||"-":"-";var e,t,a},getCustomerName(){return this.flowDetail?"contract"===this.businessType?(null===(e=this.flowDetail.contract)||void 0===e?void 0:e.customer_name)||this.flowDetail.customer_name||(null===(t=this.flowDetail.case)||void 0===t?void 0:t.customerName)||"-":(null===(a=this.flowDetail.case)||void 0===a?void 0:a.customerName)||this.flowDetail.customerName||"-":"-";var e,t,a},getCreatedBy(){return this.flowDetail?"contract"===this.businessType?(null===(e=this.flowDetail.contract)||void 0===e?void 0:e.created_by)||this.flowDetail.created_by||(null===(t=this.flowDetail.case)||void 0===t?void 0:t.createdBy)||"-":(null===(a=this.flowDetail.case)||void 0===a?void 0:a.createdBy)||this.flowDetail.createdBy||"-":"-";var e,t,a},getActiveStep(){return this.flowDetail&&this.flowDetail.progress?"completed"===this.flowDetail.status?this.flowDetail.progress.length-1:this.flowDetail.currentNodeIndex||0:0},getStepStatus(e,t){return"completed"===e.status?"finish":"pending"===e.status&&t===this.getActiveStep()?"process":"rejected"===e.status?"error":"wait"},getStepDescription(e){return"completed"===e.status?e.processedUser?"已处理 - "+e.processedUser:"已完成":"pending"===e.status?e.assignedUser?"待处理 - "+e.assignedUser:"待处理":"rejected"===e.status?"已驳回":"等待中"},getStatusTagType(e){const t={pending:"warning",completed:"success",cancelled:"info",rejected:"danger"};return t[e]||"info"},getFlowStatusText(e){const t={pending:"进行中",completed:"已完成",cancelled:"已取消",rejected:"已驳回"};return t[e]||e},getProgressStatusType(e){const t={pending:"warning",completed:"success",rejected:"danger",cancelled:"info"};return t[e]||"info"},getProgressStatusText(e){const t={pending:"待处理",completed:"已完成",rejected:"已驳回",cancelled:"已取消"};return t[e]||e}}},r=o,i=(a("d47b"),a("2877")),n=Object(i["a"])(r,l,s,!1,null,"1557f00b",null);t["a"]=n.exports},d47b:function(e,t,a){"use strict";a("c564")}}]);