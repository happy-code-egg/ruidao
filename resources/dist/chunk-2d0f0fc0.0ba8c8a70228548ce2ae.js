(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d0f0fc0"],{"9f63":function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e._self._c;return t("div",{staticClass:"update-list-container"},[t("div",{staticClass:"body-part-search"},[t("el-form",{staticClass:"demo-form-inline",attrs:{inline:!0,model:e.queryParams}},[t("el-form-item",{attrs:{label:"我方文号"}},[t("el-input",{attrs:{placeholder:"请输入",clearable:"",size:"small"},model:{value:e.queryParams.ourRefNumber,callback:function(t){e.$set(e.queryParams,"ourRefNumber",t)},expression:"queryParams.ourRefNumber"}})],1),t("el-form-item",{attrs:{label:"申请号"}},[t("el-input",{attrs:{placeholder:"请输入",clearable:"",size:"small"},model:{value:e.queryParams.applicationNo,callback:function(t){e.$set(e.queryParams,"applicationNo",t)},expression:"queryParams.applicationNo"}})],1),t("el-form-item",{attrs:{label:"客户名称"}},[t("el-input",{attrs:{placeholder:"请输入",clearable:"",size:"small"},model:{value:e.queryParams.clientName,callback:function(t){e.$set(e.queryParams,"clientName",t)},expression:"queryParams.clientName"}})],1),t("el-form-item",{attrs:{label:"项目名称"}},[t("el-input",{attrs:{placeholder:"请输入",clearable:"",size:"small"},model:{value:e.queryParams.caseName,callback:function(t){e.$set(e.queryParams,"caseName",t)},expression:"queryParams.caseName"}})],1),t("el-form-item",{attrs:{label:"更新状态"}},[t("el-select",{attrs:{placeholder:"请选择状态",clearable:"",size:"small"},model:{value:e.queryParams.updateStatus,callback:function(t){e.$set(e.queryParams,"updateStatus",t)},expression:"queryParams.updateStatus"}},[t("el-option",{attrs:{label:"待处理",value:"pending"}}),t("el-option",{attrs:{label:"处理中",value:"processing"}}),t("el-option",{attrs:{label:"已完成",value:"completed"}}),t("el-option",{attrs:{label:"已退回",value:"returned"}})],1)],1),t("el-form-item",{attrs:{label:"创建时间"}},[t("el-date-picker",{attrs:{type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",size:"small"},model:{value:e.queryParams.createTimeRange,callback:function(t){e.$set(e.queryParams,"createTimeRange",t)},expression:"queryParams.createTimeRange"}})],1)],1),t("div",{staticClass:"part-search-buttons"},[t("el-button",{attrs:{size:"small",type:"primary",icon:"el-icon-search"},on:{click:e.handleSearch}},[e._v("查询")]),t("el-button",{attrs:{size:"small",icon:"el-icon-refresh"},on:{click:e.handleReset}},[e._v("重置")]),e.tableData.length>0&&e.selectedRows.length>0?t("el-button",{attrs:{size:"small",type:"warning",icon:"el-icon-edit"},on:{click:e.handleBatchUpdate}},[e._v("批量更新")]):e._e(),e.tableData.length>0?t("el-button",{attrs:{size:"small",type:"success",icon:"el-icon-download"},on:{click:e.handleExport}},[e._v("导出")]):e._e()],1)],1),t("div",{staticClass:"body-part-table"},[e._m(0),t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.listLoading,expression:"listLoading"}],staticStyle:{width:"100%"},attrs:{size:"small",data:e.tableData,border:"",fit:"","highlight-current-row":""},on:{"selection-change":e.handleSelectionChange}},[t("el-table-column",{attrs:{type:"selection",width:"80",align:"center"}}),t("el-table-column",{attrs:{prop:"serialNo",label:"序号",width:"70",align:"center"}}),t("el-table-column",{attrs:{prop:"ourRefNumber",label:"我方文号",align:"center","show-overflow-tooltip":""}}),t("el-table-column",{attrs:{prop:"applicationNo",label:"申请号","min-width":"180",align:"center","show-overflow-tooltip":""}}),t("el-table-column",{attrs:{prop:"clientName",label:"客户名称","min-width":"180",align:"center","show-overflow-tooltip":""}}),t("el-table-column",{attrs:{prop:"caseName",label:"项目名称","min-width":"200",align:"center","show-overflow-tooltip":""}}),t("el-table-column",{attrs:{prop:"updateType",label:"更新类型","min-width":"120",align:"center"}}),t("el-table-column",{attrs:{prop:"updateStatus",label:"更新状态","min-width":"100",align:"center"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-tag",{attrs:{type:e.getStatusType(a.row.updateStatus),size:"small"}},[e._v(" "+e._s(e.getStatusText(a.row.updateStatus))+" ")])]}}])}),t("el-table-column",{attrs:{prop:"createTime",label:"创建时间",align:"center"}}),t("el-table-column",{attrs:{prop:"creator",label:"创建人","min-width":"100",align:"center"}}),t("el-table-column",{attrs:{prop:"updateTime",label:"更新时间",align:"center"}}),t("el-table-column",{attrs:{prop:"processor",label:"处理人","min-width":"100",align:"center"}}),t("el-table-column",{attrs:{label:"操作",width:"100",align:"center",fixed:"right"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-button",{attrs:{size:"small",type:"text"},on:{click:function(t){return e.handleView(a.row)}}},[e._v("查看更新")])]}}])})],1),t("el-pagination",{directives:[{name:"show",rawName:"v-show",value:e.total>0,expression:"total > 0"}],attrs:{"current-page":e.listQuery.page,"page-sizes":[10,20,30,50],"page-size":e.listQuery.limit,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"update:currentPage":function(t){return e.$set(e.listQuery,"page",t)},"update:current-page":function(t){return e.$set(e.listQuery,"page",t)},"update:pageSize":function(t){return e.$set(e.listQuery,"limit",t)},"update:page-size":function(t){return e.$set(e.listQuery,"limit",t)},"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1)])},r=[function(){var e=this,t=e._self._c;return t("div",{staticClass:"part-table-header"},[t("div",{staticClass:"part-table-title"},[t("span",[e._v("更新处理事项列表")])])])}],l=(a("14d9"),a("e9f5"),a("ab43"),a("88a7"),a("271a"),a("5494"),a("84fc")),i={name:"CaseUpdateUpdateList",data(){return{queryParams:{ourRefNumber:"",applicationNo:"",clientName:"",caseName:"",updateStatus:"",createTimeRange:[]},listLoading:!1,tableData:[],total:0,listQuery:{page:1,limit:10},selectedRows:[]}},created(){this.getList()},methods:{async getList(){this.listLoading=!0;try{const e={page:this.listQuery.page,limit:this.listQuery.limit,ourRefNumber:this.queryParams.ourRefNumber,applicationNo:this.queryParams.applicationNo,clientName:this.queryParams.clientName,caseName:this.queryParams.caseName,updateStatus:this.queryParams.updateStatus,createTimeRange:this.queryParams.createTimeRange},t=await l["a"].getUpdateList(e);t.data.success?(this.tableData=t.data.data.list.map((e,t)=>({id:e.id,serialNo:(this.listQuery.page-1)*this.listQuery.limit+t+1,ourRefNumber:e.our_ref_number||"",applicationNo:e.application_no||"",clientName:e.client_name||"",caseName:e.case_name||"",updateType:this.getUpdateTypeText(e.update_type),updateStatus:e.update_status||"",createTime:e.create_time||"",creator:e.creator_name||"",updateTime:e.update_time||"",processor:e.processor_name||""})),this.total=t.data.data.total):(this.$message.error(t.data.message||"查询失败"),this.loadMockData())}catch(e){console.error("查询失败:",e),this.$message.error("查询失败，请稍后重试"),this.loadMockData()}finally{this.listLoading=!1}},loadMockData(){this.tableData=Array.from({length:15}).map((e,t)=>({id:"update-list-"+(t+1),serialNo:t+1,ourRefNumber:`EM-${(new Date).getFullYear()}-${String(t+1).padStart(4,"0")}`,applicationNo:`CN${(new Date).getFullYear()}${String(Math.floor(1e6*Math.random())).padStart(7,"0")}.${["X","1","2","3"][t%4]}`,clientName:["北京科技有限公司","上海创新科技有限公司","深圳高新技术有限公司","广州智能科技有限公司","杭州数字科技有限公司"][t%5],caseName:["智能设备专利申请","人工智能算法专利","物联网控制系统","区块链技术应用","大数据分析系统"][t%5],updateType:["更新处理事项","更新项目信息","更新期限","更新状态"][t%4],updateStatus:["pending","processing","completed","returned"][t%4],createTime:`2024-0${Math.floor(t/3)+1}-${String(t%28+1).padStart(2,"0")} ${String(Math.floor(24*Math.random())).padStart(2,"0")}:${String(Math.floor(60*Math.random())).padStart(2,"0")}`,creator:["张三","李四","王五","赵六"][t%4],updateTime:`2024-0${Math.floor(t/3)+1}-${String(t%28+2).padStart(2,"0")} ${String(Math.floor(24*Math.random())).padStart(2,"0")}:${String(Math.floor(60*Math.random())).padStart(2,"0")}`,processor:t%4===0?"":["李处理","王处理","赵处理"][t%3]})),this.total=150},getUpdateTypeText(e){const t={add_fee:"新增费用",add_process:"新增处理事项",update_process:"更新处理事项",complete_process:"处理事项完成",update_status:"更新项目状态"};return t[e]||e},getStatusType(e){const t={pending:"warning",processing:"primary",completed:"success",returned:"danger"};return t[e]||"info"},getStatusText(e){const t={pending:"待处理",processing:"处理中",completed:"已完成",returned:"已退回"};return t[e]||"未知"},handleSelectionChange(e){this.selectedRows=e},handleSearch(){this.listQuery.page=1,this.getList(),this.$message.info("查询完成")},handleReset(){this.queryParams={ourRefNumber:"",applicationNo:"",clientName:"",caseName:"",updateStatus:"",createTimeRange:[]},this.listQuery.page=1,this.getList(),this.$message.info("已重置")},handleCreate(){this.$router.push("/case/update/update-process")},async handleExport(){try{let e=[];if(e=this.selectedRows.length>0?this.selectedRows:this.tableData,0===e.length)return void this.$message.warning("没有数据可以导出");const t=this.buildExportData(e);this.downloadCSV(t,"项目更新列表.csv"),this.$message.success(`成功导出 ${e.length} 条记录`)}catch(e){console.error("导出失败:",e),this.$message.error("导出失败，请稍后重试")}},buildExportData(e){const t=["序号","我方文号","申请号","客户名称","项目名称","更新类型","更新状态","创建时间","创建人","更新时间","处理人"],a=e.map(e=>[e.serialNo,e.ourRefNumber,e.applicationNo,e.clientName,e.caseName,e.updateType,this.getStatusText(e.updateStatus),e.createTime,e.creator,e.updateTime,e.processor]);return[t,...a]},downloadCSV(e,t){const a=e.map(e=>e.map(e=>`"${e||""}"`).join(",")).join("\n"),s="\ufeff",r=s+a,l=new Blob([r],{type:"text/csv;charset=utf-8;"}),i=document.createElement("a");if(void 0!==i.download){const e=URL.createObjectURL(l);i.setAttribute("href",e),i.setAttribute("download",t),i.style.visibility="hidden",document.body.appendChild(i),i.click(),document.body.removeChild(i)}},handleView(e){this.$router.push(`/case/update/update-process?id=${e.id}&mode=view`)},handleEdit(e){this.$router.push(`/case/update/update-process?id=${e.id}&mode=edit`)},handleProcess(e){this.$confirm("确认开始处理该更新事项吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"info"}).then(()=>{e.updateStatus="processing",e.processor="当前用户",this.$message.success("已开始处理")}).catch(()=>{this.$message.info("已取消处理")})},handleDelete(e){this.$message.info("删除功能暂未开放")},handleBatchUpdate(){if(0===this.selectedRows.length)return void this.$message.warning("请至少选择一条记录进行批量更新");const e=this.selectedRows.map(e=>e.id);this.$router.push({path:"/case/update/update-process",query:{ids:e.join(","),mode:"batch"}})},handleRefresh(){this.getList(),this.$message.success("刷新成功")},handleSizeChange(e){this.listQuery.limit=e,this.getList()},handleCurrentChange(e){this.listQuery.page=e,this.getList()}}},o=i,n=a("2877"),c=Object(n["a"])(o,s,r,!1,null,"4d2b4dcd",null);t["default"]=c.exports}}]);