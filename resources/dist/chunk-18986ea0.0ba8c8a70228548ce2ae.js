(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-18986ea0"],{"1e5a":function(e,t,s){"use strict";var a=s("23e7"),i=s("9961"),r=s("dad2");a({target:"Set",proto:!0,real:!0,forced:!r("symmetricDifference")},{symmetricDifference:i})},"1e70":function(e,t,s){"use strict";var a=s("23e7"),i=s("a5f7"),r=s("dad2"),o=!r("difference",(function(e){return 0===e.size}));a({target:"Set",proto:!0,real:!0,forced:o},{difference:i})},"21a4":function(e,t,s){"use strict";var a=function(){var e=this,t=e._self._c;return t("el-dialog",{staticClass:"process-item-dialog",attrs:{title:"处理事项",visible:e.dialogVisible,width:"90%","close-on-click-modal":!1,"close-on-press-escape":!0},on:{"update:visible":function(t){e.dialogVisible=t},close:e.handleCancel}},[t("div",{staticClass:"dialog-header-buttons"},[t("el-button",{attrs:{type:"primary",size:"small",loading:e.isSaving,disabled:e.isSaving},on:{click:e.handleSave}},[e._v(e._s(e.isSaving?"保存中...":"保存"))])],1),t("el-tabs",{staticClass:"process-tabs",model:{value:e.activeTab,callback:function(t){e.activeTab=t},expression:"activeTab"}},[t("el-tab-pane",{attrs:{label:"基本信息",name:"basic"}},[t("div",{staticClass:"basic-form"},[t("el-form",{ref:"basicForm",attrs:{model:e.form,rules:e.rules,"label-width":"140px"}},[t("el-row",{attrs:{gutter:20}},[t("el-col",{attrs:{span:8}},[t("el-form-item",{attrs:{label:"处理事项类型",prop:"itemType"}},[t("el-select",{attrs:{placeholder:"请选择"},on:{change:e.changeItemType},model:{value:e.form.itemType,callback:function(t){e.$set(e.form,"itemType",t)},expression:"form.itemType"}},e._l(e.processItemTypeOptions,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)],1),t("el-col",{attrs:{span:8}},[t("el-form-item",{attrs:{label:"处理事项",prop:"processItem"}},[t("el-select",{attrs:{placeholder:"请选择"},model:{value:e.form.processItem,callback:function(t){e.$set(e.form,"processItem",t)},expression:"form.processItem"}},e._l(e.processItemOptions,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)],1),t("el-col",{attrs:{span:8}},[t("el-form-item",{attrs:{label:"处理事项状态",prop:"processStatus"}},[t("el-select",{attrs:{placeholder:"请选择"},model:{value:e.form.processStatus,callback:function(t){e.$set(e.form,"processStatus",t)},expression:"form.processStatus"}},e._l(e.processStatusOptions,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)],1)],1),t("el-row",{attrs:{gutter:20}},[t("el-col",{attrs:{span:8}},[t("el-form-item",{attrs:{label:"内部期限"}},[t("el-date-picker",{attrs:{type:"date",placeholder:"年/月/日"},model:{value:e.form.internalDeadline,callback:function(t){e.$set(e.form,"internalDeadline",t)},expression:"form.internalDeadline"}})],1)],1),t("el-col",{attrs:{span:8}},[t("el-form-item",{attrs:{label:"是否配案"}},[t("el-radio-group",{model:{value:e.form.isAssign,callback:function(t){e.$set(e.form,"isAssign",t)},expression:"form.isAssign"}},[t("el-radio",{attrs:{label:!0}},[e._v("是")]),t("el-radio",{attrs:{label:!1}},[e._v("否")])],1)],1)],1),e.form.isAssign?t("el-col",{attrs:{span:8}},[t("el-form-item",{attrs:{label:"配案人"}},[t("SelectPerson",{attrs:{multiple:!1,placeholder:"请选择配案人"},model:{value:e.form.assignee,callback:function(t){e.$set(e.form,"assignee",t)},expression:"form.assignee"}})],1)],1):t("el-col",{attrs:{span:8}},[t("el-form-item",{attrs:{label:"处理人"}},[t("SelectPerson",{attrs:{multiple:!1,placeholder:"请选择处理人"},model:{value:e.form.handler,callback:function(t){e.$set(e.form,"handler",t)},expression:"form.handler"}})],1)],1)],1),t("el-row",{attrs:{gutter:20}},[t("el-col",{attrs:{span:8}},[t("el-form-item",{attrs:{label:"发文日期"}},[t("el-date-picker",{attrs:{type:"date",placeholder:"年/月/日"},model:{value:e.form.issueDate,callback:function(t){e.$set(e.form,"issueDate",t)},expression:"form.issueDate"}})],1)],1),t("el-col",{attrs:{span:8}},[t("el-form-item",{attrs:{label:"预计完成日"}},[t("el-date-picker",{attrs:{type:"date",placeholder:"年/月/日"},model:{value:e.form.expectedCompleteDate,callback:function(t){e.$set(e.form,"expectedCompleteDate",t)},expression:"form.expectedCompleteDate"}})],1)],1),t("el-col",{attrs:{span:8}},[t("el-form-item",{attrs:{label:"官方期限"}},[t("el-date-picker",{attrs:{type:"date",placeholder:"年/月/日"},model:{value:e.form.officialDeadline,callback:function(t){e.$set(e.form,"officialDeadline",t)},expression:"form.officialDeadline"}})],1)],1)],1),t("el-row",{attrs:{gutter:20}},[t("el-col",{attrs:{span:8}},[t("el-form-item",{attrs:{label:"核稿人"}},[t("SelectPerson",{attrs:{multiple:!1,placeholder:"请选择核稿人"},model:{value:e.form.reviewer,callback:function(t){e.$set(e.form,"reviewer",t)},expression:"form.reviewer"}})],1)],1),t("el-col",{attrs:{span:8}},[t("el-form-item",{attrs:{label:"项目阶段"}},[t("el-select",{attrs:{placeholder:"请选择"},model:{value:e.form.caseStage,callback:function(t){e.$set(e.form,"caseStage",t)},expression:"form.caseStage"}},[t("el-option",{attrs:{label:"申请阶段",value:"application"}}),t("el-option",{attrs:{label:"审查阶段",value:"examination"}}),t("el-option",{attrs:{label:"授权阶段",value:"grant"}})],1)],1)],1),t("el-col",{attrs:{span:8}},[t("el-form-item",{attrs:{label:"客户期限"}},[t("el-date-picker",{attrs:{type:"date",placeholder:"年/月/日"},model:{value:e.form.customerDeadline,callback:function(t){e.$set(e.form,"customerDeadline",t)},expression:"form.customerDeadline"}})],1)],1)],1),t("el-row",[t("el-col",{attrs:{span:8}},[t("el-form-item",{attrs:{label:"合同代码"}},[t("el-input",{attrs:{placeholder:"输入合同代码"},model:{value:e.form.contractCode,callback:function(t){e.$set(e.form,"contractCode",t)},expression:"form.contractCode"}})],1)],1),t("el-col",{attrs:{span:8}},[t("el-form-item",{attrs:{label:"处理事项系数"}},[t("el-select",{attrs:{placeholder:"请选择"},model:{value:e.form.processCoefficient,callback:function(t){e.$set(e.form,"processCoefficient",t)},expression:"form.processCoefficient"}},e._l(e.processCoefficientOptions,(function(e){return t("el-option",{key:e.id,attrs:{label:e.name,value:e.name}})})),1)],1)],1)],1),t("el-row",[t("el-col",{attrs:{span:8}},[t("el-form-item",{attrs:{label:"处理事项备注"}},[t("el-input",{attrs:{type:"textarea",placeholder:"多行输入",rows:3},model:{value:e.form.processRemark,callback:function(t){e.$set(e.form,"processRemark",t)},expression:"form.processRemark"}})],1)],1)],1)],1)],1)]),t("el-tab-pane",{attrs:{label:"费用信息",name:"cost"}},[t("div",{staticClass:"fee-form-section"},[t("div",{staticClass:"section-header"},[t("span",{staticClass:"section-title"},[e._v("服务费")]),t("el-button",{attrs:{size:"small",type:"primary",icon:"el-icon-plus"},on:{click:e.openServiceFeeDialog}},[e._v("添加服务费")])],1),t("el-table",{staticStyle:{width:"100%"},attrs:{data:e.serviceFees,border:""}},[t("el-table-column",{attrs:{prop:"feeName",label:"费用名称",width:"150"}}),t("el-table-column",{attrs:{prop:"feeDescription",label:"项目名称",width:"200"}}),t("el-table-column",{attrs:{prop:"amount",label:"服务费",width:"120"}}),t("el-table-column",{attrs:{prop:"currency",label:"币种",width:"80"}}),t("el-table-column",{attrs:{prop:"remarks",label:"备注","min-width":"150"}}),t("el-table-column",{attrs:{label:"操作",width:"200"},scopedSlots:e._u([{key:"default",fn:function(s){return[t("el-button",{attrs:{size:"mini"},on:{click:function(t){return e.editServiceFee(s.$index)}}},[e._v("编辑")]),t("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(t){return e.removeServiceFee(s.$index)}}},[e._v("删除")])]}}])})],1)],1),t("div",{staticClass:"fee-form-section"},[t("div",{staticClass:"section-header"},[t("span",{staticClass:"section-title"},[e._v("官费")]),t("el-button",{attrs:{size:"small",type:"primary",icon:"el-icon-plus"},on:{click:e.openOfficialFeeDialog}},[e._v("添加官费")])],1),t("el-table",{staticStyle:{width:"100%"},attrs:{data:e.officialFees,border:""}},[t("el-table-column",{attrs:{prop:"feeName",label:"费用名称",width:"150"}}),t("el-table-column",{attrs:{prop:"feeDescription",label:"费用描述",width:"200"}}),t("el-table-column",{attrs:{prop:"amount",label:"金额",width:"120"}}),t("el-table-column",{attrs:{prop:"currency",label:"币种",width:"80"}}),t("el-table-column",{attrs:{prop:"remarks",label:"备注","min-width":"150"}}),t("el-table-column",{attrs:{label:"操作",width:"200"},scopedSlots:e._u([{key:"default",fn:function(s){return[t("el-button",{attrs:{size:"mini"},on:{click:function(t){return e.editOfficialFee(s.$index)}}},[e._v("编辑")]),t("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(t){return e.removeOfficialFee(s.$index)}}},[e._v("删除")])]}}])})],1)],1)]),t("el-tab-pane",{attrs:{label:"附件信息",name:"files"}},[t("div",{staticClass:"case-attachment-container"},[t("div",{staticClass:"attachment-header"},[t("el-button",{attrs:{size:"small",type:"primary"},on:{click:e.openAttachmentDialog}},[e._v("新增附件")])],1),t("el-table",{staticStyle:{width:"100%"},attrs:{data:e.fileList,border:""}},[t("el-table-column",{attrs:{prop:"file_type",label:"文件大类",width:"120"}}),t("el-table-column",{attrs:{prop:"file_sub_type",label:"文件小类",width:"120"}}),t("el-table-column",{attrs:{prop:"file_desc",label:"文件描述","min-width":"200"}}),t("el-table-column",{attrs:{prop:"file_name",label:"文件名称","min-width":"200"}}),t("el-table-column",{attrs:{label:"操作",width:"150"},scopedSlots:e._u([{key:"default",fn:function(s){return[t("el-button",{attrs:{size:"mini"},on:{click:function(t){return e.downloadCaseAttachment(s.row)}}},[e._v("下载")]),t("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(t){return e.removeCaseAttachment(s.$index)}}},[e._v("删除")])]}}])})],1)],1)])],1),t("el-dialog",{attrs:{title:"添加服务费",visible:e.serviceFeeDialogVisible,width:"600px","append-to-body":""},on:{"update:visible":function(t){e.serviceFeeDialogVisible=t}}},[t("el-form",{attrs:{model:e.currentFeeForm,"label-width":"100px"}},[t("el-form-item",{attrs:{label:"费用名称"}},[t("el-input",{attrs:{placeholder:"请输入费用名称"},model:{value:e.currentFeeForm.feeName,callback:function(t){e.$set(e.currentFeeForm,"feeName",t)},expression:"currentFeeForm.feeName"}})],1),t("el-form-item",{attrs:{label:"项目名称"}},[t("el-input",{attrs:{placeholder:"请输入项目名称"},model:{value:e.currentFeeForm.feeDescription,callback:function(t){e.$set(e.currentFeeForm,"feeDescription",t)},expression:"currentFeeForm.feeDescription"}})],1),t("el-form-item",{attrs:{label:"服务费"}},[t("el-input",{attrs:{placeholder:"0.00",type:"number"},model:{value:e.currentFeeForm.amount,callback:function(t){e.$set(e.currentFeeForm,"amount",t)},expression:"currentFeeForm.amount"}})],1),t("el-form-item",{attrs:{label:"币种"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"币种"},model:{value:e.currentFeeForm.currency,callback:function(t){e.$set(e.currentFeeForm,"currency",t)},expression:"currentFeeForm.currency"}},[t("el-option",{attrs:{label:"RMB",value:"RMB"}}),t("el-option",{attrs:{label:"USD",value:"USD"}}),t("el-option",{attrs:{label:"EUR",value:"EUR"}})],1)],1),t("el-form-item",{attrs:{label:"备注"}},[t("el-input",{attrs:{placeholder:"备注"},model:{value:e.currentFeeForm.remarks,callback:function(t){e.$set(e.currentFeeForm,"remarks",t)},expression:"currentFeeForm.remarks"}})],1)],1),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.serviceFeeDialogVisible=!1}}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.saveServiceFee}},[e._v("确 定")])],1)],1),t("el-dialog",{attrs:{title:"添加官费",visible:e.officialFeeDialogVisible,width:"600px","append-to-body":""},on:{"update:visible":function(t){e.officialFeeDialogVisible=t}}},[t("el-form",{attrs:{model:e.currentFeeForm,"label-width":"100px"}},[t("el-form-item",{attrs:{label:"费用名称"}},[t("el-input",{attrs:{placeholder:"请输入费用名称"},model:{value:e.currentFeeForm.feeName,callback:function(t){e.$set(e.currentFeeForm,"feeName",t)},expression:"currentFeeForm.feeName"}})],1),t("el-form-item",{attrs:{label:"费用描述"}},[t("el-input",{attrs:{placeholder:"请输入费用描述"},model:{value:e.currentFeeForm.feeDescription,callback:function(t){e.$set(e.currentFeeForm,"feeDescription",t)},expression:"currentFeeForm.feeDescription"}})],1),t("el-form-item",{attrs:{label:"金额"}},[t("el-input",{attrs:{placeholder:"0.00",type:"number"},model:{value:e.currentFeeForm.amount,callback:function(t){e.$set(e.currentFeeForm,"amount",t)},expression:"currentFeeForm.amount"}})],1),t("el-form-item",{attrs:{label:"币种"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"币种"},model:{value:e.currentFeeForm.currency,callback:function(t){e.$set(e.currentFeeForm,"currency",t)},expression:"currentFeeForm.currency"}},[t("el-option",{attrs:{label:"RMB",value:"RMB"}}),t("el-option",{attrs:{label:"USD",value:"USD"}}),t("el-option",{attrs:{label:"EUR",value:"EUR"}})],1)],1),t("el-form-item",{attrs:{label:"备注"}},[t("el-input",{attrs:{placeholder:"备注"},model:{value:e.currentFeeForm.remarks,callback:function(t){e.$set(e.currentFeeForm,"remarks",t)},expression:"currentFeeForm.remarks"}})],1)],1),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.officialFeeDialogVisible=!1}}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.saveOfficialFee}},[e._v("确 定")])],1)],1),t("el-dialog",{attrs:{title:"新增附件",visible:e.attachmentDialogVisible,width:"600px","append-to-body":""},on:{"update:visible":function(t){e.attachmentDialogVisible=t}}},[t("el-form",{attrs:{model:e.currentAttachmentForm,"label-width":"100px"}},[t("el-form-item",{attrs:{label:"文件大类"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择文件大类"},on:{change:e.handleAttachmentFileTypeChange},model:{value:e.currentAttachmentForm.file_type,callback:function(t){e.$set(e.currentAttachmentForm,"file_type",t)},expression:"currentAttachmentForm.file_type"}},e._l(e.fileTypeOptions,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),t("el-form-item",{attrs:{label:"文件小类"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择文件小类",disabled:!e.currentAttachmentForm.file_type},on:{change:e.handleAttachmentFileSubTypeChange},model:{value:e.currentAttachmentForm.file_sub_type,callback:function(t){e.$set(e.currentAttachmentForm,"file_sub_type",t)},expression:"currentAttachmentForm.file_sub_type"}},e._l(e.getFileSubTypeOptions(e.currentAttachmentForm.file_type),(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),t("el-form-item",{attrs:{label:"文件描述"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择文件描述",disabled:!e.currentAttachmentForm.file_sub_type},model:{value:e.currentAttachmentForm.file_desc,callback:function(t){e.$set(e.currentAttachmentForm,"file_desc",t)},expression:"currentAttachmentForm.file_desc"}},e._l(e.getFileDescriptionOptions(e.currentAttachmentForm.file_type,e.currentAttachmentForm.file_sub_type),(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),t("el-form-item",{attrs:{label:"文件上传"}},[t("el-upload",{attrs:{action:e.uploadUrl,headers:e.uploadHeaders,"on-success":e.handleAttachmentUploadSuccess,"on-error":e.handleAttachmentUploadError,"before-upload":e.beforeAttachmentUpload,"show-file-list":!1,accept:"*"}},[t("el-button",{attrs:{size:"small",type:"primary",icon:"el-icon-upload",loading:e.attachmentUploading}},[e._v(" "+e._s(e.currentAttachmentForm.file_name?"重新上传":"选择文件")+" ")])],1),e.currentAttachmentForm.file_name?t("div",{staticStyle:{"margin-top":"5px","font-size":"12px",color:"#666"}},[e._v(" 已上传："+e._s(e.currentAttachmentForm.file_name)+" ")]):e._e()],1)],1),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.attachmentDialogVisible=!1}}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.saveAttachment}},[e._v("确 定")])],1)],1)],1)},i=[],r=(s("14d9"),s("e9f5"),s("910d"),s("ab43"),s("1e70"),s("79a4"),s("c1a1"),s("8b00"),s("a4e7"),s("1e5a"),s("72c3"),s("512b")),o=s("a417"),l={name:"ProcessItemDialog",components:{SelectPerson:r["a"]},model:{prop:"visible",event:"update:visible"},props:{visible:{type:Boolean,default:!1},processItemData:{type:Object,default:()=>({})},caseType:{type:String,default:"版权"},caseId:{type:[String,Number],default:null}},data(){return{dialogVisible:!1,activeTab:"basic",form:{itemType:"",processItem:"",processStatus:"",isAssign:!1,internalDeadline:"",issueDate:"",expectedCompleteDate:"",officialDeadline:"",customerDeadline:"",caseStage:"",assignee:"",handler:"",reviewer:"",contractCode:"",processCoefficient:"",processRemark:""},rules:{itemType:[{required:!0,message:"请选择处理事项类型",trigger:"change"}],processItem:[{required:!0,message:"请选择处理事项",trigger:"change"}],processStatus:[{required:!0,message:"请选择处理事项状态",trigger:"change"}]},officialFees:[],serviceFees:[],expenses:[],serviceFeeDialogVisible:!1,officialFeeDialogVisible:!1,currentFeeForm:{feeName:"",feeDescription:"",amount:"",currency:"RMB",remarks:""},editingFeeIndex:-1,editingFeeType:"",attachmentDialogVisible:!1,currentAttachmentForm:{file_type:"",file_sub_type:"",file_desc:"",file_name:"",file_path:"",file_size:0,file:null},fileTypeOptions:[],fileSubTypeOptions:{},fileDescriptionOptions:{},isSaving:!1,fileList:[],attachmentUploading:!1,processItemTypeOptions:[],processItemOptions:[],processStatusOptions:[],processCoefficientOptions:[]}},computed:{uploadUrl(){return o["a"].host+"/api/upload"},uploadHeaders(){return{Authorization:localStorage.getItem("token")||sessionStorage.getItem("token")||""}}},watch:{visible:{immediate:!0,handler(e){this.dialogVisible=e,e&&this.initForm()}},dialogVisible(e){this.$emit("update:visible",e),e&&!this.isEditMode()&&this.caseId&&this.loadCaseData()},caseType:{immediate:!0,handler(){this.loadConfigData()}},caseId:{immediate:!0,handler(e,t){e&&e!==t&&this.dialogVisible&&this.loadCaseData()}}},async created(){await this.loadConfigData(),await this.loadFileTypeOptions()},methods:{initForm(){this.processItemData&&Object.keys(this.processItemData).length>0?(console.log("编辑模式：使用已有数据",this.processItemData),this.form={itemType:this.processItemData.process_type||"",processItem:this.processItemData.process_name||"",processStatus:this.processItemData.process_status||"",isAssign:this.processItemData.is_assign||!1,internalDeadline:this.processItemData.internal_deadline||"",issueDate:this.processItemData.issue_date||"",expectedCompleteDate:this.processItemData.expected_complete_date||"",officialDeadline:this.processItemData.official_deadline||this.processItemData.due_date||"",customerDeadline:this.processItemData.customer_deadline||"",caseStage:this.processItemData.case_stage||"",assignee:this.processItemData.assignee||"",handler:this.processItemData.assigned_to||"",reviewer:this.processItemData.reviewer||"",contractCode:this.processItemData.contract_code||"",processCoefficient:this.processItemData.process_coefficient||"",processRemark:this.processItemData.process_remark||this.processItemData.process_description||""},console.log("映射后的表单数据:",this.form),console.log("检查费用和附件数据:"),console.log("service_fees:",this.processItemData.service_fees),console.log("official_fees:",this.processItemData.official_fees),console.log("attachments:",this.processItemData.attachments),this.processItemData.service_fees?(console.log("开始格式化service_fees"),this.serviceFees=this.formatFeeData(this.processItemData.service_fees),console.log("格式化后的serviceFees:",this.serviceFees)):(console.log("没有service_fees数据"),this.serviceFees=[]),this.processItemData.official_fees?(console.log("开始格式化official_fees"),this.officialFees=this.formatFeeData(this.processItemData.official_fees),console.log("格式化后的officialFees:",this.officialFees)):(console.log("没有official_fees数据"),this.officialFees=[]),this.processItemData.attachments?(console.log("开始格式化attachments"),this.fileList=this.formatAttachmentData(this.processItemData.attachments),console.log("格式化后的fileList:",this.fileList)):(console.log("没有attachments数据"),this.fileList=[])):(this.resetForm(),console.log("新增模式：重置表单"),this.caseId&&this.loadCaseData())},resetForm(){this.form={itemType:"",processItem:"",processStatus:"",isAssign:!1,internalDeadline:"",issueDate:"",expectedCompleteDate:"",officialDeadline:"",customerDeadline:"",caseStage:"",assignee:"",handler:"",reviewer:"",contractCode:"",processCoefficient:"",processRemark:""},this.officialFees=[],this.serviceFees=[],this.fileList=[]},changeItemType(){},async loadConfigData(){await Promise.all([this.loadProcessItemTypes(),this.loadProcessItems(),this.loadProcessStatusOptions(),this.loadProcessCoefficientOptions()])},async loadProcessItemTypes(){try{const e=await this.$api.dataConfig.processType.getOptions();e.data&&0===e.data.code&&(this.processItemTypeOptions=e.data.data.map(e=>({label:e.name,value:e.name})))}catch(e){console.error("加载处理事项类型失败:",e),this.processItemTypeOptions=[{label:"立项",value:"立项"},{label:"递交",value:"递交"},{label:"答复",value:"答复"},{label:"授权",value:"授权"}]}},async loadProcessItems(){try{const e={case_type:this.caseType},t=await this.$api.dataConfig.processInformation.getFilteredOptions(e);t.data&&0===t.data.code&&(this.processItemOptions=t.data.data.map(e=>({label:e.process_name,value:e.process_name,id:e.id})))}catch(e){console.error("加载处理事项列表失败:",e),this.processItemOptions=[{label:"立项申请",value:"立项申请"},{label:"材料递交",value:"材料递交"},{label:"审查答复",value:"审查答复"},{label:"授权登记",value:"授权登记"}]}},async loadProcessStatusOptions(){try{const e=await this.$api.dataConfig.processStatus.getOptions();e.data&&0===e.data.code&&(this.processStatusOptions=e.data.data.map(e=>({label:e.name,value:e.id})))}catch(e){console.error("加载处理事项状态选项失败:",e),this.processStatusOptions=[{label:"待处理",value:1},{label:"处理中",value:2},{label:"已完成",value:3},{label:"已取消",value:4}]}},async loadProcessCoefficientOptions(){try{const e=await this.$api.dataConfig.processCoefficient.getOptions();e.data&&0===e.data.code&&(this.processCoefficientOptions=e.data.data)}catch(e){console.error("加载处理事项系数选项失败:",e),this.processCoefficientOptions=[{id:1,name:"1.0"},{id:2,name:"1.2"},{id:3,name:"1.5"},{id:4,name:"2.0"}]}},handleEdit(){this.$message.info("编辑模式")},async handleSave(){this.isSaving?console.log("正在保存中，忽略重复请求"):this.caseId?(console.log("handleSave 被调用"),this.$refs.basicForm.validate(async e=>{if(console.log("表单验证结果:",e),e)try{this.isSaving=!0,console.log("开始保存处理事项，isSaving:",this.isSaving);const e={case_id:this.caseId,process_name:this.form.processItem,process_type:this.form.itemType,process_status:this.form.processStatus,assigned_to:this.form.isAssign?this.form.assignee:this.form.handler,assignee:this.form.isAssign?this.form.assignee:null,is_assign:this.form.isAssign,due_date:this.form.officialDeadline,official_deadline:this.form.officialDeadline,internal_deadline:this.form.internalDeadline,customer_deadline:this.form.customerDeadline,expected_complete_date:this.form.expectedCompleteDate,issue_date:this.form.issueDate,case_stage:this.form.caseStage,reviewer:this.form.reviewer,contract_code:this.form.contractCode,process_coefficient:this.form.processCoefficient,process_description:this.form.processRemark,process_remark:this.form.processRemark,service_fees:this.serviceFees,official_fees:this.officialFees,attachments:this.fileList};let a;var t,s;if(a=this.isEditMode()&&this.processItemData.id?await this.$api.dataConfig.caseProcess.update(this.processItemData.id,e):await this.$api.dataConfig.caseProcess.create(e),a.data&&(a.data.success||0===a.data.code))this.$emit("save",a.data.data),this.dialogVisible=!1,this.$message.success(this.isEditMode()?"更新成功":"保存成功"),console.log("保存成功");else this.$message.error((null===(t=a.data)||void 0===t?void 0:t.message)||(null===(s=a.data)||void 0===s?void 0:s.msg)||"保存失败"),console.log("保存失败:",a.data)}catch(a){console.error("保存处理事项失败:",a),this.$message.error("保存失败："+(a.message||"未知错误"))}finally{this.isSaving=!1,console.log("保存状态重置")}else console.log("表单验证失败")})):this.$message.error("请先保存案件信息后再添加处理事项")},handleCancel(){this.dialogVisible=!1},handleDelete(){this.$confirm("确认删除该处理事项？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{this.$emit("delete"),this.dialogVisible=!1,this.$message.success("删除成功")})},async loadCaseData(){if(this.caseId&&!this.isEditMode())try{console.log("新增模式：加载费用和附件数据，caseId:",this.caseId);try{const t=await this.$api.customer.getContractCaseRecordByCaseId(this.caseId);if(console.log("ContractCaseRecord API响应:",t),t.data&&t.data.success){const s=t.data.data;console.log("获取到的contract_case_records数据:",s),console.log("原始service_fees数据:",s.service_fees),console.log("原始official_fees数据:",s.official_fees),console.log("原始attachments数据:",s.attachments),console.log("service_fees类型:",typeof s.service_fees,Array.isArray(s.service_fees)),console.log("official_fees类型:",typeof s.official_fees,Array.isArray(s.official_fees)),console.log("attachments类型:",typeof s.attachments,Array.isArray(s.attachments));let a=s.service_fees||[],i=s.official_fees||[],r=s.attachments||[];if(!Array.isArray(a))if("string"===typeof a)try{a=JSON.parse(a)}catch(e){console.error("解析service_fees JSON失败:",e),a=[]}else a=[];if(!Array.isArray(i))if("string"===typeof i)try{i=JSON.parse(i)}catch(e){console.error("解析official_fees JSON失败:",e),i=[]}else i=[];if(!Array.isArray(r))if("string"===typeof r)try{r=JSON.parse(r)}catch(e){console.error("解析attachments JSON失败:",e),r=[]}else r=[];return console.log("解析后的数据:",{serviceFees:a,officialFees:i,attachments:r}),this.serviceFees=this.formatFeeData(a),this.officialFees=this.formatFeeData(i),this.fileList=this.formatAttachmentData(r),console.log("从contract_case_records表加载数据成功"),console.log("加载的费用和附件数据:",{serviceFees:this.serviceFees,officialFees:this.officialFees,fileList:this.fileList}),void((this.serviceFees.length>0||this.officialFees.length>0||this.fileList.length>0)&&this.$message.success(`已自动加载合同项目的费用和附件信息（服务费${this.serviceFees.length}项，官费${this.officialFees.length}项，附件${this.fileList.length}个）`))}}catch(t){console.error("contract_case_records API调用失败:",t),console.log("contract_case_records表中没有找到数据，尝试从cases表获取")}try{const e=await this.$api.case.getCase(this.caseId);if(console.log("Cases API响应:",e),e.data&&e.data.success){const t=e.data.data;if(console.log("获取到的cases数据:",t),t.service_fees&&t.service_fees.length>0)return this.serviceFees=this.formatFeeDataFromRelation(t.service_fees),this.officialFees=this.formatFeeDataFromRelation(t.official_fees||[]),this.fileList=this.formatAttachmentDataFromRelation(t.attachments||[]),void console.log("从cases表加载数据成功")}}catch(s){console.error("cases API调用失败:",s),console.log("cases表中也没有找到数据，使用空数据")}console.log("最终格式化后的数据:",{serviceFees:this.serviceFees,officialFees:this.officialFees,fileList:this.fileList})}catch(a){console.error("加载案例数据失败:",a),a.response&&console.error("错误响应:",a.response.status,a.response.data)}},isEditMode(){return this.processItemData&&Object.keys(this.processItemData).length>0},formatFeeData(e){return Array.isArray(e)?e.map(e=>({feeName:e.fee_name||e.feeName||"",feeDescription:e.fee_description||e.feeDescription||"",amount:e.amount||0,currency:e.currency||"RMB",remarks:e.remarks||e.remark||""})):[]},formatAttachmentData(e){return Array.isArray(e)?e.map(e=>({file_type:e.file_type||"",file_sub_type:e.file_sub_type||"",file_desc:e.file_desc||e.file_description||"",file_name:e.file_name||e.fileName||"",file_path:e.file_path||e.filePath||"",file_size:e.file_size||e.fileSize||0})):[]},formatFeeDataFromRelation(e){return Array.isArray(e)?e.map(e=>({feeName:e.fee_name||"",feeDescription:e.fee_description||"",amount:e.amount||0,currency:e.currency||"RMB",remarks:e.remarks||""})):[]},formatAttachmentDataFromRelation(e){return Array.isArray(e)?e.map(e=>({file_type:e.file_type||"",file_sub_type:e.file_sub_type||"",file_desc:e.file_desc||"",file_name:e.file_name||"",file_path:e.file_path||"",file_size:e.file_size||0})):[]},downloadCaseAttachment(e){e.file_path?(console.log("下载附件:",o["a"].host+e.file_path),window.open(o["a"].host+"/storage/"+e.file_path,"_blank")):this.$message.warning("文件路径不存在")},openServiceFeeDialog(){this.currentFeeForm={feeName:"",feeDescription:"",amount:"",currency:"RMB",remarks:""},this.editingFeeIndex=-1,this.editingFeeType="service",this.serviceFeeDialogVisible=!0},editServiceFee(e){this.currentFeeForm={...this.serviceFees[e]},this.editingFeeIndex=e,this.editingFeeType="service",this.serviceFeeDialogVisible=!0},saveServiceFee(){this.currentFeeForm.feeName&&this.currentFeeForm.amount?(this.editingFeeIndex>=0?this.$set(this.serviceFees,this.editingFeeIndex,{...this.currentFeeForm}):this.serviceFees.push({...this.currentFeeForm}),this.serviceFeeDialogVisible=!1,this.$message.success("服务费保存成功")):this.$message.error("费用名称和金额不能为空")},removeServiceFee(e){this.serviceFees.splice(e,1),this.$message.success("服务费删除成功")},openOfficialFeeDialog(){this.currentFeeForm={feeName:"",feeDescription:"",amount:"",currency:"RMB",remarks:""},this.editingFeeIndex=-1,this.editingFeeType="official",this.officialFeeDialogVisible=!0},editOfficialFee(e){this.currentFeeForm={...this.officialFees[e]},this.editingFeeIndex=e,this.editingFeeType="official",this.officialFeeDialogVisible=!0},saveOfficialFee(){this.currentFeeForm.feeName&&this.currentFeeForm.amount?(this.editingFeeIndex>=0?this.$set(this.officialFees,this.editingFeeIndex,{...this.currentFeeForm}):this.officialFees.push({...this.currentFeeForm}),this.officialFeeDialogVisible=!1,this.$message.success("官费保存成功")):this.$message.error("费用名称和金额不能为空")},removeOfficialFee(e){this.officialFees.splice(e,1),this.$message.success("官费删除成功")},openAttachmentDialog(){this.currentAttachmentForm={file_type:"",file_sub_type:"",file_desc:"",file_name:"",file_path:"",file_size:0,file:null},this.attachmentDialogVisible=!0,console.log("打开附件对话框"),console.log("当前上传URL:",this.uploadUrl),console.log("当前token:",this.getToken())},beforeAttachmentUpload(e){this.attachmentUploading=!0;const t=e.size/1024/1024<20;return t||(this.$message.error("上传文件大小不能超过 20MB!"),this.attachmentUploading=!1),t},handleAttachmentUploadSuccess(e,t){this.attachmentUploading=!1,e.success?(this.currentAttachmentForm.file_name=t.name,this.currentAttachmentForm.file_path=e.data.file_path||e.data.path,this.currentAttachmentForm.file_size=t.size,this.$message.success("文件上传成功")):this.$message.error(e.message||"文件上传失败")},handleAttachmentUploadError(e){this.attachmentUploading=!1,console.error("文件上传失败:",e),this.$message.error("文件上传失败")},saveAttachment(){this.currentAttachmentForm.file_type&&this.currentAttachmentForm.file_sub_type&&this.currentAttachmentForm.file_desc?this.currentAttachmentForm.file_path?(this.fileList.push({...this.currentAttachmentForm,upload_time:(new Date).toISOString(),uploader:"当前用户"}),this.attachmentDialogVisible=!1,this.$message.success("附件添加成功，将在保存处理事项时一起上传")):this.$message.error("请先上传文件"):this.$message.error("文件大类、小类和描述不能为空")},removeCaseAttachment(e){this.fileList.splice(e,1),this.$message.success("附件删除成功")},getToken(){return localStorage.getItem("token")||sessionStorage.getItem("token")||""},beforeFileUpload(e){const t=e.size/1024/1024<20;return t||this.$message.error("上传文件大小不能超过 20MB!"),t},async loadFileTypeOptions(){try{const e=await this.$api.dataConfig.fileCategory.getList({page:1,limit:999,isValid:1});if(console.log("文件大类API响应:",e.data),e.data&&0===e.data.code){const t=[...new Set(e.data.data.list.map(e=>e.mainCategory))];this.fileTypeOptions=t.filter(e=>e).map(e=>({value:e,label:e})),console.log("文件大类选项:",this.fileTypeOptions)}else console.error("文件大类API返回错误:",e.data),this.fileTypeOptions=[{label:"技术文档",value:"技术文档"},{label:"法律文档",value:"法律文档"},{label:"商务文档",value:"商务文档"},{label:"其他文档",value:"其他文档"}]}catch(e){console.error("加载文件大类选项失败:",e),this.fileTypeOptions=[{label:"技术文档",value:"技术文档"},{label:"法律文档",value:"法律文档"},{label:"商务文档",value:"商务文档"},{label:"其他文档",value:"其他文档"}]}},async loadFileSubTypeOptions(e){try{if(!e)return void this.$set(this.fileSubTypeOptions,e,[]);const t=await this.$api.dataConfig.fileCategory.getList({page:1,limit:999,mainCategory:e,isValid:1});if(console.log(`文件小类API响应(${e}):`,t.data),t.data&&0===t.data.code){const s=t.data.data.list.filter(e=>e.subCategory).map(e=>({value:e.subCategory,label:e.subCategory}));this.$set(this.fileSubTypeOptions,e,s),console.log(`文件小类选项(${e}):`,this.fileSubTypeOptions[e])}else this.$set(this.fileSubTypeOptions,e,[]),console.error("文件小类API返回错误:",t.data)}catch(t){console.error("加载文件小类选项失败:",t),this.$set(this.fileSubTypeOptions,e,[])}},async loadFileDescriptionOptions(e,t){try{if(!e||!t){const s=`${e||""}::${t||""}`;return void this.$set(this.fileDescriptionOptions,s,[])}const s={page:1,limit:999,fileCategoryMajor:e,fileCategoryMinor:t,isValid:1},a=await this.$api.dataConfig.fileDescription.getList(s);if(console.log("文件描述API响应:",a.data),a.data&&0===a.data.code){const s=a.data.data.list||[],i=`${e||""}::${t||""}`,r=s.map(e=>({value:e.fileName||e.file_name||e.fileDescription||e.file_description||e.name||"描述-"+e.id,label:e.fileName||e.file_name||e.fileDescription||e.file_description||e.name||"描述-"+e.id}));this.$set(this.fileDescriptionOptions,i,r),console.log(`文件描述选项(${i}):`,this.fileDescriptionOptions[i])}else{const s=`${e||""}::${t||""}`;this.$set(this.fileDescriptionOptions,s,[]),console.error("文件描述API返回错误:",a.data)}}catch(s){console.error("加载文件描述选项失败:",s);const a=`${e||""}::${t||""}`;this.$set(this.fileDescriptionOptions,a,[])}},getFileSubTypeOptions(e){const t=this.fileSubTypeOptions[e]||[];return console.log(`getFileSubTypeOptions(${e}):`,t),t},getFileDescriptionOptions(e,t){const s=`${e||""}::${t||""}`;return this.fileDescriptionOptions[s]||[]},async handleAttachmentFileTypeChange(e){this.currentAttachmentForm.file_sub_type="",this.currentAttachmentForm.file_desc="",await this.loadFileSubTypeOptions(e),this.$nextTick(()=>{this.$forceUpdate()})},async handleAttachmentFileSubTypeChange(e){this.currentAttachmentForm.file_desc="",await this.loadFileDescriptionOptions(this.currentAttachmentForm.file_type,e),this.$nextTick(()=>{this.$forceUpdate()})},formatDateTime(e){if(!e)return"";const t=new Date(e);return t.toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"})},downloadFile(e){e.file_url?window.open(e.file_url,"_blank"):this.$message.warning("文件链接不存在")}}},n=l,c=(s("5fba"),s("2877")),f=Object(c["a"])(n,a,i,!1,null,"63ecf559",null);t["a"]=f.exports},"384f":function(e,t,s){"use strict";var a=s("e330"),i=s("5388"),r=s("cb27"),o=r.Set,l=r.proto,n=a(l.forEach),c=a(l.keys),f=c(new o).next;e.exports=function(e,t,s){return s?i({iterator:c(e),next:f},t):n(e,t)}},"395e":function(e,t,s){"use strict";var a=s("dc19"),i=s("cb27").has,r=s("8e16"),o=s("7f65"),l=s("5388"),n=s("2a62");e.exports=function(e){var t=a(this),s=o(e);if(r(t)<s.size)return!1;var c=s.getIterator();return!1!==l(c,(function(e){if(!i(t,e))return n(c,"normal",!1)}))}},5388:function(e,t,s){"use strict";var a=s("c65b");e.exports=function(e,t,s){var i,r,o=s?e:e.iterator,l=e.next;while(!(i=a(l,o)).done)if(r=t(i.value),void 0!==r)return r}},"5fba":function(e,t,s){"use strict";s("d6b2")},"68df":function(e,t,s){"use strict";var a=s("dc19"),i=s("8e16"),r=s("384f"),o=s("7f65");e.exports=function(e){var t=a(this),s=o(e);return!(i(t)>s.size)&&!1!==r(t,(function(e){if(!s.includes(e))return!1}),!0)}},7282:function(e,t,s){"use strict";var a=s("e330"),i=s("59ed");e.exports=function(e,t,s){try{return a(i(Object.getOwnPropertyDescriptor(e,t)[s]))}catch(r){}}},"72c3":function(e,t,s){"use strict";var a=s("23e7"),i=s("e9bc"),r=s("dad2");a({target:"Set",proto:!0,real:!0,forced:!r("union")},{union:i})},"79a4":function(e,t,s){"use strict";var a=s("23e7"),i=s("d039"),r=s("953b"),o=s("dad2"),l=!o("intersection",(function(e){return 2===e.size&&e.has(1)&&e.has(2)}))||i((function(){return"3,2"!==String(Array.from(new Set([1,2,3]).intersection(new Set([3,2]))))}));a({target:"Set",proto:!0,real:!0,forced:l},{intersection:r})},"7f65":function(e,t,s){"use strict";var a=s("59ed"),i=s("825a"),r=s("c65b"),o=s("5926"),l=s("46c4"),n="Invalid size",c=RangeError,f=TypeError,m=Math.max,p=function(e,t){this.set=e,this.size=m(t,0),this.has=a(e.has),this.keys=a(e.keys)};p.prototype={getIterator:function(){return l(i(r(this.keys,this.set)))},includes:function(e){return r(this.has,this.set,e)}},e.exports=function(e){i(e);var t=+e.size;if(t!==t)throw new f(n);var s=o(t);if(s<0)throw new c(n);return new p(e,s)}},"83b9e":function(e,t,s){"use strict";var a=s("cb27"),i=s("384f"),r=a.Set,o=a.add;e.exports=function(e){var t=new r;return i(e,(function(e){o(t,e)})),t}},"8b00":function(e,t,s){"use strict";var a=s("23e7"),i=s("68df"),r=s("dad2"),o=!r("isSubsetOf",(function(e){return e}));a({target:"Set",proto:!0,real:!0,forced:o},{isSubsetOf:i})},"8e16":function(e,t,s){"use strict";var a=s("7282"),i=s("cb27");e.exports=a(i.proto,"size","get")||function(e){return e.size}},"953b":function(e,t,s){"use strict";var a=s("dc19"),i=s("cb27"),r=s("8e16"),o=s("7f65"),l=s("384f"),n=s("5388"),c=i.Set,f=i.add,m=i.has;e.exports=function(e){var t=a(this),s=o(e),i=new c;return r(t)>s.size?n(s.getIterator(),(function(e){m(t,e)&&f(i,e)})):l(t,(function(e){s.includes(e)&&f(i,e)})),i}},9961:function(e,t,s){"use strict";var a=s("dc19"),i=s("cb27"),r=s("83b9e"),o=s("7f65"),l=s("5388"),n=i.add,c=i.has,f=i.remove;e.exports=function(e){var t=a(this),s=o(e).getIterator(),i=r(t);return l(s,(function(e){c(t,e)?f(i,e):n(i,e)})),i}},a4e7:function(e,t,s){"use strict";var a=s("23e7"),i=s("395e"),r=s("dad2"),o=!r("isSupersetOf",(function(e){return!e}));a({target:"Set",proto:!0,real:!0,forced:o},{isSupersetOf:i})},a5f7:function(e,t,s){"use strict";var a=s("dc19"),i=s("cb27"),r=s("83b9e"),o=s("8e16"),l=s("7f65"),n=s("384f"),c=s("5388"),f=i.has,m=i.remove;e.exports=function(e){var t=a(this),s=l(e),i=r(t);return o(t)<=s.size?n(t,(function(e){s.includes(e)&&m(i,e)})):c(s.getIterator(),(function(e){f(t,e)&&m(i,e)})),i}},b4bc:function(e,t,s){"use strict";var a=s("dc19"),i=s("cb27").has,r=s("8e16"),o=s("7f65"),l=s("384f"),n=s("5388"),c=s("2a62");e.exports=function(e){var t=a(this),s=o(e);if(r(t)<=s.size)return!1!==l(t,(function(e){if(s.includes(e))return!1}),!0);var f=s.getIterator();return!1!==n(f,(function(e){if(i(t,e))return c(f,"normal",!1)}))}},c1a1:function(e,t,s){"use strict";var a=s("23e7"),i=s("b4bc"),r=s("dad2"),o=!r("isDisjointFrom",(function(e){return!e}));a({target:"Set",proto:!0,real:!0,forced:o},{isDisjointFrom:i})},cb27:function(e,t,s){"use strict";var a=s("e330"),i=Set.prototype;e.exports={Set:Set,add:a(i.add),has:a(i.has),remove:a(i["delete"]),proto:i}},d6b2:function(e,t,s){},dad2:function(e,t,s){"use strict";var a=s("d066"),i=function(e){return{size:e,has:function(){return!1},keys:function(){return{next:function(){return{done:!0}}}}}},r=function(e){return{size:e,has:function(){return!0},keys:function(){throw new Error("e")}}};e.exports=function(e,t){var s=a("Set");try{(new s)[e](i(0));try{return(new s)[e](i(-1)),!1}catch(l){if(!t)return!0;try{return(new s)[e](r(-1/0)),!1}catch(n){var o=new s;return o.add(1),o.add(2),t(o[e](r(1/0)))}}}catch(n){return!1}}},dc19:function(e,t,s){"use strict";var a=s("cb27").has;e.exports=function(e){return a(e),e}},e9bc:function(e,t,s){"use strict";var a=s("dc19"),i=s("cb27").add,r=s("83b9e"),o=s("7f65"),l=s("5388");e.exports=function(e){var t=a(this),s=o(e).getIterator(),n=r(t);return l(s,(function(e){i(n,e)})),n}}}]);