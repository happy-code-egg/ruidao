(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-5c25961f"],{"0d26":function(t,e,a){"use strict";var r=a("e330"),s=Error,n=r("".replace),i=function(t){return String(new s(t).stack)}("zxcasd"),o=/\n\s*at [^:]*:[^\n]*/,l=o.test(i);t.exports=function(t,e){if(l&&"string"==typeof t&&!s.prepareStackTrace)while(e--)t=n(t,o,"");return t}},1787:function(t,e,a){"use strict";var r=a("861d");t.exports=function(t){return r(t)||null===t}},"2ba4":function(t,e,a){"use strict";var r=a("40d5"),s=Function.prototype,n=s.apply,i=s.call;t.exports="object"==typeof Reflect&&Reflect.apply||(r?i.bind(n):function(){return i.apply(n,arguments)})},"3bbe":function(t,e,a){"use strict";var r=a("1787"),s=String,n=TypeError;t.exports=function(t){if(r(t))return t;throw new n("Can't set "+s(t)+" as a prototype")}},"6f19":function(t,e,a){"use strict";var r=a("9112"),s=a("0d26"),n=a("b980"),i=Error.captureStackTrace;t.exports=function(t,e,a,o){n&&(i?i(t,e):r(t,"stack",s(a,o)))}},7156:function(t,e,a){"use strict";var r=a("1626"),s=a("861d"),n=a("d2bb");t.exports=function(t,e,a){var i,o;return n&&r(i=e.constructor)&&i!==a&&s(o=i.prototype)&&o!==a.prototype&&n(t,o),t}},7282:function(t,e,a){"use strict";var r=a("e330"),s=a("59ed");t.exports=function(t,e,a){try{return r(s(Object.getOwnPropertyDescriptor(t,e)[a]))}catch(n){}}},"77ba":function(t,e,a){"use strict";a.r(e);var r=function(){var t=this,e=t._self._c;return e("div",{staticClass:"payment-request-detail-container"},[e("div",{staticClass:"page-header"},[e("div",{staticClass:"header-left"},[e("el-button",{attrs:{icon:"el-icon-arrow-left",size:"small"},on:{click:t.handleBack}},[t._v("返回")]),e("span",{staticClass:"page-title"},[t._v("请款单详情")]),e("el-tag",{staticStyle:{"margin-left":"15px"},attrs:{type:t.getStatusType(t.detailData.status),size:"medium"}},[t._v(" "+t._s(t.getStatusText(t.detailData.status))+" ")])],1),e("div",{staticClass:"header-right"},["draft"===t.detailData.status?e("el-button",{attrs:{size:"small",type:"primary"},on:{click:t.handleEdit}},[t._v("编辑")]):t._e(),"draft"===t.detailData.status?e("el-button",{attrs:{size:"small",type:"success"},on:{click:t.handleSubmit}},[t._v("提交审核")]):t._e(),"pending"===t.detailData.status?e("el-button",{attrs:{size:"small",type:"warning"},on:{click:t.handleApprove}},[t._v("审核")]):t._e(),["draft","pending"].includes(t.detailData.status)?e("el-button",{attrs:{size:"small"},on:{click:t.handleWithdraw}},[t._v("撤回")]):t._e(),e("el-button",{attrs:{size:"small"},on:{click:t.handlePrint}},[t._v("打印")]),e("el-button",{attrs:{size:"small"},on:{click:t.handlePreview}},[t._v("预览")]),e("el-button",{attrs:{size:"small"},on:{click:t.handleExport}},[t._v("导出PDF")])],1)]),e("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"detail-content"},[e("el-card",{staticClass:"detail-card",attrs:{shadow:"never"}},[e("div",{staticClass:"card-header",attrs:{slot:"header"},slot:"header"},[e("span",{staticClass:"card-title"},[t._v("基础信息")])]),e("el-descriptions",{attrs:{column:3,border:""}},[e("el-descriptions-item",{attrs:{label:"请款单号",span:1}},[t._v(" "+t._s(t.detailData.requestNo)+" "),t.detailData.linkedPaymentNo?e("el-button",{staticStyle:{"margin-left":"10px"},attrs:{type:"text",size:"mini"},on:{click:function(e){return t.handleViewPayment(t.detailData.linkedPaymentNo)}}},[t._v(" 关联到款: "+t._s(t.detailData.linkedPaymentNo)+" ")]):t._e()],1),e("el-descriptions-item",{attrs:{label:"客户名称",span:1}},[t._v(t._s(t.detailData.customerName))]),e("el-descriptions-item",{attrs:{label:"合同号",span:1}},[e("span",{staticClass:"link-text",on:{click:function(e){return t.handleViewContract(t.detailData.contractNo)}}},[t._v(" "+t._s(t.detailData.contractNo)+" ")])]),e("el-descriptions-item",{attrs:{label:"请款金额",span:1}},[e("span",{staticClass:"amount-highlight"},[t._v("¥"+t._s(t.detailData.totalAmount))])]),e("el-descriptions-item",{attrs:{label:"官费",span:1}},[t._v("¥"+t._s(t.detailData.officialFee))]),e("el-descriptions-item",{attrs:{label:"服务费",span:1}},[t._v("¥"+t._s(t.detailData.serviceFee))]),e("el-descriptions-item",{attrs:{label:"申请人",span:1}},[t._v(t._s(t.detailData.creator))]),e("el-descriptions-item",{attrs:{label:"申请时间",span:1}},[t._v(t._s(t.detailData.createTime))]),e("el-descriptions-item",{attrs:{label:"紧急程度",span:1}},[e("el-tag",{attrs:{type:t.getUrgentType(t.detailData.urgentLevel),size:"small"}},[t._v(" "+t._s(t.getUrgentText(t.detailData.urgentLevel))+" ")])],1),e("el-descriptions-item",{attrs:{label:"审核人",span:1}},[t._v(t._s(t.detailData.approver||"-"))]),e("el-descriptions-item",{attrs:{label:"审核时间",span:1}},[t._v(t._s(t.detailData.approveTime||"-"))]),e("el-descriptions-item",{attrs:{label:"处理期限",span:1}},[e("span",{class:{overdue:t.isOverdue(t.detailData.dueDate)}},[t._v(" "+t._s(t.detailData.dueDate)+" ")])])],1)],1),e("el-card",{staticClass:"detail-card",attrs:{shadow:"never"}},[e("div",{staticClass:"card-header",attrs:{slot:"header"},slot:"header"},[e("span",{staticClass:"card-title"},[t._v("请款明细")]),e("span",{staticClass:"amount-summary"},[t._v(" 明细总计: "),e("span",{staticClass:"amount-highlight"},[t._v("¥"+t._s(t.detailSummary.total))]),t._v(" (官费: ¥"+t._s(t.detailSummary.officialFee)+", 服务费: ¥"+t._s(t.detailSummary.serviceFee)+") ")])]),e("el-table",{attrs:{data:t.detailData.items,border:"",size:"small"}},[e("el-table-column",{attrs:{type:"index",label:"序号",width:"60",align:"center"}}),e("el-table-column",{attrs:{prop:"caseNo",label:"项目编号",width:"120"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("span",{staticClass:"link-text",on:{click:function(e){return t.handleViewCase(a.row.caseNo)}}},[t._v(" "+t._s(a.row.caseNo)+" ")])]}}])}),e("el-table-column",{attrs:{prop:"caseName",label:"项目名称","min-width":"180","show-overflow-tooltip":""}}),e("el-table-column",{attrs:{prop:"caseType",label:"项目类型",width:"100"}}),e("el-table-column",{attrs:{prop:"feeType",label:"费用类型",width:"100"}}),e("el-table-column",{attrs:{prop:"feeSubtype",label:"费用子类",width:"120"}}),e("el-table-column",{attrs:{prop:"amount",label:"金额",width:"120",align:"right"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("span",{staticClass:"amount-text"},[t._v("¥"+t._s(a.row.amount))])]}}])}),e("el-table-column",{attrs:{prop:"currency",label:"币种",width:"80",align:"center"}}),e("el-table-column",{attrs:{prop:"exchangeRate",label:"汇率",width:"80",align:"center"}}),e("el-table-column",{attrs:{prop:"dueDate",label:"交费期限",width:"120"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("span",{class:{overdue:t.isOverdue(a.row.dueDate)}},[t._v(" "+t._s(a.row.dueDate)+" ")])]}}])}),e("el-table-column",{attrs:{prop:"paymentStatus",label:"缴费状态",width:"100",align:"center"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("el-tag",{attrs:{type:t.getPaymentStatusType(a.row.paymentStatus),size:"mini"}},[t._v(" "+t._s(a.row.paymentStatus)+" ")])]}}])}),e("el-table-column",{attrs:{prop:"remark",label:"备注","show-overflow-tooltip":""}})],1)],1),t.auditRecords.length>0?e("el-card",{staticClass:"detail-card",attrs:{shadow:"never"}},[e("div",{staticClass:"card-header",attrs:{slot:"header"},slot:"header"},[e("span",{staticClass:"card-title"},[t._v("审核记录")])]),e("el-timeline",t._l(t.auditRecords,(function(a,r){return e("el-timeline-item",{key:r,attrs:{timestamp:a.time,type:t.getTimelineType(a.action)}},[e("div",{staticClass:"timeline-content"},[e("div",{staticClass:"timeline-header"},[e("span",{staticClass:"action-text"},[t._v(t._s(a.action))]),e("span",{staticClass:"operator"},[t._v(t._s(a.operator))])]),a.comment?e("div",{staticClass:"timeline-body"},[e("span",{staticClass:"comment-label"},[t._v("审核意见：")]),e("span",{staticClass:"comment-text"},[t._v(t._s(a.comment))])]):t._e(),a.adjustedAmount?e("div",{staticClass:"timeline-extra"},[e("span",{staticClass:"adjusted-label"},[t._v("调整金额：")]),e("span",{staticClass:"adjusted-amount"},[t._v("¥"+t._s(a.adjustedAmount))])]):t._e()])])})),1)],1):t._e(),e("el-card",{staticClass:"detail-card",attrs:{shadow:"never"}},[e("div",{staticClass:"card-header",attrs:{slot:"header"},slot:"header"},[e("span",{staticClass:"card-title"},[t._v("备注信息")])]),e("div",{staticClass:"remark-content"},[t.detailData.remark?e("p",[t._v(t._s(t.detailData.remark))]):e("p",{staticClass:"no-remark"},[t._v("暂无备注")])])])],1),e("el-dialog",{attrs:{title:"审核请款单",visible:t.approveDialogVisible,width:"600px","close-on-click-modal":!1},on:{"update:visible":function(e){t.approveDialogVisible=e}}},[e("el-form",{ref:"approveForm",attrs:{model:t.approveForm,rules:t.approveRules,"label-width":"100px"}},[e("el-form-item",{attrs:{label:"审核结果",prop:"result"}},[e("el-radio-group",{model:{value:t.approveForm.result,callback:function(e){t.$set(t.approveForm,"result",e)},expression:"approveForm.result"}},[e("el-radio",{attrs:{label:"approve"}},[t._v("审核通过")]),e("el-radio",{attrs:{label:"reject"}},[t._v("退回修改")])],1)],1),e("el-form-item",{attrs:{label:"审核意见",prop:"comment"}},[e("el-input",{attrs:{type:"textarea",rows:4,placeholder:"请输入审核意见（退回时必填）"},model:{value:t.approveForm.comment,callback:function(e){t.$set(t.approveForm,"comment",e)},expression:"approveForm.comment"}})],1),"approve"===t.approveForm.result?e("el-form-item",{attrs:{label:"调整金额",prop:"adjustedAmount"}},[e("el-input",{staticStyle:{width:"200px"},attrs:{placeholder:"如需调整金额请输入"},model:{value:t.approveForm.adjustedAmount,callback:function(e){t.$set(t.approveForm,"adjustedAmount",e)},expression:"approveForm.adjustedAmount"}},[e("template",{slot:"prepend"},[t._v("¥")])],2),e("span",{staticStyle:{color:"#999","margin-left":"10px"}},[t._v("不填写则按原金额审核")])],1):t._e()],1),e("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{on:{click:function(e){t.approveDialogVisible=!1}}},[t._v("取消")]),e("el-button",{attrs:{type:"primary",loading:t.submitting},on:{click:t.handleConfirmApprove}},[t._v("确认")])],1)],1)],1)},s=[],n=(a("d9e2"),a("14d9"),a("e9f5"),a("7d54"),{name:"PaymentRequestDetail",data(){return{loading:!1,submitting:!1,detailData:{},auditRecords:[],attachments:[],approveDialogVisible:!1,approveForm:{result:"approve",comment:"",adjustedAmount:""},approveRules:{result:[{required:!0,message:"请选择审核结果",trigger:"change"}],comment:[{validator:(t,e,a)=>{"reject"!==this.approveForm.result||e?a():a(new Error("退回时必须填写审核意见"))},trigger:"blur"}]}}},computed:{detailSummary(){if(!this.detailData.items||0===this.detailData.items.length)return{total:"0.00",officialFee:"0.00",serviceFee:"0.00"};let t=0,e=0,a=0;return this.detailData.items.forEach(r=>{const s=parseFloat(r.amount)||0;t+=s,"官费"===r.feeType?e+=s:a+=s}),{total:t.toFixed(2),officialFee:e.toFixed(2),serviceFee:a.toFixed(2)}}},created(){this.getDetail()},methods:{getDetail(){this.loading=!0;const t=this.$route.params.id;setTimeout(()=>{this.detailData={id:t,requestNo:"QK"+String(Date.now()).slice(-8),status:["draft","pending","approved","rejected"][Math.floor(4*Math.random())],customerName:"华为技术有限公司",contractNo:"HT202401001",totalAmount:"25800.00",officialFee:"8500.00",serviceFee:"17300.00",creator:"张三",createTime:"2024-05-15 14:30:00",approver:"李四",approveTime:"2024-05-16 09:15:00",urgentLevel:"urgent",dueDate:"2024-06-30",linkedPaymentNo:"DK202405001",remark:"本次请款涉及多个专利申请项目，请尽快审批处理。客户要求在月底前完成相关费用缴纳。",items:[{caseNo:"AN202401001",caseName:"一种智能手机散热结构及其制造方法",caseType:"发明专利",feeType:"官费",feeSubtype:"申请费",amount:"900.00",currency:"CNY",exchangeRate:"1.0",dueDate:"2024-06-15",paymentStatus:"未缴费",remark:"申请费备注"},{caseNo:"AN202401001",caseName:"一种智能手机散热结构及其制造方法",caseType:"发明专利",feeType:"官费",feeSubtype:"公布印刷费",amount:"50.00",currency:"CNY",exchangeRate:"1.0",dueDate:"2024-06-15",paymentStatus:"未缴费",remark:""},{caseNo:"AN202401002",caseName:"移动终端的快速充电方法",caseType:"发明专利",feeType:"官费",feeSubtype:"申请费",amount:"900.00",currency:"CNY",exchangeRate:"1.0",dueDate:"2024-06-20",paymentStatus:"未缴费",remark:""},{caseNo:"AN202401001",caseName:"一种智能手机散热结构及其制造方法",caseType:"发明专利",feeType:"服务费",feeSubtype:"申请代理费",amount:"8000.00",currency:"CNY",exchangeRate:"1.0",dueDate:"2024-06-30",paymentStatus:"未缴费",remark:"代理费用"},{caseNo:"AN202401002",caseName:"移动终端的快速充电方法",caseType:"发明专利",feeType:"服务费",feeSubtype:"申请代理费",amount:"8000.00",currency:"CNY",exchangeRate:"1.0",dueDate:"2024-06-30",paymentStatus:"未缴费",remark:"代理费用"}]},"draft"!==this.detailData.status&&(this.auditRecords=[{action:"提交审核",operator:"张三",time:"2024-05-15 14:30:00",comment:"请求审核通过"}],["approved","rejected"].includes(this.detailData.status)&&this.auditRecords.push({action:"approved"===this.detailData.status?"审核通过":"审核退回",operator:"李四",time:"2024-05-16 09:15:00",comment:"approved"===this.detailData.status?"审核通过，同意请款":"请修改部分费用明细",adjustedAmount:"approved"===this.detailData.status?"25800.00":""})),this.attachments=[{name:"请款申请表.pdf",type:"pdf",size:"1.2MB",uploadTime:"2024-05-15 14:25:00",url:""},{name:"合同扫描件.pdf",type:"pdf",size:"2.8MB",uploadTime:"2024-05-15 14:26:00",url:""},{name:"项目清单.xlsx",type:"excel",size:"156KB",uploadTime:"2024-05-15 14:27:00",url:""}],this.loading=!1},500)},handleBack(){this.$router.go(-1)},getStatusType(t){const e={draft:"info",pending:"warning",approved:"success",rejected:"danger",withdrawn:""};return e[t]||""},getStatusText(t){const e={draft:"草稿",pending:"待审核",approved:"已通过",rejected:"已退回",withdrawn:"已撤回"};return e[t]||t},getUrgentType(t){const e={normal:"",urgent:"warning",emergency:"danger"};return e[t]||""},getUrgentText(t){const e={normal:"普通",urgent:"紧急",emergency:"特急"};return e[t]||t},getPaymentStatusType(t){const e={"未缴费":"danger","已缴费":"success","部分缴费":"warning"};return e[t]||""},getTimelineType(t){const e={"提交审核":"primary","审核通过":"success","审核退回":"danger","撤回":"warning"};return e[t]||"primary"},getFileIcon(t){const e={pdf:"el-icon-document",excel:"el-icon-s-grid",word:"el-icon-document-copy",image:"el-icon-picture"};return e[t]||"el-icon-document"},isOverdue(t){if(!t)return!1;const e=new Date(t),a=new Date;return e<a},handleEdit(){this.$message.info("跳转到编辑页面")},handleSubmit(){this.$confirm("确认提交请款单审核吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{this.$message.success("提交成功"),this.getDetail()})},handleApprove(){this.approveForm={result:"approve",comment:"",adjustedAmount:""},this.approveDialogVisible=!0},handleConfirmApprove(){this.$refs.approveForm.validate(t=>{t&&(this.submitting=!0,setTimeout(()=>{const t="approve"===this.approveForm.result?"审核通过":"退回修改";this.$message.success(t+"成功"),this.approveDialogVisible=!1,this.submitting=!1,this.getDetail()},1e3))})},handleWithdraw(){this.$confirm("确认撤回请款单吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{this.$message.success("撤回成功"),this.getDetail()})},handlePrint(){this.$message.info("打印功能开发中")},handlePreview(){this.$message.info("预览功能开发中")},handleExport(){this.$message.info("导出PDF功能开发中")},handleViewPayment(t){this.$router.push("/finance/payment-received/detail/"+t)},handleViewContract(t){this.$message.info("查看合同: "+t)},handleViewCase(t){this.$message.info("查看项目: "+t)},handleViewFile(t){this.$message.info("查看文件: "+t.name)},handleDownloadFile(t){this.$message.info("下载文件: "+t.name)}}}),i=n,o=(a("f610"),a("2877")),l=Object(o["a"])(i,r,s,!1,null,"989dcaf2",null);e["default"]=l.exports},ab36:function(t,e,a){"use strict";var r=a("861d"),s=a("9112");t.exports=function(t,e){r(e)&&"cause"in e&&s(t,"cause",e.cause)}},aeb0:function(t,e,a){"use strict";var r=a("9bf2").f;t.exports=function(t,e,a){a in t||r(t,a,{configurable:!0,get:function(){return e[a]},set:function(t){e[a]=t}})}},b325:function(t,e,a){},b980:function(t,e,a){"use strict";var r=a("d039"),s=a("5c6c");t.exports=!r((function(){var t=new Error("a");return!("stack"in t)||(Object.defineProperty(t,"stack",s(1,7)),7!==t.stack)}))},d2bb:function(t,e,a){"use strict";var r=a("7282"),s=a("861d"),n=a("1d80"),i=a("3bbe");t.exports=Object.setPrototypeOf||("__proto__"in{}?function(){var t,e=!1,a={};try{t=r(Object.prototype,"__proto__","set"),t(a,[]),e=a instanceof Array}catch(o){}return function(a,r){return n(a),i(r),s(a)?(e?t(a,r):a.__proto__=r,a):a}}():void 0)},d9e2:function(t,e,a){"use strict";var r=a("23e7"),s=a("cfe9"),n=a("2ba4"),i=a("e5cb"),o="WebAssembly",l=s[o],c=7!==new Error("e",{cause:7}).cause,u=function(t,e){var a={};a[t]=i(t,e,c),r({global:!0,constructor:!0,arity:1,forced:c},a)},p=function(t,e){if(l&&l[t]){var a={};a[t]=i(o+"."+t,e,c),r({target:o,stat:!0,constructor:!0,arity:1,forced:c},a)}};u("Error",(function(t){return function(e){return n(t,this,arguments)}})),u("EvalError",(function(t){return function(e){return n(t,this,arguments)}})),u("RangeError",(function(t){return function(e){return n(t,this,arguments)}})),u("ReferenceError",(function(t){return function(e){return n(t,this,arguments)}})),u("SyntaxError",(function(t){return function(e){return n(t,this,arguments)}})),u("TypeError",(function(t){return function(e){return n(t,this,arguments)}})),u("URIError",(function(t){return function(e){return n(t,this,arguments)}})),p("CompileError",(function(t){return function(e){return n(t,this,arguments)}})),p("LinkError",(function(t){return function(e){return n(t,this,arguments)}})),p("RuntimeError",(function(t){return function(e){return n(t,this,arguments)}}))},e391:function(t,e,a){"use strict";var r=a("577e");t.exports=function(t,e){return void 0===t?arguments.length<2?"":e:r(t)}},e5cb:function(t,e,a){"use strict";var r=a("d066"),s=a("1a2d"),n=a("9112"),i=a("3a9b"),o=a("d2bb"),l=a("e893"),c=a("aeb0"),u=a("7156"),p=a("e391"),d=a("ab36"),m=a("6f19"),f=a("83ab"),v=a("c430");t.exports=function(t,e,a,h){var g="stackTraceLimit",b=h?2:1,y=t.split("."),_=y[y.length-1],w=r.apply(null,y);if(w){var D=w.prototype;if(!v&&s(D,"cause")&&delete D.cause,!a)return w;var x=r("Error"),k=e((function(t,e){var a=p(h?e:t,void 0),r=h?new w(t):new w;return void 0!==a&&n(r,"message",a),m(r,k,r.stack,2),this&&i(D,this)&&u(r,this,k),arguments.length>b&&d(r,arguments[b]),r}));if(k.prototype=D,"Error"!==_?o?o(k,x):l(k,x,{name:!0}):f&&g in w&&(c(k,w,g),c(k,w,"prepareStackTrace")),l(k,w),!v)try{D.name!==_&&n(D,"name",_),D.constructor=k}catch(C){}return k}}},f610:function(t,e,a){"use strict";a("b325")}}]);