(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-024a859e"],{"13d5":function(e,t,o){"use strict";var a=o("23e7"),i=o("d58f").left,l=o("a640"),n=o("1212"),r=o("9adc"),c=!r&&n>79&&n<83,s=c||!l("reduce");a({target:"Array",proto:!0,forced:s},{reduce:function(e){var t=arguments.length;return i(this,e,t,t>1?arguments[1]:void 0)}})},"17aa":function(e,t,o){"use strict";o("9c8d")},"6cf5":function(e,t,o){"use strict";o.r(t);var a=function(){var e=this,t=e._self._c;return t("div",{staticClass:"invoice-edit-container"},[t("div",{staticClass:"page-header"},[t("h3",[e._v("编辑发票")]),t("div",{staticClass:"operation-buttons"},[t("el-button",{attrs:{size:"small",type:"primary"},on:{click:e.submitInvoice}},[e._v("保存")]),t("el-button",{on:{click:e.cancelEdit}},[e._v("取消")])],1)]),t("div",{staticClass:"form-container"},[t("el-form",{ref:"invoiceForm",attrs:{model:e.invoiceForm,rules:e.rules,"label-width":"100px"}},[t("el-row",{attrs:{gutter:20}},[t("el-col",{attrs:{span:8}},[t("el-form-item",{attrs:{label:"发票名称",prop:"invoiceName"}},[t("el-input",{attrs:{placeholder:"请输入文本"},model:{value:e.invoiceForm.invoiceName,callback:function(t){e.$set(e.invoiceForm,"invoiceName",t)},expression:"invoiceForm.invoiceName"}})],1)],1),t("el-col",{attrs:{span:8}},[t("el-form-item",{attrs:{label:"客户名称",prop:"clientName"}},[t("el-select",{attrs:{filterable:"",placeholder:"请输入搜索"},model:{value:e.invoiceForm.clientName,callback:function(t){e.$set(e.invoiceForm,"clientName",t)},expression:"invoiceForm.clientName"}},e._l(e.clientOptions,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)],1),t("el-col",{attrs:{span:8}},[t("el-form-item",{attrs:{label:"发票类型",prop:"invoiceType"}},[t("el-select",{attrs:{placeholder:"三选一"},model:{value:e.invoiceForm.invoiceType,callback:function(t){e.$set(e.invoiceForm,"invoiceType",t)},expression:"invoiceForm.invoiceType"}},[t("el-option",{attrs:{label:"增值税专用发票",value:"special"}}),t("el-option",{attrs:{label:"增值税普通发票",value:"general"}}),t("el-option",{attrs:{label:"电子发票",value:"electronic"}})],1)],1)],1)],1),t("el-row",{attrs:{gutter:20}},[t("el-col",{attrs:{span:8}},[t("el-form-item",{attrs:{label:"开票抬头",prop:"invoiceTitle"}},[t("el-select",{attrs:{placeholder:"客户资料里选"},model:{value:e.invoiceForm.invoiceTitle,callback:function(t){e.$set(e.invoiceForm,"invoiceTitle",t)},expression:"invoiceForm.invoiceTitle"}},e._l(e.titleOptions,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)],1),t("el-col",{attrs:{span:8}},[t("el-form-item",{attrs:{label:"开票信用代码",prop:"creditCode"}},[t("el-input",{attrs:{placeholder:"带出字段",disabled:""},model:{value:e.invoiceForm.creditCode,callback:function(t){e.$set(e.invoiceForm,"creditCode",t)},expression:"invoiceForm.creditCode"}})],1)],1),t("el-col",{attrs:{span:8}},[t("el-form-item",{attrs:{label:"开户银行及账号",prop:"bankAccount"}},[t("el-input",{attrs:{placeholder:"带出字段",disabled:""},model:{value:e.invoiceForm.bankAccount,callback:function(t){e.$set(e.invoiceForm,"bankAccount",t)},expression:"invoiceForm.bankAccount"}})],1)],1)],1),t("el-row",{attrs:{gutter:20}},[t("el-col",{attrs:{span:8}},[t("el-form-item",{attrs:{label:"发票收款情况",prop:"receivableStatus"}},[t("el-select",{attrs:{placeholder:"请选择"},model:{value:e.invoiceForm.receivableStatus,callback:function(t){e.$set(e.invoiceForm,"receivableStatus",t)},expression:"invoiceForm.receivableStatus"}},[t("el-option",{attrs:{label:"未付款",value:"unpaid"}}),t("el-option",{attrs:{label:"部分付款",value:"partial"}}),t("el-option",{attrs:{label:"已付款",value:"paid"}})],1)],1)],1),t("el-col",{attrs:{span:8}},[t("el-form-item",{attrs:{label:"开票公司",prop:"company"}},[t("el-select",{attrs:{placeholder:"请选择"},model:{value:e.invoiceForm.company,callback:function(t){e.$set(e.invoiceForm,"company",t)},expression:"invoiceForm.company"}},[t("el-option",{attrs:{label:"公司A",value:"companyA"}}),t("el-option",{attrs:{label:"公司B",value:"companyB"}})],1)],1)],1),t("el-col",{attrs:{span:8}},[t("el-form-item",{attrs:{label:"开票电话",prop:"phone"}},[t("el-input",{attrs:{placeholder:"请输入文本"},model:{value:e.invoiceForm.phone,callback:function(t){e.$set(e.invoiceForm,"phone",t)},expression:"invoiceForm.phone"}})],1)],1)],1),t("el-row",{attrs:{gutter:20}},[t("el-col",{attrs:{span:8}},[t("el-form-item",{attrs:{label:"开票日期",prop:"invoiceDate"}},[t("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"date",placeholder:"选择日期"},model:{value:e.invoiceForm.invoiceDate,callback:function(t){e.$set(e.invoiceForm,"invoiceDate",t)},expression:"invoiceForm.invoiceDate"}})],1)],1),t("el-col",{attrs:{span:8}},[t("el-form-item",{attrs:{label:"包含官费",prop:"includeOfficialFee"}},[t("el-select",{attrs:{placeholder:"是否包含"},model:{value:e.invoiceForm.includeOfficialFee,callback:function(t){e.$set(e.invoiceForm,"includeOfficialFee",t)},expression:"invoiceForm.includeOfficialFee"}},[t("el-option",{attrs:{label:"是",value:"yes"}}),t("el-option",{attrs:{label:"否",value:"no"}})],1)],1)],1),t("el-col",{attrs:{span:8}},[t("el-form-item",{attrs:{label:"发票号",prop:"invoiceNumber"}},[t("el-input",{attrs:{placeholder:"请输入文本"},model:{value:e.invoiceForm.invoiceNumber,callback:function(t){e.$set(e.invoiceForm,"invoiceNumber",t)},expression:"invoiceForm.invoiceNumber"}})],1)],1)],1),t("el-row",{attrs:{gutter:20}},[t("el-col",{attrs:{span:8}},[t("el-form-item",{attrs:{label:"本次开票金额",prop:"currentAmount"}},[t("el-input-number",{staticStyle:{width:"100%"},attrs:{precision:2,min:0,"controls-position":"right"},model:{value:e.invoiceForm.currentAmount,callback:function(t){e.$set(e.invoiceForm,"currentAmount",t)},expression:"invoiceForm.currentAmount"}})],1)],1),t("el-col",{attrs:{span:8}},[t("el-form-item",{attrs:{label:"开票金额大写",prop:"amountInWords"}},[t("el-input",{attrs:{placeholder:"带出字段",disabled:""},model:{value:e.invoiceForm.amountInWords,callback:function(t){e.$set(e.invoiceForm,"amountInWords",t)},expression:"invoiceForm.amountInWords"}})],1)],1),t("el-col",{attrs:{span:8}},[t("el-form-item",[t("el-button",{attrs:{size:"small",type:"primary"},on:{click:e.showAddItemForm}},[e._v("添加")])],1)],1)],1),t("div",{staticClass:"item-table-container"},[t("el-table",{staticStyle:{width:"100%"},attrs:{data:e.invoiceForm.items,border:""}},[t("el-table-column",{attrs:{type:"index",label:"序号",width:"50"}}),t("el-table-column",{attrs:{prop:"itemName",label:"开票项目"}}),t("el-table-column",{attrs:{prop:"unitPrice",label:"单价"}}),t("el-table-column",{attrs:{prop:"quantity",label:"数量"}}),t("el-table-column",{attrs:{prop:"subtotal",label:"小计"}}),t("el-table-column",{attrs:{label:"操作",width:"100",align:"center"},scopedSlots:e._u([{key:"default",fn:function(o){return[t("el-button",{attrs:{size:"small",type:"text"},on:{click:function(t){return e.removeItem(o.$index)}}},[e._v("删除")])]}}])})],1)],1),e.showItemForm?t("div",{staticClass:"add-item-form"},[t("h4",[e._v("添加开票项目")]),t("el-row",{attrs:{gutter:20}},[t("el-col",{attrs:{span:6}},[t("el-form-item",{attrs:{label:"开票项目"}},[t("el-input",{attrs:{placeholder:"请输入文本"},model:{value:e.newItem.itemName,callback:function(t){e.$set(e.newItem,"itemName",t)},expression:"newItem.itemName"}})],1)],1),t("el-col",{attrs:{span:6}},[t("el-form-item",{attrs:{label:"单价"}},[t("el-input-number",{staticStyle:{width:"100%"},attrs:{precision:2,min:0,"controls-position":"right"},model:{value:e.newItem.unitPrice,callback:function(t){e.$set(e.newItem,"unitPrice",t)},expression:"newItem.unitPrice"}})],1)],1),t("el-col",{attrs:{span:6}},[t("el-form-item",{attrs:{label:"数量"}},[t("el-input-number",{staticStyle:{width:"100%"},attrs:{min:1,"controls-position":"right"},model:{value:e.newItem.quantity,callback:function(t){e.$set(e.newItem,"quantity",t)},expression:"newItem.quantity"}})],1)],1),t("el-col",{attrs:{span:6}},[t("el-form-item",{attrs:{label:"小计"}},[t("el-input",{attrs:{disabled:""},model:{value:e.subtotal,callback:function(t){e.subtotal=t},expression:"subtotal"}})],1)],1)],1),t("el-row",[t("el-col",{staticStyle:{"text-align":"center","margin-bottom":"20px"},attrs:{span:24}},[t("el-button",{attrs:{size:"small",type:"primary"},on:{click:e.addItem}},[e._v("确定")]),t("el-button",{on:{click:e.cancelAdd}},[e._v("取消")])],1)],1)],1):e._e(),t("el-row",{attrs:{gutter:20}},[t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:"开票备注",prop:"remarks"}},[t("el-input",{attrs:{type:"textarea",rows:"3",placeholder:"请输入文本"},model:{value:e.invoiceForm.remarks,callback:function(t){e.$set(e.invoiceForm,"remarks",t)},expression:"invoiceForm.remarks"}})],1)],1)],1),t("el-row",{attrs:{gutter:20}},[t("el-col",{attrs:{span:8}},[t("el-form-item",{attrs:{label:"创建人",prop:"creator"}},[t("el-input",{attrs:{placeholder:"系统自动生成",disabled:""},model:{value:e.invoiceForm.creator,callback:function(t){e.$set(e.invoiceForm,"creator",t)},expression:"invoiceForm.creator"}})],1)],1),t("el-col",{attrs:{span:8}},[t("el-form-item",{attrs:{label:"创建时间",prop:"createTime"}},[t("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"datetime",placeholder:"系统自动生成",disabled:""},model:{value:e.invoiceForm.createTime,callback:function(t){e.$set(e.invoiceForm,"createTime",t)},expression:"invoiceForm.createTime"}})],1)],1)],1),t("el-row",{attrs:{gutter:20}},[t("el-col",{attrs:{span:8}},[t("el-form-item",{attrs:{label:"修改人",prop:"updater"}},[t("el-input",{attrs:{placeholder:"系统自动生成",disabled:""},model:{value:e.invoiceForm.updater,callback:function(t){e.$set(e.invoiceForm,"updater",t)},expression:"invoiceForm.updater"}})],1)],1),t("el-col",{attrs:{span:8}},[t("el-form-item",{attrs:{label:"修改时间",prop:"updateTime"}},[t("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"datetime",placeholder:"系统自动生成",disabled:""},model:{value:e.invoiceForm.updateTime,callback:function(t){e.$set(e.invoiceForm,"updateTime",t)},expression:"invoiceForm.updateTime"}})],1)],1)],1),t("el-row",{attrs:{gutter:20}},[t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:"到账单信息",prop:"accountInfo"}},[t("el-input",{attrs:{placeholder:"请输入文本"},model:{value:e.invoiceForm.accountInfo,callback:function(t){e.$set(e.invoiceForm,"accountInfo",t)},expression:"invoiceForm.accountInfo"}})],1)],1)],1),t("el-row",{attrs:{gutter:20}},[t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:"所选业绩列表",prop:"performanceList"}},[t("el-button",{on:{click:e.selectPerformance}},[e._v("选择到账")])],1)],1)],1),e.invoiceForm.accountList&&e.invoiceForm.accountList.length>0?t("div",{staticClass:"account-table-container"},[t("el-table",{staticStyle:{width:"100%"},attrs:{data:e.invoiceForm.accountList,border:""}},[t("el-table-column",{attrs:{type:"index",label:"序号",width:"50"}}),t("el-table-column",{attrs:{prop:"accountNo",label:"到款单号"}}),t("el-table-column",{attrs:{prop:"payerName",label:"付款户名"}}),t("el-table-column",{attrs:{prop:"clientName",label:"客户名称"}}),t("el-table-column",{attrs:{prop:"amount",label:"到款金额"}}),t("el-table-column",{attrs:{prop:"receiveDate",label:"到款日期"}}),t("el-table-column",{attrs:{prop:"serviceCharge",label:"服务费"}}),t("el-table-column",{attrs:{prop:"feeAmount",label:"官费"}}),t("el-table-column",{attrs:{prop:"feeHead",label:"官费抬头"}}),t("el-table-column",{attrs:{prop:"performanceType",label:"是否为绩效"}}),t("el-table-column",{attrs:{prop:"businessPerson",label:"收款业务员"}}),t("el-table-column",{attrs:{prop:"totalAmount",label:"可开票金额"}}),t("el-table-column",{attrs:{prop:"currentAmount",label:"本次开票金额"}}),t("el-table-column",{attrs:{prop:"useDetail1",label:"到款用途1"}}),t("el-table-column",{attrs:{prop:"useDetail2",label:"到款用途2"}}),t("el-table-column",{attrs:{prop:"useDetail3",label:"到款用途3"}}),t("el-table-column",{attrs:{label:"操作",width:"100",align:"center"},scopedSlots:e._u([{key:"default",fn:function(o){return[t("el-button",{attrs:{size:"small",type:"text"},on:{click:function(t){return e.removeAccount(o.$index)}}},[e._v("移除")])]}}],null,!1,1886288053)})],1),t("div",{staticClass:"account-total"},[t("span",[e._v("总计："+e._s(e.totalAccountAmount)+"元")])])],1):e._e()],1)],1),t("el-dialog",{attrs:{title:"选择到账",visible:e.accountDialogVisible,width:"80%"},on:{"update:visible":function(t){e.accountDialogVisible=t}}},[t("div",{staticClass:"account-selection"},[t("el-table",{staticStyle:{width:"100%"},attrs:{data:e.accountOptions,border:""},on:{"selection-change":e.handleAccountSelectionChange}},[t("el-table-column",{attrs:{type:"selection",width:"80"}}),t("el-table-column",{attrs:{type:"index",label:"序号",width:"50"}}),t("el-table-column",{attrs:{prop:"accountNo",label:"到款单号"}}),t("el-table-column",{attrs:{prop:"payerName",label:"付款户名"}}),t("el-table-column",{attrs:{prop:"clientName",label:"客户名称"}}),t("el-table-column",{attrs:{prop:"amount",label:"到款金额"}}),t("el-table-column",{attrs:{prop:"receiveDate",label:"到款日期"}}),t("el-table-column",{attrs:{prop:"totalAmount",label:"可开票金额"}})],1)],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.accountDialogVisible=!1}}},[e._v("取消")]),t("el-button",{attrs:{size:"small",type:"primary"},on:{click:e.confirmAccountSelection}},[e._v("确定")])],1)])],1)},i=[],l=(o("14d9"),o("13d5"),o("e9f5"),o("ab43"),o("9485"),{name:"InvoiceEdit",data(){return{invoiceForm:{invoiceName:"",clientName:"",invoiceType:"",invoiceTitle:"",creditCode:"",bankAccount:"",receivableStatus:"",company:"",phone:"",invoiceDate:"",includeOfficialFee:"no",invoiceNumber:"",currentAmount:0,amountInWords:"",remarks:"",creator:"",createTime:null,updater:"当前用户",updateTime:new Date,accountInfo:"",items:[],accountList:[]},newItem:{itemName:"",unitPrice:0,quantity:1},rules:{invoiceName:[{required:!0,message:"请输入发票名称",trigger:"blur"}],clientName:[{required:!0,message:"请选择客户名称",trigger:"change"}],invoiceType:[{required:!0,message:"请选择发票类型",trigger:"change"}],invoiceTitle:[{required:!0,message:"请选择开票抬头",trigger:"change"}],company:[{required:!0,message:"请选择开票公司",trigger:"change"}],currentAmount:[{required:!0,message:"请输入开票金额",trigger:"blur"}]},showItemForm:!1,accountDialogVisible:!1,selectedAccounts:[],clientOptions:[{value:"client1",label:"客户1"},{value:"client2",label:"客户2"},{value:"client3",label:"客户3"}],titleOptions:[{value:"title1",label:"抬头1"},{value:"title2",label:"抬头2"}],accountOptions:[]}},computed:{subtotal(){return(this.newItem.unitPrice*this.newItem.quantity).toFixed(2)},totalAccountAmount(){return this.invoiceForm.accountList&&0!==this.invoiceForm.accountList.length?this.invoiceForm.accountList.reduce((e,t)=>e+parseFloat(t.currentAmount),0).toFixed(2):"0.00"}},created(){this.getInvoiceDetail(this.$route.query.id),this.getAccountOptions()},methods:{getInvoiceDetail(e){this.invoiceForm={id:e,invoiceName:"发票"+e,clientName:"client1",invoiceType:"special",invoiceTitle:"title1",creditCode:"91320112MA22F28XXQ",bankAccount:"工商银行 6222020200123456789",receivableStatus:"unpaid",company:"companyA",phone:"025-12345678",invoiceDate:new Date,includeOfficialFee:"no",invoiceNumber:"FP2023"+e.toString().padStart(4,"0"),currentAmount:2800,amountInWords:"贰仟捌佰元整",remarks:"紧急开票",creator:"系统管理员",createTime:new Date(2023,4,3,14,22),updater:"当前用户",updateTime:new Date,accountInfo:"到款单号:S28847382 +成都XX有限公司+20240124+5000",items:[{itemName:"发明",unitPrice:1e3,quantity:2,subtotal:2e3},{itemName:"实用",unitPrice:800,quantity:1,subtotal:800}],accountList:[{accountNo:"DK20230001",payerName:"成都XX有限公司",clientName:"客户1",amount:"5000.00",receiveDate:"2024-01-24",serviceCharge:"500.00",feeAmount:"1500.00",feeHead:"国家知识产权局",performanceType:"是",businessPerson:"业务员1",totalAmount:"5000.00",currentAmount:"2800.00",useDetail1:"专利申请",useDetail2:"",useDetail3:""}]}},getAccountOptions(){this.accountOptions=Array.from({length:10}).map((e,t)=>({id:t+1,accountNo:"DK2023000"+(t+1),payerName:"付款方"+(t+1),clientName:"客户"+(t%3+1),amount:(1e3*(t+1)).toFixed(2),receiveDate:"2023-06-"+(10+t),totalAmount:(800*(t+1)).toFixed(2)}))},showAddItemForm(){this.showItemForm=!0,this.newItem={itemName:"",unitPrice:0,quantity:1}},addItem(){this.newItem.itemName?(this.invoiceForm.items.push({itemName:this.newItem.itemName,unitPrice:this.newItem.unitPrice,quantity:this.newItem.quantity,subtotal:parseFloat(this.subtotal)}),this.showItemForm=!1):this.$message.warning("请输入开票项目名称")},cancelAdd(){this.showItemForm=!1},removeItem(e){this.invoiceForm.items.splice(e,1)},submitInvoice(){this.$refs.invoiceForm.validate(e=>{if(!e)return this.$message.error("请填写完整表单信息"),!1;0!==this.invoiceForm.items.length?(this.$message.success("保存成功"),this.$router.push("/finance/invoice/query")):this.$message.warning("请至少添加一个开票项目")})},cancelEdit(){this.$router.push("/finance/invoice/query")},selectPerformance(){this.accountDialogVisible=!0},handleAccountSelectionChange(e){this.selectedAccounts=e},confirmAccountSelection(){0!==this.selectedAccounts.length?(this.invoiceForm.accountList=this.selectedAccounts.map(e=>({...e,serviceCharge:(.1*e.amount).toFixed(2),feeAmount:(.3*e.amount).toFixed(2),feeHead:"国家知识产权局",performanceType:"是",businessPerson:"业务员1",currentAmount:(.6*e.amount).toFixed(2),useDetail1:"专利申请",useDetail2:"",useDetail3:""})),this.accountDialogVisible=!1):this.$message.warning("请至少选择一条到账记录")},removeAccount(e){this.invoiceForm.accountList.splice(e,1)}}}),n=l,r=(o("17aa"),o("2877")),c=Object(r["a"])(n,a,i,!1,null,"4518b8f5",null);t["default"]=c.exports},8558:function(e,t,o){"use strict";var a=o("cfe9"),i=o("b5db"),l=o("c6b6"),n=function(e){return i.slice(0,e.length)===e};e.exports=function(){return n("Bun/")?"BUN":n("Cloudflare-Workers")?"CLOUDFLARE":n("Deno/")?"DENO":n("Node.js/")?"NODE":a.Bun&&"string"==typeof Bun.version?"BUN":a.Deno&&"object"==typeof Deno.version?"DENO":"process"===l(a.process)?"NODE":a.window&&a.document?"BROWSER":"REST"}()},9485:function(e,t,o){"use strict";var a=o("23e7"),i=o("2266"),l=o("59ed"),n=o("825a"),r=o("46c4"),c=TypeError;a({target:"Iterator",proto:!0,real:!0},{reduce:function(e){n(this),l(e);var t=r(this),o=arguments.length<2,a=o?void 0:arguments[1],s=0;if(i(t,(function(t){o?(o=!1,a=t):a=e(a,t,s),s++}),{IS_RECORD:!0}),o)throw new c("Reduce of empty iterator with no initial value");return a}})},"9adc":function(e,t,o){"use strict";var a=o("8558");e.exports="NODE"===a},"9c8d":function(e,t,o){},a640:function(e,t,o){"use strict";var a=o("d039");e.exports=function(e,t){var o=[][e];return!!o&&a((function(){o.call(null,t||function(){return 1},1)}))}},d58f:function(e,t,o){"use strict";var a=o("59ed"),i=o("7b0b"),l=o("44ad"),n=o("07fa"),r=TypeError,c="Reduce of empty array with no initial value",s=function(e){return function(t,o,s,u){var m=i(t),p=l(m),d=n(m);if(a(o),0===d&&s<2)throw new r(c);var v=e?d-1:0,b=e?-1:1;if(s<2)while(1){if(v in p){u=p[v],v+=b;break}if(v+=b,e?v<0:d<=v)throw new r(c)}for(;e?v>=0:d>v;v+=b)v in p&&(u=o(u,p[v],v,m));return u}};e.exports={left:s(!1),right:s(!0)}}}]);