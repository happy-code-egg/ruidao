(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-25841260"],{"0d26":function(e,t,r){"use strict";var a=r("e330"),n=Error,s=a("".replace),o=function(e){return String(new n(e).stack)}("zxcasd"),i=/\n\s*at [^:]*:[^\n]*/,l=i.test(o);e.exports=function(e,t){if(l&&"string"==typeof e&&!n.prepareStackTrace)while(t--)e=s(e,i,"");return e}},1787:function(e,t,r){"use strict";var a=r("861d");e.exports=function(e){return a(e)||null===e}},"1e5a":function(e,t,r){"use strict";var a=r("23e7"),n=r("9961"),s=r("dad2");a({target:"Set",proto:!0,real:!0,forced:!s("symmetricDifference")},{symmetricDifference:n})},"1e70":function(e,t,r){"use strict";var a=r("23e7"),n=r("a5f7"),s=r("dad2"),o=!s("difference",(function(e){return 0===e.size}));a({target:"Set",proto:!0,real:!0,forced:o},{difference:n})},"2ba4":function(e,t,r){"use strict";var a=r("40d5"),n=Function.prototype,s=n.apply,o=n.call;e.exports="object"==typeof Reflect&&Reflect.apply||(a?o.bind(s):function(){return o.apply(s,arguments)})},3040:function(e,t,r){"use strict";r.r(t);var a=function(){var e=this,t=e._self._c;return t("div",{staticClass:"user-management"},[t("div",{staticClass:"body-part-search"},[t("el-form",{staticClass:"demo-form-inline",attrs:{inline:!0,model:e.searchForm}},[t("el-form-item",{attrs:{label:"用户名"}},[t("el-input",{attrs:{size:"small",placeholder:"用户名",clearable:""},model:{value:e.searchForm.username,callback:function(t){e.$set(e.searchForm,"username",t)},expression:"searchForm.username"}})],1),t("el-form-item",{attrs:{label:"姓名"}},[t("el-input",{attrs:{size:"small",placeholder:"姓名",clearable:""},model:{value:e.searchForm.name,callback:function(t){e.$set(e.searchForm,"name",t)},expression:"searchForm.name"}})],1),t("el-form-item",{attrs:{label:"部门"}},[t("el-cascader",{attrs:{size:"small",options:e.departmentTreeOptions,props:{checkStrictly:!0,value:"value",label:"label",emitPath:!1},placeholder:"请选择部门",clearable:"",filterable:""},on:{change:e.handleDepartmentChange},model:{value:e.searchForm.department,callback:function(t){e.$set(e.searchForm,"department",t)},expression:"searchForm.department"}})],1),t("el-form-item",{attrs:{label:"状态"}},[t("el-select",{attrs:{size:"small",placeholder:"请选择"},model:{value:e.searchForm.status,callback:function(t){e.$set(e.searchForm,"status",t)},expression:"searchForm.status"}},[t("el-option",{attrs:{label:"全部",value:""}}),t("el-option",{attrs:{label:"启用",value:"1"}}),t("el-option",{attrs:{label:"禁用",value:"0"}})],1)],1),t("el-form-item",[t("el-button",{attrs:{size:"small",type:"primary"},on:{click:e.handleSearch}},[e._v("查询")]),t("el-button",{attrs:{size:"small"},on:{click:e.resetSearch}},[e._v("重置")]),t("el-button",{attrs:{size:"small",type:"primary"},on:{click:e.showAddUserDialog}},[e._v("添加用户")])],1)],1)],1),t("div",{staticClass:"body-part-content"},[t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{data:e.userList,border:"",size:"small"}},[t("el-table-column",{attrs:{prop:"id",align:"center",label:"ID",width:"80"}}),t("el-table-column",{attrs:{prop:"username",align:"center",label:"用户名",width:"120"}}),t("el-table-column",{attrs:{prop:"name",align:"center",label:"姓名",width:"120"}}),t("el-table-column",{attrs:{prop:"gender",align:"center",label:"性别",width:"120"}}),t("el-table-column",{attrs:{prop:"department",align:"center",label:"所属部门","min-width":"160"},scopedSlots:e._u([{key:"default",fn:function(r){return[t("span",{attrs:{title:r.row.departmentFullPath||r.row.department}},[e._v(" "+e._s(r.row.departmentFullPath||r.row.department||"未分配部门")+" ")])]}}])}),t("el-table-column",{attrs:{prop:"position",align:"center",label:"职位"}}),t("el-table-column",{attrs:{prop:"role",align:"center",label:"角色"},scopedSlots:e._u([{key:"default",fn:function(r){return e._l(r.row.role,(function(r){return t("el-tag",{key:r,staticStyle:{margin:"5px"},attrs:{type:"success"}},[e._v(" "+e._s(r)+" ")])}))}}])}),t("el-table-column",{attrs:{prop:"createTime",align:"center",label:"创建时间",width:"200"}}),t("el-table-column",{attrs:{prop:"status",align:"center",label:"离职在职状态",width:"120"},scopedSlots:e._u([{key:"default",fn:function(r){return[t("el-tag",{attrs:{type:1===r.row.status?"success":"info"}},[e._v(" "+e._s(1===r.row.status?"在职":"离职")+" ")])]}}])}),t("el-table-column",{attrs:{prop:"status",align:"center",label:"账号状态",width:"120"},scopedSlots:e._u([{key:"default",fn:function(r){return[t("el-tag",{attrs:{type:1===r.row.accountStatus?"success":"info"}},[e._v(" "+e._s(1===r.row.accountStatus?"启用":"禁用")+" ")])]}}])}),t("el-table-column",{attrs:{width:"250",align:"center",label:"操作",fixed:"right"},scopedSlots:e._u([{key:"default",fn:function(r){return[1===r.row.accountStatus?t("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(t){return e.toggleStatus(r.row)}}},[e._v("禁用")]):e._e(),0===r.row.accountStatus?t("el-button",{attrs:{size:"mini",type:"success"},on:{click:function(t){return e.toggleStatus(r.row)}}},[e._v("启用")]):e._e(),t("el-button",{attrs:{size:"mini"},on:{click:function(t){return e.handleEdit(r.row)}}},[e._v("编辑")]),t("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(t){return e.handleResetPassword(r.row)}}},[e._v("重置密码")])]}}])})],1),t("div",[t("el-pagination",{attrs:{"current-page":e.currentPage,"page-sizes":[10,20,50,100],"page-size":e.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1)],1),t("el-dialog",{attrs:{title:e.dialogTitle,visible:e.dialogVisible,"append-to-body":"","close-on-click-modal":!1},on:{"update:visible":function(t){e.dialogVisible=t}}},[t("el-form",{ref:"userForm",attrs:{model:e.userForm,rules:e.rules,"label-width":"140px"}},[t("el-form-item",{attrs:{label:"用户名（工号）",prop:"username"}},[t("el-input",{attrs:{disabled:e.isEdit},model:{value:e.userForm.username,callback:function(t){e.$set(e.userForm,"username",t)},expression:"userForm.username"}})],1),t("el-form-item",{attrs:{label:"姓名",prop:"name"}},[t("el-input",{model:{value:e.userForm.name,callback:function(t){e.$set(e.userForm,"name",t)},expression:"userForm.name"}})],1),t("el-form-item",{attrs:{label:"性别",prop:"gender"}},[t("el-select",{attrs:{placeholder:"请选择性别"},model:{value:e.userForm.gender,callback:function(t){e.$set(e.userForm,"gender",t)},expression:"userForm.gender"}},[t("el-option",{attrs:{label:"男",value:"男"}}),t("el-option",{attrs:{label:"女",value:"女"}})],1)],1),e.isEdit?e._e():t("el-form-item",{attrs:{label:"密码",prop:"password"}},[t("el-input",{attrs:{type:"password"},model:{value:e.userForm.password,callback:function(t){e.$set(e.userForm,"password",t)},expression:"userForm.password"}})],1),e.isEdit?e._e():t("el-form-item",{attrs:{label:"确认密码",prop:"confirmPassword"}},[t("el-input",{attrs:{type:"password"},model:{value:e.userForm.confirmPassword,callback:function(t){e.$set(e.userForm,"confirmPassword",t)},expression:"userForm.confirmPassword"}})],1),t("el-form-item",{attrs:{label:"所属部门",prop:"department"}},[t("el-cascader",{staticStyle:{width:"100%"},attrs:{options:e.departmentTreeOptions,props:{checkStrictly:!0,value:"value",label:"label",emitPath:!1},placeholder:"请选择部门",clearable:"",filterable:""},model:{value:e.userForm.department,callback:function(t){e.$set(e.userForm,"department",t)},expression:"userForm.department"}})],1),t("el-form-item",{attrs:{label:"职位",prop:"position"}},[t("el-input",{model:{value:e.userForm.position,callback:function(t){e.$set(e.userForm,"position",t)},expression:"userForm.position"}})],1),t("el-form-item",{attrs:{label:"邮箱",prop:"email"}},[t("el-input",{model:{value:e.userForm.email,callback:function(t){e.$set(e.userForm,"email",t)},expression:"userForm.email"}})],1),t("el-form-item",{attrs:{label:"手机号",prop:"phone"}},[t("el-input",{model:{value:e.userForm.phone,callback:function(t){e.$set(e.userForm,"phone",t)},expression:"userForm.phone"}})],1),t("el-form-item",{attrs:{label:"角色",prop:"role"}},[t("el-select",{attrs:{placeholder:"请选择角色",multiple:"",clearable:""},model:{value:e.userForm.role,callback:function(t){e.$set(e.userForm,"role",t)},expression:"userForm.role"}},e._l(e.roleOptions,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),t("el-form-item",{attrs:{label:"离职在职状态"}},[t("el-switch",{staticClass:"form-switch",attrs:{"active-value":1,"inactive-value":0,"active-text":"在职","inactive-text":"离职"},model:{value:e.userForm.status,callback:function(t){e.$set(e.userForm,"status",t)},expression:"userForm.status"}})],1),t("el-form-item",{attrs:{label:"账号状态"}},[t("el-switch",{staticClass:"form-switch",attrs:{"active-value":1,"inactive-value":0,"active-text":"启用","inactive-text":"禁用"},model:{value:e.userForm.accountStatus,callback:function(t){e.$set(e.userForm,"accountStatus",t)},expression:"userForm.accountStatus"}})],1)],1),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.dialogVisible=!1}}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.submitForm}},[e._v("确 定")])],1)],1)],1)},n=[],s=(r("d9e2"),r("14d9"),r("e9f5"),r("910d"),r("f665"),r("7d54"),r("ab43"),r("a732"),r("1e70"),r("79a4"),r("c1a1"),r("8b00"),r("a4e7"),r("1e5a"),r("72c3"),{name:"UserManagement",data(){const e=(e,t,r)=>{t!==this.userForm.password?r(new Error("两次输入密码不一致!")):r()};return{searchForm:{username:"",name:"",department:"",status:""},userList:[],loading:!1,currentPage:1,pageSize:10,total:0,dialogVisible:!1,dialogTitle:"添加用户",isEdit:!1,userForm:{id:null,username:"",name:"",gender:"",level:"",position:"",password:"",confirmPassword:"",department:"",role:[],email:"",phone:"",status:1,accountStatus:1},rules:{username:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:3,max:20,message:"长度在 3 到 20 个字符",trigger:"blur"}],name:[{required:!0,message:"请输入姓名",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,message:"密码长度不能小于6位",trigger:"blur"}],confirmPassword:[{required:!0,message:"请再次输入密码",trigger:"blur"},{validator:e,trigger:"blur"}],department:[{required:!0,message:"请选择部门",trigger:"change"}],role:[{required:!0,message:"请选择角色",trigger:"change"}],email:[{required:!0,message:"请输入邮箱地址",trigger:"blur"},{type:"email",message:"请输入正确的邮箱地址",trigger:"blur"}],phone:[{required:!0,message:"请输入手机号",trigger:"blur"},{pattern:/^1[3-9]\d{9}$/,message:"请输入正确的手机号码",trigger:"blur"}]},departmentOptions:[],departmentTreeOptions:[],departmentList:[],roleOptions:[]}},async created(){await this.loadDepartments(),await this.loadRoles(),this.fetchData()},methods:{async fetchData(){this.loading=!0;try{const e={username:this.searchForm.username||"",name:this.searchForm.name||"",department_id:this.searchForm.department||"",status:this.searchForm.status,page:this.currentPage,limit:this.pageSize};console.log("搜索参数:",e),console.log("部门筛选值:",this.searchForm.department);const t=await this.$api.user.getList(e);0===t.data.code?(console.log("API返回的用户数据:",t.data.data),this.userList=this.convertApiDataToLocal(t.data.data),this.total=t.data.count,console.log("转换后的用户列表:",this.userList)):this.$message.error(t.data.msg||"获取用户列表失败")}catch(e){console.error("获取用户列表失败:",e),this.$message.error("获取用户列表失败"),this.fetchDataMock()}finally{this.loading=!1}},convertApiDataToLocal(e){return e.map(e=>{let t=null,r="",a="未分配部门";e.department&&(t=e.department.id,r=e.department.name||e.department.department_name||"",a=t?this.getDepartmentPathFromList(t)||r||"未知部门":r||"未知部门");const n={id:e.id,username:e.username,name:e.real_name,gender:e.gender||"未知",department:r,departmentId:t,departmentFullPath:a,position:e.position,email:e.email,phone:e.phone,role:e.roles?e.roles.map(e=>e.name):[],roleIds:e.roles?e.roles.map(e=>e.id):[],createTime:e.created_at,status:e.status,accountStatus:e.status};return console.log(`用户 ${e.username} 的部门信息:`,{"原始部门数据":e.department,"部门ID":t,"部门名称":r,"完整路径":a}),n})},async loadDepartments(){try{const e=await this.$api.department.getList();if(0===e.data.code){console.log("部门API返回的原始数据:",e.data.data);const t=e.data.data.some(e=>void 0!==e.children);t?(this.departmentList=this.flattenDepartmentTree(e.data.data),this.departmentTreeOptions=e.data.data.map(e=>this.convertDepartmentToTreeOption(e))):(this.departmentList=e.data.data,this.departmentTreeOptions=this.buildDepartmentTree(e.data.data)),this.departmentOptions=this.departmentList.map(e=>({value:e.id,label:e.department_name})),console.log("处理后的部门列表:",this.departmentList),console.log("部门树形选项:",this.departmentTreeOptions)}}catch(e){console.error("获取部门列表失败:",e),this.loadMockDepartments()}},flattenDepartmentTree(e){const t=[],r=(a,n=0)=>{a.forEach(a=>{t.push({id:a.id,department_name:a.department_name,parent_id:n,level:this.calculateNodeLevel(a,e),sort_order:a.sort_order||0}),a.children&&a.children.length>0&&r(a.children,a.id)})};return r(e),console.log("树形数据转平铺结果:",t),t},calculateNodeLevel(e,t,r=1){if(e.parent_id&&0!==e.parent_id){const a=this.findNodeInTree(t,e.parent_id);if(a)return this.calculateNodeLevel(a,t,r+1)}return r},findNodeInTree(e,t){for(const r of e){if(r.id===t)return r;if(r.children&&r.children.length>0){const e=this.findNodeInTree(r.children,t);if(e)return e}}return null},convertDepartmentToTreeOption(e){const t={value:e.id,label:e.department_name,children:[]};return e.children&&e.children.length>0?t.children=e.children.map(e=>this.convertDepartmentToTreeOption(e)):delete t.children,t},buildDepartmentTree(e){const t={},r=[];return e.forEach(r=>{t[r.id]={value:r.id,label:r.department_name,level:r.level||this.calculateDepartmentLevel(r,e),children:[]}}),e.forEach(e=>{const a=t[e.id];if(e.parent_id&&0!==e.parent_id){const n=t[e.parent_id];n?n.children.push(a):r.push(a)}else r.push(a)}),r},calculateDepartmentLevel(e,t){if(!e.parent_id||0===e.parent_id)return 1;const r=t.find(t=>t.id===e.parent_id);return r?this.calculateDepartmentLevel(r,t)+1:1},loadMockDepartments(){const e=[{id:1,department_name:"总办",parent_id:0,level:1},{id:2,department_name:"技术部",parent_id:1,level:2},{id:3,department_name:"市场部",parent_id:1,level:2},{id:4,department_name:"人事部",parent_id:1,level:2},{id:5,department_name:"前端组",parent_id:2,level:3},{id:6,department_name:"后端组",parent_id:2,level:3},{id:7,department_name:"销售组",parent_id:3,level:3},{id:8,department_name:"推广组",parent_id:3,level:3}];this.departmentList=e,this.departmentOptions=e.map(e=>({value:e.id,label:e.department_name})),this.departmentTreeOptions=this.buildDepartmentTree(e)},buildDepartmentFullPath(e){if(!e)return"未分配部门";if(e.full_path)return e.full_path;if(e.parent){const t=this.buildDepartmentFullPath(e.parent)+" / "+(e.name||e.department_name);return t}if(e.id){const t=this.getDepartmentPathFromList(e.id);if(t)return t}const t=e.name||e.department_name||"未知部门";return t},getDepartmentPathFromList(e){if(!e||!this.departmentList.length)return"";const t=(e,r=new Set)=>{if(r.has(e))return[];r.add(e);const a=this.departmentList.find(t=>t.id===e);if(!a)return[];if(!a.parent_id||0===a.parent_id)return[a.department_name];const n=t(a.parent_id,r);return[...n,a.department_name]},r=t(e),a=r.join(" / ");return console.log(`构建部门路径 ID=${e}:`,a),a},findDepartmentIdByName(e){if(!e)return console.log("部门名称为空，返回空字符串"),"";console.log(`查找部门名称 "${e}" 对应的ID`),console.log("当前部门列表:",this.departmentList),console.log("当前部门选项:",this.departmentOptions);const t=this.departmentList.find(t=>t.department_name===e);if(t)return console.log(`从部门列表找到部门 "${e}" 对应的ID:`,t.id),t.id;const r=this.departmentOptions.find(t=>t.label===e);if(r)return console.log(`从部门选项找到部门 "${e}" 对应的ID:`,r.value),r.value;const a=this.departmentList.find(t=>t.department_name&&t.department_name.includes(e));return a?(console.log(`模糊匹配找到部门 "${e}" 对应的ID:`,a.id),a.id):(console.log(`未找到部门 "${e}" 对应的ID`),"")},async loadRoles(){try{const e=await this.$api.role.getList();0===e.data.code&&(this.roleOptions=e.data.data.map(e=>({value:e.id,label:e.role_name})))}catch(e){console.error("获取角色列表失败:",e)}},fetchDataMock(){0===this.departmentList.length&&this.loadMockDepartments();const e=[];for(let a=1;a<=23;a++){const t=a%8+1;e.push({id:a,username:"user"+a,name:"用户"+a,gender:a%2===0?"男":"女",department:this.getDepartmentLabel(t),departmentId:t,departmentFullPath:this.getDepartmentFullPathLabel(t),position:"职位"+a,email:`user${a}@example.com`,phone:"1381234"+this.padZero(a,4),role:[this.getRoleLabel(a%5+1)],createTime:"2023-06-15 10:30:00",status:a%3===0?0:1,accountStatus:a%3===0?0:1})}const t=(this.currentPage-1)*this.pageSize,r=t+this.pageSize;this.userList=e.slice(t,r),this.total=e.length},getDepartmentLabel(e){const t=this.departmentOptions.find(t=>t.value===String(e));return t?t.label:`未知部门(${e})`},getDepartmentFullPathLabel(e){if(!e)return"未分配部门";if(0===this.departmentTreeOptions.length)return this.getDepartmentLabel(e);const t=this.getDepartmentPathFromList(Number(e));return t||this.getDepartmentLabel(e)},getRoleLabel(e){const t=this.roleOptions.find(t=>t.value===String(e));return t?t.label:""},padZero(e,t){return(Array(t).join("0")+e).slice(-t)},handleDepartmentChange(e){console.log("部门选择变化:",e),this.searchForm.department=e},handleSearch(){this.currentPage=1,this.fetchData()},resetSearch(){this.searchForm={username:"",name:"",department:"",status:""},this.handleSearch()},async showAddUserDialog(){this.dialogTitle="添加用户",this.isEdit=!1,0===this.roleOptions.length&&await this.loadRoles(),this.userForm={id:null,username:"",name:"",gender:"",level:"",position:"",password:"",confirmPassword:"",department:"",role:[],email:"",phone:"",status:1,accountStatus:1},this.dialogVisible=!0,this.$nextTick(()=>{this.$refs.userForm&&this.$refs.userForm.clearValidate()})},async handleEdit(e){this.dialogTitle="编辑用户",this.isEdit=!0,0===this.departmentTreeOptions.length&&(console.log("部门选项未加载，重新加载..."),await this.loadDepartments()),0===this.roleOptions.length&&(console.log("角色选项未加载，重新加载..."),await this.loadRoles());let t=[];console.log("编辑用户行数据:",e),console.log("当前角色选项:",this.roleOptions),console.log("当前部门选项:",this.departmentTreeOptions);try{const r=await this.$api.user.getUserRoles(e.id);console.log("API返回的角色数据:",r.data),0===r.data.code&&(t=r.data.data.map(e=>"object"===typeof e?e.id:e),console.log("处理后的角色ID数组:",t))}catch(a){console.error("获取用户角色失败:",a),e.role&&Array.isArray(e.role)&&(console.log("从行数据获取角色名称:",e.role),t=e.role.map(e=>{const t=this.roleOptions.find(t=>t.label===e);return console.log(`角色名称 "${e}" 对应的选项:`,t),t?t.value:null}).filter(e=>null!==e),console.log("从行数据映射的角色ID:",t))}0===t.length&&(e.roleIds&&Array.isArray(e.roleIds)?(console.log("使用保存的roleIds:",e.roleIds),t=e.roleIds):e.role&&Array.isArray(e.role)&&(console.log("尝试重新映射角色数据..."),t=e.role.map(e=>{const t=this.roleOptions.find(t=>t.label===e);return t?t.value:null}).filter(e=>null!==e),console.log("重新映射后的角色ID:",t))),0===t.length&&e.role&&Array.isArray(e.role)&&(console.log("使用角色名称作为最终备用方案..."),t=e.role.slice(),console.log("最终备用角色数据:",t));let r="";e.departmentId?(r=e.departmentId,console.log("使用departmentId:",r)):e.department&&(r=this.findDepartmentIdByName(e.department),console.log(`通过部门名称 "${e.department}" 查找到的ID:`,r)),this.userForm={id:e.id,username:e.username,name:e.name,gender:e.gender,level:e.level||"",position:e.position||"",department:r,role:t,email:e.email||"",phone:e.phone||"",status:e.status,accountStatus:e.accountStatus,password:"",confirmPassword:""},console.log("最终设置的userForm:",this.userForm),console.log("特别是部门字段:",this.userForm.department),console.log("特别是角色字段:",this.userForm.role),this.dialogVisible=!0,this.$nextTick(()=>{this.$refs.userForm&&this.$refs.userForm.clearValidate()})},handleResetPassword(e){this.$confirm("确认重置该用户密码为123456吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{const t=await this.$api.user.resetPassword(e.id,{password:"123456"});0===t.data.code?this.$message.success("密码重置成功!"):this.$message.error(t.data.msg||"密码重置失败")}catch(t){console.error("重置密码失败:",t),this.$message.error("密码重置失败，请稍后重试")}}).catch(()=>{this.$message.info("已取消重置密码")})},handleDelete(e){this.$confirm("确认删除该用户吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{this.$message({type:"success",message:"删除成功!"}),this.fetchData()}).catch(()=>{this.$message({type:"info",message:"已取消删除"})})},toggleStatus(e){const t=1===e.accountStatus?0:1,r=1===t?"启用":"禁用";this.$confirm(`确认${r}该用户吗?`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{const a=await this.$api.user.toggleStatus(e.id);0===a.data.code?(e.accountStatus=t,this.$message.success(r+"成功!")):this.$message.error(a.data.msg||r+"失败")}catch(a){console.error("切换用户状态失败:",a),this.$message.error(r+"失败，请稍后重试")}}).catch(()=>{this.$message.info("已取消"+r)})},submitForm(){const e={...this.rules};this.isEdit&&(delete e.password,delete e.confirmPassword),this.$refs.userForm.validate(async e=>{if(e)try{const e={username:this.userForm.username,real_name:this.userForm.name,email:this.userForm.email,phone:this.userForm.phone,department_id:this.userForm.department,position:this.userForm.position,employee_no:this.userForm.username,status:this.userForm.accountStatus,role_ids:this.userForm.role};let t;console.log("提交的表单数据:",e),this.isEdit||(e.password=this.userForm.password),t=this.isEdit?await this.$api.user.update(this.userForm.id,e):await this.$api.user.create(e),0===t.data.code?(this.$message.success(this.isEdit?"用户更新成功":"用户创建成功"),this.dialogVisible=!1,this.fetchData()):this.$message.error(t.data.msg||"操作失败")}catch(t){console.error("提交用户信息失败:",t),this.$message.error("操作失败，请稍后重试")}})},handleSizeChange(e){this.pageSize=e,this.fetchData()},handleCurrentChange(e){this.currentPage=e,this.fetchData()}}}),o=s,i=(r("748b"),r("2877")),l=Object(i["a"])(o,a,n,!1,null,"363434aa",null);t["default"]=l.exports},"384f":function(e,t,r){"use strict";var a=r("e330"),n=r("5388"),s=r("cb27"),o=s.Set,i=s.proto,l=a(i.forEach),c=a(i.keys),u=c(new o).next;e.exports=function(e,t,r){return r?n({iterator:c(e),next:u},t):l(e,t)}},"395e":function(e,t,r){"use strict";var a=r("dc19"),n=r("cb27").has,s=r("8e16"),o=r("7f65"),i=r("5388"),l=r("2a62");e.exports=function(e){var t=a(this),r=o(e);if(s(t)<r.size)return!1;var c=r.getIterator();return!1!==i(c,(function(e){if(!n(t,e))return l(c,"normal",!1)}))}},"3bbe":function(e,t,r){"use strict";var a=r("1787"),n=String,s=TypeError;e.exports=function(e){if(a(e))return e;throw new s("Can't set "+n(e)+" as a prototype")}},"4f71":function(e,t,r){},5388:function(e,t,r){"use strict";var a=r("c65b");e.exports=function(e,t,r){var n,s,o=r?e:e.iterator,i=e.next;while(!(n=a(i,o)).done)if(s=t(n.value),void 0!==s)return s}},"68df":function(e,t,r){"use strict";var a=r("dc19"),n=r("8e16"),s=r("384f"),o=r("7f65");e.exports=function(e){var t=a(this),r=o(e);return!(n(t)>r.size)&&!1!==s(t,(function(e){if(!r.includes(e))return!1}),!0)}},"6f19":function(e,t,r){"use strict";var a=r("9112"),n=r("0d26"),s=r("b980"),o=Error.captureStackTrace;e.exports=function(e,t,r,i){s&&(o?o(e,t):a(e,"stack",n(r,i)))}},7156:function(e,t,r){"use strict";var a=r("1626"),n=r("861d"),s=r("d2bb");e.exports=function(e,t,r){var o,i;return s&&a(o=t.constructor)&&o!==r&&n(i=o.prototype)&&i!==r.prototype&&s(e,i),e}},7282:function(e,t,r){"use strict";var a=r("e330"),n=r("59ed");e.exports=function(e,t,r){try{return a(n(Object.getOwnPropertyDescriptor(e,t)[r]))}catch(s){}}},"72c3":function(e,t,r){"use strict";var a=r("23e7"),n=r("e9bc"),s=r("dad2");a({target:"Set",proto:!0,real:!0,forced:!s("union")},{union:n})},"748b":function(e,t,r){"use strict";r("4f71")},"79a4":function(e,t,r){"use strict";var a=r("23e7"),n=r("d039"),s=r("953b"),o=r("dad2"),i=!o("intersection",(function(e){return 2===e.size&&e.has(1)&&e.has(2)}))||n((function(){return"3,2"!==String(Array.from(new Set([1,2,3]).intersection(new Set([3,2]))))}));a({target:"Set",proto:!0,real:!0,forced:i},{intersection:s})},"7f65":function(e,t,r){"use strict";var a=r("59ed"),n=r("825a"),s=r("c65b"),o=r("5926"),i=r("46c4"),l="Invalid size",c=RangeError,u=TypeError,d=Math.max,m=function(e,t){this.set=e,this.size=d(t,0),this.has=a(e.has),this.keys=a(e.keys)};m.prototype={getIterator:function(){return i(n(s(this.keys,this.set)))},includes:function(e){return s(this.has,this.set,e)}},e.exports=function(e){n(e);var t=+e.size;if(t!==t)throw new u(l);var r=o(t);if(r<0)throw new c(l);return new m(e,r)}},"83b9e":function(e,t,r){"use strict";var a=r("cb27"),n=r("384f"),s=a.Set,o=a.add;e.exports=function(e){var t=new s;return n(e,(function(e){o(t,e)})),t}},"8b00":function(e,t,r){"use strict";var a=r("23e7"),n=r("68df"),s=r("dad2"),o=!s("isSubsetOf",(function(e){return e}));a({target:"Set",proto:!0,real:!0,forced:o},{isSubsetOf:n})},"8e16":function(e,t,r){"use strict";var a=r("7282"),n=r("cb27");e.exports=a(n.proto,"size","get")||function(e){return e.size}},"953b":function(e,t,r){"use strict";var a=r("dc19"),n=r("cb27"),s=r("8e16"),o=r("7f65"),i=r("384f"),l=r("5388"),c=n.Set,u=n.add,d=n.has;e.exports=function(e){var t=a(this),r=o(e),n=new c;return s(t)>r.size?l(r.getIterator(),(function(e){d(t,e)&&u(n,e)})):i(t,(function(e){r.includes(e)&&u(n,e)})),n}},9961:function(e,t,r){"use strict";var a=r("dc19"),n=r("cb27"),s=r("83b9e"),o=r("7f65"),i=r("5388"),l=n.add,c=n.has,u=n.remove;e.exports=function(e){var t=a(this),r=o(e).getIterator(),n=s(t);return i(r,(function(e){c(t,e)?u(n,e):l(n,e)})),n}},a4e7:function(e,t,r){"use strict";var a=r("23e7"),n=r("395e"),s=r("dad2"),o=!s("isSupersetOf",(function(e){return!e}));a({target:"Set",proto:!0,real:!0,forced:o},{isSupersetOf:n})},a5f7:function(e,t,r){"use strict";var a=r("dc19"),n=r("cb27"),s=r("83b9e"),o=r("8e16"),i=r("7f65"),l=r("384f"),c=r("5388"),u=n.has,d=n.remove;e.exports=function(e){var t=a(this),r=i(e),n=s(t);return o(t)<=r.size?l(t,(function(e){r.includes(e)&&d(n,e)})):c(r.getIterator(),(function(e){u(t,e)&&d(n,e)})),n}},ab36:function(e,t,r){"use strict";var a=r("861d"),n=r("9112");e.exports=function(e,t){a(t)&&"cause"in t&&n(e,"cause",t.cause)}},aeb0:function(e,t,r){"use strict";var a=r("9bf2").f;e.exports=function(e,t,r){r in e||a(e,r,{configurable:!0,get:function(){return t[r]},set:function(e){t[r]=e}})}},b4bc:function(e,t,r){"use strict";var a=r("dc19"),n=r("cb27").has,s=r("8e16"),o=r("7f65"),i=r("384f"),l=r("5388"),c=r("2a62");e.exports=function(e){var t=a(this),r=o(e);if(s(t)<=r.size)return!1!==i(t,(function(e){if(r.includes(e))return!1}),!0);var u=r.getIterator();return!1!==l(u,(function(e){if(n(t,e))return c(u,"normal",!1)}))}},b980:function(e,t,r){"use strict";var a=r("d039"),n=r("5c6c");e.exports=!a((function(){var e=new Error("a");return!("stack"in e)||(Object.defineProperty(e,"stack",n(1,7)),7!==e.stack)}))},c1a1:function(e,t,r){"use strict";var a=r("23e7"),n=r("b4bc"),s=r("dad2"),o=!s("isDisjointFrom",(function(e){return!e}));a({target:"Set",proto:!0,real:!0,forced:o},{isDisjointFrom:n})},cb27:function(e,t,r){"use strict";var a=r("e330"),n=Set.prototype;e.exports={Set:Set,add:a(n.add),has:a(n.has),remove:a(n["delete"]),proto:n}},d2bb:function(e,t,r){"use strict";var a=r("7282"),n=r("861d"),s=r("1d80"),o=r("3bbe");e.exports=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,r={};try{e=a(Object.prototype,"__proto__","set"),e(r,[]),t=r instanceof Array}catch(i){}return function(r,a){return s(r),o(a),n(r)?(t?e(r,a):r.__proto__=a,r):r}}():void 0)},d9e2:function(e,t,r){"use strict";var a=r("23e7"),n=r("cfe9"),s=r("2ba4"),o=r("e5cb"),i="WebAssembly",l=n[i],c=7!==new Error("e",{cause:7}).cause,u=function(e,t){var r={};r[e]=o(e,t,c),a({global:!0,constructor:!0,arity:1,forced:c},r)},d=function(e,t){if(l&&l[e]){var r={};r[e]=o(i+"."+e,t,c),a({target:i,stat:!0,constructor:!0,arity:1,forced:c},r)}};u("Error",(function(e){return function(t){return s(e,this,arguments)}})),u("EvalError",(function(e){return function(t){return s(e,this,arguments)}})),u("RangeError",(function(e){return function(t){return s(e,this,arguments)}})),u("ReferenceError",(function(e){return function(t){return s(e,this,arguments)}})),u("SyntaxError",(function(e){return function(t){return s(e,this,arguments)}})),u("TypeError",(function(e){return function(t){return s(e,this,arguments)}})),u("URIError",(function(e){return function(t){return s(e,this,arguments)}})),d("CompileError",(function(e){return function(t){return s(e,this,arguments)}})),d("LinkError",(function(e){return function(t){return s(e,this,arguments)}})),d("RuntimeError",(function(e){return function(t){return s(e,this,arguments)}}))},dad2:function(e,t,r){"use strict";var a=r("d066"),n=function(e){return{size:e,has:function(){return!1},keys:function(){return{next:function(){return{done:!0}}}}}},s=function(e){return{size:e,has:function(){return!0},keys:function(){throw new Error("e")}}};e.exports=function(e,t){var r=a("Set");try{(new r)[e](n(0));try{return(new r)[e](n(-1)),!1}catch(i){if(!t)return!0;try{return(new r)[e](s(-1/0)),!1}catch(l){var o=new r;return o.add(1),o.add(2),t(o[e](s(1/0)))}}}catch(l){return!1}}},dc19:function(e,t,r){"use strict";var a=r("cb27").has;e.exports=function(e){return a(e),e}},e391:function(e,t,r){"use strict";var a=r("577e");e.exports=function(e,t){return void 0===e?arguments.length<2?"":t:a(e)}},e5cb:function(e,t,r){"use strict";var a=r("d066"),n=r("1a2d"),s=r("9112"),o=r("3a9b"),i=r("d2bb"),l=r("e893"),c=r("aeb0"),u=r("7156"),d=r("e391"),m=r("ab36"),p=r("6f19"),h=r("83ab"),f=r("c430");e.exports=function(e,t,r,g){var b="stackTraceLimit",v=g?2:1,w=e.split("."),y=w[w.length-1],F=a.apply(null,w);if(F){var _=F.prototype;if(!f&&n(_,"cause")&&delete _.cause,!r)return F;var S=a("Error"),x=t((function(e,t){var r=d(g?t:e,void 0),a=g?new F(e):new F;return void 0!==r&&s(a,"message",r),p(a,x,a.stack,2),this&&o(_,this)&&u(a,this,x),arguments.length>v&&m(a,arguments[v]),a}));if(x.prototype=_,"Error"!==y?i?i(x,S):l(x,S,{name:!0}):h&&b in F&&(c(x,F,b),c(x,F,"prepareStackTrace")),l(x,F),!f)try{_.name!==y&&s(_,"name",y),_.constructor=x}catch(D){}return x}}},e9bc:function(e,t,r){"use strict";var a=r("dc19"),n=r("cb27").add,s=r("83b9e"),o=r("7f65"),i=r("5388");e.exports=function(e){var t=a(this),r=o(e).getIterator(),l=s(t);return i(r,(function(e){n(l,e)})),l}}}]);