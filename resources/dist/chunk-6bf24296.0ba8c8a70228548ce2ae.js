(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-6bf24296"],{"1f3d":function(t,s,a){"use strict";a("32a5")},"32a5":function(t,s,a){},9406:function(t,s,a){"use strict";a.r(s);var e=function(){var t=this,s=t._self._c;return s("div",{staticClass:"dashboard-container"},[s("el-row",{staticClass:"stats-row",attrs:{gutter:20}},t._l(t.statistics,(function(a){return s("el-col",{key:a.key,attrs:{xs:24,sm:12,md:6}},[s("div",{staticClass:"stat-card"},[s("div",{staticClass:"stat-icon",style:{backgroundColor:a.color}},[s("i",{class:a.icon})]),s("div",{staticClass:"stat-content"},[s("div",{staticClass:"stat-value"},[t._v(t._s(a.value))]),s("div",{staticClass:"stat-label"},[t._v(t._s(a.label))])])])])})),1),s("el-row",{staticClass:"content-row",attrs:{gutter:20}},[s("el-col",{attrs:{xs:24,sm:24,md:12}},[s("el-card",{staticClass:"dashboard-card"},[s("div",{staticClass:"card-header",attrs:{slot:"header"},slot:"header"},[s("span",{staticClass:"card-title"},[s("i",{staticClass:"el-icon-bell"}),t._v(" 我的待办 "),t.myTasks.length>0?s("el-badge",{staticClass:"task-badge",attrs:{value:t.myTasks.length}}):t._e()],1),s("el-button",{attrs:{type:"text"},on:{click:t.goToTaskCenter}},[t._v("查看全部")])],1),s("div",{staticClass:"task-list"},[0===t.myTasks.length?s("div",{staticClass:"empty-state"},[s("i",{staticClass:"el-icon-circle-check"}),s("p",[t._v("暂无待办任务")])]):s("div",t._l(t.myTasks.slice(0,5),(function(a){return s("div",{key:a.id,staticClass:"task-item",on:{click:function(s){return t.handleTask(a)}}},[s("div",{staticClass:"task-content"},[s("div",{staticClass:"task-title"},[t._v(t._s(a.business_title))]),s("div",{staticClass:"task-meta"},[s("el-tag",{attrs:{size:"mini",type:t.getBusinessTypeColor(a.business_type)}},[t._v(" "+t._s(a.business_type_text)+" ")]),s("span",{staticClass:"task-node"},[t._v(t._s(a.node_name))]),s("span",{staticClass:"task-time"},[t._v(t._s(a.created_at_human))])],1)]),s("div",{staticClass:"task-action"},[s("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(s){return s.stopPropagation(),t.processTask(a)}}},[t._v(" 处理 ")])],1)])})),0)])])],1),s("el-col",{attrs:{xs:24,sm:24,md:12}},[s("el-card",{staticClass:"dashboard-card"},[s("div",{staticClass:"card-header",attrs:{slot:"header"},slot:"header"},[s("span",{staticClass:"card-title"},[s("i",{staticClass:"el-icon-time"}),t._v(" 最新动态 ")])]),s("div",{staticClass:"activity-list"},[0===t.recentActivities.length?s("div",{staticClass:"empty-state"},[s("i",{staticClass:"el-icon-document"}),s("p",[t._v("暂无动态")])]):s("div",t._l(t.recentActivities.slice(0,8),(function(a){return s("div",{key:a.id,staticClass:"activity-item"},[s("div",{staticClass:"activity-icon"},[s("i",{staticClass:"el-icon-user"})]),s("div",{staticClass:"activity-content"},[s("div",{staticClass:"activity-title"},[t._v(t._s(a.title))]),s("div",{staticClass:"activity-description"},[t._v(" "+t._s(a.processor_name)+" "+t._s(a.description)+" ")]),s("div",{staticClass:"activity-time"},[t._v(t._s(a.processed_at_human))])])])})),0)])])],1)],1),s("el-row",{staticClass:"bottom-row",attrs:{gutter:20}},[s("el-col",{attrs:{xs:24,sm:24,md:12}},[s("el-card",{staticClass:"dashboard-card"},[s("div",{staticClass:"card-header",attrs:{slot:"header"},slot:"header"},[s("span",{staticClass:"card-title"},[s("i",{staticClass:"el-icon-s-operation"}),t._v(" 快速操作 ")])]),s("div",{staticClass:"quick-actions"},t._l(t.quickActions,(function(a){return s("div",{key:a.name,staticClass:"action-item",on:{click:function(s){return t.handleQuickAction(a)}}},[s("div",{staticClass:"action-icon"},[s("i",{class:a.icon})]),s("div",{staticClass:"action-name"},[t._v(t._s(a.name))])])})),0)])],1),s("el-col",{attrs:{xs:24,sm:24,md:12}},[s("el-card",{staticClass:"dashboard-card"},[s("div",{staticClass:"card-header",attrs:{slot:"header"},slot:"header"},[s("span",{staticClass:"card-title"},[s("i",{staticClass:"el-icon-message"}),t._v(" 系统通知 ")])]),s("div",{staticClass:"notification-list"},[0===t.notifications.length?s("div",{staticClass:"empty-state"},[s("i",{staticClass:"el-icon-bell"}),s("p",[t._v("暂无通知")])]):s("div",t._l(t.notifications.slice(0,3),(function(a){return s("div",{key:a.id,staticClass:"notification-item"},[s("div",{staticClass:"notification-icon",class:a.type},[s("i",{staticClass:"el-icon-info"})]),s("div",{staticClass:"notification-content"},[s("div",{staticClass:"notification-title"},[t._v(t._s(a.title))]),s("div",{staticClass:"notification-text"},[t._v(t._s(a.content))]),s("div",{staticClass:"notification-time"},[t._v(t._s(a.created_at))])])])})),0)])])],1)],1),s("el-dialog",{attrs:{title:"处理任务",visible:t.taskDialogVisible,width:"600px"},on:{"update:visible":function(s){t.taskDialogVisible=s},close:t.resetTaskDialog}},[t.currentTask?s("div",[s("div",{staticClass:"task-info"},[s("h4",[t._v(t._s(t.currentTask.business_title))]),s("p",[t._v("当前节点："+t._s(t.currentTask.node_name))]),s("p",[t._v("创建时间："+t._s(t.currentTask.created_at))])]),s("el-form",{attrs:{model:t.taskForm,"label-width":"80px"}},[s("el-form-item",{attrs:{label:"处理结果",required:""}},[s("el-radio-group",{model:{value:t.taskForm.action,callback:function(s){t.$set(t.taskForm,"action",s)},expression:"taskForm.action"}},[s("el-radio",{attrs:{label:"approve"}},[t._v("通过")]),s("el-radio",{attrs:{label:"reject"}},[t._v("驳回")]),s("el-radio",{attrs:{label:"back"}},[t._v("退回")])],1)],1),"back"===t.taskForm.action?s("el-form-item",{attrs:{label:"退回到",required:""}},[s("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择退回节点"},on:{focus:t.loadBackableNodes},model:{value:t.taskForm.backToNodeIndex,callback:function(s){t.$set(t.taskForm,"backToNodeIndex",s)},expression:"taskForm.backToNodeIndex"}},t._l(t.backableNodes,(function(a){return s("el-option",{key:a.index,attrs:{label:`${a.name} (${a.processor||"未知"})`,value:a.index}},[s("span",{staticStyle:{float:"left"}},[t._v(t._s(a.name))]),s("span",{staticStyle:{float:"right",color:"#8492a6","font-size":"13px"}},[t._v(" "+t._s(a.processor||"未知")+" ")])])})),1)],1):t._e(),s("el-form-item",{attrs:{label:"处理意见"}},[s("el-input",{attrs:{type:"textarea",rows:4,placeholder:"back"===t.taskForm.action?"请输入退回原因":"请输入处理意见"},model:{value:t.taskForm.comment,callback:function(s){t.$set(t.taskForm,"comment",s)},expression:"taskForm.comment"}})],1)],1)],1):t._e(),s("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:function(s){t.taskDialogVisible=!1}}},[t._v("取消")]),s("el-button",{attrs:{type:"primary",loading:t.taskProcessing},on:{click:t.submitTaskProcess}},[t._v(" 确定 ")])],1)])],1)},i=[],c=(a("14d9"),{name:"Dashboard",data(){return{loading:!1,statistics:[{key:"contracts",label:"合同总数",value:156,icon:"el-icon-document",color:"#409EFF"},{key:"monthContracts",label:"本月新增",value:23,icon:"el-icon-plus",color:"#67C23A"},{key:"pendingApproval",label:"待审批",value:8,icon:"el-icon-time",color:"#E6A23C"},{key:"myTasks",label:"我的待办",value:5,icon:"el-icon-bell",color:"#F56C6C"}],myTasks:[{id:1,business_title:"张三的专利申请合同",business_type:"contract",business_type_text:"合同",node_name:"主管审查",created_at:"2024-09-05 10:30:00",created_at_human:"2小时前"},{id:2,business_title:"李四的商标注册合同",business_type:"contract",business_type_text:"合同",node_name:"流程审查",created_at:"2024-09-05 08:15:00",created_at_human:"4小时前"},{id:3,business_title:"王五的版权登记合同",business_type:"contract",business_type_text:"合同",node_name:"客服核实",created_at:"2024-09-04 16:20:00",created_at_human:"1天前"}],recentActivities:[{id:1,title:"赵六的发明专利合同",description:"主管审查 - 通过",processor_name:"张经理",processed_at:"2024-09-05 11:45:00",processed_at_human:"30分钟前",business_type:"contract",business_type_text:"合同"},{id:2,title:"钱七的商标续展合同",description:"流程审查 - 通过",processor_name:"李主管",processed_at:"2024-09-05 10:20:00",processed_at_human:"2小时前",business_type:"contract",business_type_text:"合同"},{id:3,title:"孙八的专利检索合同",description:"客服核实 - 通过",processor_name:"王客服",processed_at:"2024-09-05 09:10:00",processed_at_human:"3小时前",business_type:"contract",business_type_text:"合同"}],notifications:[{id:1,type:"system",title:"系统维护通知",content:"系统将于今晚22:00进行维护，预计维护时间1小时",created_at:"2024-09-05 10:00:00"},{id:2,type:"feature",title:"新功能上线",content:"工作流管理功能已上线，支持合同审批流程",created_at:"2024-09-04 14:30:00"}],quickActions:[{name:"新建合同",icon:"el-icon-document-add",route:"/contracts/create"},{name:"我的待办",icon:"el-icon-bell",route:"/dashboard/tasks"},{name:"合同列表",icon:"el-icon-document",route:"/contracts"},{name:"工作流配置",icon:"el-icon-setting",route:"/config/system/workflow"}],taskDialogVisible:!1,currentTask:null,taskForm:{action:"approve",comment:"",backToNodeIndex:null},taskProcessing:!1,backableNodes:[]}},created(){},methods:{getBusinessTypeColor(t){const s={contract:"primary",case:"success",payment:"warning"};return s[t]||"info"},handleTask(t){console.log("查看任务详情:",t),this.$message.info("任务详情功能开发中...")},processTask(t){this.currentTask=t,this.taskDialogVisible=!0,this.backableNodes=[]},async loadBackableNodes(){if(this.currentTask&&this.currentTask.instance_id)try{const t=await this.$api.workflow.getBackableNodes(this.currentTask.instance_id);t.data&&0===t.data.code&&(this.backableNodes=t.data.data)}catch(t){console.error("获取可退回节点失败:",t),this.$message.error("获取可退回节点失败")}},async submitTaskProcess(){if(this.currentTask)if("back"!==this.taskForm.action||null!==this.taskForm.backToNodeIndex){this.taskProcessing=!0;try{const s={action:this.taskForm.action,comment:this.taskForm.comment};"back"===this.taskForm.action&&(s.back_to_node_index=this.taskForm.backToNodeIndex);const a=await this.$api.workflow.processTask(this.currentTask.id,s);if(a.data&&0===a.data.code){this.$message.success("处理成功"),this.taskDialogVisible=!1;const t=this.myTasks.findIndex(t=>t.id===this.currentTask.id);t>-1&&(this.myTasks.splice(t,1),this.statistics[3].value=this.myTasks.length)}else{var t;this.$message.error((null===(t=a.data)||void 0===t?void 0:t.msg)||"处理失败")}}catch(a){var s;console.error("任务处理失败:",a),this.$message.error("处理失败："+((null===(s=a.response)||void 0===s||null===(s=s.data)||void 0===s?void 0:s.msg)||a.message))}finally{this.taskProcessing=!1}}else this.$message.warning("请选择退回节点")},resetTaskDialog(){this.currentTask=null,this.taskForm={action:"approve",comment:"",backToNodeIndex:null},this.backableNodes=[]},goToTaskCenter(){this.$router.push("/dashboard/tasks")},handleQuickAction(t){t.route&&this.$router.push(t.route)}}}),o=c,n=(a("1f3d"),a("2877")),l=Object(n["a"])(o,e,i,!1,null,"44fec956",null);s["default"]=l.exports}}]);