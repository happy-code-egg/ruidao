(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-6e544c32"],{"4e3e":function(e,t,a){},8595:function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e._self._c;return t("div",{staticClass:"contacts-container"},[t("div",{staticClass:"body-part-search"},[t("div",{staticClass:"filter-form"},[t("el-form",{ref:"queryForm",attrs:{model:e.filters,"label-width":"100px"}},[t("div",[t("el-row",[t("el-col",{attrs:{span:6}},[t("el-form-item",{attrs:{label:"客户名称",prop:"customerName"}},[t("el-input",{attrs:{placeholder:"客户名称",clearable:"",size:"small"},model:{value:e.filters.customerName,callback:function(t){e.$set(e.filters,"customerName",t)},expression:"filters.customerName"}})],1)],1),t("el-col",{attrs:{span:6}},[t("el-form-item",{attrs:{label:"姓名",prop:"name"}},[t("el-input",{attrs:{placeholder:"姓名",clearable:"",size:"small"},model:{value:e.filters.name,callback:function(t){e.$set(e.filters,"name",t)},expression:"filters.name"}})],1)],1),t("el-col",{attrs:{span:6}},[t("el-form-item",{attrs:{label:"联系人类型",prop:"contactType"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"联系人类型",clearable:"",size:"small"},model:{value:e.filters.contactType,callback:function(t){e.$set(e.filters,"contactType",t)},expression:"filters.contactType"}},[t("el-option",{attrs:{label:"IPR",value:"IPR"}}),t("el-option",{attrs:{label:"流程人员",value:"流程人员"}}),t("el-option",{attrs:{label:"技术人员",value:"技术人员"}}),t("el-option",{attrs:{label:"财务人员",value:"财务人员"}}),t("el-option",{attrs:{label:"公司负责人",value:"公司负责人"}}),t("el-option",{attrs:{label:"发明人",value:"发明人"}}),t("el-option",{attrs:{label:"文件转送人",value:"文件转送人"}}),t("el-option",{attrs:{label:"商标联系人",value:"商标联系人"}}),t("el-option",{attrs:{label:"其它",value:"其它"}}),t("el-option",{attrs:{label:"技术主导",value:"技术主导"}}),t("el-option",{attrs:{label:"经办人",value:"经办人"}})],1)],1)],1),t("el-col",{attrs:{span:6}},[t("el-form-item",{attrs:{label:"手机号",prop:"phone"}},[t("el-input",{attrs:{placeholder:"手机号",clearable:"",size:"small"},model:{value:e.filters.phone,callback:function(t){e.$set(e.filters,"phone",t)},expression:"filters.phone"}})],1)],1),t("el-col",{attrs:{span:6}},[t("el-form-item",{attrs:{label:"是否在职",prop:"isOnJob"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"是否在职",clearable:"",size:"small"},model:{value:e.filters.isOnJob,callback:function(t){e.$set(e.filters,"isOnJob",t)},expression:"filters.isOnJob"}},[t("el-option",{attrs:{label:"是",value:!0}}),t("el-option",{attrs:{label:"否",value:!1}})],1)],1)],1),t("el-col",{attrs:{span:6}},[t("el-form-item",{attrs:{label:"联系人部门",prop:"department"}},[t("el-input",{attrs:{placeholder:"联系人部门",clearable:"",size:"small"},model:{value:e.filters.department,callback:function(t){e.$set(e.filters,"department",t)},expression:"filters.department"}})],1)],1),t("el-col",{attrs:{span:6}},[t("el-form-item",{attrs:{label:"联系人业务员",prop:"businessStaff"}},[t("el-input",{attrs:{placeholder:"请输入业务人员姓名",clearable:"",size:"small"},model:{value:e.filters.businessStaff,callback:function(t){e.$set(e.filters,"businessStaff",t)},expression:"filters.businessStaff"}})],1)],1)],1)],1)]),t("div",{staticClass:"part-search-buttons"},[t("el-button",{attrs:{size:"small",type:"primary",icon:"el-icon-search"},on:{click:e.search}},[e._v("查询")]),t("el-button",{attrs:{size:"small",icon:"el-icon-refresh"},on:{click:e.resetFilters}},[e._v("重置")])],1)],1)]),t("div",{staticClass:"body-part-content table-container"},[e._m(0),t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{data:e.tableData,border:"",size:"small"},on:{"selection-change":e.handleSelectionChange}},[t("el-table-column",{attrs:{type:"selection",width:"55"}}),t("el-table-column",{attrs:{type:"index",label:"序号",width:"50",align:"center"}}),e.visibleColumns.name?t("el-table-column",{attrs:{prop:"name",label:"姓名",sortable:"",align:"center"}}):e._e(),e.visibleColumns.customerName?t("el-table-column",{attrs:{prop:"customerName",label:"所属客户",sortable:"",align:"center"}}):e._e(),e.visibleColumns.contactType?t("el-table-column",{attrs:{prop:"contactType",label:"联系人类型",width:"120",align:"center"}}):e._e(),e.visibleColumns.phone?t("el-table-column",{attrs:{prop:"phone",label:"手机号",width:"120",align:"center"}}):e._e(),e.visibleColumns.gender?t("el-table-column",{attrs:{prop:"gender",label:"性别",width:"80"}}):e._e(),e.visibleColumns.isOnJob?t("el-table-column",{attrs:{label:"是否在职",width:"80",align:"center"},scopedSlots:e._u([{key:"default",fn:function(a){return[a.row.isOnJob?t("el-tag",{attrs:{type:"success"}},[e._v("是")]):t("el-tag",{attrs:{type:"info"}},[e._v("否")])]}}],null,!1,723500836)}):e._e(),e.visibleColumns.position?t("el-table-column",{attrs:{prop:"position",label:"职位",width:"120",align:"center"}}):e._e(),e.visibleColumns.department?t("el-table-column",{attrs:{prop:"department",label:"部门",width:"120",align:"center"}}):e._e(),e.visibleColumns.email?t("el-table-column",{attrs:{prop:"email",label:"邮箱",width:"180",align:"center"}}):e._e(),e.visibleColumns.businessStaffName?t("el-table-column",{attrs:{prop:"businessStaffName",label:"业务人员",width:"100",align:"center"}}):e._e(),t("el-table-column",{attrs:{align:"center",fixed:"right",label:"操作",width:"200"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-button",{attrs:{type:"text",size:"small",icon:"el-icon-view"},on:{click:function(t){return e.handleView(a.row)}}},[e._v("查看")])]}}])})],1),t("el-pagination",{attrs:{"current-page":e.pagination.currentPage,"page-sizes":[10,20,50,100],"page-size":e.pagination.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:e.pagination.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1),t("el-dialog",{attrs:{title:"create"===e.dialogStatus?"添加联系人":"edit"===e.dialogStatus?"编辑联系人":"查看联系人",visible:e.dialogVisible,width:"650px","append-to-body":"","destroy-on-close":""},on:{"update:visible":function(t){e.dialogVisible=t}}},[t("el-form",{ref:"contactForm",attrs:{model:e.contactForm,rules:e.contactRules,"label-width":"100px",disabled:"view"===e.dialogStatus}},[t("el-row",[t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"所属客户",prop:"customerId"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择客户"},model:{value:e.contactForm.customerId,callback:function(t){e.$set(e.contactForm,"customerId",t)},expression:"contactForm.customerId"}},e._l(e.customerOptions,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"联系人类型",prop:"contactType"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择类型"},model:{value:e.contactForm.contactType,callback:function(t){e.$set(e.contactForm,"contactType",t)},expression:"contactForm.contactType"}},[t("el-option",{attrs:{label:"决策人",value:"决策人"}}),t("el-option",{attrs:{label:"使用人",value:"使用人"}}),t("el-option",{attrs:{label:"采购",value:"采购"}}),t("el-option",{attrs:{label:"财务",value:"财务"}})],1)],1)],1)],1),t("el-row",[t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"姓名",prop:"name"}},[t("el-input",{model:{value:e.contactForm.name,callback:function(t){e.$set(e.contactForm,"name",t)},expression:"contactForm.name"}})],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"性别",prop:"gender"}},[t("el-select",{attrs:{placeholder:"请选择"},model:{value:e.contactForm.gender,callback:function(t){e.$set(e.contactForm,"gender",t)},expression:"contactForm.gender"}},[t("el-option",{attrs:{label:"男",value:"男"}}),t("el-option",{attrs:{label:"女",value:"女"}})],1)],1)],1)],1),t("el-row",[t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"手机号",prop:"phone"}},[t("el-input",{model:{value:e.contactForm.phone,callback:function(t){e.$set(e.contactForm,"phone",t)},expression:"contactForm.phone"}})],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"座机",prop:"landline"}},[t("el-input",{model:{value:e.contactForm.landline,callback:function(t){e.$set(e.contactForm,"landline",t)},expression:"contactForm.landline"}})],1)],1)],1),t("el-row",[t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"是否在职",prop:"isOnJob"}},[t("el-select",{attrs:{placeholder:"请选择"},model:{value:e.contactForm.isOnJob,callback:function(t){e.$set(e.contactForm,"isOnJob",t)},expression:"contactForm.isOnJob"}},[t("el-option",{attrs:{label:"是",value:!0}}),t("el-option",{attrs:{label:"否",value:!1}})],1)],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"职位",prop:"position"}},[t("el-input",{model:{value:e.contactForm.position,callback:function(t){e.$set(e.contactForm,"position",t)},expression:"contactForm.position"}})],1)],1)],1),t("el-row",[t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"部门",prop:"department"}},[t("el-input",{model:{value:e.contactForm.department,callback:function(t){e.$set(e.contactForm,"department",t)},expression:"contactForm.department"}})],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"称呼",prop:"title"}},[t("el-input",{model:{value:e.contactForm.title,callback:function(t){e.$set(e.contactForm,"title",t)},expression:"contactForm.title"}})],1)],1)],1),t("el-row",[t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"邮箱",prop:"email"}},[t("el-input",{model:{value:e.contactForm.email,callback:function(t){e.$set(e.contactForm,"email",t)},expression:"contactForm.email"}})],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"业务人员",prop:"businessStaff"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择业务人员",clearable:""},model:{value:e.contactForm.businessStaffId,callback:function(t){e.$set(e.contactForm,"businessStaffId",t)},expression:"contactForm.businessStaffId"}},e._l(e.userOptions,(function(e){return t("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1)],1)],1),t("el-row",[t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:"工作地址",prop:"workAddress"}},[t("el-input",{model:{value:e.contactForm.workAddress,callback:function(t){e.$set(e.contactForm,"workAddress",t)},expression:"contactForm.workAddress"}})],1)],1)],1),t("el-row",[t("el-col",{attrs:{span:24}},[t("el-form-item",{attrs:{label:"备注",prop:"remark"}},[t("el-input",{attrs:{type:"textarea",rows:"3",placeholder:"请输入备注"},model:{value:e.contactForm.remark,callback:function(t){e.$set(e.contactForm,"remark",t)},expression:"contactForm.remark"}})],1)],1)],1),t("el-row",[t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"创建人",prop:"createUser"}},[t("el-input",{attrs:{disabled:""},model:{value:e.contactForm.createUserName,callback:function(t){e.$set(e.contactForm,"createUserName",t)},expression:"contactForm.createUserName"}})],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"创建时间",prop:"createTime"}},[t("el-input",{attrs:{disabled:""},model:{value:e.contactForm.createdAt,callback:function(t){e.$set(e.contactForm,"createdAt",t)},expression:"contactForm.createdAt"}})],1)],1)],1),t("el-row",[t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"修改人",prop:"updateUser"}},[t("el-input",{attrs:{disabled:""},model:{value:e.contactForm.updateUserName,callback:function(t){e.$set(e.contactForm,"updateUserName",t)},expression:"contactForm.updateUserName"}})],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"修改时间",prop:"updateTime"}},[t("el-input",{attrs:{disabled:""},model:{value:e.contactForm.updatedAt,callback:function(t){e.$set(e.contactForm,"updatedAt",t)},expression:"contactForm.updatedAt"}})],1)],1)],1)],1),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.dialogVisible=!1}}},[e._v("取 消")]),"view"!==e.dialogStatus?t("el-button",{attrs:{type:"primary"},on:{click:e.saveContact}},[e._v("确 定")]):e._e()],1)],1)],1)},o=[function(){var e=this,t=e._self._c;return t("div",{staticClass:"part-table-header table-header"},[t("div",{staticClass:"part-table-title table-title"},[t("span",[e._v("联系人列表")])])])}],i=(a("14d9"),a("e9f5"),a("7d54"),a("ab43"),a("f6b0")),r={name:"ContactsManagement",data(){return{activeTab:"contacts",filters:{name:"",phone:"",customerName:"",contactType:"",isOnJob:"",department:"",businessStaff:""},listQuery:{page:1,limit:20,name:"",phone:"",customer_name:"",contact_type:"",is_on_job:"",department:"",business_staff:""},availableColumns:[{prop:"name",label:"姓名"},{prop:"customerName",label:"所属客户"},{prop:"contactType",label:"联系人类型"},{prop:"phone",label:"手机号"},{prop:"gender",label:"性别"},{prop:"isOnJob",label:"是否在职"},{prop:"position",label:"职位"},{prop:"department",label:"部门"},{prop:"email",label:"邮箱"},{prop:"businessStaffName",label:"业务人员"}],defaultSelectedColumns:["name","customerName","contactType","phone","gender","isOnJob","position","department","email","businessStaffName"],visibleColumns:{name:!0,customerName:!0,contactType:!0,phone:!0,gender:!0,isOnJob:!0,position:!0,department:!0,email:!0,businessStaffName:!0},tableData:[],loading:!1,multipleSelection:[],pagination:{currentPage:1,pageSize:20,total:0},jumpPage:"",dialogVisible:!1,dialogStatus:"create",contactForm:{id:null,customerId:"",customerName:"",name:"",contactType:"",phone:"",landline:"",gender:"",isOnJob:!0,position:"",department:"",title:"",email:"",businessStaffId:"",businessStaffName:"",workAddress:"",remark:"",createUserId:"",createUserName:"",createdAt:"",updateUserId:"",updateUserName:"",updatedAt:""},contactRules:{customerId:[{required:!0,message:"请选择所属客户",trigger:"change"}],name:[{required:!0,message:"请输入联系人姓名",trigger:"blur"}],contactType:[{required:!0,message:"请选择联系人类型",trigger:"change"}],phone:[{required:!0,message:"请输入手机号",trigger:"blur"},{pattern:/^1[3-9]\d{9}$/,message:"请输入正确的手机号",trigger:"blur"}],email:[{type:"email",message:"请输入正确的邮箱地址",trigger:"blur"}]},customerOptions:[],userOptions:[]}},created(){this.getContactsList(),this.getCustomerOptions(),this.getUserOptions(),this.$root.$on("contact-data-changed",()=>{this.getContactsList()})},beforeDestroy(){this.$root.$off("contact-data-changed")},methods:{updateVisibleColumns(e){const t={};this.availableColumns.forEach(a=>{t[a.prop]=e.includes(a.prop)}),this.visibleColumns=t},async getContactsList(){try{this.loading=!0;const e={page:this.pagination.currentPage,per_page:this.pagination.pageSize,...this.listQuery},t=await i["a"].getContactList(e);if(t.data&&t.data.success){const e=t.data.data;this.tableData=e.list||e||[],this.pagination.total=e.total||0,this.pagination.currentPage=parseInt(e.current_page)||this.pagination.currentPage,this.pagination.pageSize=parseInt(e.per_page)||this.pagination.pageSize}else this.$message.error("获取联系人列表失败"),this.tableData=[]}catch(e){console.error("获取联系人列表失败：",e),this.$message.error("获取联系人列表失败："+(e.message||"未知错误")),this.tableData=[]}finally{this.loading=!1}},async getCustomerOptions(){try{const e=await i["a"].getCustomerOptions();e.data&&e.data.success?this.customerOptions=e.data.data||[]:(this.$message.error("获取客户选项失败"),this.customerOptions=[])}catch(e){console.error("获取客户选项失败：",e),this.$message.error("获取客户选项失败："+(e.message||"未知错误")),this.customerOptions=[]}},async getUserOptions(){try{const e=await i["a"].getUserOptions();e.data&&e.data.success?this.userOptions=(e.data.data||[]).map(e=>({id:e.userId,name:e.userName})):(this.$message.error("获取用户选项失败"),this.userOptions=[])}catch(e){console.error("获取用户选项失败：",e),this.$message.error("获取用户选项失败："+(e.message||"未知错误")),this.userOptions=[]}},handleTabClick(e){"customers"===e.name&&this.$router.push("/customer")},search(){this.pagination.currentPage=1,this.listQuery={page:1,limit:this.pagination.pageSize,name:this.filters.name,phone:this.filters.phone,customer_name:this.filters.customerName,contact_type:this.filters.contactType,is_on_job:""!==this.filters.isOnJob?this.filters.isOnJob:void 0,department:this.filters.department,business_staff:this.filters.businessStaff},this.getContactsList()},resetFilters(){this.filters={name:"",phone:"",customerName:"",contactType:"",isOnJob:"",department:"",businessStaff:""},this.listQuery={page:1,limit:this.pagination.pageSize,name:"",phone:"",customer_name:"",contact_type:"",is_on_job:"",department:"",business_staff:""},this.pagination.currentPage=1,this.getContactsList()},openAddDialog(){this.dialogStatus="create",this.contactForm={id:null,customerId:"",customerName:"",name:"",contactType:"",phone:"",landline:"",gender:"",isOnJob:!0,position:"",department:"",title:"",email:"",businessStaffId:"",businessStaffName:"",workAddress:"",remark:"",createUserId:"",createUserName:"",createdAt:"",updateUserId:"",updateUserName:"",updatedAt:""},this.dialogVisible=!0,this.$nextTick(()=>{this.$refs.contactForm&&(this.$refs.contactForm.clearValidate(),this.$refs.contactForm.resetFields())})},async handleView(e){try{this.dialogStatus="view";const t=await i["a"].getContact(e.id);if(t&&t.data&&t.data.success){const e=t.data.data;this.contactForm={id:e.id,customerId:e.customer_id,customerName:e.customerName||e.customer_name,name:e.contact_name||e.name,contactType:e.contact_type_text||e.contactType,phone:e.phone,landline:e.telephone||e.landline,gender:e.gender,isOnJob:void 0!==e.is_on_job?e.is_on_job:e.isOnJob,position:e.position,department:e.department,title:e.title,email:e.email||e.work_email,businessStaffId:e.business_staff_id||e.businessStaffId,businessStaffName:e.business_staff_name||e.businessStaffName,workAddress:e.work_address||e.workAddress,remark:e.remarks||e.remark,createUserId:e.created_by,createUserName:e.create_user_name||e.createUserName,createdAt:this.formatDateTime(e.created_at),updateUserId:e.updated_by,updateUserName:e.update_user_name||e.updateUserName,updatedAt:this.formatDateTime(e.updated_at)}}else this.contactForm={id:e.id,customerId:e.customer_id||e.customerId,customerName:e.customerName,name:e.name,contactType:e.contactType,phone:e.phone,landline:e.landline,gender:e.gender,isOnJob:e.isOnJob,position:e.position,department:e.department,title:e.title,email:e.email,businessStaffId:e.businessStaffId,businessStaffName:e.businessStaffName,workAddress:e.workAddress,remark:e.remark,createUser:e.createUser,createTime:e.createTime,updateUser:e.updateUser,updateTime:e.updateTime};this.dialogVisible=!0}catch(t){console.error("获取联系人详情失败：",t),this.contactForm=JSON.parse(JSON.stringify(e)),this.dialogVisible=!0}},async handleEdit(e){try{this.dialogStatus="edit";const t=await i["a"].getContact(e.id);if(t&&t.data&&t.data.success){const e=t.data.data;this.contactForm={id:e.id,customerId:e.customer_id,customerName:e.customerName||e.customer_name,name:e.contact_name||e.name,contactType:e.contact_type_text||e.contactType,phone:e.phone,landline:e.telephone||e.landline,gender:e.gender,isOnJob:void 0!==e.is_on_job?e.is_on_job:e.isOnJob,position:e.position,department:e.department,title:e.title,email:e.email,businessStaffId:e.business_staff_id||e.businessStaffId,businessStaffName:e.business_staff_name||e.businessStaffName,workAddress:e.work_address||e.workAddress,remark:e.remarks||e.remark,createUser:e.created_by||e.createUser,createTime:this.formatDateTime(e.created_at||e.createTime),updateUser:e.updated_by||e.updateUser,updateTime:this.formatDateTime(e.updated_at||e.updateTime)}}else this.contactForm={id:e.id,customerId:e.customer_id||e.customerId,customerName:e.customerName,name:e.name,contactType:e.contactType,phone:e.phone,landline:e.landline,gender:e.gender,isOnJob:e.isOnJob,position:e.position,department:e.department,title:e.title,email:e.email,businessStaffId:e.businessStaffId,businessStaffName:e.businessStaffName,workAddress:e.workAddress,remark:e.remark,createUser:e.createUser,createTime:e.createTime,updateUser:e.updateUser,updateTime:e.updateTime};this.dialogVisible=!0,this.$nextTick(()=>{this.$refs.contactForm&&this.$refs.contactForm.clearValidate()})}catch(t){console.error("获取联系人详情失败：",t),this.contactForm=JSON.parse(JSON.stringify(e)),this.dialogVisible=!0,this.$nextTick(()=>{this.$refs.contactForm&&this.$refs.contactForm.clearValidate()})}},async saveContact(){try{await this.$refs.contactForm.validate(),this.loading=!0;const e={customer_id:this.contactForm.customerId,contact_name:this.contactForm.name,contact_type_text:this.contactForm.contactType,phone:this.contactForm.phone,telephone:this.contactForm.landline,gender:this.contactForm.gender||null,is_on_job:this.contactForm.isOnJob,position:this.contactForm.position,department:this.contactForm.department,title:this.contactForm.title,email:this.contactForm.email,business_staff_id:this.contactForm.businessStaffId,work_address:this.contactForm.workAddress,remarks:this.contactForm.remark};let t;"create"===this.dialogStatus?t=await i["a"].createContact(e):"edit"===this.dialogStatus&&(t=await i["a"].updateContact(this.contactForm.id,e)),t&&t.data&&t.data.success?(this.$message.success("create"===this.dialogStatus?"添加成功":"修改成功"),this.dialogVisible=!1,this.getContactsList(),this.$root.$emit&&this.$root.$emit("contact-data-changed")):this.$message.error(t.data?t.data.message:"操作失败")}catch(e){if(e.response&&422===e.response.status){const t=e.response.data.errors||{},a=Object.values(t).flat();this.$message.error("数据验证失败："+a.join("; "))}else console.error("保存联系人失败：",e),this.$message.error("保存失败："+(e.message||"未知错误"))}finally{this.loading=!1}},async handleDelete(e){try{await this.$confirm("确认删除该联系人?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),this.loading=!0;const t=await i["a"].deleteContact(e.id);t&&t.data&&t.data.success?(this.$message.success("删除成功"),this.getContactsList(),this.$root.$emit&&this.$root.$emit("contact-data-changed")):this.$message.error(t.data?t.data.message:"删除失败")}catch(t){if("cancel"===t)return;console.error("删除联系人失败：",t),this.$message.error("删除失败："+(t.message||"未知错误"))}finally{this.loading=!1}},async handleBatchDelete(){if(0!==this.multipleSelection.length)try{const t=this.multipleSelection.map(e=>e.id);await this.$confirm(`确认删除选中的 ${t.length} 个联系人?`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});let a=0,s=0;for(const o of t)try{const e=await i["a"].deleteContact(o);e&&e.data&&e.data.success?a++:s++}catch(e){s++,console.error("删除联系人失败：",e)}a>0?(this.$message.success(`成功删除 ${a} 个联系人${s>0?`，失败 ${s} 个`:""}`),this.getContactsList(),this.$root.$emit&&this.$root.$emit("contact-data-changed")):this.$message.error("删除失败")}catch(e){if("cancel"===e)return;console.error("批量删除失败：",e),this.$message.error("批量删除失败")}else this.$message.warning("请选择要删除的联系人")},handleSelectionChange(e){this.multipleSelection=e},handleSizeChange(e){this.pagination.pageSize=e,this.pagination.currentPage=1,this.listQuery.page=1,this.listQuery.limit=e,this.getContactsList()},handleCurrentChange(e){this.pagination.currentPage=e,this.listQuery.page=e,this.getContactsList()},handleJumpPage(){if(this.jumpPage&&/^\d+$/.test(this.jumpPage)){const e=parseInt(this.jumpPage);e>0&&e<=Math.ceil(this.pagination.total/this.pagination.pageSize)?(this.pagination.currentPage=e,this.search()):this.$message.warning("请输入有效的页码")}else this.$message.warning("请输入有效的页码")},formatDateTime(e){if(!e)return"";try{const t=new Date(e);return isNaN(t.getTime())?e:t.toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"})}catch(t){return e}}}},n=r,l=(a("ceed"),a("2877")),c=Object(l["a"])(n,s,o,!1,null,null,null);t["default"]=c.exports},ceed:function(e,t,a){"use strict";a("4e3e")}}]);