(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d0d6713"],{7323:function(e,a,t){"use strict";t.r(a);var s=function(){var e=this,a=e._self._c;return a("div",{staticClass:"patent-search-page"},[a("div",{staticClass:"search-card"},[a("file-search")],1)])},l=[],r=function(){var e=this,a=e._self._c;return a("div",{staticClass:"file-search"},[a("div",{staticClass:"body-part-search"},[a("div",{staticClass:"search-form"},[a("el-form",{ref:"searchForm",attrs:{model:e.searchForm,"label-width":"120px"}},[a("el-row",[a("el-col",{attrs:{span:6}},[a("el-form-item",{attrs:{label:"项目类型"}},[a("el-select",{attrs:{size:"small",placeholder:"请选择",clearable:""},model:{value:e.searchForm.caseType,callback:function(a){e.$set(e.searchForm,"caseType",a)},expression:"searchForm.caseType"}},e._l(e.caseTypeOptions,(function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)],1),a("el-col",{attrs:{span:6}},[a("el-form-item",{attrs:{label:"业务类型"}},[a("el-select",{attrs:{size:"small",placeholder:"请选择",clearable:""},model:{value:e.searchForm.businessType,callback:function(a){e.$set(e.searchForm,"businessType",a)},expression:"searchForm.businessType"}},e._l(e.businessTypeOptions,(function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)],1),a("el-col",{attrs:{span:6}},[a("el-form-item",{attrs:{label:"申请类型"}},[a("el-select",{attrs:{size:"small",placeholder:"请选择",clearable:""},model:{value:e.searchForm.applicationType,callback:function(a){e.$set(e.searchForm,"applicationType",a)},expression:"searchForm.applicationType"}},e._l(e.applicationTypeOptions,(function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)],1),a("el-col",{attrs:{span:6}},[a("el-form-item",{attrs:{label:"申请日"}},[a("el-date-picker",{attrs:{size:"small",type:"daterange","start-placeholder":"年/月/日","end-placeholder":"年/月/日",format:"yyyy/MM/dd","value-format":"yyyy-MM-dd",clearable:""},model:{value:e.searchForm.applicationDateRange,callback:function(a){e.$set(e.searchForm,"applicationDateRange",a)},expression:"searchForm.applicationDateRange"}})],1)],1)],1),a("el-row",[a("el-col",{attrs:{span:6}},[a("el-form-item",{attrs:{label:"客户名称"}},[a("el-input",{attrs:{size:"small",placeholder:"单行输入文本",clearable:""},model:{value:e.searchForm.customerName,callback:function(a){e.$set(e.searchForm,"customerName",a)},expression:"searchForm.customerName"}})],1)],1),a("el-col",{attrs:{span:6}},[a("el-form-item",{attrs:{label:"申请人"}},[a("el-input",{attrs:{size:"small",placeholder:"单行输入文本",clearable:""},model:{value:e.searchForm.applicant,callback:function(a){e.$set(e.searchForm,"applicant",a)},expression:"searchForm.applicant"}})],1)],1),a("el-col",{attrs:{span:6}},[a("el-form-item",{attrs:{label:"项目编号"}},[a("el-input",{attrs:{size:"small",placeholder:"单行输入文本",clearable:""},model:{value:e.searchForm.projectNumber,callback:function(a){e.$set(e.searchForm,"projectNumber",a)},expression:"searchForm.projectNumber"}})],1)],1),a("el-col",{attrs:{span:6}},[a("el-form-item",{attrs:{label:"项目名称"}},[a("el-input",{attrs:{size:"small",placeholder:"单行输入文本",clearable:""},model:{value:e.searchForm.caseName,callback:function(a){e.$set(e.searchForm,"caseName",a)},expression:"searchForm.caseName"}})],1)],1)],1),a("el-row",[a("el-col",{attrs:{span:6}},[a("el-form-item",{attrs:{label:"申请号"}},[a("el-input",{attrs:{size:"small",placeholder:"单行输入文本",clearable:""},model:{value:e.searchForm.applicationNumber,callback:function(a){e.$set(e.searchForm,"applicationNumber",a)},expression:"searchForm.applicationNumber"}})],1)],1),a("el-col",{attrs:{span:6}},[a("el-form-item",{attrs:{label:"注册号"}},[a("el-input",{attrs:{size:"small",placeholder:"单行输入文本",clearable:""},model:{value:e.searchForm.registrationNumber,callback:function(a){e.$set(e.searchForm,"registrationNumber",a)},expression:"searchForm.registrationNumber"}})],1)],1),a("el-col",{attrs:{span:6}},[a("el-form-item",{attrs:{label:"申请国家(地区)"}},[a("el-select",{attrs:{size:"small",placeholder:"请选择",clearable:""},model:{value:e.searchForm.applicationCountry,callback:function(a){e.$set(e.searchForm,"applicationCountry",a)},expression:"searchForm.applicationCountry"}},e._l(e.countryOptions,(function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)],1),a("el-col",{attrs:{span:6}},[a("el-form-item",{attrs:{label:"项目流向"}},[a("el-select",{attrs:{size:"small",placeholder:"请选择",clearable:""},model:{value:e.searchForm.caseFlow,callback:function(a){e.$set(e.searchForm,"caseFlow",a)},expression:"searchForm.caseFlow"}},e._l(e.caseFlowOptions,(function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)],1),a("el-col",{attrs:{span:6}},[a("el-form-item",{attrs:{label:"来文名称"}},[a("el-select",{attrs:{size:"small",placeholder:"请选择",clearable:""},model:{value:e.searchForm.documentName,callback:function(a){e.$set(e.searchForm,"documentName",a)},expression:"searchForm.documentName"}},e._l(e.documentNameOptions,(function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)],1),a("el-col",{attrs:{span:6}},[a("el-form-item",{attrs:{label:"业务人员"}},[a("el-select",{attrs:{size:"small",placeholder:"后台预先选人",clearable:""},model:{value:e.searchForm.businessStaff,callback:function(a){e.$set(e.searchForm,"businessStaff",a)},expression:"searchForm.businessStaff"}},e._l(e.staffOptions,(function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)],1),a("el-col",{attrs:{span:6}},[a("el-form-item",{attrs:{label:"技术主导"}},[a("el-select",{attrs:{size:"small",placeholder:"后台预先选人",clearable:""},model:{value:e.searchForm.processStaff,callback:function(a){e.$set(e.searchForm,"processStaff",a)},expression:"searchForm.processStaff"}},e._l(e.staffOptions,(function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)],1),a("el-col",{attrs:{span:6}},[a("el-form-item",{attrs:{label:"上传日期"}},[a("el-date-picker",{attrs:{size:"small",type:"daterange","start-placeholder":"年/月/日","end-placeholder":"年/月/日",format:"yyyy/MM/dd","value-format":"yyyy-MM-dd",clearable:""},model:{value:e.searchForm.uploadDateRange,callback:function(a){e.$set(e.searchForm,"uploadDateRange",a)},expression:"searchForm.uploadDateRange"}})],1)],1)],1),a("el-row",[a("el-col",{attrs:{span:6}},[a("el-form-item",{attrs:{label:"发文日"}},[a("el-date-picker",{attrs:{size:"small",type:"daterange","start-placeholder":"年/月/日","end-placeholder":"年/月/日",format:"yyyy/MM/dd","value-format":"yyyy-MM-dd",clearable:""},model:{value:e.searchForm.sendDateRange,callback:function(a){e.$set(e.searchForm,"sendDateRange",a)},expression:"searchForm.sendDateRange"}})],1)],1),a("el-col",{attrs:{span:6}},[a("el-form-item",{attrs:{label:"收文日"}},[a("el-date-picker",{attrs:{size:"small",type:"daterange","start-placeholder":"年/月/日","end-placeholder":"年/月/日",format:"yyyy/MM/dd","value-format":"yyyy-MM-dd",clearable:""},model:{value:e.searchForm.receiveDateRange,callback:function(a){e.$set(e.searchForm,"receiveDateRange",a)},expression:"searchForm.receiveDateRange"}})],1)],1)],1)],1),a("div",{staticClass:"part-search-buttons"},[a("el-button",{attrs:{size:"small",type:"primary"},on:{click:e.handleSearch}},[e._v("查询")]),a("el-button",{attrs:{size:"small"},on:{click:e.handleReset}},[e._v("重置")])],1)],1)]),a("div",{staticClass:"body-part-content"},[a("div",{staticClass:"part-table-header"},[e._m(0),a("div",{staticClass:"part-table-operations"},[a("el-button",{attrs:{size:"small"},on:{click:e.handleExport}},[e._v("导出")]),a("el-button",{attrs:{size:"small"},on:{click:e.handleDownload}},[e._v("下载")])],1)]),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.tableLoading,expression:"tableLoading"}],staticStyle:{width:"100%"},attrs:{data:e.tableData,border:"",size:"small"},on:{"selection-change":e.handleSelectionChange}},[a("el-table-column",{attrs:{type:"selection",width:"55",align:"center"}}),a("el-table-column",{attrs:{prop:"index",label:"序号",width:"80",align:"center"}}),a("el-table-column",{attrs:{prop:"ourFileNumber",label:"项目编号","min-width":"120","show-overflow-tooltip":""}}),a("el-table-column",{attrs:{prop:"customerName",label:"客户名称","min-width":"120","show-overflow-tooltip":""}}),e.isTrademark?a("el-table-column",{attrs:{prop:"registrationNumber",label:"注册号","min-width":"140","show-overflow-tooltip":""}}):a("el-table-column",{attrs:{prop:"applicationNumber",label:"申请号","min-width":"140","show-overflow-tooltip":""}}),a("el-table-column",{attrs:{prop:"caseName",label:"项目名称","min-width":"160","show-overflow-tooltip":""}}),a("el-table-column",{attrs:{prop:"applicationType",label:"申请类型",width:"100"}}),a("el-table-column",{attrs:{prop:"applicant",label:"申请人","min-width":"120","show-overflow-tooltip":""}}),a("el-table-column",{attrs:{prop:"technicalLead",label:"技术主导",width:"100"}}),a("el-table-column",{attrs:{prop:"documentName",label:"来文名称","min-width":"140","show-overflow-tooltip":""}}),e.isTrademark?a("el-table-column",{attrs:{prop:"receiveDate",label:"收文日",width:"100",align:"center"}}):a("el-table-column",{attrs:{prop:"sendDate",label:"发文日",width:"100",align:"center"}}),a("el-table-column",{attrs:{prop:"businessStaff",label:"业务人员",width:"100"}}),a("el-table-column",{attrs:{prop:"applicationDate",label:"申请日",width:"100",align:"center"}}),e.isTrademark?a("el-table-column",{attrs:{prop:"trademarkCategory",label:"商标类别",width:"100"}}):e._e(),a("el-table-column",{attrs:{label:"文件",width:"120",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{size:"small",type:"text"},on:{click:function(a){return e.handleFile(t.row)}}},[e._v("下载")])]}}])}),a("el-table-column",{attrs:{label:"操作",width:"120",align:"center",fixed:"right"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{size:"small",type:"text"},on:{click:function(a){return e.handleView(t.row)}}},[e._v("查看")])]}}])})],1),a("div",{staticClass:"pagination-wrapper"},[a("el-pagination",{attrs:{"current-page":e.pagination.currentPage,"page-sizes":[10,20,50,100],"page-size":e.pagination.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:e.pagination.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1)],1),a("el-dialog",{attrs:{title:"列筛选",visible:e.showColumnFilter,width:"600px"},on:{"update:visible":function(a){e.showColumnFilter=a},close:e.handleColumnFilterClose}},[a("div",{staticClass:"column-filter"},[a("el-checkbox-group",{model:{value:e.selectedColumns,callback:function(a){e.selectedColumns=a},expression:"selectedColumns"}},[a("el-row",e._l(e.hiddenColumnOptions,(function(t){return a("el-col",{key:t.key,attrs:{span:6}},[a("el-checkbox",{attrs:{label:t.key}},[e._v(e._s(t.label))])],1)})),1)],1)],1),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(a){e.showColumnFilter=!1}}},[e._v("取 消")]),a("el-button",{attrs:{size:"small",type:"primary"},on:{click:e.handleColumnFilterConfirm}},[e._v("确 定")])],1)])],1)},o=[function(){var e=this,a=e._self._c;return a("div",{staticClass:"part-table-title"},[a("span",[e._v("文件管理")])])}],i=(t("e9f5"),t("910d"),t("7d54"),t("ab43"),t("88a7"),t("271a"),t("5494"),{name:"FileSearch",data(){return{tableLoading:!1,showColumnFilter:!1,selectedColumns:[],searchForm:{customerName:"",applicant:"",ourFileNumber:"",applicationNumber:"",registrationNumber:"",caseName:"",applicationDateRange:[],applicationDateEmpty:!1,caseType:"",businessType:"",applicationType:"",applicationCountry:"",caseFlow:"",businessStaff:"",documentName:"",processStaff:"",sendDateRange:[],sendDateEmpty:!1,receiveDateRange:[],receiveDateEmpty:!1,importDateRange:[],importDateEmpty:!1},visibleColumns:{caseStatus:!1,caseRemarks:!1,technicalLead:!1,caseHandler:!1,proposalName:!1,presalesSupport:!1,openDate:!1,handlingDepartment:!1,businessAssistant:!1,caseCoefficient:!1,businessStaffDepartment:!1,leadDepartment:!1,customField1:!1,customField2:!1,customField3:!1,customField4:!1,customField5:!1,hasTechnicalDisclosure:!1,agencyName:!1,agentName:!1,priorityNumber:!1,priorityDate:!1,doubleReport:!1},hiddenColumnOptions:[{key:"caseStatus",label:"项目状态"},{key:"caseRemarks",label:"项目备注"},{key:"technicalLead",label:"技术主导"},{key:"caseHandler",label:"项目处理人"},{key:"proposalName",label:"提案名称"},{key:"presalesSupport",label:"售前支持"},{key:"openDate",label:"开卷日期"},{key:"handlingDepartment",label:"承办部门"},{key:"businessAssistant",label:"业务助理"},{key:"caseCoefficient",label:"项目系数"},{key:"businessStaffDepartment",label:"业务人员部门"},{key:"leadDepartment",label:"主导人部门"},{key:"customField1",label:"自定义字段1"},{key:"customField2",label:"自定义字段2"},{key:"customField3",label:"自定义字段3"},{key:"customField4",label:"自定义字段4"},{key:"customField5",label:"自定义字段5"},{key:"hasTechnicalDisclosure",label:"有无技术交底书"},{key:"agencyName",label:"代理机构名称"},{key:"agentName",label:"代理师姓名"},{key:"priorityNumber",label:"优先权号"},{key:"priorityDate",label:"优先权日"},{key:"doubleReport",label:"双报"}],caseTypeOptions:[],businessTypeOptions:[],applicationTypeOptions:[],countryOptions:[],caseFlowOptions:[],staffOptions:[],documentNameOptions:[],caseStatusOptions:[],departmentOptions:[],tableData:[],selectedRows:[],pagination:{currentPage:1,pageSize:20,total:0}}},mounted(){this.initOptions(),this.fetchData()},computed:{isTrademark(){return"trademark"===this.searchForm.caseType}},methods:{async initOptions(){try{const[e,a,t,s,l,r,o]=await Promise.all([this.$api.search.getFileOptions("case_types"),this.$api.search.getFileOptions("business_types"),this.$api.search.getFileOptions("application_types"),this.$api.search.getFileOptions("countries"),this.$api.search.getFileOptions("case_flows"),this.$api.search.getFileOptions("staff"),this.$api.search.getFileOptions("document_names")]);e.data.success&&(this.caseTypeOptions=e.data.data),a.data.success&&(this.businessTypeOptions=a.data.data),t.data.success&&(this.applicationTypeOptions=t.data.data),s.data.success&&(this.countryOptions=s.data.data),l.data.success&&(this.caseFlowOptions=l.data.data),r.data.success&&(this.staffOptions=r.data.data),o.data.success&&(this.documentNameOptions=o.data.data)}catch(e){console.error("获取选项数据失败:",e),this.$message.error("获取选项数据失败")}},handleSearch(){this.pagination.currentPage=1,this.fetchData()},handleReset(){this.$refs.searchForm.resetFields(),Object.keys(this.searchForm).forEach(e=>{Array.isArray(this.searchForm[e])?this.searchForm[e]=[]:this.searchForm[e]=""}),this.fetchData()},async handleExport(){try{if(0===this.selectedRows.length)return void this.$message.warning("请先选择要导出的数据");const e={search_params:{case_type:this.searchForm.caseType,business_type:this.searchForm.businessType,application_type:this.searchForm.applicationType,customer_name:this.searchForm.customerName,applicant:this.searchForm.applicant,project_number:this.searchForm.projectNumber,case_name:this.searchForm.caseName,application_number:this.searchForm.applicationNumber,registration_number:this.searchForm.registrationNumber,application_country:this.searchForm.applicationCountry,case_flow:this.searchForm.caseFlow,document_name:this.searchForm.documentName,business_staff:this.searchForm.businessStaff,process_staff:this.searchForm.processStaff,application_date_range:this.searchForm.applicationDateRange,upload_date_range:this.searchForm.uploadDateRange,send_date_range:this.searchForm.sendDateRange,receive_date_range:this.searchForm.receiveDateRange},selected_ids:this.selectedRows.map(e=>e.id)},a=await this.$api.search.exportFiles(e),t=new Blob([a.data],{type:"text/csv;charset=utf-8"}),s=window.URL.createObjectURL(t),l=document.createElement("a");l.href=s,l.download=`文件管理导出_${(new Date).toISOString().slice(0,10)}.csv`,document.body.appendChild(l),l.click(),document.body.removeChild(l),window.URL.revokeObjectURL(s),this.$message.success("导出成功")}catch(a){var e;console.error("导出失败:",a),this.$message.error("导出失败："+((null===(e=a.response)||void 0===e||null===(e=e.data)||void 0===e?void 0:e.message)||a.message))}},async handleDownload(){try{if(0===this.selectedRows.length)return void this.$message.warning("请先选择要下载的文件");const e=this.selectedRows.map(e=>e.fileId).filter(e=>e);if(0===e.length)return void this.$message.warning("所选项目中没有可下载的文件");const a=await this.$api.search.batchDownloadFiles({file_ids:e});a.data.success?this.$message.success(a.data.message):this.$message.error(a.data.message||"批量下载失败")}catch(a){var e;console.error("批量下载失败:",a),this.$message.error("批量下载失败："+((null===(e=a.response)||void 0===e||null===(e=e.data)||void 0===e?void 0:e.message)||a.message))}},handleColumnFilterConfirm(){this.selectedColumns.forEach(e=>{this.$set(this.visibleColumns,e,!0)}),Object.keys(this.visibleColumns).forEach(e=>{this.selectedColumns.includes(e)||this.$set(this.visibleColumns,e,!1)}),this.showColumnFilter=!1},handleColumnFilterClose(){this.selectedColumns=Object.keys(this.visibleColumns).filter(e=>this.visibleColumns[e])},async fetchData(){this.tableLoading=!0;try{const e={case_type:this.searchForm.caseType,business_type:this.searchForm.businessType,application_type:this.searchForm.applicationType,customer_name:this.searchForm.customerName,applicant:this.searchForm.applicant,project_number:this.searchForm.projectNumber,case_name:this.searchForm.caseName,application_number:this.searchForm.applicationNumber,registration_number:this.searchForm.registrationNumber,application_country:this.searchForm.applicationCountry,case_flow:this.searchForm.caseFlow,document_name:this.searchForm.documentName,business_staff:this.searchForm.businessStaff,process_staff:this.searchForm.processStaff,application_date_range:this.searchForm.applicationDateRange,upload_date_range:this.searchForm.uploadDateRange,send_date_range:this.searchForm.sendDateRange,receive_date_range:this.searchForm.receiveDateRange,page:this.pagination.currentPage,limit:this.pagination.pageSize};Object.keys(e).forEach(a=>{""!==e[a]&&null!==e[a]&&void 0!==e[a]||delete e[a],Array.isArray(e[a])&&0===e[a].length&&delete e[a]});const a=await this.$api.search.searchFiles(e);a.data.success?(this.tableData=a.data.data.list,this.pagination.total=a.data.data.total,this.pagination.currentPage=a.data.data.current_page,this.pagination.pageSize=a.data.data.per_page):this.$message.error(a.data.message||"查询失败"),this.tableLoading=!1}catch(a){var e;console.error("查询失败:",a),this.$message.error("查询失败："+((null===(e=a.response)||void 0===e||null===(e=e.data)||void 0===e?void 0:e.message)||a.message)),this.tableLoading=!1}},handleSelectionChange(e){this.selectedRows=e},handleSizeChange(e){this.pagination.pageSize=e,this.fetchData()},handleCurrentChange(e){this.pagination.currentPage=e,this.fetchData()},handleView(e){this.$message.info("查看详情："+e.caseName)},handleEdit(e){this.$message.info("编辑项目："+e.caseName)},async handleFile(e){try{if(!e.fileId)return void this.$message.warning("暂无文件");const a=await this.$api.search.downloadFile(e.fileId),t=a.headers["content-disposition"];let s=e.caseName||e.documentName||"文件";if(t){const e=t.match(/filename[^;=\n]*=((['"]).*?\2|[^;\n]*)/);e&&e[1]&&(s=e[1].replace(/['"]/g,""))}const l=new Blob([a.data]),r=window.URL.createObjectURL(l),o=document.createElement("a");o.href=r,o.download=s,document.body.appendChild(o),o.click(),document.body.removeChild(o),window.URL.revokeObjectURL(r),this.$message.success("开始下载："+s)}catch(t){var a;console.error("文件下载失败:",t),this.$message.error("文件下载失败："+((null===(a=t.response)||void 0===a||null===(a=a.data)||void 0===a?void 0:a.message)||t.message))}}}}),n=i,c=t("2877"),p=Object(c["a"])(n,r,o,!1,null,"40353282",null),m=p.exports,h={name:"FileSearchPage",components:{FileSearch:m}},d=h,u=Object(c["a"])(d,s,l,!1,null,"eca20914",null);a["default"]=u.exports}}]);