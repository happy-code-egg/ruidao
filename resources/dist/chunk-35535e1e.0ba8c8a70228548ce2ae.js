(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-35535e1e"],{"01a7":function(e,t,a){},7457:function(e,t,a){"use strict";a("01a7")},cf66:function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e._self._c;return t("div",{staticClass:"log-management"},[t("div",{staticClass:"body-part-search"},[t("el-form",{staticClass:"demo-form-inline",attrs:{inline:!0,model:e.searchForm}},[t("el-form-item",{attrs:{label:"操作人"}},[t("el-input",{attrs:{size:"small",placeholder:"操作人"},model:{value:e.searchForm.username,callback:function(t){e.$set(e.searchForm,"username",t)},expression:"searchForm.username"}})],1),t("el-form-item",{attrs:{label:"操作类型"}},[t("el-select",{attrs:{size:"small",placeholder:"请选择"},model:{value:e.searchForm.type,callback:function(t){e.$set(e.searchForm,"type",t)},expression:"searchForm.type"}},[t("el-option",{attrs:{label:"全部",value:""}}),t("el-option",{attrs:{label:"登录",value:"LOGIN"}}),t("el-option",{attrs:{label:"退出",value:"LOGOUT"}}),t("el-option",{attrs:{label:"新增",value:"INSERT"}}),t("el-option",{attrs:{label:"修改",value:"UPDATE"}}),t("el-option",{attrs:{label:"删除",value:"DELETE"}}),t("el-option",{attrs:{label:"导出",value:"EXPORT"}}),t("el-option",{attrs:{label:"导入",value:"IMPORT"}}),t("el-option",{attrs:{label:"其他",value:"OTHER"}})],1)],1),t("el-form-item",{attrs:{label:"状态"}},[t("el-select",{attrs:{size:"small",placeholder:"请选择"},model:{value:e.searchForm.status,callback:function(t){e.$set(e.searchForm,"status",t)},expression:"searchForm.status"}},[t("el-option",{attrs:{label:"全部",value:""}}),t("el-option",{attrs:{label:"成功",value:"1"}}),t("el-option",{attrs:{label:"失败",value:"0"}})],1)],1),t("el-form-item",{attrs:{label:"操作时间"}},[t("el-date-picker",{attrs:{type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",size:"small","value-format":"yyyy-MM-dd"},model:{value:e.searchForm.dateRange,callback:function(t){e.$set(e.searchForm,"dateRange",t)},expression:"searchForm.dateRange"}})],1),t("el-form-item",[t("el-button",{attrs:{size:"small",type:"primary"},on:{click:e.handleSearch}},[e._v("查询")]),t("el-button",{attrs:{size:"small"},on:{click:e.resetSearch}},[e._v("重置")])],1)],1)],1),t("div",{staticClass:"body-part-content"},[t("div",{staticClass:"part-table-header"},[e._m(0),t("div",{staticClass:"part-table-operations"},[t("el-button",{attrs:{size:"small",type:"danger",disabled:0===e.selectedLogs.length},on:{click:e.handleClear}},[e._v("清空日志")]),t("el-button",{attrs:{size:"small",type:"primary"},on:{click:e.handleExport}},[e._v("导出")])],1)]),t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{data:e.logList,border:"",size:"small"},on:{"selection-change":e.handleSelectionChange}},[t("el-table-column",{attrs:{align:"center",type:"selection",width:"80"}}),t("el-table-column",{attrs:{align:"center",prop:"id",label:"日志编号",width:"80"}}),t("el-table-column",{attrs:{align:"center",prop:"title",label:"操作模块",width:"120"}}),t("el-table-column",{attrs:{align:"center",prop:"type",label:"操作类型",width:"100"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-tag",{attrs:{type:e.getTypeTagType(a.row.type)}},[e._v(e._s(e.getTypeName(a.row.type)))])]}}])}),t("el-table-column",{attrs:{align:"center",prop:"method",label:"请求方法"}}),t("el-table-column",{attrs:{align:"center",prop:"requestMethod",label:"请求方式",width:"100"}}),t("el-table-column",{attrs:{align:"center",prop:"username",label:"操作人",width:"120"}}),t("el-table-column",{attrs:{align:"center",prop:"ip",label:"操作IP",width:"120"}}),t("el-table-column",{attrs:{align:"center",prop:"location",label:"操作地点",width:"150"}}),t("el-table-column",{attrs:{align:"center",prop:"status",label:"操作状态",width:"100"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-tag",{attrs:{type:1===a.row.status?"success":"danger"}},[e._v(" "+e._s(1===a.row.status?"成功":"失败")+" ")])]}}])}),t("el-table-column",{attrs:{align:"center",prop:"operTime",label:"操作时间",width:"180"}}),t("el-table-column",{attrs:{align:"center",label:"操作",width:"200",fixed:"right"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(t){return e.handleViewDetail(a.row)}}},[e._v("详情")]),t("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(t){return e.handleDelete(a.row)}}},[e._v("删除")])]}}])})],1),t("div",{staticClass:"pagination-container"},[t("el-pagination",{attrs:{"current-page":e.currentPage,"page-sizes":[10,20,50,100],"page-size":e.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1)],1),t("el-dialog",{attrs:{title:"日志详情",visible:e.detailVisible,width:"700px","append-to-body":"","close-on-click-modal":!1},on:{"update:visible":function(t){e.detailVisible=t}}},[t("el-descriptions",{attrs:{column:2,border:""}},[t("el-descriptions-item",{attrs:{label:"日志编号"}},[e._v(e._s(e.currentLog.id))]),t("el-descriptions-item",{attrs:{label:"操作模块"}},[e._v(e._s(e.currentLog.title))]),t("el-descriptions-item",{attrs:{label:"操作类型"}},[t("el-tag",{attrs:{type:e.getTypeTagType(e.currentLog.type)}},[e._v(e._s(e.getTypeName(e.currentLog.type)))])],1),t("el-descriptions-item",{attrs:{label:"操作人"}},[e._v(e._s(e.currentLog.username))]),t("el-descriptions-item",{attrs:{label:"操作IP"}},[e._v(e._s(e.currentLog.ip))]),t("el-descriptions-item",{attrs:{label:"操作地点"}},[e._v(e._s(e.currentLog.location))]),t("el-descriptions-item",{attrs:{label:"操作状态"}},[t("el-tag",{attrs:{type:1===e.currentLog.status?"success":"danger"}},[e._v(" "+e._s(1===e.currentLog.status?"成功":"失败")+" ")])],1),t("el-descriptions-item",{attrs:{label:"操作时间"}},[e._v(e._s(e.currentLog.operTime))]),t("el-descriptions-item",{attrs:{label:"请求方法",span:2}},[e._v(e._s(e.currentLog.method))]),t("el-descriptions-item",{attrs:{label:"请求地址",span:2}},[e._v(e._s(e.currentLog.url))])],1),t("div",{staticClass:"detail-section"},[t("div",{staticClass:"section-title"},[e._v("请求参数")]),t("div",{staticClass:"code-block"},[t("pre",[e._v(e._s(e.formatJson(e.currentLog.requestParam)))])])]),0===e.currentLog.status?t("div",{staticClass:"detail-section"},[t("div",{staticClass:"section-title"},[e._v("异常信息")]),t("div",{staticClass:"code-block error"},[t("pre",[e._v(e._s(e.currentLog.errorMsg))])])]):t("div",{staticClass:"detail-section"},[t("div",{staticClass:"section-title"},[e._v("返回结果")]),t("div",{staticClass:"code-block"},[t("pre",[e._v(e._s(e.formatJson(e.currentLog.jsonResult)))])])]),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.detailVisible=!1}}},[e._v("关 闭")])],1)],1)],1)},r=[function(){var e=this,t=e._self._c;return t("div",{staticClass:"part-table-title"},[t("span",[e._v("系统日志")])])}],l=(a("14d9"),a("e9f5"),a("910d"),a("ab43"),a("88a7"),a("271a"),a("5494"),{name:"LogManagement",data(){return{searchForm:{username:"",type:"",status:"",dateRange:[]},logList:[],loading:!1,currentPage:1,pageSize:10,total:0,selectedLogs:[],detailVisible:!1,currentLog:{}}},created(){this.fetchData()},methods:{async fetchData(){this.loading=!0;try{const e={page:this.currentPage,limit:this.pageSize,keyword:this.searchForm.username,type:this.getTypeNumber(this.searchForm.type)};this.searchForm.dateRange&&2===this.searchForm.dateRange.length&&(e.start_date=this.searchForm.dateRange[0],e.end_date=this.searchForm.dateRange[1]);const t=await this.$api.log.getList(e);0===t.data.code?(this.logList=t.data.data.map(e=>({id:e.id,title:e.content||"系统操作",type:this.getTypeCode(e.type),method:"System Operation",requestMethod:"POST",username:e.user?e.user.username:"System",ip:e.ip_address||"127.0.0.1",location:"内网IP",status:1,operTime:e.created_at,url:"/api/system",requestParam:JSON.stringify(e.request_param),jsonResult:JSON.stringify(e.json_result),errorMsg:8===e.type?e.content:""})),this.total=t.data.count||0):(this.$message.error(t.data.msg||"获取日志列表失败"),this.fetchDataMock())}catch(e){console.error("获取日志列表失败:",e),this.$message.error("获取日志列表失败，使用模拟数据"),this.fetchDataMock()}finally{this.loading=!1}},getTypeCode(e){const t={0:"OTHER",1:"INSERT",2:"UPDATE",3:"DELETE",4:"LOGIN",5:"LOGOUT",6:"EXPORT",7:"IMPORT",8:"ERROR"};return t[e]||"OTHER"},getTypeNumber(e){const t={OTHER:0,INSERT:1,UPDATE:2,DELETE:3,LOGIN:4,LOGOUT:5,EXPORT:6,IMPORT:7,ERROR:8};return t[e]||null},fetchDataMock(){const e=[],t=["LOGIN","LOGOUT","INSERT","UPDATE","DELETE","EXPORT","IMPORT","OTHER"],a=["用户管理","角色管理","权限管理","部门管理","系统设置","客户管理","合同管理","财务管理"],s=["com.example.controller.UserController.list","com.example.controller.RoleController.add","com.example.controller.PermissionController.update","com.example.controller.DepartmentController.delete","com.example.controller.SystemController.config","com.example.controller.LoginController.login","com.example.controller.LoginController.logout"],r=["GET","POST","PUT","DELETE"],l=["admin","zhangsan","lisi","wangwu","zhaoliu"],o=["192.168.1.1","192.168.1.2","192.168.1.3","192.168.1.4","127.0.0.1"],n=["北京市","上海市","广州市","深圳市","杭州市","内网IP"];for(let d=1;d<=100;d++){const i=t[Math.floor(Math.random()*t.length)],c=Math.random()>.1?1:0,h=new Date;h.setDate(h.getDate()-Math.floor(30*Math.random())),e.push({id:1e4+d,title:a[Math.floor(Math.random()*a.length)],type:i,method:s[Math.floor(Math.random()*s.length)],requestMethod:r[Math.floor(Math.random()*r.length)],username:l[Math.floor(Math.random()*l.length)],ip:o[Math.floor(Math.random()*o.length)],location:n[Math.floor(Math.random()*n.length)],status:c,operTime:this.formatDate(h),url:"/api/"+i.toLowerCase(),requestParam:JSON.stringify({id:Math.floor(1e3*Math.random()),name:"test"+Math.floor(100*Math.random()),value:Math.random().toString(36).substring(2)}),jsonResult:1===c?JSON.stringify({code:200,msg:"操作成功",data:{id:Math.floor(1e3*Math.random()),result:Math.random()>.5?"success":"partial success"}}):"",errorMsg:0===c?"java.lang.NullPointerException: 空指针异常\n\tat com.example.service.impl.UserServiceImpl.getUser(UserServiceImpl.java:42)\n\tat com.example.controller.UserController.getUser(UserController.java:25)":""})}let i=[...e];if(this.searchForm.username&&(i=i.filter(e=>e.username.toLowerCase().includes(this.searchForm.username.toLowerCase()))),this.searchForm.type&&(i=i.filter(e=>e.type===this.searchForm.type)),""!==this.searchForm.status&&(i=i.filter(e=>e.status===parseInt(this.searchForm.status))),this.searchForm.dateRange&&2===this.searchForm.dateRange.length){const e=new Date(this.searchForm.dateRange[0]).getTime(),t=new Date(this.searchForm.dateRange[1]+" 23:59:59").getTime();i=i.filter(a=>{const s=new Date(a.operTime).getTime();return s>=e&&s<=t})}i.sort((e,t)=>new Date(t.operTime).getTime()-new Date(e.operTime).getTime());const c=(this.currentPage-1)*this.pageSize,h=c+this.pageSize;this.logList=i.slice(c,h),this.total=i.length},formatDate(e){const t=e.getFullYear(),a=String(e.getMonth()+1).padStart(2,"0"),s=String(e.getDate()).padStart(2,"0"),r=String(e.getHours()).padStart(2,"0"),l=String(e.getMinutes()).padStart(2,"0"),o=String(e.getSeconds()).padStart(2,"0");return`${t}-${a}-${s} ${r}:${l}:${o}`},formatJson(e){if(!e)return"";try{const t=JSON.parse(e);return JSON.stringify(t,null,2)}catch(t){return e}},getTypeName(e){switch(e){case"LOGIN":return"登录";case"LOGOUT":return"退出";case"INSERT":return"新增";case"UPDATE":return"修改";case"DELETE":return"删除";case"EXPORT":return"导出";case"IMPORT":return"导入";case"OTHER":return"其他";default:return"未知"}},getTypeTagType(e){switch(e){case"LOGIN":return"success";case"LOGOUT":return"info";case"INSERT":return"primary";case"UPDATE":return"warning";case"DELETE":return"danger";case"EXPORT":return"success";case"IMPORT":return"warning";case"OTHER":return"info";default:return"info"}},handleSearch(){this.currentPage=1,this.fetchData()},resetSearch(){this.searchForm={username:"",type:"",status:"",dateRange:[]},this.handleSearch()},handleSelectionChange(e){this.selectedLogs=e},handleViewDetail(e){this.currentLog={...e},this.detailVisible=!0},async handleDelete(e){this.$confirm("确认删除该日志记录吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{const t=await this.$api.log.delete(e.id);0===t.data.code?(this.$message.success("删除成功!"),this.fetchData()):this.$message.error(t.data.msg||"删除失败")}catch(t){console.error("删除日志失败:",t),this.$message.error("删除失败，请稍后重试")}}).catch(()=>{this.$message.info("已取消删除")})},async handleClear(){if(0===this.selectedLogs.length)return void this.$message.warning("请至少选择一条日志记录");const e=this.selectedLogs.length===this.logList.length?"确认清空所有日志记录吗?":`确认清空已选择的 ${this.selectedLogs.length} 条日志记录吗?`;this.$confirm(e,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{let e;if(this.selectedLogs.length===this.logList.length)e=await this.$api.log.clear();else{const t=this.selectedLogs.map(e=>e.id);e=await this.$api.log.batchDelete({ids:t})}0===e.data.code?(this.$message.success("清空成功!"),this.selectedLogs=[],this.fetchData()):this.$message.error(e.data.msg||"清空失败")}catch(e){console.error("清空日志失败:",e),this.$message.error("清空失败，请稍后重试")}}).catch(()=>{this.$message.info("已取消清空")})},async handleExport(){try{const e={keyword:this.searchForm.username,type:this.getTypeNumber(this.searchForm.type)};this.searchForm.dateRange&&2===this.searchForm.dateRange.length&&(e.start_date=this.searchForm.dateRange[0],e.end_date=this.searchForm.dateRange[1]);const t=await this.$api.log.export(e),a=new Blob([t.data],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),s=window.URL.createObjectURL(a),r=document.createElement("a");r.href=s,r.download=`系统日志_${(new Date).toISOString().slice(0,10)}.xlsx`,document.body.appendChild(r),r.click(),document.body.removeChild(r),window.URL.revokeObjectURL(s),this.$message.success("日志导出成功!")}catch(e){console.error("导出日志失败:",e),this.$message.error("导出失败，请稍后重试")}},handleSizeChange(e){this.pageSize=e,this.fetchData()},handleCurrentChange(e){this.currentPage=e,this.fetchData()}}}),o=l,n=(a("7457"),a("2877")),i=Object(n["a"])(o,s,r,!1,null,null,null);t["default"]=i.exports}}]);